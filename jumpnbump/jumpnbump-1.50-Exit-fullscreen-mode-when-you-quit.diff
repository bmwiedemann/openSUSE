From 568f2432f3de8ef5d3fea76313fef78f813534c2 Mon Sep 17 00:00:00 2001
From: Ansgar Burchardt <ansgar-guest@alioth.debian.org>
Date: Mon, 8 Dec 2008 01:23:07 +0100
Subject: [PATCH 1/8] Exit fullscreen mode when you quit

see http://bugs.debian.org/338705
---
 globals.pre |    1 +
 main.c      |    1 +
 sdl/gfx.c   |    5 +++++
 3 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/globals.h b/globals.h
index 87c5506..babf59a 100644
--- a/globals.h
+++ b/globals.h
@@ -344,6 +344,7 @@ void register_mask(void *pixels);
 #ifdef USE_SDL
 /* long filelength(int handle); */
 void fs_toggle();
+void exit_fullscreen();
 int intr_sysupdate();
 #endif
 
diff --git a/main.c b/main.c
index 6efdd04..76c9463 100644
--- a/main.c
+++ b/main.c
@@ -3338,6 +3338,7 @@ void deinit_program(void)
 		free(mask_pic);
 
 	remove_keyb_handler();
+	exit_fullscreen();
 
 #ifdef DOS
 	regs.x.ax = 0x3;
diff --git a/sdl/gfx.c b/sdl/gfx.c
index 9585632..4cea7e5 100644
--- a/sdl/gfx.c
+++ b/sdl/gfx.c
@@ -226,6 +226,11 @@ void fs_toggle()
 		fullscreen ^= 1;
 }
 
+void exit_fullscreen()
+{
+	if (fullscreen)
+		fs_toggle();
+}
 
 void wait_vrt(int mix)
 {
-- 
1.6.2.1

