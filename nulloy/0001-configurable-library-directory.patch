From d3534e7f60842365542ab39d3f26f85fdccbba0c Mon Sep 17 00:00:00 2001
From: Sergey Vlasov <sergey@vlasov.me>
Date: Fri, 17 May 2019 15:14:25 +0000
Subject: [PATCH] configurable library directory

---
 configure              | 9 ++++++++-
 nulloy.desktop         | 2 +-
 src/pluginLoader.cpp   | 2 +-
 src/plugins/plugin.pri | 2 +-
 src/src.pro            | 1 +
 5 files changed, 12 insertions(+), 4 deletions(-)

Index: nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda/configure
===================================================================
--- nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda.orig/configure	2019-01-03 01:47:17.000000000 +0200
+++ nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda/configure	2019-05-18 10:05:29.953428079 +0200
@@ -3,6 +3,7 @@
 BASENAME=$(basename $0)
 CWD=$(dirname $0)
 PREFIX=/usr
+LIBDIR=lib
 DEBUG=no
 APP_NAME=nulloy
 
@@ -30,7 +31,8 @@ echo_help() {
     echo '    --no-skins                  disable skins support'
     echo '    --force-version VERSION     overrides version.pri'
     echo '    --no-update-check           disable online check functionality'
-    echo '    --prefix PREFIX             installation prefix (ignored on Mac)'
+    echo '    --prefix PREFIX             installation prefix (default: /usr, ignored on Mac)'
+    echo '    --libdir LIBDIR             library directory under prefix (default: lib)'
     echo '    --debug                     build in debug mode'
     echo '    --tests                     build unit tests'
 }
@@ -44,7 +46,7 @@ while test $# -gt 0; do
     case "$1" in
         --prefix)
             shift
-            if command -v realpath &> /dev/null && -d $(dirname "$1"); then
+            if command -v realpath &> /dev/null && [ -d $(dirname "$1") ]; then
                 PREFIX=$(realpath "$1")
             else
                 PREFIX=$(readlink -m "$1")
@@ -68,6 +70,8 @@ while test $# -gt 0; do
             BUILD_TESTS=yes ;;
         --no-skins)
             SUPPORT_SKINS=no ;;
+        --libdir)
+            shift; LIBDIR=$1 ;;
         --no-update-check)
             UPDATE_CHECK=no ;;
         --help|-h)
@@ -164,6 +168,9 @@ else
 fi
 echo "PREFIX = $PREFIX" >> $QMAKE_CACHE
 
+echo "N_LIBDIR = $LIBDIR" >> $QMAKE_CACHE
+echo "Library directory: $LIBDIR"
+
 echo "N_CONFIG_SUCCESS = yes" >> $QMAKE_CACHE
 
 echo
Index: nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda/nulloy.desktop
===================================================================
--- nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda.orig/nulloy.desktop	2019-01-03 01:47:17.000000000 +0200
+++ nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda/nulloy.desktop	2019-05-18 09:55:34.378262401 +0200
@@ -10,7 +10,7 @@ MimeType=x-content/audio-player;audio/ba
 Icon=nulloy
 Exec=nulloy %F
 
-Actions=PlayPause;Stop;Next;Previous
+Actions=PlayPause;Stop;Next;Previous;
 
 [Desktop Action PlayPause]
 Name=Play / Pause
Index: nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda/src/pluginLoader.cpp
===================================================================
--- nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda.orig/src/pluginLoader.cpp	2019-01-03 01:47:17.000000000 +0200
+++ nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda/src/pluginLoader.cpp	2019-05-18 09:55:34.378262401 +0200
@@ -113,7 +113,7 @@ void NPluginLoader::init()
         pluginsDirList << NCore::rcDir() + "/" + _pluginsDirName;
     if (QDir(QCoreApplication::applicationDirPath()).dirName() == "bin") {
         QDir dir(QCoreApplication::applicationDirPath());
-        dir.cd(QString() + "../lib/nulloy/" + _pluginsDirName);
+        dir.cd(QString() + "../" + N_LIBDIR + "/nulloy/" + _pluginsDirName);
         pluginsDirList << dir.absolutePath();
     }
 #endif
Index: nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda/src/plugins/plugin.pri
===================================================================
--- nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda.orig/src/plugins/plugin.pri	2019-01-03 01:47:17.000000000 +0200
+++ nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda/src/plugins/plugin.pri	2019-05-18 09:55:34.378262401 +0200
@@ -17,7 +17,7 @@ unix {
     mac {
         target.path = ../../../$${APP_NAME}.app/Contents/MacOS/plugins
     } else {
-        target.path = $$PREFIX/lib/$$APP_NAME/plugins
+        target.path = $$PREFIX/$$LIBDIR/$$APP_NAME/plugins
     }
     INSTALLS += target
 }
Index: nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda/src/src.pro
===================================================================
--- nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda.orig/src/src.pro	2019-01-03 01:47:17.000000000 +0200
+++ nulloy-d15e0f3aee22ef1cdd84729cf75f505adcc0ffda/src/src.pro	2019-05-18 09:55:34.378262401 +0200
@@ -4,4 +4,5 @@ DESTDIR = ..
 
 SRC_DIR = $$PWD
 include($$SRC_DIR/src.pri)
+DEFINES += N_LIBDIR=\""\\\"$${N_LIBDIR}\\\""\"
 SOURCES += $$SRC_DIR/main.cpp
