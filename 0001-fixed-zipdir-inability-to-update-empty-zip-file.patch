From ecf070148199c333dec01f28e4a7a05118162260 Mon Sep 17 00:00:00 2001
From: "alexey.lysiuk" <alexey.lysiuk@gmail.com>
Date: Sun, 1 Nov 2020 10:24:22 +0200
Subject: [PATCH] - fixed zipdir inability to update empty zip file

https://forum.zdoom.org/viewtopic.php?t=70468
---
 tools/zipdir/zipdir.c |    2 ++
 1 file changed, 2 insertions(+)

Index: gzdoom-g4.5.0/tools/zipdir/zipdir.c
===================================================================
--- gzdoom-g4.5.0.orig/tools/zipdir/zipdir.c
+++ gzdoom-g4.5.0/tools/zipdir/zipdir.c
@@ -781,6 +781,8 @@ void write_zip(const char *zipname, dir_
 			if (central_dir == NULL)
 			{
 				fprintf(stderr, "Could not read central directory from %s. (Is it a zipfile?)\n", zipname);
+				fclose(ozip);
+				ozip = NULL;
 				update = 0;
 			}
 		}
