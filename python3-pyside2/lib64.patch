From f041ed5f4a3960cebf65c963b50d2c5490cd8b2a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stefan=20Br=C3=BCns?= <stefan.bruens@rwth-aachen.de>
Date: Thu, 20 Dec 2018 19:05:03 +0100
Subject: [PATCH] Lookup clang library and install in arch specific library
 path

---
 build_scripts/platforms/unix.py                               | 4 ++--
 sources/pyside2/CMakeLists.txt                                | 2 +-
 .../shiboken2/ApiExtractor/clangparser/compilersupport.cpp    | 2 +-
 sources/shiboken2/CMakeLists.txt                              | 4 ++--
 4 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/build_scripts/platforms/unix.py b/build_scripts/platforms/unix.py
index 83de489..f6498c6 100644
--- a/build_scripts/platforms/unix.py
+++ b/build_scripts/platforms/unix.py
@@ -81,7 +81,7 @@ def prepare_packages_posix(self, vars):
 
         # <install>/lib/lib* -> {st_package_name}/
         copydir(
-            "{install_dir}/lib/",
+            "{install_dir}/lib64/",
             "{st_build_dir}/{st_package_name}",
             filter=[
                 adjusted_lib_name("libshiboken*",
@@ -156,7 +156,7 @@ def prepare_packages_posix(self, vars):
 
         # <install>/lib/lib* -> {st_package_name}/
         copydir(
-            "{install_dir}/lib/",
+            "{install_dir}/lib64/",
             "{st_build_dir}/{st_package_name}",
             filter=[
                 adjusted_lib_name("libpyside*",

diff --git a/sources/pyside2/CMakeLists.txt b/sources/pyside2/CMakeLists.txt
index 1e6f017..fdfb631 100644
--- a/sources/pyside2/CMakeLists.txt
+++ b/sources/pyside2/CMakeLists.txt
@@ -94,7 +94,7 @@ endif()
 
 option(BUILD_TESTS "Build tests." TRUE)
 option(ENABLE_VERSION_SUFFIX "Used to use current version in suffix to generated files. This is used to allow multiples versions installed simultaneous." FALSE)
-set(LIB_SUFFIX "" CACHE STRING "Define suffix of directory name (32/64)" )
+set(LIB_SUFFIX "64" CACHE STRING "Define suffix of directory name (32/64)" )
 set(LIB_INSTALL_DIR "lib${LIB_SUFFIX}" CACHE PATH "The subdirectory relative to the install prefix where libraries will be installed (default is /lib${LIB_SUFFIX})" FORCE)
 if(CMAKE_HOST_APPLE)
     set(ALTERNATIVE_QT_INCLUDE_DIR "" CACHE PATH "Deprecated. CMake now finds the proper include dir itself.")
diff --git a/sources/shiboken2/ApiExtractor/clangparser/compilersupport.cpp b/sources/shiboken2/ApiExtractor/clangparser/compilersupport.cpp
index d3d5c8d..acb1efd 100644
--- a/sources/shiboken2/ApiExtractor/clangparser/compilersupport.cpp
+++ b/sources/shiboken2/ApiExtractor/clangparser/compilersupport.cpp
@@ -243,7 +243,7 @@ static QString findClangLibDir()
 {
     for (const char *envVar : {"LLVM_INSTALL_DIR", "CLANG_INSTALL_DIR"}) {
         if (qEnvironmentVariableIsSet(envVar)) {
-            const QString path = QFile::decodeName(qgetenv(envVar)) + QLatin1String("/lib");
+            const QString path = QFile::decodeName(qgetenv(envVar)) + QLatin1String("/lib64");
             if (QFileInfo::exists(path))
                 return path;
         }
diff --git a/sources/shiboken2/CMakeLists.txt b/sources/shiboken2/CMakeLists.txt
index 1e52c42..4cac3ae 100644
--- a/sources/shiboken2/CMakeLists.txt
+++ b/sources/shiboken2/CMakeLists.txt
@@ -122,7 +122,8 @@ if(MSVC)
     set(CLANG_LIB_NAMES libclang)
 endif()
 
-find_library(CLANG_LIBRARY NAMES ${CLANG_LIB_NAMES} HINTS ${CLANG_DIR}/lib)
+set(LIB_SUFFIX "64" CACHE STRING "Define suffix of directory name (32/64)" )
+find_library(CLANG_LIBRARY NAMES ${CLANG_LIB_NAMES} HINTS ${CLANG_DIR}/lib${LIB_SUFFIX})
 if (NOT EXISTS ${CLANG_LIBRARY})
     string(REPLACE ";" ", " CLANG_LIB_NAMES_STRING "${CLANG_LIB_NAMES}")
     message(FATAL_ERROR "Unable to find the Clang library in ${CLANG_DIR}.\
@@ -309,7 +310,6 @@ set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -D QT_NO_CAST_FROM_ASCII -D QT_NO_CAST_T
 set(CMAKE_CXX_STANDARD 11)
 set(CMAKE_CXX_STANDARD_REQUIRED ON)
 
-set(LIB_SUFFIX "" CACHE STRING "Define suffix of directory name (32/64)" )
 set(LIB_INSTALL_DIR "lib${LIB_SUFFIX}" CACHE PATH "The subdirectory relative to the install prefix where libraries will be installed (default is /lib${LIB_SUFFIX})" FORCE)
 set(BIN_INSTALL_DIR "bin" CACHE PATH "The subdirectory relative to the install prefix where dlls will be installed (default is /bin)" FORCE)
 
