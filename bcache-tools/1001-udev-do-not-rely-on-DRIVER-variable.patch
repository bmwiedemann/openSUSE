From b48c30983b1510d94745bd07494fa81a68a5896e Mon Sep 17 00:00:00 2001
From: Jan Engelhardt <jengelh@inai.de>
Date: Sat, 28 Mar 2015 10:50:57 +0100
Subject: [PATCH] udev: do not rely on DRIVER variable

The DRIVER variable will only be set on a single event (when the
module creates the first instance?). Any subsequent udev event, e.g. a
change event for bcache0, does not have the DRIVER tag set. In fact,
most events don't. (This can be reproduced with `udevadm trigger`.)
This leads to a change in the contents of the SYMLINK variable which
leads to removal of /dev/bcache/, since DRIVER is not set.

Don't even bother to create such a volatile /dev/bcache/ in the
first place so users don't go chasing after it.

References: https://bugzilla.opensuse.org/880858
---
 69-bcache.rules | 6 ------
 1 file changed, 6 deletions(-)

diff --git a/69-bcache.rules b/69-bcache.rules
index 9cc7f0d..096fde6 100644
--- a/69-bcache.rules
+++ b/69-bcache.rules
@@ -22,11 +22,5 @@ RUN{builtin}+="kmod load bcache"
 RUN+="bcache-register $tempnode"
 LABEL="bcache_backing_end"
 
-# Cached devices: symlink
-DRIVER=="bcache", ENV{CACHED_UUID}=="?*", \
-        SYMLINK+="bcache/by-uuid/$env{CACHED_UUID}"
-DRIVER=="bcache", ENV{CACHED_LABEL}=="?*", \
-        SYMLINK+="bcache/by-label/$env{CACHED_LABEL}"
-
 LABEL="bcache_end"
 
-- 
2.1.4

