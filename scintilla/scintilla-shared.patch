Index: scintilla/gtk/makefile
===================================================================
--- scintilla.orig/gtk/makefile
+++ scintilla/gtk/makefile
@@ -45,7 +45,7 @@ DEL = del /q
 COMPLIB=$(srcdir)\..\bin\scintilla.a
 else
 DEL = rm -f
-COMPLIB=$(srcdir)/../bin/scintilla.a
+COMPLIB=$(srcdir)/../bin/libscintilla.la
 endif
 
 vpath %.h $(srcdir) $(srcdir)/../src $(srcdir)/../include $(srcdir)/../lexlib
@@ -75,12 +75,12 @@ else
 CTFLAGS=-DDEBUG -g $(CXXBASEFLAGS) $(THREADFLAGS)
 endif
 else
-CTFLAGS=-DNDEBUG -Os $(CXXBASEFLAGS) $(THREADFLAGS)
+CTFLAGS=-DNDEBUG $(CXXBASEFLAGS) $(THREADFLAGS)
 endif
 
 CXXTFLAGS:=--std=gnu++0x $(CTFLAGS) $(REFLAGS)
 
-CONFIGFLAGS:=$(shell pkg-config --cflags $(GTKVERSION))
+CONFIGFLAGS:=$(shell pkg-config --cflags --libs $(GTKVERSION))
 MARSHALLER=scintilla-marshal.o
 
 .cxx.o:
@@ -111,7 +111,7 @@ LEXSORTED=$(shell ls $(srcdir)/../lexers
 DEPSRCS=$(srcdir)/*.cxx $(srcdir)/../src/*.cxx $(srcdir)/../lexlib/*.cxx $(LEXSORTED)
 deps: deps.mak
 deps.mak:
-	$(CXX) -MM $(CONFIGFLAGS) $(CXXTFLAGS) $(DEPSRCS) | sed -e 's/\/usr.* //' | grep [a-zA-Z] > $@
+	$(CXX) -MM $(CONFIGFLAGS) $(CXXTFLAGS) $(CXXFLAGS) $(DEPSRCS) | sed -e 's/\/usr.* //' | grep [a-zA-Z] > $@
 
 $(COMPLIB): Accessor.o CharacterSet.o LexerBase.o LexerModule.o LexerSimple.o StyleContext.o WordList.o \
 	CharClassify.o Decoration.o Document.o PerLine.o Catalogue.o CallTip.o CaseConvert.o CaseFolder.o \
@@ -120,8 +120,7 @@ $(COMPLIB): Accessor.o CharacterSet.o Le
 	KeyMap.o LineMarker.o PositionCache.o ScintillaGTK.o ScintillaGTKAccessible.o CellBuffer.o CharacterCategory.o ViewStyle.o \
 	RESearch.o RunStyles.o Selection.o Style.o Indicator.o AutoComplete.o UniConversion.o XPM.o \
 	$(MARSHALLER) $(LEXOBJS)
-	$(AR) $(ARFLAGS) $@ $^
-	$(RANLIB) $@
+	libtool --mode=link gcc $(CONFIGFLAGS) -o $@ $^ -rpath $(LIBDIR) $(CONFIGLDFLAGS) -version-info $(VERSION)
 
 # Automatically generate header dependencies with "make deps"
 include deps.mak
