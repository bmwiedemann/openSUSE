Index: cpuinfo.sh
===================================================================
--- cpuinfo.sh.orig
+++ cpuinfo.sh
@@ -91,6 +91,7 @@ _mmx2=no
 _sse=no
 _sse2=no
 _mtrr=no
+_longmode=no
 
 for i in $pparam ; do
  case "$i" in
@@ -101,6 +102,7 @@ for i in $pparam ; do
   mtrr|k6_mtrr|cyrix_arr)   _mtrr=yes    ;;
   xmm|sse|kni)  _sse=yes    _mmx2=yes    ;;
   sse2)         _sse2=yes                ;;
+  lm)           _longmode=yes            ;;
  esac
 done
 
@@ -178,8 +180,13 @@ case "$pvendor" in
 			   else
 				proc=i686
 			   fi
-                           ;;
-			15) proc=pentium4
+ 			   ;;
+			15)
+			   if test "$_longmode" = yes ; then
+				proc=k8
+			   else
+				proc=pentium4
+			   fi
 			   ;;
 			*) proc=pentium4
 			   ;;
