Subject: Support creating sparse volumes on ZFS pools
From: Iain Buclaw ibuclaw@gdcproject.org Mon Feb 26 23:31:05 2024 +0100
Date: Sat Mar 2 11:37:45 2024 -0500:
Git: 78f7797c13e6e8c56ee059dba721278270c4c4dd

Closes #487

Signed-off-by: Iain Buclaw <ibuclaw@gdcproject.org>

diff --git a/virtManager/createvol.py b/virtManager/createvol.py
index ea82964a..da54b662 100644
--- a/virtManager/createvol.py
+++ b/virtManager/createvol.py
@@ -7,7 +7,7 @@
 from gi.repository import Gtk
 
 from virtinst import log
-from virtinst import StorageVolume
+from virtinst import StorageVolume, StoragePool
 
 from .lib import uiutil
 from .asyncjob import vmmAsyncJob
@@ -180,7 +180,9 @@ class vmmCreateVolume(vmmGObjectUI):
 
     def _can_sparse(self):
         dtype = self._parent_pool.xmlobj.get_disk_type()
-        return dtype == StorageVolume.TYPE_FILE
+        ptype = self._parent_pool.xmlobj.type
+        return (dtype == StorageVolume.TYPE_FILE or
+                ptype in [StoragePool.TYPE_ZFS])
 
     def _show_sparse(self):
         uiutil.set_grid_row_visible(
