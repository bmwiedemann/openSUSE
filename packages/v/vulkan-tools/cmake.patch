From 2cb1cd9899748daa5c30f822aaafdc4d2fcca464 Mon Sep 17 00:00:00 2001
From: Jan Engelhardt <jengelh@inai.de>
Date: Sun, 6 Jul 2025 17:27:55 +0200
Subject: [PATCH] build: workaround FTBFS due to cmake
References: https://github.com/KhronosGroup/Vulkan-Tools/issues/1130

[6/19] Building C object cube/CMakeFiles/vkcube.dir/cube.c.o
FAILED: [code=2] cube/CMakeFiles/vkcube.dir/cube.c.o
/usr/bin/cc -D/usr/lib64/libm.so" -DVK_USE_PLATFORM_DISPLAY_KHR -DVK_USE_PLATFORM_WAYLAND_KHR -DVK_USE_PLATFORM_XCB_KHR -DVK_USE_PLATFORM_XLIB_KHR -DWAYLAND_LIBRARY=\"/usr/lib64/libwayland-client.so -DXCB_LIBRARY=\"/usr/lib64/libxcb.so\" -DXLIB_LIBRARY=\"/usr/lib64/libX11.so\" -I/usr/include/wayland -I/home/ej/obs_nosave/zu/X11/Wayland/vulkan-tools/Vulkan-Tools/cube -I/home/ej/obs_nosave/zu/X11/Wayland/vulkan-tools/Vulkan-Tools/cube/. -O2 -Wall -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=3 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables -fstack-clash-protection -Werror=return-type -flto=auto -g -O2 -g -DNDEBUG -std=c99 -fPIE -fvisibility=hidden -Wall -Wextra -Wno-unused-parameter -Wno-missing-field-initializers -Wno-stringop-truncation -MD -MT cube/CMakeFiles/vkcube.dir/cube.c.o -MF cube/CMakeFiles/vkcube.dir/cube.c.o.d -o cube/CMakeFiles/vkcube.dir/cube.c.o -c /home/ej/obs_nosave/zu/X11/Wayland/vulkan-tools/Vulkan-Tools/cube/cube.c
/bin/sh: -c: line 1: unexpected EOF while looking for matching `"'
ninja: build stopped: subcommand failed.
---
 cube/CMakeLists.txt |   12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

Index: Vulkan-Tools-vulkan-sdk-1.4.313.0/cube/CMakeLists.txt
===================================================================
--- Vulkan-Tools-vulkan-sdk-1.4.313.0.orig/cube/CMakeLists.txt
+++ Vulkan-Tools-vulkan-sdk-1.4.313.0/cube/CMakeLists.txt
@@ -308,13 +308,13 @@ if (ANDROID)
 endif()
 
 if (XCB_LINK_LIBRARIES)
-    target_compile_definitions(vkcube PRIVATE "XCB_LIBRARY=\"${XCB_LINK_LIBRARIES}\"")
+    target_compile_definitions(vkcube PRIVATE "XCB_LIBRARY=\"libxcb.so.1\"")
 endif()
 if (X11_LINK_LIBRARIES)
-    target_compile_definitions(vkcube PRIVATE "XLIB_LIBRARY=\"${X11_LINK_LIBRARIES}\"")
+    target_compile_definitions(vkcube PRIVATE "XLIB_LIBRARY=\"libX11.so.6\"")
 endif()
 if (WAYLAND_CLIENT_LINK_LIBRARIES)
-    target_compile_definitions(vkcube PRIVATE "WAYLAND_LIBRARY=\"${WAYLAND_CLIENT_LINK_LIBRARIES}\"")
+    target_compile_definitions(vkcube PRIVATE "WAYLAND_LIBRARY=\"libwayland-client.so.0\"")
 endif()
 
 # ----------------------------------------------------------------------------
@@ -361,13 +361,13 @@ target_compile_definitions(vkcubepp PRIV
 target_link_libraries(vkcubepp ${CMAKE_DL_LIBS} Vulkan::Headers)
 
 if (XCB_LINK_LIBRARIES )
-    target_compile_definitions(vkcubepp PUBLIC "XCB_LIBRARY=\"${XCB_LINK_LIBRARIES}\"")
+    target_compile_definitions(vkcubepp PUBLIC "XCB_LIBRARY=\"libxcb.so.1\"")
 endif()
 if (X11_LINK_LIBRARIES)
-    target_compile_definitions(vkcubepp PUBLIC "XLIB_LIBRARY=\"${X11_LINK_LIBRARIES}\"")
+    target_compile_definitions(vkcubepp PUBLIC "XLIB_LIBRARY=\"libX11.so.6\"")
 endif()
 if (WAYLAND_CLIENT_LINK_LIBRARIES)
-    target_compile_definitions(vkcubepp PUBLIC "WAYLAND_LIBRARY=\"${WAYLAND_CLIENT_LINK_LIBRARIES}\"")
+    target_compile_definitions(vkcubepp PUBLIC "WAYLAND_LIBRARY=\"libwayland-client.so.0\"")
 endif()
 
 if(APPLE)
