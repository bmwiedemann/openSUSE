From: Gert Wollny <gert.wollny@collabora.com>
Date: Wed, 15 Jan 2020 13:43:58 +0100
Subject: [PATCH] vrend: Don't try launching a grid if no CS is available

Git-commit: 63bcca251f093d83da7e290ab4bbd38ae69089b5
References: boo#1162519, CVE-2020-8002

Closes #155

Signed-off-by: Gert Wollny <gert.wollny@collabora.com>
Reviewed-by: Gurchetan Singh <gurchetansingh@chromium.org>
Signed-off-by: Bruce Rogers <brogers@suse.com>
---
 src/vrend_renderer.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/vrend_renderer.c b/src/vrend_renderer.c
index a054bad..2280fc4 100644
--- a/src/vrend_renderer.c
+++ b/src/vrend_renderer.c
@@ -4604,6 +4604,13 @@ void vrend_launch_grid(struct vrend_context *ctx,
       }
       ctx->sub->shader_dirty = true;
    }
+
+   if (!ctx->sub->prog) {
+      vrend_printf("%s: Skipping compute shader execution due to missing shaders: %s\n",
+                   __func__, ctx->debug_name);
+      return;
+   }
+
    vrend_use_program(ctx, ctx->sub->prog->id);
 
    vrend_draw_bind_ubo_shader(ctx, PIPE_SHADER_COMPUTE, 0);
-- 
2.25.0

