From 010c04a0b113ace5beda1962dbf090d7cef4b467 Mon Sep 17 00:00:00 2001
From: Mika Lindqvist <postmaster@raasu.org>
Date: Fri, 17 Jun 2022 13:06:56 +0300
Subject: [PATCH] In compatibility mode, always define z_crc_t as uint32_t for
 backwards compatibility.

Guillaume GARDET: Drop unused part: zlib-ng.h.in and zlib.h.in and add zlib-ng.h
---
 configure     | 1 +
 zconf-ng.h.in | 1 -
 zconf.h.in    | 3 ++-
 zlib-ng.h.in  | 5 +++--
 zlib.h.in     | 4 ++--
 5 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/configure b/configure
index 26529dbb5..ffee40054 100755
--- a/configure
+++ b/configure
@@ -874,6 +874,7 @@ echo >> configure.log
 
 # Check for ANSI C compliant compiler
 cat > $test.c <<EOF
+#include <stdint.h>
 #include <stdio.h>
 #include <stdarg.h>
 #include "zconf${SUFFIX}.h"
diff --git a/zconf-ng.h.in b/zconf-ng.h.in
index 16fdcfa0f..7f8983bf4 100644
--- a/zconf-ng.h.in
+++ b/zconf-ng.h.in
@@ -116,7 +116,6 @@ typedef PTRDIFF_TYPE ptrdiff_t;
 #endif
 
 #include <sys/types.h>      /* for off_t */
-#include <stdarg.h>         /* for va_list */
 
 #include <stddef.h>         /* for wchar_t and NULL */
 
diff --git a/zconf.h.in b/zconf.h.in
index eea3c4ac7..c82a8ad00 100644
--- a/zconf.h.in
+++ b/zconf.h.in
@@ -127,6 +127,8 @@ typedef void const *voidpc;
 typedef void       *voidpf;
 typedef void       *voidp;
 
+typedef uint32_t z_crc_t;
+
 #ifdef HAVE_UNISTD_H    /* may be set to #if 1 by configure/cmake/etc */
 #  define Z_HAVE_UNISTD_H
 #endif
@@ -136,7 +138,6 @@ typedef PTRDIFF_TYPE ptrdiff_t;
 #endif
 
 #include <sys/types.h>      /* for off_t */
-#include <stdarg.h>         /* for va_list */
 
 #include <stddef.h>         /* for wchar_t and NULL */
 
--- a/zlib-ng.h      2022-06-21 11:34:06.375814802 +0200
+++ b/zlib-ng.h   2022-06-21 11:34:49.756324508 +0200
@@ -33,6 +33,7 @@
 #  error Include zlib-ng.h for zlib-ng API or zlib.h for zlib-compat API but not both
 #endif
 
+#include <stdarg.h>
 #include <stdint.h>
 #include "zconf-ng.h"
 
