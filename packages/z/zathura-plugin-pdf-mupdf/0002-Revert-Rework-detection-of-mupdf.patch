From fe541d1ac43ff4590c371c6f2b5678f355535974 Mon Sep 17 00:00:00 2001
From: llyyr <llyyr.public@gmail.com>
Date: Tue, 7 Mar 2023 07:13:50 +0530
Subject: [PATCH] Revert "Rework detection of mupdf"

This reverts commit 49a85efb915bfed933d251f6074b807d0e1ef385.
---
 meson.build       | 17 +++++------------
 meson_options.txt |  6 ++++++
 2 files changed, 11 insertions(+), 12 deletions(-)

diff --git a/meson.build b/meson.build
index 1f628af..e35f679 100644
--- a/meson.build
+++ b/meson.build
@@ -19,7 +19,7 @@ zathura = dependency('zathura', version: '>=0.5.2')
 girara = dependency('girara-gtk3')
 glib = dependency('glib-2.0')
 cairo = dependency('cairo')
-mupdf = dependency('mupdf', required: false)
+mupdf = cc.find_library('mupdf')
 mupdfthird = cc.find_library('mupdf-third')
 
 build_dependencies = [
@@ -27,30 +27,23 @@ build_dependencies = [
   girara,
   glib,
   cairo,
+  mupdf,
+  mupdfthird
 ]
 
-if not mupdf.found()
-  # normal build of mupdf
-  mupdf = cc.find_library('mupdf')
-  build_dependencies += [mupdf, mupdfthird]
-else
-  # build from Debian's libmupdf-dev
-  build_dependencies += [mupdf, mupdfthird]
-
+if get_option('link-external')
   libjpeg = dependency('libjpeg')
   libjbig2dec = cc.find_library('jbig2dec')
   libopenjp2 = dependency('libopenjp2')
   tesseract = dependency('tesseract')
   leptonica = dependency('lept')
-  mujs = dependency('mujs')
 
   build_dependencies += [
     libjpeg,
     libjbig2dec,
     libopenjp2,
     tesseract,
-    leptonica,
-    mujs
+    leptonica
   ]
 endif
 
diff --git a/meson_options.txt b/meson_options.txt
index c8df610..db9d0c5 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -1,3 +1,9 @@
+option('link-external',
+  type: 'boolean',
+  value: false,
+  description: 'Link external libraries required by mupdf.'
+)
+
 option('plugindir',
   type: 'string',
   value: '',
-- 
2.39.2

