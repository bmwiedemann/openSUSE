From 35c2bba4906a278d876503855c55c2e7f9247616 Mon Sep 17 00:00:00 2001
From: Jaroslav Kysela <perex@perex.cz>
Date: Mon, 27 Jan 2020 16:06:25 +0100
Subject: [PATCH 20/36] SDP4430: corrections and fixes

Signed-off-by: Jaroslav Kysela <perex@perex.cz>
---
 ucm2/SDP4430/FMAnalog.conf  | 11 +++-----
 ucm2/SDP4430/HiFiLP.conf    |  7 +++--
 ucm2/SDP4430/Record.conf    |  5 +++-
 ucm2/SDP4430/SDP4430.conf   |  2 +-
 ucm2/SDP4430/Voice.conf     |  6 +++--
 ucm2/SDP4430/VoiceAll.conf  | 63 --------------------------------------------
 ucm2/SDP4430/VoiceCall.conf | 64 +++++++++++++++++++++++++++++++++++++++++++++
 7 files changed, 82 insertions(+), 76 deletions(-)
 delete mode 100644 ucm2/SDP4430/VoiceAll.conf
 create mode 100644 ucm2/SDP4430/VoiceCall.conf

diff --git a/ucm2/SDP4430/FMAnalog.conf b/ucm2/SDP4430/FMAnalog.conf
index 96814652a275..2cfabf92cb57 100644
--- a/ucm2/SDP4430/FMAnalog.conf
+++ b/ucm2/SDP4430/FMAnalog.conf
@@ -9,19 +9,12 @@ SectionVerb {
                 cset "name='Capture Volume' 4"
 	]
 
-
 	DisableSequence [
                 cset "name='AMIC_UL PDM Switch' 0"
                 cset "name='MUX_UL00' 0"
                 cset "name='MUX_UL01' 0"
                 cset "name='Capture Volume' 0"
 	]
-
-	# Optional TQ and ALSA PCMs
-	Value {
-		TQ "Music"
-                CapturePCM "hw:${CardId},0"
-	}
 }
 
 SectionDevice."Headset" {
@@ -38,5 +31,9 @@ SectionDevice."Headset" {
                 cset "name='Analog Right Capture Route' 3"
                 cset "name='Capture Preamplifier Volume' 0"
 	]
+
+	Value {
+                CapturePCM "hw:${CardId},0"
+	}
 }
 
diff --git a/ucm2/SDP4430/HiFiLP.conf b/ucm2/SDP4430/HiFiLP.conf
index 51380d946756..731ac210b479 100644
--- a/ucm2/SDP4430/HiFiLP.conf
+++ b/ucm2/SDP4430/HiFiLP.conf
@@ -18,10 +18,8 @@ SectionVerb {
                 cset "name='SDT DL Volume' 0"
 	]
 
-	# Optional TQ and ALSA PCMs
 	Value {
 		TQ "Music"
-		PlaybackPCM "hw:${CardId},6"
 	}
 }
 
@@ -39,4 +37,9 @@ SectionDevice."Headset" {
 		cset "name='HS Left Playback' 0"
                 cset "name='Headset Playback Volume' 0"
 	]
+
+	Value {
+		PlaybackPriority 100
+		PlaybackPCM "hw:${CardId},6"
+	}
 }
diff --git a/ucm2/SDP4430/Record.conf b/ucm2/SDP4430/Record.conf
index 9f62fd14bb97..d3c4955ac2d8 100644
--- a/ucm2/SDP4430/Record.conf
+++ b/ucm2/SDP4430/Record.conf
@@ -19,7 +19,6 @@ SectionVerb {
 	# Optional TQ and ALSA PCMs
 	Value {
 		TQ "Music"
-		CapturePCM "hw:${CardId},0"
 	}
 
 }
@@ -38,4 +37,8 @@ SectionDevice."Headset" {
                 cset "name='Analog Right Capture Route' 3"
                 cset "name='Capture Preamplifier Volume' 0"
 	]
+
+	Value {
+		CapturePCM "hw:${CardId},0"
+	}
 }
diff --git a/ucm2/SDP4430/SDP4430.conf b/ucm2/SDP4430/SDP4430.conf
index df5b5b97d74a..fd958903f290 100644
--- a/ucm2/SDP4430/SDP4430.conf
+++ b/ucm2/SDP4430/SDP4430.conf
@@ -13,7 +13,7 @@ SectionUseCase."HiFi" {
 }
 
 SectionUseCase."HiFi_Low_Power" {
-	File "HiHiLP.conf"
+	File "HiFiLP.conf"
 	Comment "Play HiFi quality Music in Low Power Mode"
 }
 
diff --git a/ucm2/SDP4430/Voice.conf b/ucm2/SDP4430/Voice.conf
index 7d10a1711bcc..15cd4f08e310 100644
--- a/ucm2/SDP4430/Voice.conf
+++ b/ucm2/SDP4430/Voice.conf
@@ -18,10 +18,8 @@ SectionVerb {
                 cset "name='SDT DL Volume' 0"
 	]
 
-	# Optional TQ and ALSA PCMs
 	Value {
 		TQ "Voice"
-		PlaybackPCM "hw:${CardId},2"
 	}
 }
 
@@ -39,4 +37,8 @@ SectionDevice."Headset" {
 		cset "name='HS Left Playback' 0"
                 cset "name='Headset Playback Volume' 0"
 	]
+
+	Value {
+		PlaybackPCM "hw:${CardId},2"
+	}
 }
diff --git a/ucm2/SDP4430/VoiceAll.conf b/ucm2/SDP4430/VoiceAll.conf
deleted file mode 100644
index 07843c552ade..000000000000
--- a/ucm2/SDP4430/VoiceAll.conf
+++ /dev/null
@@ -1,63 +0,0 @@
-# Use case Configuration for TI SDP4430 HiFi Music
-# By Liam Girdwood <lrg@slimlogic.co.uk>
-
-SectionVerb {
-  	EnableSequence [
-                cset "name='AMIC_UL PDM Switch' 1"
-                cset "name='Sidetone Mixer Capture' 1"
-                cset "name='MUX_VX0' 9"
-                cset "name='MUX_VX1' 10"
-		cset "name='DL1 Mixer Voice' 1"
-		cset "name='Sidetone Mixer Playback' 1"
-                cset "name='DL1 PDM Switch' 1"
-		cset "name='DL1 Voice Playback Volume' 90,90"
-                cset "name='Capture Volume' 4"
-                cset "name='Capture Mixer Voice Capture' 90,90"
-                cset "name='SDT DL Volume' 120"
-	]
-
-
-	DisableSequence [
-                cset "name='AMIC_UL PDM Switch' 0"
-                cset "name='Sidetone Mixer Capture' 0"
-                cset "name='MUX_VX0' 0"
-                cset "name='MUX_VX1' 0"
-		cset "name='DL1 Mixer Voice' 0"
-		cset "name='Sidetone Mixer Playback' 0"
-                cset "name='DL1 PDM Switch' 0"
-		cset "name='DL1 Voice Playback Volume' 0,0"
-                cset "name='Capture Volume' 0"
-		cset "name='DL1 Voice Playback Volume' 0,0"
-                cset "name='SDT DL Volume' 0"
-	]
-
-	# Optional TQ and ALSA PCMs
-	Value {
-		TQ "Voice"
-                CapturePCM "hw:${CardId},2"
-		PlaybackPCM "hw:${CardId},2"
-	}
-}
-
-SectionDevice."Headset" {
-	Comment "SDP4430 3.5mm Headset"
-	
-	EnableSequence [
-                cset "name='Analog Left Capture Route' 0"
-                cset "name='Analog Right Capture Route' 0"
-                cset "name='Capture Preamplifier Volume' 2"
-                cset "name='HS Left Playback' 1"
-                cset "name='HS Right Playback' 1"
-                cset "name='Headset Playback Volume' 13"
-	]
-
-	DisableSequence [
-                cset "name='Analog Left Capture Route' 3"
-                cset "name='Analog Right Capture Route' 3"
-                cset "name='Capture Preamplifier Volume' 0"
-		cset "name='HS Right Playback' 0"
-		cset "name='HS Left Playback' 0"
-                cset "name='Headset Playback Volume' 0"
-	]
-}
-
diff --git a/ucm2/SDP4430/VoiceCall.conf b/ucm2/SDP4430/VoiceCall.conf
new file mode 100644
index 000000000000..2f02a2ba0247
--- /dev/null
+++ b/ucm2/SDP4430/VoiceCall.conf
@@ -0,0 +1,64 @@
+# Use case Configuration for TI SDP4430 HiFi Music
+# By Liam Girdwood <lrg@slimlogic.co.uk>
+
+SectionVerb {
+  	EnableSequence [
+                cset "name='AMIC_UL PDM Switch' 1"
+                cset "name='Sidetone Mixer Capture' 1"
+                cset "name='MUX_VX0' 9"
+                cset "name='MUX_VX1' 10"
+		cset "name='DL1 Mixer Voice' 1"
+		cset "name='Sidetone Mixer Playback' 1"
+                cset "name='DL1 PDM Switch' 1"
+		cset "name='DL1 Voice Playback Volume' 90,90"
+                cset "name='Capture Volume' 4"
+                cset "name='Capture Mixer Voice Capture' 90,90"
+                cset "name='SDT DL Volume' 120"
+	]
+
+
+	DisableSequence [
+                cset "name='AMIC_UL PDM Switch' 0"
+                cset "name='Sidetone Mixer Capture' 0"
+                cset "name='MUX_VX0' 0"
+                cset "name='MUX_VX1' 0"
+		cset "name='DL1 Mixer Voice' 0"
+		cset "name='Sidetone Mixer Playback' 0"
+                cset "name='DL1 PDM Switch' 0"
+		cset "name='DL1 Voice Playback Volume' 0,0"
+                cset "name='Capture Volume' 0"
+		cset "name='DL1 Voice Playback Volume' 0,0"
+                cset "name='SDT DL Volume' 0"
+	]
+
+	Value {
+		TQ "Voice"
+	}
+}
+
+SectionDevice."Headset" {
+	Comment "SDP4430 3.5mm Headset"
+	
+	EnableSequence [
+                cset "name='Analog Left Capture Route' 0"
+                cset "name='Analog Right Capture Route' 0"
+                cset "name='Capture Preamplifier Volume' 2"
+                cset "name='HS Left Playback' 1"
+                cset "name='HS Right Playback' 1"
+                cset "name='Headset Playback Volume' 13"
+	]
+
+	DisableSequence [
+                cset "name='Analog Left Capture Route' 3"
+                cset "name='Analog Right Capture Route' 3"
+                cset "name='Capture Preamplifier Volume' 0"
+		cset "name='HS Right Playback' 0"
+		cset "name='HS Left Playback' 0"
+                cset "name='Headset Playback Volume' 0"
+	]
+
+	Value {
+                CapturePCM "hw:${CardId},2"
+		PlaybackPCM "hw:${CardId},2"
+	}
+}
-- 
2.16.4

