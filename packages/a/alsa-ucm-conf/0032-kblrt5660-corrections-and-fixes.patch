From d2f2b3649b2ea4caa2fc93cdabe9ed813efbae68 Mon Sep 17 00:00:00 2001
From: Jaroslav Kysela <perex@perex.cz>
Date: Wed, 5 Feb 2020 02:54:11 +0100
Subject: [PATCH 32/36] kblrt5660: corrections and fixes

Signed-off-by: Jaroslav Kysela <perex@perex.cz>
---
 ucm2/kblrt5660/Hdmi1.conf | 28 +++++++++++++++++++---------
 ucm2/kblrt5660/Hdmi2.conf | 30 ++++++++++++++++++++----------
 ucm2/kblrt5660/HiFi.conf  | 26 ++++++++++----------------
 3 files changed, 49 insertions(+), 35 deletions(-)

diff --git a/ucm2/kblrt5660/Hdmi1.conf b/ucm2/kblrt5660/Hdmi1.conf
index b6adbaa834dc..ccf51183fdd3 100755
--- a/ucm2/kblrt5660/Hdmi1.conf
+++ b/ucm2/kblrt5660/Hdmi1.conf
@@ -1,14 +1,24 @@
 # Usecase for device HDMI1/Display Port stereo playback on Intel KABYLAKE platforms
 # For Audio in I2S mode
 
-SectionDevice."Hdmi1" {
-        Comment "HDMI/Display Port 1 Stereo"
+SectionDevice."HDMI1" {
+	Comment "HDMI/Display Port 1 Stereo"
 
-        Value {
-                PlaybackPCM "hw:${CardId},2"
-                PlaybackChannels "2"
-                PlaybackPriority "2"
-                JackControl "HDMI/DP, pcm=4 Jack"
-        }
+	Value {
+		PlaybackPriority 200
+		PlaybackPCM "hw:${CardId},2"
+		PlaybackChannels 2
+		If.1 {
+			Condition {
+				Type ControlExists
+				Control "iface=CARD,name='HDMI/DP,pcm=4 Jack'"
+			}
+			True {
+				JackControl "HDMI/DP,pcm=4 Jack"
+			}
+			False {
+				JackControl "HDMI/DP, pcm=4 Jack"
+			}
+		}
+	}
 }
-
diff --git a/ucm2/kblrt5660/Hdmi2.conf b/ucm2/kblrt5660/Hdmi2.conf
index 19e9bd0b300b..c5e400166ed7 100755
--- a/ucm2/kblrt5660/Hdmi2.conf
+++ b/ucm2/kblrt5660/Hdmi2.conf
@@ -1,14 +1,24 @@
-# Usecase for device HDMI2/Display Port stereo playback on Intel KABYLAKE platforms
+# Usecase for device HDMI1/Display Port stereo playback on Intel KABYLAKE platforms
 # For Audio in I2S mode
 
-SectionDevice."Hdmi2" {
-        Comment "HDMI/Display Port 2 Stereo"
+SectionDevice."HDMI2" {
+	Comment "HDMI/Display Port 2 Stereo"
 
-        Value {
-                PlaybackPCM "hw:${CardId},3"
-                PlaybackChannels "2"
-                PlaybackPriority "3"
-                JackControl "HDMI/DP, pcm=5 Jack"
-        }
+	Value {
+		PlaybackPriority 300
+		PlaybackPCM "hw:${CardId},3"
+		PlaybackChannels 2
+		If.1 {
+			Condition {
+				Type ControlExists
+				Control "iface=CARD,name='HDMI/DP,pcm=5 Jack'"
+			}
+			True {
+				JackControl "HDMI/DP,pcm=5 Jack"
+			}
+			False {
+				JackControl "HDMI/DP, pcm=5 Jack"
+			}
+		}
+	}
 }
-
diff --git a/ucm2/kblrt5660/HiFi.conf b/ucm2/kblrt5660/HiFi.conf
index af0d805a3aa7..0f5d46dafb15 100755
--- a/ucm2/kblrt5660/HiFi.conf
+++ b/ucm2/kblrt5660/HiFi.conf
@@ -1,18 +1,8 @@
 # UCM for Intel Kabylake platforms with RT5660
 # For Audio in I2S mode
 
-SectionVerb {
-
-	# ALSA PCM
-	Value {
-		# ALSA PCM device for HiFi
-		PlaybackPCM "hw:${CardId},0"
-		CapturePCM "hw:${CardId},1"
-	}
-}
-
-SectionDevice."LineOut" {
-	Comment "LineOut playback"
+SectionDevice."Line1" {
+	Comment "Line playback"
 
 	EnableSequence [
 		cset "name='DAC1 Playback Volume' 30"
@@ -36,14 +26,16 @@ SectionDevice."LineOut" {
 	]
 
 	Value {
-		PlaybackChannels "2"
+		PlaybackPriority 100
+		PlaybackPCM "hw:${CardId}"
+		PlaybackChannels 2
 		JackDev "rt5660-jack"
 		JackControl "Line Out Jack"
 	}
 }
 
-SectionDevice."LineIn" {
-	Comment "LineIn capture"
+SectionDevice."Line2" {
+	Comment "Line capture"
 
 	EnableSequence [
 		cset "name='ADC Capture Volume' 30"
@@ -67,7 +59,9 @@ SectionDevice."LineIn" {
 	]
 
 	Value {
-		CaptureChannels "2"
+		CapturePriority 100
+		CapturePCM "hw:${CardId},1"		
+		CaptureChannels 2
 		JackDev "rt5660-jack"
 		JackControl "Line In Jack"
 	}
-- 
2.16.4

