From 3f63dc26445ae7c215e48a57af83b6da325f166d Mon Sep 17 00:00:00 2001
From: Jaroslav Kysela <perex@perex.cz>
Date: Thu, 7 Jan 2021 17:41:38 +0100
Subject: [PATCH 39/44] ucm: uc_mgr_substitute_tree() fix use after free

Signed-off-by: Jaroslav Kysela <perex@perex.cz>
---
 src/ucm/ucm_subs.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/ucm/ucm_subs.c b/src/ucm/ucm_subs.c
index f608bb0955a6..df6d736fc820 100644
--- a/src/ucm/ucm_subs.c
+++ b/src/ucm/ucm_subs.c
@@ -417,11 +417,12 @@ int uc_mgr_substitute_tree(snd_use_case_mgr_t *uc_mgr, snd_config_t *node)
 		if (err < 0)
 			return err;
 		err = snd_config_set_id(node, s);
-		free(s);
 		if (err < 0) {
 			uc_error("unable to set substituted id '%s' (old id '%s')", s, id);
+			free(s);
 			return err;
 		}
+		free(s);
 	}
 	if (snd_config_get_type(node) != SND_CONFIG_TYPE_COMPOUND) {
 		if (snd_config_get_type(node) == SND_CONFIG_TYPE_STRING) {
-- 
2.26.2

