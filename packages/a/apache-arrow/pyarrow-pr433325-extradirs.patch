From 888a5ae568d155d03fbff0db8849517fd24a99ff Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ra=C3=BAl=20Cumplido?= <raulcumplido@gmail.com>
Date: Thu, 18 Jul 2024 16:48:52 +0200
Subject: [PATCH 1/9] GH-43299: [Release][Packaging] Only include pyarrow and
 pyarrow.* when finding packages on setuptools

---
 python/pyproject.toml | 1 +
 1 file changed, 1 insertion(+)

diff --git a/python/pyproject.toml b/python/pyproject.toml
index d863bb3e5f0ac..d70b7fcce5903 100644
--- a/python/pyproject.toml
+++ b/python/pyproject.toml
@@ -74,6 +74,7 @@ include-package-data=true
 
 [tool.setuptools.packages.find]
 where = ["."]
+include = ["pyarrow", "pyarrow.*"]
 
 [tool.setuptools.package-data]
 pyarrow = ["*.pxd", "*.pyx", "includes/*.pxd"]

From 46d1afc62514ae04a3815aede7722ac5a9ecce64 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ra=C3=BAl=20Cumplido?= <raulcumplido@gmail.com>
Date: Thu, 18 Jul 2024 17:33:33 +0200
Subject: [PATCH 2/9] Update include

---
 python/pyproject.toml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/python/pyproject.toml b/python/pyproject.toml
index d70b7fcce5903..d1c5a799f870f 100644
--- a/python/pyproject.toml
+++ b/python/pyproject.toml
@@ -74,7 +74,7 @@ include-package-data=true
 
 [tool.setuptools.packages.find]
 where = ["."]
-include = ["pyarrow", "pyarrow.*"]
+include = ["pyarrow*"]
 
 [tool.setuptools.package-data]
 pyarrow = ["*.pxd", "*.pyx", "includes/*.pxd"]

From d954d75432f05723fca0644842deafd941802842 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ra=C3=BAl=20Cumplido?= <raulcumplido@gmail.com>
Date: Thu, 18 Jul 2024 18:00:40 +0200
Subject: [PATCH 3/9] try again without *

---
 python/pyproject.toml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/python/pyproject.toml b/python/pyproject.toml
index d1c5a799f870f..222f8d2ece681 100644
--- a/python/pyproject.toml
+++ b/python/pyproject.toml
@@ -74,7 +74,7 @@ include-package-data=true
 
 [tool.setuptools.packages.find]
 where = ["."]
-include = ["pyarrow*"]
+include = ["pyarrow"]
 
 [tool.setuptools.package-data]
 pyarrow = ["*.pxd", "*.pyx", "includes/*.pxd"]

From 2fa434ffc03cca1a251c80c51dd6e98f63db19d1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ra=C3=BAl=20Cumplido?= <raulcumplido@gmail.com>
Date: Thu, 18 Jul 2024 18:36:55 +0200
Subject: [PATCH 4/9] Exclude tests from wheels

---
 python/pyproject.toml | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/python/pyproject.toml b/python/pyproject.toml
index 222f8d2ece681..45c3b60c8aeed 100644
--- a/python/pyproject.toml
+++ b/python/pyproject.toml
@@ -75,6 +75,8 @@ include-package-data=true
 [tool.setuptools.packages.find]
 where = ["."]
 include = ["pyarrow"]
+exclude = ["pyarrow.tests"]
+namespaces = false
 
 [tool.setuptools.package-data]
 pyarrow = ["*.pxd", "*.pyx", "includes/*.pxd"]

From 204a27b0534161a35e2d79241dcadd0471341c2a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ra=C3=BAl=20Cumplido?= <raulcumplido@gmail.com>
Date: Fri, 19 Jul 2024 12:43:29 +0200
Subject: [PATCH 5/9] Try excluding pyarrow. and pyarrow/tests explicitly

---
 python/pyproject.toml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/python/pyproject.toml b/python/pyproject.toml
index 45c3b60c8aeed..d675f07a82391 100644
--- a/python/pyproject.toml
+++ b/python/pyproject.toml
@@ -75,7 +75,7 @@ include-package-data=true
 [tool.setuptools.packages.find]
 where = ["."]
 include = ["pyarrow"]
-exclude = ["pyarrow.tests"]
+exclude = ["pyarrow/tests", "pyarrow."]
 namespaces = false
 
 [tool.setuptools.package-data]

From a1d73a28e3d6e57366ff43d06389a2f3fa47c7de Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ra=C3=BAl=20Cumplido?= <raulcumplido@gmail.com>
Date: Fri, 19 Jul 2024 13:40:25 +0200
Subject: [PATCH 6/9] Try removing where from packages find

---
 python/pyproject.toml | 1 -
 1 file changed, 1 deletion(-)

diff --git a/python/pyproject.toml b/python/pyproject.toml
index d675f07a82391..9a91fd76a4a20 100644
--- a/python/pyproject.toml
+++ b/python/pyproject.toml
@@ -73,7 +73,6 @@ zip-safe=false
 include-package-data=true
 
 [tool.setuptools.packages.find]
-where = ["."]
 include = ["pyarrow"]
 exclude = ["pyarrow/tests", "pyarrow."]
 namespaces = false

From 346c0f1982735cac2a4b76a13efbb2a201bf158f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ra=C3=BAl=20Cumplido?= <raulcumplido@gmail.com>
Date: Mon, 22 Jul 2024 14:46:54 +0200
Subject: [PATCH 7/9] Try with pyarrow.tests

---
 python/pyproject.toml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/python/pyproject.toml b/python/pyproject.toml
index 9a91fd76a4a20..d83cf8fe45d8c 100644
--- a/python/pyproject.toml
+++ b/python/pyproject.toml
@@ -74,7 +74,7 @@ include-package-data=true
 
 [tool.setuptools.packages.find]
 include = ["pyarrow"]
-exclude = ["pyarrow/tests", "pyarrow."]
+exclude = ["pyarrow.tests"]
 namespaces = false
 
 [tool.setuptools.package-data]

From f6273223a1b006406bf315f41424be03a51a3b1e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ra=C3=BAl=20Cumplido?= <raulcumplido@gmail.com>
Date: Mon, 22 Jul 2024 15:34:31 +0200
Subject: [PATCH 8/9] Remove excludes

---
 python/pyproject.toml | 1 -
 1 file changed, 1 deletion(-)

diff --git a/python/pyproject.toml b/python/pyproject.toml
index d83cf8fe45d8c..7e14795428315 100644
--- a/python/pyproject.toml
+++ b/python/pyproject.toml
@@ -74,7 +74,6 @@ include-package-data=true
 
 [tool.setuptools.packages.find]
 include = ["pyarrow"]
-exclude = ["pyarrow.tests"]
 namespaces = false
 
 [tool.setuptools.package-data]

From f855f0c14fbc4703123e36924f1641cf4a48396a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ra=C3=BAl=20Cumplido?= <raulcumplido@gmail.com>
Date: Thu, 25 Jul 2024 11:33:51 +0200
Subject: [PATCH 9/9] Remove PYARROW_INSTALL_TESTS and packages definition on
 setup.py

---
 ci/scripts/python_wheel_macos_build.sh     |  1 -
 ci/scripts/python_wheel_manylinux_build.sh |  1 -
 ci/scripts/python_wheel_windows_build.bat  |  1 -
 docs/source/developers/python.rst          |  3 ---
 python/setup.py                            | 16 +---------------
 5 files changed, 1 insertion(+), 21 deletions(-)

diff --git a/ci/scripts/python_wheel_macos_build.sh b/ci/scripts/python_wheel_macos_build.sh
index 3ed9d5d8dd12f..6c314d0632f60 100755
--- a/ci/scripts/python_wheel_macos_build.sh
+++ b/ci/scripts/python_wheel_macos_build.sh
@@ -152,7 +152,6 @@ echo "=== (${PYTHON_VERSION}) Building wheel ==="
 export PYARROW_BUILD_TYPE=${CMAKE_BUILD_TYPE}
 export PYARROW_BUNDLE_ARROW_CPP=1
 export PYARROW_CMAKE_GENERATOR=${CMAKE_GENERATOR}
-export PYARROW_INSTALL_TESTS=1
 export PYARROW_WITH_ACERO=${ARROW_ACERO}
 export PYARROW_WITH_AZURE=${ARROW_AZURE}
 export PYARROW_WITH_DATASET=${ARROW_DATASET}
diff --git a/ci/scripts/python_wheel_manylinux_build.sh b/ci/scripts/python_wheel_manylinux_build.sh
index aa86494a9d47d..b5b45c54a800d 100755
--- a/ci/scripts/python_wheel_manylinux_build.sh
+++ b/ci/scripts/python_wheel_manylinux_build.sh
@@ -140,7 +140,6 @@ echo "=== (${PYTHON_VERSION}) Building wheel ==="
 export PYARROW_BUILD_TYPE=${CMAKE_BUILD_TYPE}
 export PYARROW_BUNDLE_ARROW_CPP=1
 export PYARROW_CMAKE_GENERATOR=${CMAKE_GENERATOR}
-export PYARROW_INSTALL_TESTS=1
 export PYARROW_WITH_ACERO=${ARROW_ACERO}
 export PYARROW_WITH_AZURE=${ARROW_AZURE}
 export PYARROW_WITH_DATASET=${ARROW_DATASET}
diff --git a/ci/scripts/python_wheel_windows_build.bat b/ci/scripts/python_wheel_windows_build.bat
index 54f02ec6f6ed0..1f1d5dca721d9 100644
--- a/ci/scripts/python_wheel_windows_build.bat
+++ b/ci/scripts/python_wheel_windows_build.bat
@@ -106,7 +106,6 @@ echo "=== (%PYTHON_VERSION%) Building wheel ==="
 set PYARROW_BUILD_TYPE=%CMAKE_BUILD_TYPE%
 set PYARROW_BUNDLE_ARROW_CPP=ON
 set PYARROW_CMAKE_GENERATOR=%CMAKE_GENERATOR%
-set PYARROW_INSTALL_TESTS=ON
 set PYARROW_WITH_ACERO=%ARROW_ACERO%
 set PYARROW_WITH_DATASET=%ARROW_DATASET%
 set PYARROW_WITH_FLIGHT=%ARROW_FLIGHT%
diff --git a/docs/source/developers/python.rst b/docs/source/developers/python.rst
index 2f3e892ce8ede..bed095b4b8d11 100644
--- a/docs/source/developers/python.rst
+++ b/docs/source/developers/python.rst
@@ -632,9 +632,6 @@ PyArrow are:
    * - ``PYARROW_BUNDLE_CYTHON_CPP``
      - Bundle the C++ files generated by Cython
      - ``0`` (``OFF``)
-   * - ``PYARROW_INSTALL_TESTS``
-     - Add the test to the python package
-     - ``1`` (``ON``)
    * - ``PYARROW_BUILD_VERBOSE``
      - Enable verbose output from Makefile builds
      - ``0`` (``OFF``)
diff --git a/python/setup.py b/python/setup.py
index 11cd7028023be..c4517d21c42f1 100755
--- a/python/setup.py
+++ b/python/setup.py
@@ -32,7 +32,7 @@
     from distutils import sysconfig
 
 import pkg_resources
-from setuptools import setup, Extension, Distribution, find_namespace_packages
+from setuptools import setup, Extension, Distribution
 
 from Cython.Distutils import build_ext as _build_ext
 import Cython
@@ -371,21 +371,7 @@ def has_ext_modules(foo):
         return True
 
 
-if strtobool(os.environ.get('PYARROW_INSTALL_TESTS', '1')):
-    packages = find_namespace_packages(include=['pyarrow*'])
-    exclude_package_data = {}
-else:
-    packages = find_namespace_packages(include=['pyarrow*'],
-                                       exclude=["pyarrow.tests*"])
-    # setuptools adds back importable packages even when excluded.
-    # https://github.com/pypa/setuptools/issues/3260
-    # https://github.com/pypa/setuptools/issues/3340#issuecomment-1219383976
-    exclude_package_data = {"pyarrow": ["tests*"]}
-
-
 setup(
-    packages=packages,
-    exclude_package_data=exclude_package_data,
     distclass=BinaryDistribution,
     # Dummy extension to trigger build_ext
     ext_modules=[Extension('__dummy__', sources=[])],
