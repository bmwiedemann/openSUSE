From 5b3309d3b2dbfd773e8cf698fe632b715082e544 Mon Sep 17 00:00:00 2001
From: Franck HOUSSEN <fghoussen@users.noreply.github.com>
Date: Sun, 3 Oct 2021 19:43:00 +0200
Subject: [PATCH 1/2] [BUG FIX] arpackmm: Cut-off in case previous run used
 different nbDim.

---
 CHANGES                                 | 2 ++
 EXAMPLES/MATRIX_MARKET/arpackSolver.hpp | 6 +++++-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/EXAMPLES/MATRIX_MARKET/arpackSolver.hpp b/EXAMPLES/MATRIX_MARKET/arpackSolver.hpp
index cec79a64..dac9a08d 100644
--- a/EXAMPLES/MATRIX_MARKET/arpackSolver.hpp
+++ b/EXAMPLES/MATRIX_MARKET/arpackSolver.hpp
@@ -659,7 +659,11 @@ class arpackSolver {
       if (restartFromFile) {
         ifstream ifs(fileName.c_str());
         if (ifs.is_open()) {
-          a_int nbCV = 1; if (readNbCV) {ifs >> nbCV; if (nbCV < nbCV) nbCV = nbCV;}
+          a_int nbCV = 1;
+          if (readNbCV) {
+            ifs >> nbCV;
+            if (nbCV < nbDim) nbCV = nbDim; // Cut-off in case previous run used different nbDim.
+          }
           for (a_int n = 0; rv && n < nbDim*nbCV; n++) ifs >> rv[n];
           if (verbose >= 1) {
             cout << endl << "arpackSolver:" << endl;

From 2764848f0a72e30d5050e641405f7ec9d8eb6706 Mon Sep 17 00:00:00 2001
From: Franck HOUSSEN <fghoussen@users.noreply.github.com>
Date: Sun, 3 Oct 2021 19:43:47 +0200
Subject: [PATCH 2/2] [BUG FIX] arpackmm: command line sanity checks.

---
 CHANGES                             | 2 ++
 EXAMPLES/MATRIX_MARKET/arpackmm.cpp | 7 +++++++
 2 files changed, 9 insertions(+)

diff --git a/EXAMPLES/MATRIX_MARKET/arpackmm.cpp b/EXAMPLES/MATRIX_MARKET/arpackmm.cpp
index 8865bd8a..e2451bc3 100644
--- a/EXAMPLES/MATRIX_MARKET/arpackmm.cpp
+++ b/EXAMPLES/MATRIX_MARKET/arpackmm.cpp
@@ -316,6 +316,13 @@ class options {
       }
     }
 
+    // Sanity checks.
+
+    if (!stdPb && fileB.empty()) {
+      cerr << "Error: generalized problem without B matrix" << endl;
+      return usage();
+    }
+
     return 0;
   };
 
