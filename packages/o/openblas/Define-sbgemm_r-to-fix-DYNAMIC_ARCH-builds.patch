From: Martin Kroeker <martin@ruby.chemie.uni-freiburg.de>
Date: Fri Feb 25 10:04:00 2022 +0100
Subject: Define sbgemm_r to fix DYNAMIC_ARCH builds
Patch-mainline: Not yet
Git-repo: https://github.com/xianyi/OpenBLAS
Git-commit: d9894f45d30e82fd1491ae38477a1fcd79faeed1
References: 


Signed-off-by: Egbert Eich <eich@suse.de>
---
 kernel/setparam-ref.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/kernel/setparam-ref.c b/kernel/setparam-ref.c
index fe796be6..a81b32dd 100644
--- a/kernel/setparam-ref.c
+++ b/kernel/setparam-ref.c
@@ -1824,6 +1824,13 @@ static void init_parameter(void) {
   fprintf(stderr, "L2 = %8d DGEMM_P  .. %d\n", l2, TABLE_NAME.dgemm_p);
 #endif
 
+#if BUILD_BFLOAT16==1
+  TABLE_NAME.sbgemm_r = (((BUFFER_SIZE -
+			       ((TABLE_NAME.sbgemm_p * TABLE_NAME.sbgemm_q *  4 + TABLE_NAME.offsetA
+				 + TABLE_NAME.align) & ~TABLE_NAME.align)
+			       ) / (TABLE_NAME.sbgemm_q *  4) - 15) & ~15);
+#endif
+
 #if BUILD_SINGLE==1
   TABLE_NAME.sgemm_r = (((BUFFER_SIZE -
 			       ((TABLE_NAME.sgemm_p * TABLE_NAME.sgemm_q *  4 + TABLE_NAME.offsetA
