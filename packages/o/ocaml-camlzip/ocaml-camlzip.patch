--- /dev/null
+++ b/config/discover.ml
@@ -0,0 +1,21 @@
+module C = Configurator.V1
+
+let () =
+C.main ~name:"zip" (fun c ->
+
+let stale_gzip : C.Pkg_config.package_conf = {
+ libs = [ "-lz" ];
+ cflags = []
+} in
+
+let conf =
+  match C.Pkg_config.get c with
+  | None -> C.die "'pkg-config' missing"
+  | Some pc ->
+    match (C.Pkg_config.query pc ~package:"zlib") with
+      | None -> stale_gzip
+      | Some deps -> deps
+  in
+
+  C.Flags.write_sexp "c_flags.sexp"         conf.cflags;
+  C.Flags.write_sexp "c_library_flags.sexp" conf.libs)
--- /dev/null
+++ b/config/dune
@@ -0,0 +1,3 @@
+(executable
+ (name discover)
+ (libraries dune.configurator))
--- /dev/null
+++ b/dune
@@ -0,0 +1,18 @@
+(library
+ (public_name zip)
+ (synopsis "OCaml ZIP interface")
+ (wrapped false)
+ (modules gzip zip zlib)
+ (libraries stdlib-shims)
+ (c_names zlibstubs)
+ (c_flags
+  (:include c_flags.sexp))
+ (c_library_flags
+  (:include c_library_flags.sexp)))
+
+(rule
+ (targets c_flags.sexp c_library_flags.sexp)
+ (deps
+  (:discover config/discover.exe))
+ (action
+  (run %{discover})))
--- /dev/null
+++ b/dune-project
@@ -0,0 +1,26 @@
+(lang dune 1.10)
+
+(generate_opam_files true)
+
+(license "LGPL-2.1-or-later with OCaml-LGPL-linking-exception")
+
+(authors "Xavier Leroy")
+
+(maintainers "Xavier Leroy <xavier.leroy@college-de-france.fr>")
+
+(homepage "https://github.com/xavierleroy/camlzip")
+
+(bug_reports "https://github.com/xavierleroy/camlzip/issues")
+
+(package
+ (name zip)
+ (synopsis
+   "Accessing compressed files in ZIP, GZIP and JAR format.")
+ (description "The Camlzip library provides easy access to compressed files in ZIP and GZIP format, as well as to Java JAR files.  It provides functions for reading from and writing to compressed files in these formats.")
+ (depends
+  dune.configurator
+  dune
+  stdlib-shims
+  conf-zlib
+  (ocaml
+   (>= 4.02.0))))
