From 6a0bd6a46a662f9792966c06e61fed5fbed0aff4 Mon Sep 17 00:00:00 2001
From: Ferdinand Thiessen <rpm@fthiessen.de>
Date: Mon, 28 Feb 2022 15:06:43 +0100
Subject: [PATCH 1/2] openvswitch: merge compiler.h files into one file

Signed-off-by: Ferdinand Thiessen <rpm@fthiessen.de>
---
 include/openvswitch/compiler.h         | 14 ++++++++
 lib/bundle.h                           |  2 +-
 lib/command-line.h                     |  2 +-
 lib/compiler.h                         | 44 --------------------------
 lib/coverage.h                         |  2 +-
 lib/db-ctl-base.c                      |  3 +-
 lib/db-ctl-base.h                      |  2 +-
 lib/dns-resolve-stub.c                 |  2 +-
 lib/dpctl.c                            |  3 +-
 lib/dpctl.h                            |  2 +-
 lib/dpif-netdev-extract-avx512.c       |  4 +--
 lib/dpif-netdev-lookup-avx512-gather.c |  4 +--
 lib/dpif-netdev-lookup-generic.c       |  6 ++--
 lib/fat-rwlock.h                       |  2 +-
 lib/guarded-list.h                     |  2 +-
 lib/if-notifier-stub.c                 |  2 +-
 lib/learn.h                            |  2 +-
 lib/lldp/lldp.c                        |  2 +-
 lib/lldp/lldpd.c                       |  2 +-
 lib/multipath.h                        |  2 +-
 lib/netdev-native-tnl.h                |  2 +-
 lib/netdev-vport-private.h             |  2 +-
 lib/netdev-vport.h                     |  2 +-
 lib/netlink-conntrack.c                |  2 +-
 lib/netlink-conntrack.h                |  2 +-
 lib/nx-match.h                         |  2 +-
 lib/ofp-actions.c                      |  2 +-
 lib/ofp-print.c                        |  2 +-
 lib/ovs-atomic.h                       |  2 +-
 lib/ovs-numa.h                         |  2 +-
 lib/ovs-rcu.h                          |  2 +-
 lib/ovs-router.c                       |  4 +--
 lib/ovs-thread.c                       |  2 +-
 lib/ovsdb-data.h                       |  2 +-
 lib/ovsdb-error.h                      |  2 +-
 lib/ovsdb-idl.h                        |  2 +-
 lib/ovsdb-parser.h                     |  2 +-
 lib/ovsdb-types.h                      |  2 +-
 lib/packets.h                          |  2 +-
 lib/pcap-file.c                        |  2 +-
 lib/route-table-stub.c                 |  2 +-
 lib/rstp.h                             |  2 +-
 lib/sha1.c                             |  2 +-
 lib/stp.h                              |  2 +-
 lib/syslog-direct.c                    |  2 +-
 lib/syslog-libc.c                      |  2 +-
 lib/syslog-null.c                      |  2 +-
 lib/table.h                            |  2 +-
 lib/tun-metadata.c                     |  2 +-
 lib/unicode.h                          |  2 +-
 lib/util.c                             |  2 +-
 lib/util.h                             | 34 ++++++++++----------
 ofproto/ofproto-dpif-sflow.c           |  2 +-
 ovsdb/column.h                         |  2 +-
 ovsdb/condition.h                      |  2 +-
 ovsdb/file.h                           |  2 +-
 ovsdb/log.h                            |  2 +-
 ovsdb/mutation.h                       |  2 +-
 ovsdb/ovsdb-client.c                   |  2 +-
 ovsdb/ovsdb-tool.c                     |  3 +-
 ovsdb/ovsdb.h                          |  2 +-
 ovsdb/raft-rpc.c                       |  2 +-
 ovsdb/raft.h                           |  2 +-
 ovsdb/storage.h                        |  2 +-
 ovsdb/table.h                          |  2 +-
 ovsdb/transaction.h                    |  2 +-
 tests/ovstest.h                        |  2 +-
 tests/test-reconnect.c                 |  2 +-
 utilities/ovs-dpctl.c                  |  2 +-
 utilities/ovs-ofctl.c                  |  2 +-
 utilities/ovs-testcontroller.c         |  2 +-
 utilities/ovs-vsctl.c                  |  2 +-
 vswitchd/ovs-vswitchd.c                |  2 +-
 vtep/vtep-ctl.c                        |  4 +--
 74 files changed, 108 insertions(+), 141 deletions(-)
 delete mode 100644 lib/compiler.h

Index: openvswitch-2.17.2/include/openvswitch/compiler.h
===================================================================
--- openvswitch-2.17.2.orig/include/openvswitch/compiler.h
+++ openvswitch-2.17.2/include/openvswitch/compiler.h
@@ -27,6 +27,16 @@
   #define __has_extension(x) 0
 #endif
 
+/* Output a message (not an error) while compiling without failing the
+ * compilation process */
+#if HAVE_PRAGMA_MESSAGE && !__CHECKER__
+#define DO_PRAGMA(x) _Pragma(#x)
+#define BUILD_MESSAGE(x) \
+    DO_PRAGMA(message(x))
+#else
+#define BUILD_MESSAGE(x)
+#endif
+
 /* To make OVS_NO_RETURN portable across gcc/clang and MSVC, it should be
  * added at the beginning of the function declaration. */
 #if __GNUC__ && !__CHECKER__
@@ -38,6 +48,8 @@
 #endif
 
 #if __GNUC__ && !__CHECKER__
+#define OVS_MALLOC_LIKE __attribute__((__malloc__))
+#define OVS_ALWAYS_INLINE __attribute__((always_inline))
 #define OVS_UNUSED __attribute__((__unused__))
 #define OVS_PRINTF_FORMAT(FMT, ARG1) __attribute__((__format__(printf, FMT, ARG1)))
 #define OVS_SCANF_FORMAT(FMT, ARG1) __attribute__((__format__(scanf, FMT, ARG1)))
@@ -51,6 +63,8 @@
 #define OVS_WARN_UNUSED_RESULT
 #define OVS_LIKELY(CONDITION) (!!(CONDITION))
 #define OVS_UNLIKELY(CONDITION) (!!(CONDITION))
+#define OVS_MALLOC_LIKE
+#define OVS_ALWAYS_INLINE
 #endif
 
 #if __has_feature(c_thread_safety_attributes)
Index: openvswitch-2.17.2/lib/bundle.h
===================================================================
--- openvswitch-2.17.2.orig/lib/bundle.h
+++ openvswitch-2.17.2/lib/bundle.h
@@ -23,7 +23,7 @@
 #include <stddef.h>
 #include <stdint.h>
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openflow/nicira-ext.h"
 #include "openvswitch/ofp-errors.h"
 #include "openvswitch/types.h"
Index: openvswitch-2.17.2/lib/command-line.h
===================================================================
--- openvswitch-2.17.2.orig/lib/command-line.h
+++ openvswitch-2.17.2/lib/command-line.h
@@ -19,7 +19,7 @@
 
 /* Utilities for command-line parsing. */
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 struct option;
 
Index: openvswitch-2.17.2/lib/compiler.h
===================================================================
--- openvswitch-2.17.2.orig/lib/compiler.h
+++ /dev/null
@@ -1,44 +0,0 @@
-/*
- * Copyright (c) 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2019 Nicira, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at:
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-#ifndef COMPILER_H
-#define COMPILER_H 1
-
-#include "openvswitch/compiler.h"
-
-#if __GNUC__ && !__CHECKER__
-#define STRFTIME_FORMAT(FMT) __attribute__((__format__(__strftime__, FMT, 0)))
-#define MALLOC_LIKE __attribute__((__malloc__))
-#define ALWAYS_INLINE __attribute__((always_inline))
-#define SENTINEL(N) __attribute__((sentinel(N)))
-#else
-#define STRFTIME_FORMAT(FMT)
-#define MALLOC_LIKE
-#define ALWAYS_INLINE
-#define SENTINEL(N)
-#endif
-
-/* Output a message (not an error) while compiling without failing the
- * compilation process */
-#if HAVE_PRAGMA_MESSAGE && !__CHECKER__
-#define DO_PRAGMA(x) _Pragma(#x)
-#define BUILD_MESSAGE(x) \
-    DO_PRAGMA(message(x))
-#else
-#define BUILD_MESSAGE(x)
-#endif
-
-#endif /* compiler.h */
Index: openvswitch-2.17.2/lib/coverage.h
===================================================================
--- openvswitch-2.17.2.orig/lib/coverage.h
+++ openvswitch-2.17.2/lib/coverage.h
@@ -28,7 +28,7 @@
  * a useful debugging tool. */
 
 #include "ovs-thread.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 /* Makes coverage_run run every 5000 ms (5 seconds).
  * If this value is redefined, the new value must
Index: openvswitch-2.17.2/lib/db-ctl-base.c
===================================================================
--- openvswitch-2.17.2.orig/lib/db-ctl-base.c
+++ openvswitch-2.17.2/lib/db-ctl-base.c
@@ -22,8 +22,7 @@
 
 #include "db-ctl-base.h"
 
-#include "command-line.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "dirs.h"
 #include "openvswitch/dynamic-string.h"
 #include "fatal-signal.h"
Index: openvswitch-2.17.2/lib/db-ctl-base.h
===================================================================
--- openvswitch-2.17.2.orig/lib/db-ctl-base.h
+++ openvswitch-2.17.2/lib/db-ctl-base.h
@@ -17,7 +17,7 @@
 #ifndef DB_CTL_BASE_H
 #define DB_CTL_BASE_H 1
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/dynamic-string.h"
 #include "openvswitch/shash.h"
 
Index: openvswitch-2.17.2/lib/dns-resolve-stub.c
===================================================================
--- openvswitch-2.17.2.orig/lib/dns-resolve-stub.c
+++ openvswitch-2.17.2/lib/dns-resolve-stub.c
@@ -16,7 +16,7 @@
 
 #include <config.h>
 #include "dns-resolve.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 void
 dns_resolve_init(bool is_daemon OVS_UNUSED)
Index: openvswitch-2.17.2/lib/dpctl.c
===================================================================
--- openvswitch-2.17.2.orig/lib/dpctl.c
+++ openvswitch-2.17.2/lib/dpctl.c
@@ -27,8 +27,7 @@
 #include <string.h>
 #include <unistd.h>
 
-#include "command-line.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "ct-dpif.h"
 #include "dirs.h"
 #include "dpctl.h"
Index: openvswitch-2.17.2/lib/dpctl.h
===================================================================
--- openvswitch-2.17.2.orig/lib/dpctl.h
+++ openvswitch-2.17.2/lib/dpctl.h
@@ -18,7 +18,7 @@
 
 #include <stdbool.h>
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 struct dpctl_params {
     /* True if it is called by ovs-appctl command. */
Index: openvswitch-2.17.2/lib/dpif-netdev-extract-avx512.c
===================================================================
--- openvswitch-2.17.2.orig/lib/dpif-netdev-extract-avx512.c
+++ openvswitch-2.17.2/lib/dpif-netdev-extract-avx512.c
@@ -468,12 +468,12 @@ mfex_handle_tcp_flags(const struct tcp_h
 }
 
 /* Generic loop to process any mfex profile. This code is specialized into
- * multiple actual MFEX implementation functions. Its marked ALWAYS_INLINE
+ * multiple actual MFEX implementation functions. Its marked OVS_ALWAYS_INLINE
  * to ensure the compiler specializes each instance. The code is marked "hot"
  * to inform the compiler this is a hotspot in the program, encouraging
  * inlining of callee functions such as the permute calls.
  */
-static inline uint32_t ALWAYS_INLINE
+static inline uint32_t OVS_ALWAYS_INLINE
 __attribute__ ((hot))
 mfex_avx512_process(struct dp_packet_batch *packets,
                     struct netdev_flow_key *keys,
Index: openvswitch-2.17.2/lib/dpif-netdev-lookup-avx512-gather.c
===================================================================
--- openvswitch-2.17.2.orig/lib/dpif-netdev-lookup-avx512-gather.c
+++ openvswitch-2.17.2/lib/dpif-netdev-lookup-avx512-gather.c
@@ -152,7 +152,7 @@ netdev_rule_matches_key(const struct dpc
  *   u64_lanes_mask: bitmask of lanes to process.
  *   use_vpop: compile-time constant indicating if VPOPCNT instruction allowed.
  */
-static inline ALWAYS_INLINE __m512i
+static inline OVS_ALWAYS_INLINE __m512i
 avx512_blocks_gather(__m512i v_u0,
                      __m512i v_u1,
                      const uint64_t *pkt_blocks,
@@ -203,7 +203,7 @@ avx512_blocks_gather(__m512i v_u0,
         return v_masked_blocks;
 }
 
-static inline uint32_t ALWAYS_INLINE
+static inline uint32_t OVS_ALWAYS_INLINE
 avx512_lookup_impl(struct dpcls_subtable *subtable,
                    uint32_t keys_map,
                    const struct netdev_flow_key *keys[],
Index: openvswitch-2.17.2/lib/dpif-netdev-lookup-generic.c
===================================================================
--- openvswitch-2.17.2.orig/lib/dpif-netdev-lookup-generic.c
+++ openvswitch-2.17.2/lib/dpif-netdev-lookup-generic.c
@@ -170,12 +170,12 @@ netdev_rule_matches_key(const struct dpc
  * unroll loops and flatten out code-sequences based on the knowledge of the
  * mf_bits_* compile time values. This results in improved performance.
  *
- * Note: this function is marked with ALWAYS_INLINE to ensure the compiler
+ * Note: this function is marked with OVS_ALWAYS_INLINE to ensure the compiler
  * inlines the below code, and then uses the compile time constants to make
- * specialized versions of the runtime code. Without ALWAYS_INLINE, the
+ * specialized versions of the runtime code. Without OVS_ALWAYS_INLINE, the
  * compiler might decide to not inline, and performance will suffer.
  */
-static inline uint32_t ALWAYS_INLINE
+static inline uint32_t OVS_ALWAYS_INLINE
 lookup_generic_impl(struct dpcls_subtable *subtable,
                     uint32_t keys_map,
                     const struct netdev_flow_key *keys[],
Index: openvswitch-2.17.2/lib/fat-rwlock.h
===================================================================
--- openvswitch-2.17.2.orig/lib/fat-rwlock.h
+++ openvswitch-2.17.2/lib/fat-rwlock.h
@@ -17,7 +17,7 @@
 #ifndef FAT_RWLOCK_H
 #define FAT_RWLOCK_H 1
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/list.h"
 #include "ovs-thread.h"
 
Index: openvswitch-2.17.2/lib/guarded-list.h
===================================================================
--- openvswitch-2.17.2.orig/lib/guarded-list.h
+++ openvswitch-2.17.2/lib/guarded-list.h
@@ -18,7 +18,7 @@
 #define GUARDED_LIST_H 1
 
 #include <stddef.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/list.h"
 #include "ovs-thread.h"
 
Index: openvswitch-2.17.2/lib/if-notifier-stub.c
===================================================================
--- openvswitch-2.17.2.orig/lib/if-notifier-stub.c
+++ openvswitch-2.17.2/lib/if-notifier-stub.c
@@ -17,7 +17,7 @@
 #include <config.h>
 #include "if-notifier.h"
 #include <stddef.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 struct if_notifier *
 if_notifier_create(if_notify_func *cb OVS_UNUSED, void *aux OVS_UNUSED)
Index: openvswitch-2.17.2/lib/learn.h
===================================================================
--- openvswitch-2.17.2.orig/lib/learn.h
+++ openvswitch-2.17.2/lib/learn.h
@@ -17,7 +17,7 @@
 #ifndef LEARN_H
 #define LEARN_H 1
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/ofp-errors.h"
 
 struct ds;
Index: openvswitch-2.17.2/lib/lldp/lldp.c
===================================================================
--- openvswitch-2.17.2.orig/lib/lldp/lldp.c
+++ openvswitch-2.17.2/lib/lldp/lldp.c
@@ -25,7 +25,7 @@
 #include <sys/ioctl.h>
 #include <sys/socket.h>
 #include <sys/types.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "dp-packet.h"
 #include "packets.h"
 
Index: openvswitch-2.17.2/lib/lldp/lldpd.c
===================================================================
--- openvswitch-2.17.2.orig/lib/lldp/lldpd.c
+++ openvswitch-2.17.2/lib/lldp/lldpd.c
@@ -39,7 +39,7 @@
 #include <sys/select.h>
 #include <sys/utsname.h>
 #endif
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/dynamic-string.h"
 #include "openvswitch/list.h"
 #include "packets.h"
Index: openvswitch-2.17.2/lib/multipath.h
===================================================================
--- openvswitch-2.17.2.orig/lib/multipath.h
+++ openvswitch-2.17.2/lib/multipath.h
@@ -18,7 +18,7 @@
 #define MULTIPATH_H 1
 
 #include <stdint.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/ofp-errors.h"
 
 struct ds;
Index: openvswitch-2.17.2/lib/netdev-native-tnl.h
===================================================================
--- openvswitch-2.17.2.orig/lib/netdev-native-tnl.h
+++ openvswitch-2.17.2/lib/netdev-native-tnl.h
@@ -19,7 +19,7 @@
 
 #include <stdbool.h>
 #include <stddef.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "dp-packet.h"
 #include "packets.h"
 #include "unixctl.h"
Index: openvswitch-2.17.2/lib/netdev-vport-private.h
===================================================================
--- openvswitch-2.17.2.orig/lib/netdev-vport-private.h
+++ openvswitch-2.17.2/lib/netdev-vport-private.h
@@ -19,7 +19,7 @@
 
 #include <stdbool.h>
 #include <stddef.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "netdev.h"
 #include "netdev-provider.h"
 #include "ovs-thread.h"
Index: openvswitch-2.17.2/lib/netdev-vport.h
===================================================================
--- openvswitch-2.17.2.orig/lib/netdev-vport.h
+++ openvswitch-2.17.2/lib/netdev-vport.h
@@ -19,7 +19,7 @@
 
 #include <stdbool.h>
 #include <stddef.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 struct dpif_netlink_vport;
 struct dpif_flow_stats;
Index: openvswitch-2.17.2/lib/netlink-conntrack.c
===================================================================
--- openvswitch-2.17.2.orig/lib/netlink-conntrack.c
+++ openvswitch-2.17.2/lib/netlink-conntrack.c
@@ -27,7 +27,7 @@
 #include <linux/netfilter/nf_conntrack_sctp.h>
 
 #include "byte-order.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/dynamic-string.h"
 #include "netlink.h"
 #include "netlink-socket.h"
Index: openvswitch-2.17.2/lib/netlink-conntrack.h
===================================================================
--- openvswitch-2.17.2.orig/lib/netlink-conntrack.h
+++ openvswitch-2.17.2/lib/netlink-conntrack.h
@@ -20,7 +20,7 @@
 #include <linux/netfilter/nfnetlink_cttimeout.h>
 
 #include "byte-order.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "ct-dpif.h"
 #include "openvswitch/dynamic-string.h"
 #include "openvswitch/hmap.h"
Index: openvswitch-2.17.2/lib/nx-match.h
===================================================================
--- openvswitch-2.17.2.orig/lib/nx-match.h
+++ openvswitch-2.17.2/lib/nx-match.h
@@ -20,7 +20,7 @@
 #include <stdint.h>
 #include <sys/types.h>
 #include <netinet/in.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "flow.h"
 #include "openvswitch/meta-flow.h"
 #include "openvswitch/ofp-errors.h"
Index: openvswitch-2.17.2/lib/ofp-actions.c
===================================================================
--- openvswitch-2.17.2.orig/lib/ofp-actions.c
+++ openvswitch-2.17.2/lib/ofp-actions.c
@@ -22,7 +22,7 @@
 #include "bundle.h"
 #include "byte-order.h"
 #include "colors.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "dummy.h"
 #include "openvswitch/hmap.h"
 #include "learn.h"
Index: openvswitch-2.17.2/lib/ofp-print.c
===================================================================
--- openvswitch-2.17.2.orig/lib/ofp-print.c
+++ openvswitch-2.17.2/lib/ofp-print.c
@@ -30,7 +30,7 @@
 #include "bundle.h"
 #include "byte-order.h"
 #include "colors.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "dp-packet.h"
 #include "flow.h"
 #include "learn.h"
Index: openvswitch-2.17.2/lib/ovs-atomic.h
===================================================================
--- openvswitch-2.17.2.orig/lib/ovs-atomic.h
+++ openvswitch-2.17.2/lib/ovs-atomic.h
@@ -322,7 +322,7 @@
 #include <stdbool.h>
 #include <stddef.h>
 #include <stdint.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "util.h"
 
 #define IN_OVS_ATOMIC_H
Index: openvswitch-2.17.2/lib/ovs-numa.h
===================================================================
--- openvswitch-2.17.2.orig/lib/ovs-numa.h
+++ openvswitch-2.17.2/lib/ovs-numa.h
@@ -20,7 +20,7 @@
 #include <limits.h>
 #include <stdbool.h>
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/hmap.h"
 
 #define OVS_CORE_UNSPEC INT_MAX
Index: openvswitch-2.17.2/lib/ovs-rcu.h
===================================================================
--- openvswitch-2.17.2.orig/lib/ovs-rcu.h
+++ openvswitch-2.17.2/lib/ovs-rcu.h
@@ -170,7 +170,7 @@
  *     }
  */
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "ovs-atomic.h"
 
 #if __GNUC__
Index: openvswitch-2.17.2/lib/ovs-router.c
===================================================================
--- openvswitch-2.17.2.orig/lib/ovs-router.c
+++ openvswitch-2.17.2/lib/ovs-router.c
@@ -31,8 +31,8 @@
 #include <unistd.h>
 
 #include "classifier.h"
-#include "command-line.h"
-#include "compiler.h"
+#include "colors.h"
+#include "openvswitch/compiler.h"
 #include "dpif.h"
 #include "fatal-signal.h"
 #include "openvswitch/dynamic-string.h"
Index: openvswitch-2.17.2/lib/ovs-thread.c
===================================================================
--- openvswitch-2.17.2.orig/lib/ovs-thread.c
+++ openvswitch-2.17.2/lib/ovs-thread.c
@@ -23,7 +23,7 @@
 #endif
 #include <stdlib.h>
 #include <unistd.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "fatal-signal.h"
 #include "hash.h"
 #include "openvswitch/list.h"
Index: openvswitch-2.17.2/lib/ovsdb-data.h
===================================================================
--- openvswitch-2.17.2.orig/lib/ovsdb-data.h
+++ openvswitch-2.17.2/lib/ovsdb-data.h
@@ -17,7 +17,7 @@
 #define OVSDB_DATA_H 1
 
 #include <stdlib.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "ovsdb-types.h"
 #include "openvswitch/json.h"
 #include "openvswitch/shash.h"
Index: openvswitch-2.17.2/lib/ovsdb-error.h
===================================================================
--- openvswitch-2.17.2.orig/lib/ovsdb-error.h
+++ openvswitch-2.17.2/lib/ovsdb-error.h
@@ -16,7 +16,7 @@
 #ifndef OVSDB_ERROR_H
 #define OVSDB_ERROR_H 1
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 struct json;
 
Index: openvswitch-2.17.2/lib/ovsdb-idl.h
===================================================================
--- openvswitch-2.17.2.orig/lib/ovsdb-idl.h
+++ openvswitch-2.17.2/lib/ovsdb-idl.h
@@ -37,7 +37,7 @@
 
 #include <stdbool.h>
 #include <stdint.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "ovsdb-types.h"
 #include "ovsdb-data.h"
 #include "openvswitch/list.h"
Index: openvswitch-2.17.2/lib/ovsdb-parser.h
===================================================================
--- openvswitch-2.17.2.orig/lib/ovsdb-parser.h
+++ openvswitch-2.17.2/lib/ovsdb-parser.h
@@ -17,7 +17,7 @@
 #define OVSDB_PARSER_H 1
 
 #include <stdbool.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/json.h"
 #include "sset.h"
 #include "util.h"
Index: openvswitch-2.17.2/lib/ovsdb-types.h
===================================================================
--- openvswitch-2.17.2.orig/lib/ovsdb-types.h
+++ openvswitch-2.17.2/lib/ovsdb-types.h
@@ -19,7 +19,7 @@
 #include <float.h>
 #include <stdbool.h>
 #include <stdint.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "uuid.h"
 
 #ifdef __cplusplus
Index: openvswitch-2.17.2/lib/packets.h
===================================================================
--- openvswitch-2.17.2.orig/lib/packets.h
+++ openvswitch-2.17.2/lib/packets.h
@@ -21,7 +21,7 @@
 #include <sys/types.h>
 #include <stdint.h>
 #include <string.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/geneve.h"
 #include "openvswitch/packets.h"
 #include "openvswitch/types.h"
Index: openvswitch-2.17.2/lib/pcap-file.c
===================================================================
--- openvswitch-2.17.2.orig/lib/pcap-file.c
+++ openvswitch-2.17.2/lib/pcap-file.c
@@ -22,7 +22,7 @@
 #include <string.h>
 #include <sys/stat.h>
 #include "byte-order.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "dp-packet.h"
 #include "flow.h"
 #include "openvswitch/hmap.h"
Index: openvswitch-2.17.2/lib/route-table-stub.c
===================================================================
--- openvswitch-2.17.2.orig/lib/route-table-stub.c
+++ openvswitch-2.17.2/lib/route-table-stub.c
@@ -14,7 +14,7 @@
 
 #include <config.h>
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "ovs-router.h"
 #include "route-table.h"
 
Index: openvswitch-2.17.2/lib/rstp.h
===================================================================
--- openvswitch-2.17.2.orig/lib/rstp.h
+++ openvswitch-2.17.2/lib/rstp.h
@@ -33,7 +33,7 @@
 
 #include <stdint.h>
 #include <stdbool.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "util.h"
 
 /* Thread Safety: Callers passing in RSTP and RSTP port object
Index: openvswitch-2.17.2/lib/sha1.c
===================================================================
--- openvswitch-2.17.2.orig/lib/sha1.c
+++ openvswitch-2.17.2/lib/sha1.c
@@ -33,7 +33,7 @@
 #include "sha1.h"
 #include <ctype.h>
 #include <string.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "util.h"
 
 /* a bit faster & bigger, if defined */
Index: openvswitch-2.17.2/lib/stp.h
===================================================================
--- openvswitch-2.17.2.orig/lib/stp.h
+++ openvswitch-2.17.2/lib/stp.h
@@ -22,7 +22,7 @@
 
 #include <stdbool.h>
 #include <stdint.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "util.h"
 
 struct dp_packet;
Index: openvswitch-2.17.2/lib/syslog-direct.c
===================================================================
--- openvswitch-2.17.2.orig/lib/syslog-direct.c
+++ openvswitch-2.17.2/lib/syslog-direct.c
@@ -20,7 +20,7 @@
 #include <string.h>
 #include <unistd.h>
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/dynamic-string.h"
 #include "socket-util.h"
 #include "syslog-provider.h"
Index: openvswitch-2.17.2/lib/syslog-libc.c
===================================================================
--- openvswitch-2.17.2.orig/lib/syslog-libc.c
+++ openvswitch-2.17.2/lib/syslog-libc.c
@@ -21,7 +21,7 @@
 #include <syslog.h>
 #include <unistd.h>
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/dynamic-string.h"
 #include "socket-util.h"
 #include "syslog-provider.h"
Index: openvswitch-2.17.2/lib/syslog-null.c
===================================================================
--- openvswitch-2.17.2.orig/lib/syslog-null.c
+++ openvswitch-2.17.2/lib/syslog-null.c
@@ -17,7 +17,7 @@
 
 #include <config.h>
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "syslog-provider.h"
 #include "util.h"
 
Index: openvswitch-2.17.2/lib/table.h
===================================================================
--- openvswitch-2.17.2.orig/lib/table.h
+++ openvswitch-2.17.2/lib/table.h
@@ -19,7 +19,7 @@
 
 #include <stdbool.h>
 #include <stddef.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/json.h"
 
 struct ds;
Index: openvswitch-2.17.2/lib/tun-metadata.c
===================================================================
--- openvswitch-2.17.2.orig/lib/tun-metadata.c
+++ openvswitch-2.17.2/lib/tun-metadata.c
@@ -19,7 +19,7 @@
 #include <stdbool.h>
 
 #include "bitmap.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/hmap.h"
 #include "openvswitch/match.h"
 #include "nx-match.h"
Index: openvswitch-2.17.2/lib/unicode.h
===================================================================
--- openvswitch-2.17.2.orig/lib/unicode.h
+++ openvswitch-2.17.2/lib/unicode.h
@@ -19,7 +19,7 @@
 
 #include <stdbool.h>
 #include <stddef.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 /* Returns true if 'c' is a Unicode code point, otherwise false. */
 static inline bool
Index: openvswitch-2.17.2/lib/util.c
===================================================================
--- openvswitch-2.17.2.orig/lib/util.c
+++ openvswitch-2.17.2/lib/util.c
@@ -202,7 +202,7 @@ xstrdup(const char *s)
     return xmemdup0(s, strlen(s));
 }
 
-char * MALLOC_LIKE
+char * OVS_MALLOC_LIKE
 nullable_xstrdup(const char *s)
 {
     return s ? xstrdup(s) : NULL;
Index: openvswitch-2.17.2/lib/util.h
===================================================================
--- openvswitch-2.17.2.orig/lib/util.h
+++ openvswitch-2.17.2/lib/util.h
@@ -26,7 +26,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "util.h"
 #include "openvswitch/util.h"
 #if defined(__aarch64__) && __GNUC__ >= 6
@@ -156,28 +156,28 @@ bool memory_locked(void);
 OVS_NO_RETURN void out_of_memory(void);
 
 /* Allocation wrappers that abort if memory is exhausted. */
-void *xmalloc(size_t) MALLOC_LIKE;
-void *xcalloc(size_t, size_t) MALLOC_LIKE;
-void *xzalloc(size_t) MALLOC_LIKE;
+void *xmalloc(size_t) OVS_MALLOC_LIKE;
+void *xcalloc(size_t, size_t) OVS_MALLOC_LIKE;
+void *xzalloc(size_t) OVS_MALLOC_LIKE;
 void *xrealloc(void *, size_t);
-void *xmemdup(const void *, size_t) MALLOC_LIKE;
-char *xmemdup0(const char *, size_t) MALLOC_LIKE;
-char *xstrdup(const char *) MALLOC_LIKE;
-char *nullable_xstrdup(const char *) MALLOC_LIKE;
+void *xmemdup(const void *, size_t) OVS_MALLOC_LIKE;
+char *xmemdup0(const char *, size_t) OVS_MALLOC_LIKE;
+char *xstrdup(const char *) OVS_MALLOC_LIKE;
+char *nullable_xstrdup(const char *) OVS_MALLOC_LIKE;
 bool nullable_string_is_equal(const char *a, const char *b);
-char *xasprintf(const char *format, ...) OVS_PRINTF_FORMAT(1, 2) MALLOC_LIKE;
-char *xvasprintf(const char *format, va_list) OVS_PRINTF_FORMAT(1, 0) MALLOC_LIKE;
+char *xasprintf(const char *format, ...) OVS_PRINTF_FORMAT(1, 2) OVS_MALLOC_LIKE;
+char *xvasprintf(const char *format, va_list) OVS_PRINTF_FORMAT(1, 0) OVS_MALLOC_LIKE;
 void *x2nrealloc(void *p, size_t *n, size_t s);
 
 /* Allocation wrappers for specialized situations where coverage counters
  * cannot be used. */
-void *xmalloc__(size_t) MALLOC_LIKE;
-void *xcalloc__(size_t, size_t) MALLOC_LIKE;
-void *xzalloc__(size_t) MALLOC_LIKE;
+void *xmalloc__(size_t) OVS_MALLOC_LIKE;
+void *xcalloc__(size_t, size_t) OVS_MALLOC_LIKE;
+void *xzalloc__(size_t) OVS_MALLOC_LIKE;
 void *xrealloc__(void *, size_t);
 
-void *xmalloc_cacheline(size_t) MALLOC_LIKE;
-void *xzalloc_cacheline(size_t) MALLOC_LIKE;
+void *xmalloc_cacheline(size_t) OVS_MALLOC_LIKE;
+void *xzalloc_cacheline(size_t) OVS_MALLOC_LIKE;
 void free_cacheline(void *);
 
 void ovs_strlcpy(char *dst, const char *src, size_t size);
@@ -185,9 +185,9 @@ void ovs_strzcpy(char *dst, const char *
 
 int string_ends_with(const char *str, const char *suffix);
 
-void *xmalloc_pagealign(size_t) MALLOC_LIKE;
+void *xmalloc_pagealign(size_t) OVS_MALLOC_LIKE;
 void free_pagealign(void *);
-void *xmalloc_size_align(size_t, size_t) MALLOC_LIKE;
+void *xmalloc_size_align(size_t, size_t) OVS_MALLOC_LIKE;
 void free_size_align(void *);
 
 /* The C standards say that neither the 'dst' nor 'src' argument to
Index: openvswitch-2.17.2/ofproto/ofproto-dpif-sflow.c
===================================================================
--- openvswitch-2.17.2.orig/ofproto/ofproto-dpif-sflow.c
+++ openvswitch-2.17.2/ofproto/ofproto-dpif-sflow.c
@@ -23,7 +23,7 @@
 #include <net/if.h>
 #include <stdlib.h>
 #include "collectors.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "dpif.h"
 #include "hash.h"
 #include "openvswitch/hmap.h"
Index: openvswitch-2.17.2/ovsdb/column.h
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/column.h
+++ openvswitch-2.17.2/ovsdb/column.h
@@ -17,7 +17,7 @@
 #define OVSDB_COLUMN_H 1
 
 #include <stdbool.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "ovsdb-types.h"
 
 struct ovsdb_table;
Index: openvswitch-2.17.2/ovsdb/condition.h
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/condition.h
+++ openvswitch-2.17.2/ovsdb/condition.h
@@ -17,7 +17,7 @@
 #define OVSDB_CONDITION_H 1
 
 #include <stddef.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "ovsdb-data.h"
 #include "bitmap.h"
 #include "ovsdb-condition.h"
Index: openvswitch-2.17.2/ovsdb/file.h
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/file.h
+++ openvswitch-2.17.2/ovsdb/file.h
@@ -17,7 +17,7 @@
 #define OVSDB_FILE_H 1
 
 #include <stdbool.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 struct ovsdb;
 struct ovsdb_schema;
Index: openvswitch-2.17.2/ovsdb/log.h
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/log.h
+++ openvswitch-2.17.2/ovsdb/log.h
@@ -37,7 +37,7 @@
 
 #include <stdint.h>
 #include <sys/types.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 struct ds;
 struct json;
Index: openvswitch-2.17.2/ovsdb/mutation.h
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/mutation.h
+++ openvswitch-2.17.2/ovsdb/mutation.h
@@ -17,7 +17,7 @@
 #define OVSDB_MUTATION_H 1
 
 #include <stddef.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "ovsdb-data.h"
 
 struct json;
Index: openvswitch-2.17.2/ovsdb/ovsdb-client.c
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/ovsdb-client.c
+++ openvswitch-2.17.2/ovsdb/ovsdb-client.c
@@ -28,7 +28,7 @@
 
 #include "command-line.h"
 #include "column.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "daemon.h"
 #include "dirs.h"
 #include "openvswitch/dynamic-string.h"
Index: openvswitch-2.17.2/ovsdb/ovsdb-tool.c
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/ovsdb-tool.c
+++ openvswitch-2.17.2/ovsdb/ovsdb-tool.c
@@ -23,8 +23,7 @@
 #include <string.h>
 
 #include "column.h"
-#include "command-line.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "dirs.h"
 #include "openvswitch/dynamic-string.h"
 #include "fatal-signal.h"
Index: openvswitch-2.17.2/ovsdb/ovsdb.h
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/ovsdb.h
+++ openvswitch-2.17.2/ovsdb/ovsdb.h
@@ -16,7 +16,7 @@
 #ifndef OVSDB_OVSDB_H
 #define OVSDB_OVSDB_H 1
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/hmap.h"
 #include "openvswitch/list.h"
 #include "openvswitch/shash.h"
Index: openvswitch-2.17.2/ovsdb/raft-rpc.c
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/raft-rpc.c
+++ openvswitch-2.17.2/ovsdb/raft-rpc.c
@@ -19,7 +19,7 @@
 #include "raft-rpc.h"
 #include <stdlib.h>
 #include <string.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "jsonrpc.h"
 #include "ovsdb-error.h"
 #include "ovsdb-parser.h"
Index: openvswitch-2.17.2/ovsdb/raft.h
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/raft.h
+++ openvswitch-2.17.2/ovsdb/raft.h
@@ -61,7 +61,7 @@
 
 #include <stdbool.h>
 #include <stdint.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "uuid.h"
 
 struct json;
Index: openvswitch-2.17.2/ovsdb/storage.h
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/storage.h
+++ openvswitch-2.17.2/ovsdb/storage.h
@@ -18,7 +18,7 @@
 
 #include <stdint.h>
 #include <sys/types.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 struct json;
 struct ovsdb_schema;
Index: openvswitch-2.17.2/ovsdb/table.h
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/table.h
+++ openvswitch-2.17.2/ovsdb/table.h
@@ -17,7 +17,7 @@
 #define OVSDB_TABLE_H 1
 
 #include <stdbool.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/hmap.h"
 #include "openvswitch/shash.h"
 
Index: openvswitch-2.17.2/ovsdb/transaction.h
===================================================================
--- openvswitch-2.17.2.orig/ovsdb/transaction.h
+++ openvswitch-2.17.2/ovsdb/transaction.h
@@ -17,7 +17,7 @@
 #define OVSDB_TRANSACTION_H 1
 
 #include <stdbool.h>
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 struct json;
 struct ovsdb;
Index: openvswitch-2.17.2/tests/ovstest.h
===================================================================
--- openvswitch-2.17.2.orig/tests/ovstest.h
+++ openvswitch-2.17.2/tests/ovstest.h
@@ -17,7 +17,7 @@
 #ifndef OVSTEST_H
 #define OVSTEST_H
 
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 
 #include "command-line.h"
 
Index: openvswitch-2.17.2/tests/test-reconnect.c
===================================================================
--- openvswitch-2.17.2.orig/tests/test-reconnect.c
+++ openvswitch-2.17.2/tests/test-reconnect.c
@@ -21,8 +21,8 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
+#include "openvswitch/compiler.h"
 #include "command-line.h"
-#include "compiler.h"
 #include "ovstest.h"
 #include "svec.h"
 #include "util.h"
Index: openvswitch-2.17.2/utilities/ovs-dpctl.c
===================================================================
--- openvswitch-2.17.2.orig/utilities/ovs-dpctl.c
+++ openvswitch-2.17.2/utilities/ovs-dpctl.c
@@ -31,8 +31,8 @@
 #include <sys/stat.h>
 #include <sys/time.h>
 
+#include "openvswitch/compiler.h"
 #include "command-line.h"
-#include "compiler.h"
 #include "dirs.h"
 #include "dpctl.h"
 #include "fatal-signal.h"
Index: openvswitch-2.17.2/utilities/ovs-ofctl.c
===================================================================
--- openvswitch-2.17.2.orig/utilities/ovs-ofctl.c
+++ openvswitch-2.17.2/utilities/ovs-ofctl.c
@@ -34,7 +34,7 @@
 #include "command-line.h"
 #include "daemon.h"
 #include "colors.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "dirs.h"
 #include "dp-packet.h"
 #include "fatal-signal.h"
Index: openvswitch-2.17.2/utilities/ovs-testcontroller.c
===================================================================
--- openvswitch-2.17.2.orig/utilities/ovs-testcontroller.c
+++ openvswitch-2.17.2/utilities/ovs-testcontroller.c
@@ -24,8 +24,8 @@
 #include <stdio.h>
 #include <string.h>
 
+#include "openvswitch/compiler.h"
 #include "command-line.h"
-#include "compiler.h"
 #include "daemon.h"
 #include "fatal-signal.h"
 #include "learning-switch.h"
Index: openvswitch-2.17.2/utilities/ovs-vsctl.c
===================================================================
--- openvswitch-2.17.2.orig/utilities/ovs-vsctl.c
+++ openvswitch-2.17.2/utilities/ovs-vsctl.c
@@ -29,8 +29,8 @@
 
 #include "db-ctl-base.h"
 
+#include "openvswitch/compiler.h"
 #include "command-line.h"
-#include "compiler.h"
 #include "dirs.h"
 #include "fatal-signal.h"
 #include "hash.h"
Index: openvswitch-2.17.2/vswitchd/ovs-vswitchd.c
===================================================================
--- openvswitch-2.17.2.orig/vswitchd/ovs-vswitchd.c
+++ openvswitch-2.17.2/vswitchd/ovs-vswitchd.c
@@ -26,8 +26,8 @@
 #endif
 
 #include "bridge.h"
+#include "openvswitch/compiler.h"
 #include "command-line.h"
-#include "compiler.h"
 #include "daemon.h"
 #include "dirs.h"
 #include "dpif.h"
Index: openvswitch-2.17.2/vtep/vtep-ctl.c
===================================================================
--- openvswitch-2.17.2.orig/vtep/vtep-ctl.c
+++ openvswitch-2.17.2/vtep/vtep-ctl.c
@@ -29,9 +29,9 @@
 
 #include "db-ctl-base.h"
 
-#include "command-line.h"
-#include "compiler.h"
+#include "openvswitch/compiler.h"
 #include "openvswitch/dynamic-string.h"
+#include "command-line.h"
 #include "fatal-signal.h"
 #include "hash.h"
 #include "openvswitch/json.h"
