From e1084440d543f3045038cc4e5fdc0a67eabf06d6 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stefan=20Br=C3=BCns?= <stefan.bruens@rwth-aachen.de>
Date: Mon, 10 Feb 2020 18:37:32 +0100
Subject: [PATCH] Use absolute CMAKE_INSTALL_FULL_LIBDIR for libdir in
 pkgconfig files

According to cmake GNUInstallDirs documentation, CMAKE_INSTALL_LIBDIR
may be either absolute or relative to CMAKE_INSTALL_PREFIX. Use
CMAKE_INSTALL_FULL_LIBDIR, which is always the full absolute path.

Remove unused exec_prefix variable.

Fixes https://github.com/AcademySoftwareFoundation/openexr/issues/595
---
 IlmBase/IlmBase.pc.in           | 1 -
 IlmBase/config/CMakeLists.txt   | 4 ++--
 OpenEXR/OpenEXR.pc.in           | 1 -
 OpenEXR/config/CMakeLists.txt   | 5 ++---
 PyIlmBase/config/CMakeLists.txt | 4 ++--
 5 files changed, 6 insertions(+), 9 deletions(-)

Index: openexr-2.5.7/IlmBase/IlmBase.pc.in
===================================================================
--- openexr-2.5.7.orig/IlmBase/IlmBase.pc.in	2021-06-15 02:15:14.000000000 +0200
+++ openexr-2.5.7/IlmBase/IlmBase.pc.in	2021-08-03 12:26:33.419242739 +0200
@@ -4,7 +4,6 @@
 ##
 
 prefix=@prefix@
-exec_prefix=@exec_prefix@
 libdir=@libdir@
 includedir=@includedir@
 libsuffix=@LIB_SUFFIX_DASH@
Index: openexr-2.5.7/IlmBase/config/CMakeLists.txt
===================================================================
--- openexr-2.5.7.orig/IlmBase/config/CMakeLists.txt	2021-08-03 12:26:33.423242767 +0200
+++ openexr-2.5.7/IlmBase/config/CMakeLists.txt	2021-08-03 12:26:47.735343624 +0200
@@ -76,8 +76,8 @@ if(ILMBASE_INSTALL_PKG_CONFIG)
   function(ilmbase_pkg_config_help pcinfile)
     set(prefix ${CMAKE_INSTALL_PREFIX})
     set(exec_prefix "\${prefix}")
-    set(libdir "\${exec_prefix}/${CMAKE_INSTALL_LIBDIR}")
-    set(includedir "\${prefix}/${CMAKE_INSTALL_INCLUDEDIR}")
+    set(libdir "${CMAKE_INSTALL_FULL_LIBDIR}")
+    set(includedir "${CMAKE_INSTALL_FULL_INCLUDEDIR}")
     string(TOUPPER "${CMAKE_BUILD_TYPE}" uppercase_CMAKE_BUILD_TYPE)
     set(LIB_SUFFIX_DASH ${ILMBASE_LIB_SUFFIX}${CMAKE_${uppercase_CMAKE_BUILD_TYPE}_POSTFIX})
     if(TARGET Threads::Threads)
Index: openexr-2.5.7/OpenEXR/OpenEXR.pc.in
===================================================================
--- openexr-2.5.7.orig/OpenEXR/OpenEXR.pc.in	2021-06-15 02:15:14.000000000 +0200
+++ openexr-2.5.7/OpenEXR/OpenEXR.pc.in	2021-08-03 12:26:33.423242767 +0200
@@ -4,7 +4,6 @@
 ##
 
 prefix=@prefix@
-exec_prefix=@exec_prefix@
 libdir=@libdir@
 includedir=@includedir@
 OpenEXR_includedir=@includedir@/OpenEXR
Index: openexr-2.5.7/OpenEXR/config/CMakeLists.txt
===================================================================
--- openexr-2.5.7.orig/OpenEXR/config/CMakeLists.txt	2021-08-03 12:26:33.423242767 +0200
+++ openexr-2.5.7/OpenEXR/config/CMakeLists.txt	2021-08-03 12:27:23.867598269 +0200
@@ -74,9 +74,8 @@ if(OPENEXR_INSTALL_PKG_CONFIG)
   # use a helper function to avoid variable pollution, but pretty simple
   function(openexr_pkg_config_help pcinfile)
     set(prefix ${CMAKE_INSTALL_PREFIX})
-    set(exec_prefix "\${prefix}")
-    set(libdir "\${exec_prefix}/${CMAKE_INSTALL_LIBDIR}")
-    set(includedir "\${prefix}/${CMAKE_INSTALL_INCLUDEDIR}")
+    set(libdir "${CMAKE_INSTALL_FULL_LIBDIR}")
+    set(includedir "${CMAKE_INSTALL_FULL_INCLUDEDIR}")
     string(TOUPPER "${CMAKE_BUILD_TYPE}" uppercase_CMAKE_BUILD_TYPE)
     set(LIB_SUFFIX_DASH ${OPENEXR_LIB_SUFFIX}${CMAKE_${uppercase_CMAKE_BUILD_TYPE}_POSTFIX})
     if(TARGET Threads::Threads)
Index: openexr-2.5.7/PyIlmBase/config/CMakeLists.txt
===================================================================
--- openexr-2.5.7.orig/PyIlmBase/config/CMakeLists.txt	2021-08-03 12:26:33.423242767 +0200
+++ openexr-2.5.7/PyIlmBase/config/CMakeLists.txt	2021-08-03 12:27:01.255438907 +0200
@@ -16,8 +16,8 @@ if(PYILMBASE_INSTALL_PKG_CONFIG)
   function(pyilmbase_pkg_config_help pcinfile)
     set(prefix ${CMAKE_INSTALL_PREFIX})
     set(exec_prefix ${CMAKE_INSTALL_BINDIR})
-    set(libdir ${CMAKE_INSTALL_LIBDIR})
-    set(includedir ${CMAKE_INSTALL_INCLUDEDIR})
+    set(libdir ${CMAKE_INSTALL_FULL_LIBDIR})
+    set(includedir ${CMAKE_INSTALL_FULL_INCLUDEDIR})
     string(TOUPPER "${CMAKE_BUILD_TYPE}" uppercase_CMAKE_BUILD_TYPE)
     set(LIB_SUFFIX_DASH ${OPENEXR_LIB_SUFFIX}${CMAKE_${uppercase_CMAKE_BUILD_TYPE}_POSTFIX})
     string(REPLACE ".in" "" pcout ${pcinfile})
