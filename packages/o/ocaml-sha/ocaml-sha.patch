--- a/sha1_stubs.c
+++ b/sha1_stubs.c
@@ -154,7 +154,7 @@ CAMLprim value stub_sha1_to_bin(value di
 	CAMLlocal1(result);
 
 	result = caml_alloc_string(20);
-	sha1_to_bin((sha1_digest *) digest, String_val(result));
+	sha1_to_bin((sha1_digest *) digest, &Byte(result, 0));
 
 	CAMLreturn(result);
 }
@@ -165,7 +165,7 @@ CAMLprim value stub_sha1_to_hex(value di
 	CAMLlocal1(result);
 
 	result = caml_alloc_string(40);
-	sha1_to_hex((sha1_digest *) digest, String_val(result));
+	sha1_to_hex((sha1_digest *) digest, &Byte(result, 0));
 
 	CAMLreturn(result);
 }
--- a/sha256_stubs.c
+++ b/sha256_stubs.c
@@ -152,7 +152,7 @@ CAMLprim value stub_sha256_to_bin(value
 	CAMLlocal1(result);
 
 	result = caml_alloc_string(32);
-	sha256_to_bin((sha256_digest *) digest, String_val(result));
+	sha256_to_bin((sha256_digest *) digest, &Byte(result, 0));
 
 	CAMLreturn(result);
 }
@@ -163,7 +163,7 @@ CAMLprim value stub_sha256_to_hex(value
 	CAMLlocal1(result);
 
 	result = caml_alloc_string(64);
-	sha256_to_hex((sha256_digest *) digest, String_val(result));
+	sha256_to_hex((sha256_digest *) digest, &Byte(result, 0));
 
 	CAMLreturn(result);
 }
--- a/sha512_stubs.c
+++ b/sha512_stubs.c
@@ -152,7 +152,7 @@ CAMLprim value stub_sha512_to_bin(value
 	CAMLlocal1(result);
 
 	result = caml_alloc_string(64);
-	sha512_to_bin((sha512_digest *) digest, String_val(result));
+	sha512_to_bin((sha512_digest *) digest, &Byte(result, 0));
 
 	CAMLreturn(result);
 }
@@ -163,7 +163,7 @@ CAMLprim value stub_sha512_to_hex(value
 	CAMLlocal1(result);
 
 	result = caml_alloc_string(128);
-	sha512_to_hex((sha512_digest *) digest, String_val(result));
+	sha512_to_hex((sha512_digest *) digest, &Byte(result, 0));
 
 	CAMLreturn(result);
 }
