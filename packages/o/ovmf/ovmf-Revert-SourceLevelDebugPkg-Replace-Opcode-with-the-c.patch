From 44c1b4c12c3e1f4d751036c81e6eab1abf91bfe6 Mon Sep 17 00:00:00 2001
From: "Lee, Chun-Yi" <jlee@suse.com>
Date: Tue, 23 Aug 2022 16:56:37 +0800
Subject: [PATCH 3/5] Revert "SourceLevelDebugPkg: Replace Opcode with the
 corresponding instructions."

This reverts commit 7bc8b1d9f412507d579f21ea9af56fced81e7827.

Signed-off-by: Lee, Chun-Yi <jlee@suse.com>
---
 .../Library/DebugAgent/DebugAgentCommon/Ia32/AsmFuncs.nasm  | 6 +++---
 .../Library/DebugAgent/DebugAgentCommon/X64/AsmFuncs.nasm   | 6 +++---
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/SourceLevelDebugPkg/Library/DebugAgent/DebugAgentCommon/Ia32/AsmFuncs.nasm b/SourceLevelDebugPkg/Library/DebugAgent/DebugAgentCommon/Ia32/AsmFuncs.nasm
index b5e5a96e34..912256ba45 100644
--- a/SourceLevelDebugPkg/Library/DebugAgent/DebugAgentCommon/Ia32/AsmFuncs.nasm
+++ b/SourceLevelDebugPkg/Library/DebugAgent/DebugAgentCommon/Ia32/AsmFuncs.nasm
@@ -1,6 +1,6 @@
 ;------------------------------------------------------------------------------
 ;
-; Copyright (c) 2010 - 2022, Intel Corporation. All rights reserved.<BR>
+; Copyright (c) 2010 - 2015, Intel Corporation. All rights reserved.<BR>
 ; SPDX-License-Identifier: BSD-2-Clause-Patent
 ;
 ; Module Name:
@@ -321,7 +321,7 @@ NoExtrPush:
     test    edx, BIT24  ; Test for FXSAVE/FXRESTOR support.
                         ; edx still contains result from CPUID above
     jz      .2
-    fxsave  [edi]
+    db 0xf, 0xae, 00000111y ;fxsave [edi]
 .2:
 
     ;; save the exception data
@@ -342,7 +342,7 @@ NoExtrPush:
     cpuid               ; use CPUID to determine if FXSAVE/FXRESTOR are supported
     test    edx, BIT24  ; Test for FXSAVE/FXRESTOR support
     jz      .3
-    fxrstor [esi]
+    db 0xf, 0xae, 00001110y ; fxrstor [esi]
 .3:
     add esp, 512
 
diff --git a/SourceLevelDebugPkg/Library/DebugAgent/DebugAgentCommon/X64/AsmFuncs.nasm b/SourceLevelDebugPkg/Library/DebugAgent/DebugAgentCommon/X64/AsmFuncs.nasm
index b1019e017b..ccee120ca1 100644
--- a/SourceLevelDebugPkg/Library/DebugAgent/DebugAgentCommon/X64/AsmFuncs.nasm
+++ b/SourceLevelDebugPkg/Library/DebugAgent/DebugAgentCommon/X64/AsmFuncs.nasm
@@ -1,6 +1,6 @@
 ;------------------------------------------------------------------------------
 ;
-; Copyright (c) 2016 - 2022, Intel Corporation. All rights reserved.<BR>
+; Copyright (c) 2016, Intel Corporation. All rights reserved.<BR>
 ; SPDX-License-Identifier: BSD-2-Clause-Patent
 ;
 ; Module Name:
@@ -293,7 +293,7 @@ NoExtrPush:
     rep     stosq
     pop     rcx
     mov     rdi, rsp
-    fxsave  [rdi]
+    db 0xf, 0xae, 00000111y ;fxsave [rdi]
 
     ;; save the exception data
     push    qword [rbp + 16]
@@ -314,7 +314,7 @@ NoExtrPush:
     add     rsp, 8
 
     mov     rsi, rsp
-    fxrstor [rsi]
+    db 0xf, 0xae, 00001110y ; fxrstor [rsi]
     add     rsp, 512
 
     ;; UINT64  Dr0, Dr1, Dr2, Dr3, Dr6, Dr7;
-- 
2.26.2

