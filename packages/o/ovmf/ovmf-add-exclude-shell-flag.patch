Index: edk2-edk2-stable202111/OvmfPkg/OvmfPkgX64.fdf
===================================================================
--- edk2-edk2-stable202111.orig/OvmfPkg/OvmfPkgX64.fdf
+++ edk2-edk2-stable202111/OvmfPkg/OvmfPkgX64.fdf
@@ -315,7 +315,9 @@ INF  ShellPkg/DynamicCommand/TftpDynamic
 INF  ShellPkg/DynamicCommand/HttpDynamicCommand/HttpDynamicCommand.inf
 INF  OvmfPkg/LinuxInitrdDynamicShellCommand/LinuxInitrdDynamicShellCommand.inf
 !endif
+!ifndef $(EXCLUDE_SHELL)
 INF  ShellPkg/Application/Shell/Shell.inf
+!endif
 
 INF MdeModulePkg/Logo/LogoDxe.inf
 
Index: edk2-edk2-stable202111/OvmfPkg/OvmfPkgIa32X64.fdf
===================================================================
--- edk2-edk2-stable202111.orig/OvmfPkg/OvmfPkgIa32X64.fdf
+++ edk2-edk2-stable202111/OvmfPkg/OvmfPkgIa32X64.fdf
@@ -299,7 +299,9 @@ INF  ShellPkg/DynamicCommand/TftpDynamic
 INF  ShellPkg/DynamicCommand/HttpDynamicCommand/HttpDynamicCommand.inf
 INF  OvmfPkg/LinuxInitrdDynamicShellCommand/LinuxInitrdDynamicShellCommand.inf
 !endif
+!ifndef $(EXCLUDE_SHELL)
 INF  ShellPkg/Application/Shell/Shell.inf
+!endif
 
 INF MdeModulePkg/Logo/LogoDxe.inf
 
