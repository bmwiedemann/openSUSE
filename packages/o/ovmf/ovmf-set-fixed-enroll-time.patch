From c0cec3409f3abda1e2359a79ccac575b4ea1838b Mon Sep 17 00:00:00 2001
From: Gary Lin <glin@suse.com>
Date: Tue, 21 May 2019 16:56:06 +0800
Subject: [PATCH 1/1] OvmfPkg/EnrollDefaultKeys: Set the fixed time

For the reproducible build, we need to set the fixed time when setting
the authenticate variables.

Signed-off-by: Gary Lin <glin@suse.com>
---
 OvmfPkg/EnrollDefaultKeys/EnrollDefaultKeys.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/OvmfPkg/EnrollDefaultKeys/EnrollDefaultKeys.c b/OvmfPkg/EnrollDefaultKeys/EnrollDefaultKeys.c
index f45cb799f726..0e42e49d48f2 100644
--- a/OvmfPkg/EnrollDefaultKeys/EnrollDefaultKeys.c
+++ b/OvmfPkg/EnrollDefaultKeys/EnrollDefaultKeys.c
@@ -301,6 +301,16 @@ EnrollListOfCerts (
   if (EFI_ERROR (Status)) {
     goto FreeData;
   }
+
+  // Set the fixed time for the reproducible build
+  // 2019-5-20 00:00:00
+  SingleHeader->TimeStamp.Year       = 2019;
+  SingleHeader->TimeStamp.Month      = 5;
+  SingleHeader->TimeStamp.Day        = 20;
+  SingleHeader->TimeStamp.Hour       = 0;
+  SingleHeader->TimeStamp.Minute     = 0;
+  SingleHeader->TimeStamp.Second     = 0;
+
   SingleHeader->TimeStamp.Pad1       = 0;
   SingleHeader->TimeStamp.Nanosecond = 0;
   SingleHeader->TimeStamp.TimeZone   = 0;
-- 
2.21.0

