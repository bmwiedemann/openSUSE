From 60856db2ca1b37079e9a7a2e1cbbbc9d2dcb43fa Mon Sep 17 00:00:00 2001
From: Michael Terry <mike@mterry.name>
Date: Wed, 9 Mar 2022 12:28:18 -0500
Subject: [PATCH] build: fix test case ownership with latest valac

---
 libdeja/tests/runner.vala          | 4 ++--
 libdeja/tests/unit/unit-tests.vala | 2 +-
 monitor/tests/scheduler.vala       | 2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/libdeja/tests/runner.vala b/libdeja/tests/runner.vala
index 95f6dbe1..b7216328 100644
--- a/libdeja/tests/runner.vala
+++ b/libdeja/tests/runner.vala
@@ -1032,7 +1032,7 @@ int main(string[] args)
   if (keyfile.has_group("Duplicity")) {
     var suite = new TestSuite("duplicity");
     suite.add(new TestCase(testname, backup_setup, duplicity_run, backup_teardown));
-    TestSuite.get_root().add_suite(suite);
+    TestSuite.get_root().add_suite((owned)suite);
     found_group = true;
   }
 
@@ -1040,7 +1040,7 @@ int main(string[] args)
   if (keyfile.has_group("Restic")) {
     var suite = new TestSuite("restic");
     suite.add(new TestCase(testname, backup_setup, restic_run, backup_teardown));
-    TestSuite.get_root().add_suite(suite);
+    TestSuite.get_root().add_suite((owned)suite);
     found_group = true;
   }
 #endif
diff --git a/libdeja/tests/unit/unit-tests.vala b/libdeja/tests/unit/unit-tests.vala
index 8cce6317..cbe85ea6 100644
--- a/libdeja/tests/unit/unit-tests.vala
+++ b/libdeja/tests/unit/unit-tests.vala
@@ -138,7 +138,7 @@ int main(string[] args)
   unit.add(new TestCase("parse-dir", setup, parse_dir, teardown));
   unit.add(new TestCase("parse-version", setup, parse_version, teardown));
   unit.add(new TestCase("prompt", setup, prompt, teardown));
-  TestSuite.get_root().add_suite(unit);
+  TestSuite.get_root().add_suite((owned)unit);
 
   return Test.run();
 }
diff --git a/monitor/tests/scheduler.vala b/monitor/tests/scheduler.vala
index d83da81a..beabc134 100644
--- a/monitor/tests/scheduler.vala
+++ b/monitor/tests/scheduler.vala
@@ -242,7 +242,7 @@ int main(string[] args)
   unit.add(new TestCase("period-changes", setup, notices_period_changes, teardown));
   unit.add(new TestCase("period-overdue", setup, period_change_overdue, teardown));
   unit.add(new TestCase("backup-changes", setup, notices_last_backup_changes, teardown));
-  TestSuite.get_root().add_suite(unit);
+  TestSuite.get_root().add_suite((owned)unit);
 
   return Test.run();
 }
-- 
GitLab

