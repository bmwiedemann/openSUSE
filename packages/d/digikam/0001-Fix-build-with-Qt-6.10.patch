From d6b89f46e07b62564b247ef8f579103bf26af863 Mon Sep 17 00:00:00 2001
From: Christophe Marin <christophe@krop.fr>
Date: Sat, 11 Oct 2025 22:36:11 +0200
Subject: [PATCH] Fix build with Qt 6.10

---
 core/cmake/rules/RulesQtFramework.cmake              | 7 +++++++
 core/libs/autorotator/autorotator.cpp                | 1 +
 core/libs/dimg/CMakeLists.txt                        | 8 ++++++++
 core/libs/facesengine/recognition/faceclassifier.cpp | 1 +
 core/libs/mlfoundation/mlpipelinefoundation.h        | 1 +
 5 files changed, 18 insertions(+)

diff --git a/core/cmake/rules/RulesQtFramework.cmake b/core/cmake/rules/RulesQtFramework.cmake
index 1faad05..d7f91bf 100644
--- a/core/cmake/rules/RulesQtFramework.cmake
+++ b/core/cmake/rules/RulesQtFramework.cmake
@@ -43,6 +43,13 @@ if(Qt6_FOUND)
                  OpenGLWidgets
     )
 
+    if(Qt6Gui_VERSION VERSION_GREATER_EQUAL 6.10)
+    find_package(Qt6 REQUIRED
+                 NO_MODULE COMPONENTS
+                 GuiPrivate
+    )
+    endif()
+
 else()
 
     find_package(Qt${QT_VERSION_MAJOR}
diff --git a/core/libs/autorotator/autorotator.cpp b/core/libs/autorotator/autorotator.cpp
index 4d9c1b5..5036979 100644
--- a/core/libs/autorotator/autorotator.cpp
+++ b/core/libs/autorotator/autorotator.cpp
@@ -16,6 +16,7 @@
 
 // Qt includes
 
+#include <QElapsedTimer>
 #include <QException>
 
 // digiKam includes
diff --git a/core/libs/dimg/CMakeLists.txt b/core/libs/dimg/CMakeLists.txt
index 7ca444e..aeab286 100644
--- a/core/libs/dimg/CMakeLists.txt
+++ b/core/libs/dimg/CMakeLists.txt
@@ -246,3 +246,11 @@ set_target_properties(core_dimg_obj
                       C_STANDARD_REQUIRED YES
                       C_EXTENSIONS NO
 )
+
+# Qt 6.10
+if(Qt6GuiPrivate_FOUND)
+    target_link_libraries(core_dimg_obj
+                          PRIVATE
+                          Qt6::GuiPrivate
+    )
+endif()
diff --git a/core/libs/facesengine/recognition/faceclassifier.cpp b/core/libs/facesengine/recognition/faceclassifier.cpp
index 048f86b..81e83c1 100644
--- a/core/libs/facesengine/recognition/faceclassifier.cpp
+++ b/core/libs/facesengine/recognition/faceclassifier.cpp
@@ -17,6 +17,7 @@
 
 // Qt includes
 
+#include <QElapsedTimer>
 #include <QException>
 #include <QReadWriteLock>
 #include <QtConcurrentRun>
diff --git a/core/libs/mlfoundation/mlpipelinefoundation.h b/core/libs/mlfoundation/mlpipelinefoundation.h
index 500b1f9..8c4287f 100644
--- a/core/libs/mlfoundation/mlpipelinefoundation.h
+++ b/core/libs/mlfoundation/mlpipelinefoundation.h
@@ -17,6 +17,7 @@
 
 // Qt includes
 
+#include <QElapsedTimer>
 #include <QImage>
 #include <QIcon>
 #include <QAtomicInteger>
-- 
2.51.0

