--- a/configure.ac	2011-10-21 13:40:55.000000000 +0900
+++ b/configure.ac	2011-10-27 18:06:58.938922585 +0900
@@ -14,6 +14,8 @@
 
 AC_CONFIG_HEADERS(src/config.h)
 
+PKG_PROG_PKG_CONFIG
+
 # FreeBSD installs its version of libpopt into /usr/local/, but does
 # not put that on the default library and header path.
 # Solaris doesn't even ship libpopt.  We used to add that path if
@@ -503,16 +505,17 @@
 	    [provide mutual authentication services via the GSS-API])])
 
 if test x"$with_auth" = xyes; then
-        AC_SEARCH_LIBS([gss_init_sec_context],
-                        [gssapi gssapi_krb5 gss],
-	                AC_DEFINE(HAVE_GSSAPI, 1, [Define if the GSS_API is available])
+        PKG_CHECK_MODULES(GSSAPI, libgssglue,
+	                [AC_DEFINE(HAVE_GSSAPI, 1, [Define if the GSS_API is available])
+			CFLAGS="$CFLAGS $GSSAPI_CFLAGS"
+			LIBS="$LIBS $GSSAPI_LIBS"
 	                AUTH_COMMON_OBJS="src/auth_common.o"
 	                AUTH_DISTCC_OBJS="src/auth_distcc.o"
-	                AUTH_DISTCCD_OBJS="src/auth_distccd.o",
-	                AC_MSG_FAILURE([--with-auth was given but no GSS-API library found])
+	                AUTH_DISTCCD_OBJS="src/auth_distccd.o"],
+	                [AC_MSG_FAILURE([--with-auth was given but no GSS-API library found])
 	                AUTH_COMMON_OBJS=""
                         AUTH_DISTCC_OBJS=""
-                        AUTH_DISTCCD_OBJS="")
+                        AUTH_DISTCCD_OBJS=""])
 fi
 
 AC_SUBST(AUTH_COMMON_OBJS)
