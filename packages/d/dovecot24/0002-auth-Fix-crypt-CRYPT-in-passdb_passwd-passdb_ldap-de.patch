From 929133d81dc5fb9e69640e67728b824098a1bbd3 Mon Sep 17 00:00:00 2001
From: Marco Bettini <marco.bettini@open-xchange.com>
Date: Tue, 16 Dec 2025 09:49:16 +0000
Subject: [PATCH 2/4] auth: Fix crypt -> CRYPT in passdb_passwd, passdb_ldap
 defaults for passdb_default_password_scheme

---
 src/auth/db-ldap-settings.c | 8 +++++++-
 src/auth/passdb-passwd.c    | 8 +++++++-
 2 files changed, 14 insertions(+), 2 deletions(-)

diff --git a/src/auth/db-ldap-settings.c b/src/auth/db-ldap-settings.c
index d91fd7f4ea..d9d31ff791 100644
--- a/src/auth/db-ldap-settings.c
+++ b/src/auth/db-ldap-settings.c
@@ -52,9 +52,15 @@ static const struct ldap_settings ldap_default_settings = {
 };
 
 static const struct setting_keyvalue ldap_default_settings_keyvalue[] = {
-	{ "passdb_ldap/passdb_default_password_scheme", "crypt" },
 	{ "passdb_ldap/passdb_fields_import_all", "no" },
 	{ "userdb_ldap/userdb_fields_import_all", "no" },
+
+	/* This now now the same as the default passdb_default_password_scheme,
+	   but it needs to be here explicitly as long as settings-history-core.txt
+	   supports dovecot_config_version with
+	   passdb_default_password_scheme=PLAIN default */
+	{ "passdb_ldap/passdb_default_password_scheme", "CRYPT" },
+
 	{ NULL, NULL }
 };
 
diff --git a/src/auth/passdb-passwd.c b/src/auth/passdb-passwd.c
index 71f5800cf8..12210e6e0e 100644
--- a/src/auth/passdb-passwd.c
+++ b/src/auth/passdb-passwd.c
@@ -28,8 +28,14 @@ static const struct setting_define auth_passwd_setting_defines[] = {
 
 static const struct setting_keyvalue auth_passwd_default_settings_keyvalue[] = {
 	{ "passdb_passwd/passdb_use_worker", "yes" },
-	{ "passdb_passwd/passdb_default_password_scheme", "crypt" },
 	{ "userdb_passwd/userdb_use_worker", "yes" },
+
+	/* This now now the same as the default passdb_default_password_scheme,
+	   but it needs to be here explicitly as long as settings-history-core.txt
+	   supports dovecot_config_version with
+	   passdb_default_password_scheme=PLAIN default */
+	{ "passdb_passwd/passdb_default_password_scheme", "CRYPT" },
+
 	{ NULL, NULL }
 };
 
-- 
2.52.0

