From c81baf1a9cc938a283f6c52c8fd10bab84183391 Mon Sep 17 00:00:00 2001
From: Eike Ziller <eike.ziller@qt.io>
Date: Wed, 6 Jan 2021 17:45:17 +0100
Subject: [PATCH] cmake build: Use GNUInstallDirs for installation paths on
 Linux

Allows e.g. distributions to adapt to system layout.

Fixes: QTCREATORBUG-25142
Change-Id: Ia6d759514fef5a154334bc3d7221ea4b970122f2
Reviewed-by: Cristian Adam <cristian.adam@qt.io>
---
 cmake/QtCreatorAPIInternal.cmake | 35 ++++++++++++++++----------------
 1 file changed, 18 insertions(+), 17 deletions(-)

diff --git a/cmake/QtCreatorAPIInternal.cmake b/cmake/QtCreatorAPIInternal.cmake
index 0aafe289e6f..79583f79254 100644
--- a/cmake/QtCreatorAPIInternal.cmake
+++ b/cmake/QtCreatorAPIInternal.cmake
@@ -37,35 +37,36 @@ if (APPLE)
 
   set(_IDE_OUTPUT_PATH "${_IDE_APP_PATH}/${_IDE_APP_TARGET}.app/Contents")
 
-  set(_IDE_PLUGIN_PATH "${_IDE_OUTPUT_PATH}/PlugIns")
   set(_IDE_LIBRARY_BASE_PATH "Frameworks")
-  set(_IDE_LIBRARY_PATH "${_IDE_OUTPUT_PATH}/Frameworks")
+  set(_IDE_LIBRARY_PATH "${_IDE_OUTPUT_PATH}/${_IDE_LIBRARY_BASE_PATH}")
+  set(_IDE_PLUGIN_PATH "${_IDE_OUTPUT_PATH}/PlugIns")
   set(_IDE_LIBEXEC_PATH "${_IDE_OUTPUT_PATH}/Resources/libexec")
   set(_IDE_DATA_PATH "${_IDE_OUTPUT_PATH}/Resources")
   set(_IDE_DOC_PATH "${_IDE_OUTPUT_PATH}/Resources/doc")
   set(_IDE_BIN_PATH "${_IDE_OUTPUT_PATH}/MacOS")
-
-  set(QT_DEST_PLUGIN_PATH "${_IDE_PLUGIN_PATH}")
-  set(QT_DEST_QML_PATH "${_IDE_DATA_PATH}/../Imports/qtquick2")
-else ()
+elseif(WIN32)
   set(_IDE_APP_PATH "bin")
   set(_IDE_APP_TARGET "${IDE_ID}")
 
   set(_IDE_LIBRARY_BASE_PATH "lib")
-  set(_IDE_LIBRARY_PATH "lib/qtcreator")
-  set(_IDE_PLUGIN_PATH "lib/qtcreator/plugins")
-  if (WIN32)
-    set(_IDE_LIBEXEC_PATH "bin")
-    set(QT_DEST_PLUGIN_PATH "bin/plugins")
-    set(QT_DEST_QML_PATH "bin/qml")
-  else ()
-    set(_IDE_LIBEXEC_PATH "libexec/qtcreator")
-    set(QT_DEST_PLUGIN_PATH  "lib/Qt/plugins")
-    set(QT_DEST_QML_PATH "lib/Qt/qml")
-  endif ()
+  set(_IDE_LIBRARY_PATH "${_IDE_LIBRARY_BASE_PATH}/qtcreator")
+  set(_IDE_PLUGIN_PATH "${_IDE_LIBRARY_BASE_PATH}/qtcreator/plugins")
+  set(_IDE_LIBEXEC_PATH "bin")
   set(_IDE_DATA_PATH "share/qtcreator")
   set(_IDE_DOC_PATH "share/doc/qtcreator")
   set(_IDE_BIN_PATH "bin")
+else ()
+  include(GNUInstallDirs)
+  set(_IDE_APP_PATH "${CMAKE_INSTALL_BINDIR}")
+  set(_IDE_APP_TARGET "${IDE_ID}")
+
+  set(_IDE_LIBRARY_BASE_PATH "${CMAKE_INSTALL_LIBDIR}")
+  set(_IDE_LIBRARY_PATH "${_IDE_LIBRARY_BASE_PATH}/qtcreator")
+  set(_IDE_PLUGIN_PATH "${_IDE_LIBRARY_BASE_PATH}/qtcreator/plugins")
+  set(_IDE_LIBEXEC_PATH "${CMAKE_INSTALL_LIBEXECDIR}/qtcreator")
+  set(_IDE_DATA_PATH "${CMAKE_INSTALL_DATAROOTDIR}/qtcreator")
+  set(_IDE_DOC_PATH "${CMAKE_INSTALL_DATAROOTDIR}/doc/qtcreator")
+  set(_IDE_BIN_PATH "${CMAKE_INSTALL_BINDIR}")
 endif ()
 
 file(RELATIVE_PATH _PLUGIN_TO_LIB "/${_IDE_PLUGIN_PATH}" "/${_IDE_LIBRARY_PATH}")
