From eaae274cb1975be558d8a535ba2310bc67c073a6 Mon Sep 17 00:00:00 2001
From: "Bernhard M. Wiedemann" <bwiedemann suse de>
Date: Wed, 24 Mar 2021 16:00:08 +0100
Subject: [PATCH] https://bugzilla.opensuse.org/show_bug.cgi?id=1163766

seccomp filters disallow a new kernel syscall to get time
used on i586
---
 .../sandbox/linux/system_headers/x86_32_linux_syscalls.h  | 8 ++++++++
 .../chromium/sandbox/policy/linux/bpf_ime_policy_linux.cc | 3 +++
 3 files changed, 16 insertions(+)

diff --git a/src/3rdparty/chromium/sandbox/linux/system_headers/x86_32_linux_syscalls.h b/src/3rdparty/chromium/sandbox/linux/system_headers/x86_32_linux_syscalls.h
index 7613c9bbc..7093ac054 100644
--- a/src/3rdparty/chromium/sandbox/linux/system_headers/x86_32_linux_syscalls.h
+++ b/src/3rdparty/chromium/sandbox/linux/system_headers/x86_32_linux_syscalls.h
@@ -1710,5 +1710,13 @@
 #define __NR_clone3 435
 #endif
 
+#if !defined(__NR_clock_gettime64)
+#define __NR_clock_gettime64 403
+#endif
+
+#if !defined(__NR_clock_nanosleep_time64)
+#define __NR_clock_nanosleep_time64 407
+#endif
+
 #endif  // SANDBOX_LINUX_SYSTEM_HEADERS_X86_32_LINUX_SYSCALLS_H_
 
diff --git a/src/3rdparty/chromium/sandbox/policy/linux/bpf_ime_policy_linux.cc b/src/3rdparty/chromium/sandbox/policy/linux/bpf_ime_policy_linux.cc
index 3fcdbcc18..c7a00c2c2 100644
--- a/src/3rdparty/chromium/sandbox/policy/linux/bpf_ime_policy_linux.cc
+++ b/src/3rdparty/chromium/sandbox/policy/linux/bpf_ime_policy_linux.cc
@@ -31,6 +31,9 @@ ResultExpr ImeProcessPolicy::EvaluateSyscall(int sysno) const {
 #endif
 #if defined(__NR_clock_gettime)
     case __NR_clock_gettime:
+#endif
+#if defined(__NR_clock_gettime64)
+    case __NR_clock_gettime64:
 #endif
       return Allow();
 // https://crbug.com/991435
-- 
2.30.2

