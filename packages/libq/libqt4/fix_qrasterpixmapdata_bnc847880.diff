Index: qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmap_raster.cpp
===================================================================
--- qt-everywhere-opensource-src-4.8.6.orig/src/gui/image/qpixmap_raster.cpp
+++ qt-everywhere-opensource-src-4.8.6/src/gui/image/qpixmap_raster.cpp
@@ -330,7 +330,7 @@ QImage QRasterPixmapData::toImage(const
         return image;
 
     QRect clipped = rect.intersected(QRect(0, 0, w, h));
-    const uint du = uint(d);
+    const uint du = uint(image.depth());
     if ((du % 8 == 0) && (((uint(clipped.x()) * du)) % 32 == 0))
         return QImage(image.scanLine(clipped.y()) + clipped.x() * (du / 8),
                       clipped.width(), clipped.height(),
