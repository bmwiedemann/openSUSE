From ab02e2a5b343db8a128907a04e374c49141d5e3c Mon Sep 17 00:00:00 2001
From: Christian Goll <cgoll@suse.de>
Date: Mon, 16 Mar 2020 15:49:59 +0100
Subject: [PATCH] fix mpi build
 https://github.com/tensorflow/tensorflow/issues/17437

---
 tensorflow/contrib/mpi_collectives/BUILD | 1 +
 tensorflow/tensorflow.bzl                | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/tensorflow/contrib/mpi_collectives/BUILD b/tensorflow/contrib/mpi_collectives/BUILD
index f8072ac1e8..8f2649eb50 100644
--- a/tensorflow/contrib/mpi_collectives/BUILD
+++ b/tensorflow/contrib/mpi_collectives/BUILD
@@ -53,6 +53,7 @@ tf_custom_op_library(
         ":mpi_defines",
         ":mpi_message_proto_cc",
         "//third_party/mpi",
+        "//tensorflow/stream_executor",
     ],
 )
 
diff --git a/tensorflow/tensorflow.bzl b/tensorflow/tensorflow.bzl
index 4aa412180f..d3e0a48c0d 100644
--- a/tensorflow/tensorflow.bzl
+++ b/tensorflow/tensorflow.bzl
@@ -1806,7 +1806,7 @@ def tf_custom_op_library(name, srcs = [], gpu_srcs = [], deps = [], linkopts = [
         name = name + "_check_deps",
         disallowed_deps = [
             clean_dep("//tensorflow/core:framework"),
-            clean_dep("//tensorflow/core:lib"),
+            #clean_dep("//tensorflow/core:lib"),
         ],
         deps = deps + if_cuda_is_configured_compat(cuda_deps) + if_rocm_is_configured(rocm_deps),
     )
-- 
2.25.0

