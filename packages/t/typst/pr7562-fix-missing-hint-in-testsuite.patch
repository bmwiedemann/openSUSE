From 72bd29b741dbb6977a8fc873f23783ab07bd2b2f Mon Sep 17 00:00:00 2001
From: Tobias Schmitz <tobiasschmitz2001@gmail.com>
Date: Thu, 11 Dec 2025 15:04:46 +0100
Subject: [PATCH] Fix running tests in release mode

---
 tests/src/run.rs              | 6 ++++++
 tests/suite/pdftags/break.typ | 1 -
 2 files changed, 6 insertions(+), 1 deletion(-)

Index: typst-0.14.1/tests/src/run.rs
===================================================================
--- typst-0.14.1.orig/tests/src/run.rs
+++ typst-0.14.1/tests/src/run.rs
@@ -245,6 +245,12 @@ impl<'a> Runner<'a> {
 
         // Check hints.
         for hint in &diag.hints {
+            // HACK: This hint only gets emitted in debug builds, so filter it
+            // out to make the test suite also pass for release builds.
+            if hint == "set `RUST_BACKTRACE` to `1` or `full` to capture a backtrace" {
+                continue;
+            }
+
             self.validate_note(NoteKind::Hint, diag.span.id(), range.clone(), hint);
         }
     }
Index: typst-0.14.1/tests/suite/pdftags/break.typ
===================================================================
--- typst-0.14.1.orig/tests/suite/pdftags/break.typ
+++ typst-0.14.1/tests/suite/pdftags/break.typ
@@ -30,5 +30,4 @@ Foo #quote($$ + parbreak())
 #show heading: v(0pt) + [A]
 // Error: 3-6 internal error: tags weren't properly closed (occurred at crates/typst-pdf/src/tags/tree/build.rs:187:9)
 // Hint: 3-6 please report this as a bug
-// Hint: 3-6 set `RUST_BACKTRACE` to `1` or `full` to capture a backtrace
 #[= A]B
