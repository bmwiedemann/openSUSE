From 3c5802812e0ae918ba5979e6a16abe39d0e2d7bf Mon Sep 17 00:00:00 2001
From: Jiri Slaby <jslaby@suse.cz>
Date: Thu, 8 Aug 2019 11:42:38 +0200
Subject: [PATCH] poppler 0.79

---
 texk/web2c/pdftexdir/pdftosrc-newpoppler.cc | 6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

diff --git a/texk/web2c/pdftexdir/pdftosrc-newpoppler.cc b/texk/web2c/pdftexdir/pdftosrc-newpoppler.cc
index 78fc2dd..682bcdf 100644
--- a/texk/web2c/pdftexdir/pdftosrc-newpoppler.cc
+++ b/texk/web2c/pdftexdir/pdftosrc-newpoppler.cc
@@ -157,12 +157,11 @@ int main(int argc, char *argv[])
                         (e->type == xrefEntryFree ? "f" : "n"));
             else {              // e->offset is the object number of the object stream
                 Stream *str;
-                Lexer *lexer;
                 Parser *parser;
                 Object objStr, obj1, obj2;
                 int nObjects, first, n;
                 int localOffset = 0;
-                Guint firstOffset;
+                unsigned int firstOffset;
 
                 objStr = xref->fetch(e->offset, 0);
                 assert(objStr.isStream());
@@ -175,8 +174,7 @@ int main(int argc, char *argv[])
                 // parse the header: object numbers and offsets
                 objStr.streamReset();
                 str = new EmbedStream(objStr.getStream(), Object(objNull), true, first);
-                lexer = new Lexer(xref, str);
-                parser = new Parser(xref, lexer, false);
+                parser = new Parser(xref, str, false);
                 for (n = 0; n < nObjects; ++n) {
                     obj1 = parser->getObj();
                     obj2 = parser->getObj();
diff --git a/texk/web2c/pdftexdir/pdftoepdf-poppler0.79.0.cc b/texk/web2c/pdftexdir/pdftoepdf-poppler0.79.0.cc
index 13c3bd5..ea78179 100644
--- a/texk/web2c/pdftexdir/pdftoepdf-poppler0.79.0.cc
+++ b/texk/web2c/pdftexdir/pdftoepdf-poppler0.79.0.cc
@@ -760,8 +760,8 @@ read_pdf_info(char *image_name, char *page_name, int page_num,
         LinkDest *link = pdf_doc->doc->findDest(&name);
         if (link == 0 || !link->isOk())
             pdftex_fail("PDF inclusion: invalid destination <%s>", page_name);
-        Ref ref = link->getPageRef();
-        page_num = pdf_doc->doc->getCatalog()->findPage(ref.num, ref.gen);
+        const Ref ref = link->getPageRef();
+        page_num = pdf_doc->doc->getCatalog()->findPage(ref);
         if (page_num == 0)
             pdftex_fail("PDF inclusion: destination is not a page <%s>",
                         page_name);
-- 
2.21.0

