#!/bin/bash
# helper script for msgheadermerge
PO_HEADER_DIR=$1
PO_HEADER_ORDER=$2
if test -d $1 ; then
    cat >/dev/null
    cat $PO_HEADER_ORDER |
    while read ; do
	if test "${REPLY}" != "${REPLY/ }" ; then
	    echo "ERROR: Malformed header line $PO_HEADER_DIR/$REPLY. Ignoring." >&2
	else
	    if test -f $PO_HEADER_DIR/$REPLY ; then
		TAG=${REPLY//__SLASH__//} # safety check counterpart
		echo -n "$TAG: "
		cat "$PO_HEADER_DIR/$REPLY"
	    fi
	fi
	rm -f "$PO_HEADER_DIR/$REPLY"
    done
    if ! rmdir $PO_HEADER_DIR ; then
	echo "WARNING: These items of $PO_HEADER_DIR were not processed:" >&2
	ls -1 $PO_HEADER_DIR >&2
	echo "This can happen if the file lacks one of mandatory header items." >&2
    fi
else
    exit 1
fi
