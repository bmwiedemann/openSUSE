From: Jason Dillaman <dillaman@redhat.com>
Date: Tue, 9 Oct 2018 12:56:35 -0400
Subject: file_zbc: optionally build zbc handler
Git-repo: https://github.com/agrover/tcmu-runner.git
Git-commit: aa87146e0ef46e535dd5ba6243a41323de6b53a4

Signed-off-by: Jason Dillaman <dillaman@redhat.com>
Acked-by: Lee Duncan <lduncan@suse.com>
---
 CMakeLists.txt | 31 +++++++++++++++++--------------
 1 file changed, 17 insertions(+), 14 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 2a4c4b0a3197..01f7777d4357 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -11,6 +11,7 @@ set(tcmu-runner_HANDLER_PATH "${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_LIBDIR}/tc
 option(with-glfs "build Gluster glfs handler" true)
 option(with-qcow "build qcow handler" true)
 option(with-rbd "build Ceph rbd handler" true)
+option(with-zbc "build zbc handler" true)
 
 find_library(LIBNL_LIB nl-3)
 find_library(LIBNL_GENL_LIB nl-genl-3)
@@ -168,26 +169,28 @@ target_include_directories(handler_file_optical
   )
 target_link_libraries(handler_file_optical ${PTHREAD})
 
-# Stuff for building the file zbc handler
-add_library(handler_file_zbc
-  SHARED
-  file_zbc.c
-  )
-set_target_properties(handler_file_zbc
-  PROPERTIES
-  PREFIX ""
-  )
-target_include_directories(handler_file_zbc
-  PUBLIC ${PROJECT_SOURCE_DIR}/ccan
-  )
-install(TARGETS handler_file_zbc DESTINATION ${CMAKE_INSTALL_LIBDIR}/tcmu-runner)
-
 # The minimal library consumer
 add_executable(consumer
   consumer.c
   )
 target_link_libraries(consumer tcmu)
 
+if (with-zbc)
+	# Stuff for building the file zbc handler
+	add_library(handler_file_zbc
+	  SHARED
+	  file_zbc.c
+	  )
+	set_target_properties(handler_file_zbc
+	  PROPERTIES
+	  PREFIX ""
+	  )
+	target_include_directories(handler_file_zbc
+	  PUBLIC ${PROJECT_SOURCE_DIR}/ccan
+	  )
+	install(TARGETS handler_file_zbc DESTINATION ${CMAKE_INSTALL_LIBDIR}/tcmu-runner)
+endif (with-zbc)
+
 if (with-rbd)
 	find_library(LIBRBD rbd)
 

