From b135bbd92d7753b2ac94634c6248efe1cfd376e1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fridrich=20=C5=A0trba?= <fridrich.strba@bluewin.ch>
Date: Tue, 10 Oct 2023 13:06:25 +0200
Subject: [PATCH 13/14] startscript

---
 .../common-linux/tuxguitar.sh                 | 61 ++++++++++++++++---
 1 file changed, 54 insertions(+), 7 deletions(-)

diff --git a/build-scripts/common-resources/common-linux/tuxguitar.sh b/build-scripts/common-resources/common-linux/tuxguitar.sh
index a213786a..348848bb 100755
--- a/build-scripts/common-resources/common-linux/tuxguitar.sh
+++ b/build-scripts/common-resources/common-linux/tuxguitar.sh
@@ -1,20 +1,67 @@
 #!/bin/sh
-##SCRIPT DIR
-TG_DIR=`dirname $(realpath "$0")`
+
+# system dependencies
+swt_guess_()
+{
+    t="/usr/lib/eclipse/plugins/org.eclipse.swt.gtk.linux.*.jar"
+    [ -r "$t" ] && f="$t"
+    t="/etc/alternatives/swt.jar"
+    [ -r "$t" ] && f="$t"
+    t="/usr/share/java/swt.jar"
+    [ -r "$t" ] && f="$t"
+    t="/usr/lib/java/swt.jar"
+    [ -r "$t" ] && f="$t"
+    t="/usr/lib64/java/swt.jar"
+    [ -r "$t" ] && f="$t"
+    file -L "$f" >/dev/null 2>&1 || f=""
+    echo "$f"
+}
+
+itext_pdf_guess_()
+{
+    t="/usr/share/java/itext.jar"
+    [ -r "$t" ] && f="$t"
+    t="/usr/share/java/itext-pdf.jar"
+    [ -r "$t" ] && f="$t"
+    t="/usr/share/java/itextpdf/itextpdf.jar"
+    [ -r "$t" ] && f="$t"
+    file -L "$f" >/dev/null 2>&1 || f=""
+    echo "$f"
+}
+
+itext_xmlworker_guess_()
+{
+    t="/usr/share/java/xmlworker.jar"
+    [ -r "$t" ] && f="$t"
+    t="/usr/share/java/itext-xmlworker.jar"
+    [ -r "$t" ] && f="$t"
+    t="/usr/share/java/itextpdf/xmlworker.jar"
+    [ -r "$t" ] && f="$t"
+    file -L "$f" >/dev/null 2>&1 || f=""
+    echo "$f"
+}
+
 ##JAVA
 JAVA=`which java`
 ##LIBRARY_PATH
-LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:${TG_DIR}/lib/
+LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/lib64/tuxguitar
 ##CLASSPATH
-CLASSPATH=${CLASSPATH}:${TG_DIR}/lib/*
-CLASSPATH=${CLASSPATH}:${TG_DIR}/share/
-CLASSPATH=${CLASSPATH}:${TG_DIR}/dist/
+CLASSPATH=/usr/share/java/tuxguitar/tuxguitar.jar:/usr/share/java/tuxguitar/*:
+t=$(itext_pdf_guess_)
+[ -r "$t" ] && CLASSPATH=${CLASSPATH}:$t
+t=$(itext_xmlworker_guess_)
+[ -r "$t" ] && CLASSPATH=${CLASSPATH}:$t
+t=$(swt_guess_)
+[ -r "$t" ] && CLASSPATH=${CLASSPATH}:$t
+
 ##MAINCLASS
 MAINCLASS=org.herac.tuxguitar.app.TGMainSingleton
 ##JVM ARGUMENTS
 VM_ARGS="-Xmx512m"
+## SHAREPATH
+SHAREPATH=/usr/share/tuxguitar
 ##EXPORT VARS
 export CLASSPATH
 export LD_LIBRARY_PATH
 ##LAUNCH
-${JAVA} ${VM_ARGS} -cp :${CLASSPATH} -Dtuxguitar.home.path="${TG_DIR}" -Dtuxguitar.share.path="share/" -Djava.library.path="${LD_LIBRARY_PATH}" ${MAINCLASS} "$@"
+${JAVA} ${VM_ARGS} -cp :${CLASSPATH} -Dtuxguitar.share.path="${SHAREPATH}/" -Djava.library.path="${LD_LIBRARY_PATH}" ${MAINCLASS} "$@"
-- 
2.42.0

