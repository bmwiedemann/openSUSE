From b1eb01629b6af035dc95d6815ca4731922fb0fa4 Mon Sep 17 00:00:00 2001
From: Alberto Planas <aplanas@suse.com>
Date: Mon, 28 Feb 2022 17:37:45 +0100
Subject: [PATCH] config: fix config search order

The configuration search order for RawConfigParser is from left (less
priority) to right (high priority).

This patch set the correct search order and adjust the test.

Signed-off-by: Alberto Planas <aplanas@suse.com>
---
 keylime/config.py   | 5 +++--
 test/test_config.py | 4 ++--
 2 files changed, 5 insertions(+), 4 deletions(-)

Index: keylime-v6.3.1/keylime/config.py
===================================================================
--- keylime-v6.3.1.orig/keylime/config.py
+++ keylime-v6.3.1/keylime/config.py
@@ -7,7 +7,8 @@ import os.path
 import configparser
 from typing import Optional
 
-# resources in importlib is a Python 3.7 feature, so we disable fallback support if we cannot import this module
+# resources in importlib is a Python 3.7 feature, so we disable
+# fallback support if we cannot import this module
 try:
     from importlib import resources
     _CONFIG_FALLBACK = True
@@ -118,7 +119,7 @@ if not REQUIRE_ROOT:
 # Config files can be merged together, reading from the system to the
 # user.
 CONFIG_FILES = [
-    os.path.expanduser("~/.config/keylime.conf"), "/etc/keylime.conf", "/usr/etc/keylime.conf"
+    "/usr/etc/keylime.conf", "/etc/keylime.conf", os.path.expanduser("~/.config/keylime.conf")
 ]
 if "KEYLIME_CONFIG" in os.environ:
     CONFIG_FILES.insert(0, os.environ["KEYLIME_CONFIG"])
Index: keylime-v6.3.1/test/test_config.py
===================================================================
--- keylime-v6.3.1.orig/test/test_config.py
+++ keylime-v6.3.1/test/test_config.py
@@ -22,9 +22,9 @@ class TestConfig(unittest.TestCase):
         self.assertEqual(
             config.CONFIG_FILES,
             [
-                os.path.expanduser("~/.config/keylime.conf"),
-                "/etc/keylime.conf",
                 "/usr/etc/keylime.conf",
+                "/etc/keylime.conf",
+                os.path.expanduser("~/.config/keylime.conf"),
             ],
         )
 
