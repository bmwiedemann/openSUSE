From 6addcab364d972d0f990f50e8125390ee290ecbc Mon Sep 17 00:00:00 2001
From: Fabian Vogt <fabian@ritter-vogt.de>
Date: Mon, 19 Oct 2020 14:53:38 +0000
Subject: [PATCH] Detect softpipe and llvmpipe on Mesa 20.2+

It seems like the vendor string changed from "VMware Inc." to "Mesa/X.org".
---
 .../data/glplatform/llvmpipe-10.0             | 22 +++++++++++++++++++
 libkwineffects/kwinglplatform.cpp             |  4 ++--
 2 files changed, 24 insertions(+), 2 deletions(-)
 create mode 100644 autotests/libkwineffects/data/glplatform/llvmpipe-10.0

diff --git a/autotests/libkwineffects/data/glplatform/llvmpipe-10.0 b/autotests/libkwineffects/data/glplatform/llvmpipe-10.0
new file mode 100644
index 000000000..92581afb6
--- /dev/null
+++ b/autotests/libkwineffects/data/glplatform/llvmpipe-10.0
@@ -0,0 +1,22 @@
+[Driver]
+Vendor=Mesa/X.org
+Renderer=llvmpipe (LLVM 10.0.1, 256 bits)
+Version=3.1 Mesa 20.2.1
+ShadingLanguageVersion=1.40
+
+[Settings]
+LooseBinding=true
+GLSL=true
+TextureNPOT=true
+Mesa=true
+Gallium=true
+SoftwareEmulation=true
+GLVersion=3,1
+GLSLVersion=1,40
+MesaVersion=20,2,1
+GalliumVersion=0,4
+DriverVersion=20,2,1
+Driver=12
+ChipClass=99999
+Compositor=9
+
diff --git a/libkwineffects/kwinglplatform.cpp b/libkwineffects/kwinglplatform.cpp
index bccb7be14..56a97f02f 100644
--- a/libkwineffects/kwinglplatform.cpp
+++ b/libkwineffects/kwinglplatform.cpp
@@ -894,12 +894,12 @@ void GLPlatform::detect(OpenGLPlatformInterface platformInterface)
         }
 
         // softpipe
-        else if (m_vendor == "VMware, Inc." && m_chipset == "softpipe" ) {
+        else if (m_chipset == "softpipe") {
             m_driver = Driver_Softpipe;
         }
 
         // llvmpipe
-        else if (m_vendor == "VMware, Inc." && m_chipset == "llvmpipe") {
+        else if (m_chipset == "llvmpipe") {
             m_driver = Driver_Llvmpipe;
         }
 
-- 
2.25.1

