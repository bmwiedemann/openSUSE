From 36bb57c0dd704b75326e23ee632a43458a07f4dc Mon Sep 17 00:00:00 2001
From: Tomaz Canabrava <tcanabrava@kde.org>
Date: Tue, 28 Dec 2021 10:15:04 +0000
Subject: [PATCH] Add posix permissions on filesystems used in posix systems

---
 src/fs/btrfs.h    | 2 ++
 src/fs/f2fs.h     | 2 ++
 src/fs/hfsplus.h  | 2 ++
 src/fs/jfs.h      | 2 ++
 src/fs/minix.h    | 5 ++++-
 src/fs/nilfs2.h   | 2 ++
 src/fs/ocfs2.h    | 2 ++
 src/fs/reiser4.h  | 2 ++
 src/fs/reiserfs.h | 2 ++
 src/fs/udf.h      | 2 ++
 src/fs/xfs.h      | 2 ++
 src/fs/zfs.h      | 2 ++
 12 files changed, 26 insertions(+), 1 deletion(-)

diff --git a/src/fs/btrfs.h b/src/fs/btrfs.h
index 8f69eaa..9cdea7c 100644
--- a/src/fs/btrfs.h
+++ b/src/fs/btrfs.h
@@ -42,6 +42,8 @@ public:
     bool writeLabel(Report& report, const QString& deviceNode, const QString& newLabel) override;
     bool writeLabelOnline(Report& report, const QString& deviceNode, const QString& mountPoint, const QString& newLabel) override;
     bool updateUUID(Report& report, const QString& deviceNode) const override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetUsed() const override {
         return m_GetUsed;
diff --git a/src/fs/f2fs.h b/src/fs/f2fs.h
index 4e5edd6..8bb7278 100644
--- a/src/fs/f2fs.h
+++ b/src/fs/f2fs.h
@@ -40,6 +40,8 @@ public:
     bool resize(Report& report, const QString& deviceNode, qint64 length) const override;
 //     bool writeLabel(Report& report, const QString& deviceNode, const QString& newLabel) override;
 //     bool updateUUID(Report& report, const QString& deviceNode) const override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetUsed() const override {
         return m_GetUsed;
diff --git a/src/fs/hfsplus.h b/src/fs/hfsplus.h
index 7df4a51..e591f2b 100644
--- a/src/fs/hfsplus.h
+++ b/src/fs/hfsplus.h
@@ -37,6 +37,8 @@ public:
 
     bool check(Report& report, const QString& deviceNode) const override;
     bool create(Report& report, const QString& deviceNode) override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetLabel() const override {
         return m_GetLabel;
diff --git a/src/fs/jfs.h b/src/fs/jfs.h
index 8c21e69..c0b8616 100644
--- a/src/fs/jfs.h
+++ b/src/fs/jfs.h
@@ -41,6 +41,8 @@ public:
     bool resizeOnline(Report& report, const QString& deviceNode, const QString& mountPoint, qint64 length) const override;
     bool writeLabel(Report& report, const QString& deviceNode, const QString& newLabel) override;
     bool writeLabelOnline(Report& report, const QString& deviceNode, const QString& mountPoint, const QString& newLabel) override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetUsed() const override {
         return m_GetUsed;
diff --git a/src/fs/minix.h b/src/fs/minix.h
index d0621b2..b4bd4d2 100644
--- a/src/fs/minix.h
+++ b/src/fs/minix.h
@@ -31,7 +31,10 @@ public:
     
     bool check(Report& report, const QString&deviceNode) const override;
     bool create(Report& report, const QString&deviceNode) override;
-    
+
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
+
     CommandSupportType supportGetLabel() const override {
         return m_GetLabel;
     }
diff --git a/src/fs/nilfs2.h b/src/fs/nilfs2.h
index e4ffee2..4c4b7cb 100644
--- a/src/fs/nilfs2.h
+++ b/src/fs/nilfs2.h
@@ -41,6 +41,8 @@ public:
     bool resizeOnline(Report& report, const QString& deviceNode, const QString& mountPoint, qint64 length) const override;
     bool writeLabel(Report& report, const QString& deviceNode, const QString& newLabel) override;
     bool updateUUID(Report& report, const QString& deviceNode) const override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetUsed() const override {
         return m_GetUsed;
diff --git a/src/fs/ocfs2.h b/src/fs/ocfs2.h
index 20e9d3a..fe10466 100644
--- a/src/fs/ocfs2.h
+++ b/src/fs/ocfs2.h
@@ -40,6 +40,8 @@ public:
     bool resize(Report& report, const QString& deviceNode, qint64 length) const override;
     bool writeLabel(Report& report, const QString& deviceNode, const QString& newLabel) override;
     bool updateUUID(Report& report, const QString& deviceNode) const override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetUsed() const override {
         return m_GetUsed;
diff --git a/src/fs/reiser4.h b/src/fs/reiser4.h
index 5cbb7e2..468ecc6 100644
--- a/src/fs/reiser4.h
+++ b/src/fs/reiser4.h
@@ -38,6 +38,8 @@ public:
     qint64 readUsedCapacity(const QString& deviceNode) const override;
     bool check(Report& report, const QString& deviceNode) const override;
     bool create(Report& report, const QString& deviceNode) override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetUsed() const override {
         return m_GetUsed;
diff --git a/src/fs/reiserfs.h b/src/fs/reiserfs.h
index 0ad56a3..f058478 100644
--- a/src/fs/reiserfs.h
+++ b/src/fs/reiserfs.h
@@ -44,6 +44,8 @@ public:
     bool resizeOnline(Report& report, const QString& deviceNode, const QString& mountPoint, qint64 length) const override;
     bool writeLabel(Report& report, const QString& deviceNode, const QString& newLabel) override;
     bool updateUUID(Report& report, const QString& deviceNode) const override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetUsed() const override {
         return m_GetUsed;
diff --git a/src/fs/udf.h b/src/fs/udf.h
index 1dd1d46..9266691 100644
--- a/src/fs/udf.h
+++ b/src/fs/udf.h
@@ -38,6 +38,8 @@ public:
     bool createWithLabel(Report& report, const QString& deviceNode, const QString& label) override;
     bool writeLabel(Report& report, const QString& deviceNode, const QString& newLabel) override;
     bool updateUUID(Report& report, const QString& deviceNode) const override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetUsed() const override {
         return m_GetUsed;
diff --git a/src/fs/xfs.h b/src/fs/xfs.h
index 66aad94..2112252 100644
--- a/src/fs/xfs.h
+++ b/src/fs/xfs.h
@@ -41,6 +41,8 @@ public:
     bool resize(Report& report, const QString& deviceNode, qint64 length) const override;
     bool resizeOnline(Report& report, const QString& deviceNode, const QString& mountPoint, qint64 length) const override;
     bool writeLabel(Report& report, const QString& deviceNode, const QString& newLabel) override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetUsed() const override {
         return m_GetUsed;
diff --git a/src/fs/zfs.h b/src/fs/zfs.h
index 61026c3..cb4b88d 100644
--- a/src/fs/zfs.h
+++ b/src/fs/zfs.h
@@ -36,6 +36,8 @@ public:
     void init() override;
 
     bool writeLabel(Report& report, const QString& deviceNode, const QString& newLabel) override;
+    QString posixPermissions() const override { return implPosixPermissions();  };
+    void setPosixPermissions(const QString& permissions) override { implSetPosixPermissions(permissions); };
 
     CommandSupportType supportGetUsed() const override {
         return m_GetUsed;
-- 
2.35.1

