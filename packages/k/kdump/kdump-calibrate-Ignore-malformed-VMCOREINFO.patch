From 34584498323ae95b1107fb260db876e56d81e3a1 Mon Sep 17 00:00:00 2001
From: Petr Tesarik <ptesarik@suse.com>
Date: Fri, 21 Jan 2022 15:59:37 +0100
Subject: calibrate: Ignore malformed VMCOREINFO lines
Patch-mainline: merged
Git-commit: 34584498323ae95b1107fb260db876e56d81e3a1

The vmcoreinfo content is sometimes not terminated properly,
producing one or more invalid lines at the end (i.e. without an
equal sign). They should be silently ignored.

Signed-off-by: Petr Tesarik <ptesarik@suse.com>
---
 calibrate/maxrss.py |   13 ++++++++-----
 1 file changed, 8 insertions(+), 5 deletions(-)

--- a/calibrate/maxrss.py
+++ b/calibrate/maxrss.py
@@ -61,11 +61,14 @@ try:
                 percpu = int(value.split()[0])
 
         elif category == 'vmcoreinfo':
-            (key, value) = data.split('=')
-            if key == 'PAGESIZE':
-                pagesize = int(value)
-            elif key == 'SIZE(page)':
-                sizeofpage = int(value)
+            try:
+                (key, value) = data.split('=')
+                if key == 'PAGESIZE':
+                    pagesize = int(value)
+                elif key == 'SIZE(page)':
+                    sizeofpage = int(value)
+            except ValueError:
+                pass
 
         else:
             if cmdline.debug:
