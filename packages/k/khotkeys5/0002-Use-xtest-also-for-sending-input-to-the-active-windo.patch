From fd301faa7ab00f5858741da2697c5f8977c2290c Mon Sep 17 00:00:00 2001
From: Fabian Vogt <fabian@ritter-vogt.de>
Date: Fri, 10 Jul 2020 14:29:20 +0200
Subject: [PATCH 2/2] Use xtest also for sending input to the active window

This is possible with xtest as well and necessary to work with applications
which don't accept synthetic events, like those using XInput2 (GTK3, Firefox)
---
 libkhotkeysprivate/shortcuts_handler.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/libkhotkeysprivate/shortcuts_handler.cpp b/libkhotkeysprivate/shortcuts_handler.cpp
index 561dc57..631348d 100644
--- a/libkhotkeysprivate/shortcuts_handler.cpp
+++ b/libkhotkeysprivate/shortcuts_handler.cpp
@@ -186,13 +186,14 @@ bool ShortcutsHandler::send_macro_key( const QKeySequence &key, Window window_P
     unsigned int keysym = key[0];
     int x_keycode;
     KKeyServer::keyQtToCodeX(keysym, &x_keycode);
+
     if( x_keycode == NoSymbol )
         return false;
 
     unsigned int x_mod;
     KKeyServer::keyQtToModX(keysym, &x_mod );
 #ifdef HAVE_XTEST
-    if( xtest() && window_P == None )
+    if( xtest() && (window_P == None || window_P == InputFocus) )
         {
         QVector<int> keycodes_to_press, keycodes_to_release;
         get_modifier_change(x_mod, keycodes_to_press, keycodes_to_release);
-- 
2.25.1

