From 78c216161f01fae3ebda62bcb27446ba386d1bbe Mon Sep 17 00:00:00 2001
From: Jean-Baptiste Mardelle <jb@kdenlive.org>
Date: Mon, 12 Dec 2022 08:29:53 +0100
Subject: [PATCH] Fix designer plugin crash

---
 src/widgets/colorpickerwidget.cpp | 18 ++++++++++--------
 1 file changed, 10 insertions(+), 8 deletions(-)

diff --git a/src/widgets/colorpickerwidget.cpp b/src/widgets/colorpickerwidget.cpp
index 18bb2e308..69bb7d3d1 100644
--- a/src/widgets/colorpickerwidget.cpp
+++ b/src/widgets/colorpickerwidget.cpp
@@ -84,14 +84,16 @@ ColorPickerWidget::ColorPickerWidget(QWidget *parent)
     // Check wether grabWindow() works. On some systems like with Wayland it does.
     // We fallback to the Freedesktop portal with DBus which has less features than
     // our custom implementation (eg. preview and avarage color are missing)
-    QPoint p(pCore->window()->geometry().center());
-    foreach (QScreen *screen, QGuiApplication::screens()) {
-        QRect screenRect = screen->geometry();
-        if (screenRect.contains(p)) {
-            QPixmap pm = screen->grabWindow(pCore->window()->winId(), p.x(), p.y(), 1, 1);
-            qDebug() << "got pixmap that is not null";
-            m_useDBus = pm.isNull();
-            break;
+    if (pCore) {
+        QPoint p(pCore->window()->geometry().center());
+        foreach (QScreen *screen, QGuiApplication::screens()) {
+            QRect screenRect = screen->geometry();
+            if (screenRect.contains(p)) {
+                QPixmap pm = screen->grabWindow(pCore->window()->winId(), p.x(), p.y(), 1, 1);
+                qDebug() << "got pixmap that is not null";
+                m_useDBus = pm.isNull();
+                break;
+            }
         }
     }
 
-- 
2.39.0

