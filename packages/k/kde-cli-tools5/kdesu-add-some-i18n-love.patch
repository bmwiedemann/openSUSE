From abee9c239f74f60a77c0931be23ad1d8670feda6 Mon Sep 17 00:00:00 2001
From: Hrvoje Senjan <hrvoje.senjan@gmail.com>
Date: Tue, 3 Dec 2013 19:31:13 +0100
Subject: [PATCH 1/1] kdesu Add some love

From/toUTF8 in practice covers more ground than 8bit.
Furthermore, make the kdesu 'command' translatable, it's used
in openSUSE with dolphin and konsole 'Start as root'
BUG: boo#852256
---
 kdesu/kdesu.cpp | 16 ++++++++--------
 1 file changed, 8 insertions(+), 8 deletions(-)

Index: kde-cli-tools-5.14.80git.20180925T084325~290b262/kdesu/kdesu.cpp
===================================================================
--- kde-cli-tools-5.14.80git.20180925T084325~290b262.orig/kdesu/kdesu.cpp
+++ kde-cli-tools-5.14.80git.20180925T084325~290b262/kdesu/kdesu.cpp
@@ -157,11 +157,11 @@ int main(int argc, char *argv[])
 
     if (result == 127)
     {
-        KMessageBox::sorry(nullptr, i18n("Cannot execute command '%1'.", QString::fromLocal8Bit(command)));
+        KMessageBox::sorry(nullptr, i18n("Cannot execute command '%1'.", QString::fromUtf8(command)));
     }
     if (result == -2)
     {
-        KMessageBox::sorry(nullptr, i18n("Cannot execute command '%1'. It contains invalid characters.", QString::fromLocal8Bit(command)));
+        KMessageBox::sorry(nullptr, i18n("Cannot execute command '%1'. It contains invalid characters.", QString::fromUtf8(command)));
     }
 
     return result;
@@ -196,7 +196,7 @@ static int startApp(QCommandLineParser&
         prompt = false;
 
     // Get target uid
-    const QByteArray user = p.value(QStringLiteral("u")).toLocal8Bit();
+    const QByteArray user = p.value(QStringLiteral("u")).toUtf8();
     QByteArray auth_user = user;
     struct passwd *pw = getpwnam(user.constData());
     if (pw == nullptr)
@@ -256,7 +256,7 @@ static int startApp(QCommandLineParser&
     // Get command
     if (p.isSet(QStringLiteral("c")))
     {
-        command = p.value(QStringLiteral("c")).toLocal8Bit();
+        command = p.value(QStringLiteral("c")).toUtf8();
         // Accepting additional arguments here is somewhat weird,
         // but one can conceive use cases: have a complex command with
         // redirections and additional file names which need to be quoted
@@ -344,7 +344,7 @@ static int startApp(QCommandLineParser&
 //     }
 
     KUser u;
-    env << (QByteArray) ("KDESU_USER=" + u.loginName().toLocal8Bit());
+    env << (QByteArray) ("KDESU_USER=" + u.loginName().toUtf8());
 
     if (keep && !terminal && !just_started)
     {
@@ -456,7 +456,7 @@ static int startApp(QCommandLineParser&
     }
     else if (keep && have_daemon)
     {
-        client.setPass(password.toLocal8Bit().constData(), timeout);
+        client.setPass(password.toUtf8().constData(), timeout);
         client.setPriority(priority);
         client.setScheduler(scheduler);
         int result = client.exec(command, user, options, env);
@@ -475,7 +475,7 @@ static int startApp(QCommandLineParser&
         proc.setPriority(priority);
         proc.setScheduler(scheduler);
         proc.setCommand(command);
-        int result = proc.exec(password.toLocal8Bit().constData());
+        int result = proc.exec(password.toUtf8().constData());
         return result;
     }
     return -1;
