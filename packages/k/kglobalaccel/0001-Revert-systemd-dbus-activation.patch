From 659018b469db2401f766b69bd565e88e1731c9c3 Mon Sep 17 00:00:00 2001
From: Fabian Vogt <fabian@ritter-vogt.de>
Date: Fri, 20 Nov 2020 21:40:32 +0100
Subject: [PATCH] Revert "systemd dbus activation"

This reverts commit 3b9a6ba78d552a83554fc13f93d52d238559325b.
Work around kde#429415, boo#1179033
---
 src/runtime/CMakeLists.txt                 | 15 +--------------
 src/runtime/plasma-kglobalaccel.service.in | 10 ----------
 2 files changed, 1 insertion(+), 24 deletions(-)
 delete mode 100644 src/runtime/plasma-kglobalaccel.service.in

diff --git a/src/runtime/CMakeLists.txt b/src/runtime/CMakeLists.txt
index 0e30e74..06e9729 100644
--- a/src/runtime/CMakeLists.txt
+++ b/src/runtime/CMakeLists.txt
@@ -71,17 +71,4 @@ install(FILES
   DESTINATION ${KDE_INSTALL_INCLUDEDIR_KF5}/KGlobalAccel/private COMPONENT Devel
 )
 
-# D-Bus activation service file, and associated systemd service
-include (ECMGenerateDBusServiceFile)
-include (ECMConfiguredInstall)
-ecm_generate_dbus_service_file(
-   NAME org.kde.kglobalaccel
-   EXECUTABLE "${KDE_INSTALL_FULL_BINDIR}/kglobalaccel5"
-   SYSTEMD_SERVICE plasma-kglobalaccel.service
-   DESTINATION ${KDE_INSTALL_DBUSSERVICEDIR}
-)
-
-ecm_install_configured_files(
-   INPUT plasma-kglobalaccel.service.in
-   DESTINATION ${KDE_INSTALL_SYSTEMDUSERUNITDIR}
-)
+kdbusaddons_generate_dbus_service_file(kglobalaccel5 org.kde.kglobalaccel ${KDE_INSTALL_FULL_BINDIR})
diff --git a/src/runtime/plasma-kglobalaccel.service.in b/src/runtime/plasma-kglobalaccel.service.in
deleted file mode 100644
index 5a88581..0000000
--- a/src/runtime/plasma-kglobalaccel.service.in
+++ /dev/null
@@ -1,10 +0,0 @@
-[Unit]
-Description=KDE Global Shortcuts Server
-PartOf=graphical-session.target
-
-[Service]
-ExecStart=@KDE_INSTALL_FULL_BINDIR@/kglobalaccel5
-BusName=org.kde.kglobalaccel
-Slice=background.slice
-TimeoutSec=5sec
-Restart=on-failure
-- 
2.25.1

