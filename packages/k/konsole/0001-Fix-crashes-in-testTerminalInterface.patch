From d1393cf591a17230b263b55d2ce890e3020f13ef Mon Sep 17 00:00:00 2001
From: Antonio Rojas <arojas@archlinux.org>
Date: Thu, 31 Aug 2023 23:13:58 +0000
Subject: [PATCH] Fix crashes in testTerminalInterface

Certain user profiles crash here

   from /lib/x86_64-linux-gnu/libQt5Widgets.so.5
    this=0x5555557c8da0, name=..., visible=true)
    at src/konsole/src/session/SessionController.cpp:2206
    mode=1) at src/konsole/src/Screen.cpp:2395
    at src/konsole/src/Vt102Emulation.cpp:1071
    this=0x555555dc2a30, cc=7)

BUG: 473043

(cherry picked from commit 5bda57405e2f64e92a1142fb0898ff8ba5fafd3c)
---
 src/session/SessionController.cpp | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/session/SessionController.cpp b/src/session/SessionController.cpp
index 1070c962f..914793402 100644
--- a/src/session/SessionController.cpp
+++ b/src/session/SessionController.cpp
@@ -2191,5 +2191,11 @@ bool SessionController::isValid() const
 
 void SessionController::setVisible(QString name, bool visible)
 {
+    /* For certain user profiles, testTerminalInterface crashes
+        in QAction::setVisible() without this check.
+    */
+    if (!actionCollection()->action(name)) {
+        return;
+    }
     actionCollection()->action(name)->setVisible(visible);
 }
-- 
2.42.0

