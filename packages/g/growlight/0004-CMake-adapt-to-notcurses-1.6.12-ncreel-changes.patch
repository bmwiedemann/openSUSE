From 724a81932f7348812bdf85705a80b80da0cf17f3 Mon Sep 17 00:00:00 2001
From: nick black <dankamongmen@gmail.com>
Date: Sun, 9 Aug 2020 21:48:11 -0400
Subject: [PATCH 04/13] CMake: adapt to notcurses 1.6.12 ncreel changes

---
 CMakeLists.txt            |  2 +-
 README.md                 |  2 +-
 src/notcurses/notcurses.c | 14 +++++++++-----
 3 files changed, 11 insertions(+), 7 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index dea2d8c..00c8a73 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -21,7 +21,7 @@ add_compile_options(-Wall -Wextra -W -Wshadow -Wformat -fexceptions)
 
 find_package(PkgConfig REQUIRED)
 find_package(Threads REQUIRED)
-find_package(notcurses 1.6.7 REQUIRED)
+find_package(notcurses 1.6.12 REQUIRED)
 pkg_check_modules(LIBATASMART REQUIRED libatasmart>=0.19)
 pkg_check_modules(LIBBLKID REQUIRED blkid>=2.20.1)
 pkg_check_modules(LIBCAP REQUIRED libcap>=2.24)
diff --git a/README.md b/README.md
index 1352f8b..eb6a68b 100644
--- a/README.md
+++ b/README.md
@@ -12,7 +12,7 @@ https://nick-black.com/dankwiki/index.php/Growlight
 
 Dependencies:
 
- - notcurses 1.6.7+
+ - notcurses 1.6.12+
  - libudev 175+
  - libblkid 2.20.1
  - libpci 3.1.9+
diff --git a/src/notcurses/notcurses.c b/src/notcurses/notcurses.c
index 33a0f5e..63acc1b 100644
--- a/src/notcurses/notcurses.c
+++ b/src/notcurses/notcurses.c
@@ -1549,20 +1549,24 @@ print_adapter_devs(struct ncplane* n, const adapterstate *as, int rows, int cols
 }
 
 static int
-redraw_adapter(struct nctablet* t, int begx, int begy, int maxx, int maxy, bool cliptop){
+redraw_adapter(struct nctablet* t, bool drawfromtop){
   struct ncplane* n = nctablet_ncplane(t);
   const adapterstate *as = nctablet_userptr(t);
   //ncplane_erase(n);
 //fprintf(stderr, "ADAPTER-redraw %s begx/y %d/%d -> maxx/y %d/%d ASS %p\n", as->c->name, begx, begy, maxx, maxy, as);
-  int lines = print_adapter_devs(n, as, maxy - begy + 1, maxx - begx + 1, cliptop);
+  int maxx, maxy;
+  ncplane_dim_yx(nctablet_ncplane(t), &maxy, &maxx);
+  --maxx;
+  --maxy;
+  int lines = print_adapter_devs(n, as, maxy + 1, maxx + 1, drawfromtop);
   if(lines < 0){
     return -1;
   }
   // FIXME shouldn't need this, but we're blasting past the bottom see notcurses #222
-  /*if(lines > maxy - begy){
-    lines = maxy - begy;
+  /*if(lines > maxy){
+    lines = maxy;
   }*/
-//fprintf(stderr, "[%s] drew %d/%d cliptop: %d\n", as->c->name, lines, maxy - begy, cliptop);
+//fprintf(stderr, "[%s] drew %d/%d cliptop: %d\n", as->c->name, lines, maxy, cliptop);
   return lines;
 }
 
-- 
2.28.0

