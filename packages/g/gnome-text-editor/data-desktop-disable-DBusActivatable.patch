From 9a97fddb82824497e76d0e895cf40757f7d89727 Mon Sep 17 00:00:00 2001
From: Christian Hergert <chergert@redhat.com>
Date: Mon, 25 Mar 2024 11:13:44 -0700
Subject: [PATCH] data/desktop: disable DBusActivatable

We can end up starting up without going through session initialization if
we are activated via D-Bus alone.

An alternative, if this should become problematic, would be to delay all
start-up procsesing options until the first activation or open request is
received by the EditorApplication.

Fixes #661
---
 data/org.gnome.TextEditor.desktop.in.in | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/data/org.gnome.TextEditor.desktop.in.in b/data/org.gnome.TextEditor.desktop.in.in
index d7516185..2ac72a38 100644
--- a/data/org.gnome.TextEditor.desktop.in.in
+++ b/data/org.gnome.TextEditor.desktop.in.in
@@ -1,7 +1,9 @@
 [Desktop Entry]
 Categories=GNOME;GTK;Utility;TextEditor;
 Keywords=write;notepad;
-DBusActivatable=true
+# Not activatable because we want to force ourself through the startup
+# options processing for session-state/etc. See #661.
+DBusActivatable=false
 Exec=gnome-text-editor %U
 MimeType=text/plain;application/x-zerosize;
 Name=Text Editor
-- 
GitLab

