From 7666bd037fff54b4734e091c24d3c9f1d1b46a9e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stefan=20Br=C3=BCns?= <stefan.bruens@rwth-aachen.de>
Date: Sat, 17 Sep 2022 23:18:44 +0200
Subject: [PATCH 3/3] Reuse common add_cxx_example function for Sat Runner

---
 cmake/cpp.cmake             |  5 +++--
 examples/cpp/CMakeLists.txt | 17 +----------------
 2 files changed, 4 insertions(+), 18 deletions(-)

diff --git a/cmake/cpp.cmake b/cmake/cpp.cmake
index 293b5415ac..b6e4f9289c 100644
--- a/cmake/cpp.cmake
+++ b/cmake/cpp.cmake
@@ -445,8 +445,9 @@ function(add_cxx_example FILE_NAME)
 
   install(TARGETS ${EXAMPLE_NAME})
 
-  if(BUILD_TESTING)
-    add_test(NAME cxx_${COMPONENT_NAME}_${EXAMPLE_NAME} COMMAND ${EXAMPLE_NAME})
+  set(SKIP_TEST (${ARGC} GREATER 1) AND ${ARG1})
+  if(BUILD_TESTING AND NOT SKIP_TEST)
+      add_test(NAME cxx_${COMPONENT_NAME}_${EXAMPLE_NAME} COMMAND ${EXAMPLE_NAME})
   endif()
   message(STATUS "Configuring example ${FILE_NAME}: ...DONE")
 endfunction()
diff --git a/examples/cpp/CMakeLists.txt b/examples/cpp/CMakeLists.txt
index dac814b314..9b7c23dc83 100644
--- a/examples/cpp/CMakeLists.txt
+++ b/examples/cpp/CMakeLists.txt
@@ -53,23 +53,8 @@ foreach(SAMPLE IN LISTS CXX_SRCS)
 endforeach()
 
 # Sat Runner
-include(GNUInstallDirs)
-if(APPLE)
-  set(CMAKE_INSTALL_RPATH
-    "@loader_path/../${CMAKE_INSTALL_LIBDIR};@loader_path")
-elseif(UNIX)
-  set(CMAKE_INSTALL_RPATH
-    "$ORIGIN/../${CMAKE_INSTALL_LIBDIR}:$ORIGIN/../lib64:$ORIGIN/../lib:$ORIGIN")
-endif()
-
-add_executable(sat_runner)
+add_cxx_example("${CMAKE_CURRENT_LIST_DIR}/sat_runner.cc" TRUE)
 target_sources(sat_runner PRIVATE
- "sat_runner.cc"
  "opb_reader.h"
  "sat_cnf_reader.h")
-target_include_directories(sat_runner PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})
-target_compile_features(sat_runner PRIVATE cxx_std_17)
-target_link_libraries(sat_runner PRIVATE ${PROJECT_NAMESPACE}::ortools)
-
-install(TARGETS sat_runner)
 
-- 
2.37.1

