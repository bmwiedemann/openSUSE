# Patch to fix new poppler API on gdcm 3.0.5
# Axel Braun <DocB@opensuse.org>

Index: gdcm-3.0.5/Applications/Cxx/gdcminfo.cxx
===================================================================
--- gdcm-3.0.5.orig/Applications/Cxx/gdcminfo.cxx
+++ gdcm-3.0.5/Applications/Cxx/gdcminfo.cxx
@@ -258,7 +258,7 @@ static std::string getInfoDate(Dict *inf
   return out;
 }
 
-static std::string getInfoString(Dict *infoDict, const char *key, UnicodeMap *uMap)
+static std::string getInfoString(Dict *infoDict, const char *key, const UnicodeMap *uMap)
 {
   Object obj;
 #ifdef LIBPOPPLER_GOOSTRING_HAS_CONSTGETCHAR
@@ -509,11 +509,11 @@ static int ProcessOneFile( std::string c
     std::string creationdate;
     std::string moddate;
 
-    UnicodeMap *uMap;
+    const UnicodeMap *uMap;
 #ifdef LIBPOPPLER_GLOBALPARAMS_CSTOR_HAS_PARAM
     globalParams = new GlobalParams(0);
 #else
-    globalParams = new GlobalParams();
+    globalParams.reset(new GlobalParams());
 #endif
     uMap = globalParams->getTextEncoding();
 
Index: gdcm-3.0.5/Applications/Cxx/gdcmpdf.cxx
===================================================================
--- gdcm-3.0.5.orig/Applications/Cxx/gdcmpdf.cxx
+++ gdcm-3.0.5/Applications/Cxx/gdcmpdf.cxx
@@ -106,7 +106,7 @@ static std::string getInfoDate(Dict *inf
   return out;
 }
 
-static std::string getInfoString(Dict *infoDict, const char *key, UnicodeMap *uMap, bool & unicode)
+static std::string getInfoString(Dict *infoDict, const char *key, const UnicodeMap *uMap, bool & unicode)
 {
   Object obj;
 #ifdef LIBPOPPLER_GOOSTRING_HAS_CONSTGETCHAR
@@ -333,13 +333,13 @@ int main (int argc, char *argv[])
   GooString *fileName;
   PDFDoc *doc;
   Object info;
-  UnicodeMap *uMap;
+  const UnicodeMap *uMap;
   ownerPW = NULL;
   userPW = NULL;
 #ifdef LIBPOPPLER_GLOBALPARAMS_CSTOR_HAS_PARAM
   globalParams = new GlobalParams(0);
 #else
-  globalParams = new GlobalParams();
+  globalParams.reset(new GlobalParams());
 #endif
   uMap = globalParams->getTextEncoding();
 
