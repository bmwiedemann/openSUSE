From 513dd2c2195312780764902b57256d43ff6efb4f Mon Sep 17 00:00:00 2001
From: Jonas Kvinge <jonas@jkvinge.net>
Date: Thu, 8 Jun 2023 19:12:54 +0200
Subject: [PATCH] adaptivedemux2: Allow data dash+xml manifest for uri

Part-of: <https://gitlab.freedesktop.org/gstreamer/gstreamer/-/merge_requests/4811>
---
 .../gst-plugins-good/ext/adaptivedemux2/gstadaptivedemux.c   | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/ext/adaptivedemux2/gstadaptivedemux.c b/ext/adaptivedemux2/gstadaptivedemux.c
index 2104486f6a9..c2607d4ffd2 100644
--- a/ext/adaptivedemux2/gstadaptivedemux.c
+++ b/ext/adaptivedemux2/gstadaptivedemux.c
@@ -991,11 +991,12 @@ handle_incoming_manifest (GstAdaptiveDemux * demux)
     GST_DEBUG_OBJECT (demux, "Fetched manifest at URI: %s (base: %s)",
         demux->manifest_uri, GST_STR_NULL (demux->manifest_base_uri));
 
-    if (!g_str_has_prefix (demux->manifest_uri, "http://")
+    if (!g_str_has_prefix (demux->manifest_uri, "data:")
+        && !g_str_has_prefix (demux->manifest_uri, "http://")
         && !g_str_has_prefix (demux->manifest_uri, "https://")) {
       GST_ELEMENT_ERROR (demux, STREAM, DEMUX,
           (_("Invalid manifest URI")),
-          ("Manifest URI needs to use either http:// or https://"));
+          ("Manifest URI needs to use either data:, http:// or https://"));
       ret = FALSE;
       goto unlock_out;
     }
-- 
GitLab

