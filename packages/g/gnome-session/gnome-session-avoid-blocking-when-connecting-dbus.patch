From 0903f9d861cb00cba9c1075cd57c6e9297122426 Mon Sep 17 00:00:00 2001
From: Xiaoguang Wang <xwang@suse.com>
Date: Thu, 15 Apr 2021 16:49:21 +0800
Subject: [PATCH] GsmPresence: Avoid blocking when connecting dbus ScreenSaver

https://gitlab.gnome.org/GNOME/gnome-session/-/issues/88
---
 gnome-session/gsm-presence.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/gnome-session/gsm-presence.c b/gnome-session/gsm-presence.c
index cdfa3ccd..cd28f5ce 100644
--- a/gnome-session/gsm-presence.c
+++ b/gnome-session/gsm-presence.c
@@ -328,7 +328,9 @@ gsm_presence_constructor (GType                  type,
         }
 
         presence->priv->screensaver_proxy = g_dbus_proxy_new_sync (presence->priv->connection,
-                                                                   G_DBUS_PROXY_FLAGS_NONE,
+                                                                   G_DBUS_PROXY_FLAGS_DO_NOT_AUTO_START |
+                                                                   G_DBUS_PROXY_FLAGS_DO_NOT_CONNECT_SIGNALS |
+                                                                   G_DBUS_PROXY_FLAGS_DO_NOT_LOAD_PROPERTIES,
                                                                    NULL,
                                                                    GS_NAME,
                                                                    GS_PATH,
-- 
2.31.1

