From 4aaaa1f23720240572cf1f18811993d3c5ccda5a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ralf=20Cors=C3=A9pius?= <corsepiu@fedoraproject.org>
Date: Tue, 15 Apr 2014 05:18:38 +0200
Subject: [PATCH 2/6] gpsbabel-1.4.3-use-system-shapelib

	Use system shapelib - not suitable for upstream in this form.
---
 Makefile.in  | 8 ++------
 configure    | 3 +--
 configure.in | 2 +-
 shape.cc     | 2 +-
 4 files changed, 5 insertions(+), 10 deletions(-)

Index: gpsbabel-1.5.3/Makefile.in
===================================================================
--- gpsbabel-1.5.3.orig/Makefile.in
+++ gpsbabel-1.5.3/Makefile.in
@@ -100,7 +100,7 @@ JEEPS=jeeps/gpsapp.o jeeps/gpscom.o \
 # Extra modules in Jeeps that we don't use
 # 	jeeps/gpsfmt.o jeeps/gpsinput.o jeeps/gpsproj.o
 
-SHAPE=shapelib/shpopen.o shapelib/dbfopen.o shapelib/safileio.o
+SHAPE=-lshp
 
 MINIZIP=zlib/contrib/minizip/zip.o \
 	zlib/contrib/minizip/ioapi.o
@@ -119,7 +119,7 @@ LIBOBJS = queue.o route.o waypt.o filter
 	  src/core/xmlstreamwriter.o \
 	  src/core/usasciicodec.o\
 	  src/core/ziparchive.o \
-	  $(GARMIN) $(JEEPS) $(SHAPE) @ZLIB@ $(FMTS) $(FILTERS)
+	  $(GARMIN) $(JEEPS) @ZLIB@ $(FMTS) $(FILTERS)
 OBJS = main.o globals.o $(LIBOBJS) @FILEINFO@
 
 DEPFILES = $(OBJS:.o=.d)
@@ -148,10 +148,10 @@ toolinfo
 all: gpsbabel$(EXEEXT)
 
 gpsbabel$(EXEEXT): configure Makefile $(OBJS) @GPSBABEL_DEBUG@ 
-	$(CXX) $(CXXFLAGS) $(LDFLAGS) $(OBJS) @LIBS@ $(QT_LIBS) @USB_LIBS@ $(OUTPUT_SWITCH)$@
+	$(CXX) $(CXXFLAGS) $(LDFLAGS) $(OBJS) @LIBS@ $(QT_LIBS) $(SHAPE) @USB_LIBS@ $(OUTPUT_SWITCH)$@
 
 gpsbabel-debug: $(OBJS)
-	$(CXX) $(CXXFLAGS) $(LDFLAGS) $(OBJS) @LIBS@ @EFENCE_LIB@ $(QT_LIBS) @USB_LIBS@ $(OUTPUT_SWITCH)$@
+	$(CXX) $(CXXFLAGS) $(LDFLAGS) $(OBJS) @LIBS@ @EFENCE_LIB@ $(QT_LIBS) $(SHAPE) @USB_LIBS@ $(OUTPUT_SWITCH)$@
 
 Makefile gbversion.h: Makefile.in config.status xmldoc/makedoc.in \
 	  gbversion.h.in gui/setup.iss.in
@@ -891,11 +891,7 @@ sbp.o: sbp.cc defs.h config.h queue.h zl
 session.o: session.cc defs.h config.h queue.h zlib/zlib.h zlib/zconf.h \
   gbfile.h cet.h inifile.h session.h src/core/datetime.h
 shape.o: shape.cc defs.h config.h queue.h zlib/zlib.h zlib/zconf.h \
-  gbfile.h cet.h inifile.h session.h src/core/datetime.h \
-  shapelib/shapefil.h
-shapelib/dbfopen.o: shapelib/dbfopen.c shapelib/shapefil.h
-shapelib/safileio.o: shapelib/safileio.c shapelib/shapefil.h
-shapelib/shpopen.o: shapelib/shpopen.c shapelib/shapefil.h
+  gbfile.h cet.h inifile.h session.h src/core/datetime.h
 skyforce.o: skyforce.cc defs.h config.h queue.h zlib/zlib.h zlib/zconf.h \
   gbfile.h cet.h inifile.h session.h src/core/datetime.h
 skytraq.o: skytraq.cc defs.h config.h queue.h zlib/zlib.h zlib/zconf.h \
Index: gpsbabel-1.5.3/configure
===================================================================
--- gpsbabel-1.5.3.orig/configure
+++ gpsbabel-1.5.3/configure
@@ -5183,7 +5183,7 @@ done
 
 
 
-ac_config_files="$ac_config_files Makefile gbversion.h gui/setup.iss xmldoc/makedoc tools/mkcapabilities win32/gpsbabel.rc jeeps/Makefile shapelib/Makefile zlib/empty"
+ac_config_files="$ac_config_files Makefile gbversion.h gui/setup.iss xmldoc/makedoc tools/mkcapabilities win32/gpsbabel.rc jeeps/Makefile zlib/empty"
 
 ac_config_files="$ac_config_files gui/makelinuxdist.sh"
 
@@ -5886,7 +5886,6 @@ do
     "tools/mkcapabilities") CONFIG_FILES="$CONFIG_FILES tools/mkcapabilities" ;;
     "win32/gpsbabel.rc") CONFIG_FILES="$CONFIG_FILES win32/gpsbabel.rc" ;;
     "jeeps/Makefile") CONFIG_FILES="$CONFIG_FILES jeeps/Makefile" ;;
-    "shapelib/Makefile") CONFIG_FILES="$CONFIG_FILES shapelib/Makefile" ;;
     "zlib/empty") CONFIG_FILES="$CONFIG_FILES zlib/empty" ;;
     "gui/makelinuxdist.sh") CONFIG_FILES="$CONFIG_FILES gui/makelinuxdist.sh" ;;
 
Index: gpsbabel-1.5.3/configure.in
===================================================================
--- gpsbabel-1.5.3.orig/configure.in
+++ gpsbabel-1.5.3/configure.in
@@ -397,7 +397,7 @@ AC_SUBST(QT_INC_OPT)
 AC_SUBST(QT_SYSINC_OPT)
 AC_SUBST(QT_LIBS)
 
-AC_CONFIG_FILES([Makefile gbversion.h gui/setup.iss xmldoc/makedoc tools/mkcapabilities win32/gpsbabel.rc jeeps/Makefile shapelib/Makefile zlib/empty])
+AC_CONFIG_FILES([Makefile gbversion.h gui/setup.iss xmldoc/makedoc tools/mkcapabilities win32/gpsbabel.rc jeeps/Makefile zlib/empty])
 AC_CONFIG_FILES([gui/makelinuxdist.sh], [chmod +x gui/makelinuxdist.sh])
 AC_OUTPUT
 
Index: gpsbabel-1.5.3/shape.cc
===================================================================
--- gpsbabel-1.5.3.orig/shape.cc
+++ gpsbabel-1.5.3/shape.cc
@@ -20,7 +20,7 @@
 
  */
 #include "defs.h"
-#include "shapelib/shapefil.h"
+#include <shapefil.h>
 #include <stdlib.h>
 
 #if SHAPELIB_ENABLED
