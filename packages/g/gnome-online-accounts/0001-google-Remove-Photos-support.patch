From f17c21fc97e465b86ed27acceeea331624e66cd6 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <debarshir@gnome.org>
Date: Thu, 22 Apr 2021 01:51:52 +0200
Subject: [PATCH] google: Remove Photos support

In theory, support for photos is still desired. However, right now the
implementation of the Google PicasaWeb API in libgdata no longer works.
Until that's fixed, there's no point in advertising support for photos.

https://gitlab.gnome.org/GNOME/gnome-online-accounts/-/issues/63
https://bugzilla.redhat.com/show_bug.cgi?id=1913641
---
 src/goabackend/goagoogleprovider.c | 15 ---------------
 1 file changed, 15 deletions(-)

Index: gnome-online-accounts-3.48.0/src/goabackend/goagoogleprovider.c
===================================================================
--- gnome-online-accounts-3.48.0.orig/src/goabackend/goagoogleprovider.c
+++ gnome-online-accounts-3.48.0/src/goabackend/goagoogleprovider.c
@@ -70,7 +70,6 @@ get_provider_features (GoaProvider *prov
          GOA_PROVIDER_FEATURE_MAIL |
          GOA_PROVIDER_FEATURE_CALENDAR |
          GOA_PROVIDER_FEATURE_CONTACTS |
-         GOA_PROVIDER_FEATURE_PHOTOS |
          GOA_PROVIDER_FEATURE_FILES |
          GOA_PROVIDER_FEATURE_PRINTERS;
 }
@@ -149,9 +148,6 @@ get_scope (GoaOAuth2Provider *oauth2_pro
          "https://docs.googleusercontent.com/ "
          "https://spreadsheets.google.com/feeds/ "
 
-         /* Google PicasaWeb API (GData) */
-         "https://picasaweb.google.com/data/ "
-
          /* GMail IMAP and SMTP access */
          "https://mail.google.com/ "
 
@@ -313,7 +309,6 @@ build_object (GoaProvider         *provi
   gboolean calendar_enabled;
   gboolean contacts_enabled;
   gboolean files_enabled;
-  gboolean photos_enabled;
   gboolean printers_enabled;
   const gchar *email_address;
 
@@ -374,10 +369,6 @@ build_object (GoaProvider         *provi
                                        contacts_enabled,
                                        FALSE);
 
-  /* Photos */
-  photos_enabled = g_key_file_get_boolean (key_file, group, "PhotosEnabled", NULL);
-  goa_object_skeleton_attach_photos (object, photos_enabled);
-
   /* Files */
   files_enabled = g_key_file_get_boolean (key_file, group, "FilesEnabled", NULL);
   uri_drive = g_strconcat ("google-drive://", email_address, "/", NULL);
@@ -393,7 +384,6 @@ build_object (GoaProvider         *provi
       goa_account_set_mail_disabled (account, !mail_enabled);
       goa_account_set_calendar_disabled (account, !calendar_enabled);
       goa_account_set_contacts_disabled (account, !contacts_enabled);
-      goa_account_set_photos_disabled (account, !photos_enabled);
       goa_account_set_files_disabled (account, !files_enabled);
       goa_account_set_printers_disabled (account, !printers_enabled);
 
@@ -410,10 +400,6 @@ build_object (GoaProvider         *provi
                         G_CALLBACK (goa_util_account_notify_property_cb),
                         (gpointer) "ContactsEnabled");
       g_signal_connect (account,
-                        "notify::photos-disabled",
-                        G_CALLBACK (goa_util_account_notify_property_cb),
-                        (gpointer) "PhotosEnabled");
-      g_signal_connect (account,
                         "notify::files-disabled",
                         G_CALLBACK (goa_util_account_notify_property_cb),
                         (gpointer) "FilesEnabled");
@@ -440,7 +426,6 @@ add_account_key_values (GoaOAuth2Provide
   g_variant_builder_add (builder, "{ss}", "MailEnabled", "true");
   g_variant_builder_add (builder, "{ss}", "CalendarEnabled", "true");
   g_variant_builder_add (builder, "{ss}", "ContactsEnabled", "true");
-  g_variant_builder_add (builder, "{ss}", "PhotosEnabled", "true");
   g_variant_builder_add (builder, "{ss}", "FilesEnabled", "true");
   g_variant_builder_add (builder, "{ss}", "PrintersEnabled", "true");
 }
