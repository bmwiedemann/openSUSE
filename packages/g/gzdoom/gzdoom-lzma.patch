From: Jan Engelhardt <jengelh@inai.de>
Date: 2018-01-08 13:48:59+0100

Use LZMA system libraries instead of bundled code.

---
 CMakeLists.txt              |    4 ++--
 src/CMakeLists.txt          |    4 ++--
 tools/zipdir/CMakeLists.txt |    4 ++--
 3 files changed, 6 insertions(+), 6 deletions(-)

Index: gzdoom-g4.2.4/CMakeLists.txt
===================================================================
--- gzdoom-g4.2.4.orig/CMakeLists.txt
+++ gzdoom-g4.2.4/CMakeLists.txt
@@ -12,6 +12,7 @@ endif()
 
 list( APPEND CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake )
 include( FindPackageHandleStandardArgs )
+include(FindPkgConfig)
 
 # Support cross compiling
 option( FORCE_CROSSCOMPILE "Turn on cross compiling." NO )
@@ -403,7 +404,7 @@ else()
 	set( GME_LIBRARIES gme )
 endif()
 
-set( LZMA_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/libraries/lzma/C" )
+pkg_check_modules(LZMA REQUIRED clzma)
 set( ADL_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/libraries/adlmidi" )
 set( OPN_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/libraries/opnmidi" )
 set( TIMIDITYPP_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/libraries/timidityplus" )
@@ -433,7 +434,6 @@ option( DYN_OPENAL "Dynamically load Ope
 option( DYN_SNDFILE "Dynamically load libsndfile" ON )
 option( DYN_MPG123 "Dynamically load libmpg123" ON )
 
-add_subdirectory( libraries/lzma )
 add_subdirectory( tools )
 add_subdirectory( libraries/dumb )
 add_subdirectory( libraries/gdtoa )
Index: gzdoom-g4.2.4/src/CMakeLists.txt
===================================================================
--- gzdoom-g4.2.4.orig/src/CMakeLists.txt
+++ gzdoom-g4.2.4/src/CMakeLists.txt
@@ -436,7 +436,7 @@ set( ZDOOM_LIBS ${ZDOOM_LIBS} "${ZLIB_LI
 if (HAVE_VULKAN)
 	set( ZDOOM_LIBS ${ZDOOM_LIBS} "glslang" "SPIRV" "OGLCompiler")
 endif()
-include_directories( "${ZLIB_INCLUDE_DIR}" "${BZIP2_INCLUDE_DIR}" "${LZMA_INCLUDE_DIR}" "${JPEG_INCLUDE_DIR}" "${ZMUSIC_INCLUDE_DIR}" )
+include_directories( "${ZLIB_INCLUDE_DIR}" "${BZIP2_INCLUDE_DIR}" "${LZMA_INCLUDE_DIRS}" "${JPEG_INCLUDE_DIR}" "${ZMUSIC_INCLUDE_DIR}" )
 
 if( ${HAVE_VM_JIT} )
 	add_definitions( -DHAVE_VM_JIT )
@@ -1211,7 +1211,7 @@ if( UNIX )
 	endif()
 endif()
 
-target_link_libraries( zdoom ${ZDOOM_LIBS} gdtoa dumb lzma adl opn timidity timidityplus wildmidi oplsynth zmusic )
+target_link_libraries( zdoom ${ZDOOM_LIBS} gdtoa dumb ${LZMA_LIBRARIES} adl opn timidity timidityplus wildmidi oplsynth zmusic )
 
 include_directories( .
 	g_statusbar
Index: gzdoom-g4.2.4/tools/zipdir/CMakeLists.txt
===================================================================
--- gzdoom-g4.2.4.orig/tools/zipdir/CMakeLists.txt
+++ gzdoom-g4.2.4/tools/zipdir/CMakeLists.txt
@@ -1,9 +1,9 @@
 cmake_minimum_required( VERSION 2.8.7 )
 
 if( NOT CMAKE_CROSSCOMPILING )
-	include_directories( "${ZLIB_INCLUDE_DIR}" "${BZIP2_INCLUDE_DIR}" "${LZMA_INCLUDE_DIR}" )
+	include_directories( "${ZLIB_INCLUDE_DIR}" "${BZIP2_INCLUDE_DIR}" "${LZMA_INCLUDE_DIRS}" )
 	add_executable( zipdir
 		zipdir.c )
-	target_link_libraries( zipdir ${ZLIB_LIBRARIES} ${BZIP2_LIBRARIES} lzma )
+	target_link_libraries( zipdir ${ZLIB_LIBRARIES} ${BZIP2_LIBRARIES} ${LZMA_LDFLAGS})
 	set( CROSS_EXPORTS ${CROSS_EXPORTS} zipdir PARENT_SCOPE )
 endif()
