From f60dd0747ad75c2971cc314111c8fc2b8a38ce19 Mon Sep 17 00:00:00 2001
From: Paul Eggert <eggert@cs.ucla.edu>
Date: Sat, 21 Nov 2020 18:09:29 -0800
Subject: [PATCH] nl_langinfo-tests: work around GCC bug 44511

* tests/test-nl_langinfo-mt.c: Ignore -Wreturn-type, to work
around a GCC bug <https://gcc.gnu.org/bugzilla/show_bug.cgi?id=44511>.
Problem reported for GNU grep by Andreas Schwab
<https://bugs.gnu.org/44535>.

Index: grep-3.6/gnulib-tests/test-nl_langinfo-mt.c
===================================================================
--- grep-3.6.orig/gnulib-tests/test-nl_langinfo-mt.c
+++ grep-3.6/gnulib-tests/test-nl_langinfo-mt.c
@@ -18,6 +18,11 @@
 
 #include <config.h>
 
+/* Work around GCC bug 44511.  */
+#if 4 < __GNUC__ + (3 <= __GNUC_MINOR__)
+# pragma GCC diagnostic ignored "-Wreturn-type"
+#endif
+
 #if USE_ISOC_THREADS || USE_POSIX_THREADS || USE_ISOC_AND_POSIX_THREADS || USE_WINDOWS_THREADS
 
 /* Specification.  */
Index: grep-3.6/gnulib-tests/test-setlocale_null-mt-all.c
===================================================================
--- grep-3.6.orig/gnulib-tests/test-setlocale_null-mt-all.c
+++ grep-3.6/gnulib-tests/test-setlocale_null-mt-all.c
@@ -18,6 +18,11 @@
 
 #include <config.h>
 
+/* Work around GCC bug 44511.  */
+#if 4 < __GNUC__ + (3 <= __GNUC_MINOR__)
+# pragma GCC diagnostic ignored "-Wreturn-type"
+#endif
+
 #if USE_ISOC_THREADS || USE_POSIX_THREADS || USE_ISOC_AND_POSIX_THREADS || USE_WINDOWS_THREADS
 
 /* Specification.  */
Index: grep-3.6/gnulib-tests/test-setlocale_null-mt-one.c
===================================================================
--- grep-3.6.orig/gnulib-tests/test-setlocale_null-mt-one.c
+++ grep-3.6/gnulib-tests/test-setlocale_null-mt-one.c
@@ -18,6 +18,11 @@
 
 #include <config.h>
 
+/* Work around GCC bug 44511.  */
+#if 4 < __GNUC__ + (3 <= __GNUC_MINOR__)
+# pragma GCC diagnostic ignored "-Wreturn-type"
+#endif
+
 #if USE_ISOC_THREADS || USE_POSIX_THREADS || USE_ISOC_AND_POSIX_THREADS || USE_WINDOWS_THREADS
 
 /* Specification.  */
