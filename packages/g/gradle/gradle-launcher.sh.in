#!@BASH@

set -e
ulimit -n $(ulimit -H -n)

# Source system prefs
if [ -f /etc/java/gradle.conf ] ; then
  . /etc/java/gradle.conf
fi

# Source user prefs
if [ -f $HOME/.gradlerc ] ; then
  . $HOME/.gradlerc
fi

. /usr/share/java-utils/java-functions
set_jvm
set_javacmd

set_classpath gradle/gradle-launcher gradle/gradle-core-api gradle/gradle-core gradle/gradle-base-services

# Split up the JVM_OPTS And GRADLE_OPTS values into an array, following the shell quoting and substitution rules
function splitJvmOpts() {
    JVM_OPTS=("$@")
}
eval splitJvmOpts $JAVA_OPTS $GRADLE_OPTS
JVM_OPTS[${#JVM_OPTS[*]}]="-Dorg.gradle.appname=gradle"

JAVA_VER=$($JAVACMD -version 2>&1 | sed -n ';s/.* version "\(.*\)\.\(.*\)\..*".*/\1\2/p;')
GRDL_JAVA_OPTS=
[ "$JAVA_VER" -ge 160 ] && GRDL_JAVA_OPTS+="--add-opens java.base/java.lang=ALL-UNNAMED --add-exports jdk.compiler/com.sun.tools.javac.file=ALL-UNNAMED"

exec "$JAVACMD" ${GRDL_JAVA_OPTS} "${JVM_OPTS[@]}" -classpath "$CLASSPATH" org.gradle.launcher.GradleMain "$@"
