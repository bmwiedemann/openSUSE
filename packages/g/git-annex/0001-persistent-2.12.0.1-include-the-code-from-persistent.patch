From 58b3b46b517358295c7041a92ce135e7c8013eec Mon Sep 17 00:00:00 2001
From: Peter Simons <simons@cryp.to>
Date: Thu, 10 Aug 2023 15:39:56 +0200
Subject: [PATCH] persistent >= 2.12.0.1 includes the code from
 persistent-template

persistent-template has been deprecated.
---
 Database/ContentIdentifier.hs | 2 --
 Database/Export.hs            | 3 ---
 Database/Fsck.hs              | 3 ---
 Database/ImportFeed.hs        | 3 ---
 Database/Keys/SQL.hs          | 3 ---
 git-annex.cabal               | 3 +--
 6 files changed, 1 insertion(+), 16 deletions(-)

Index: git-annex-10.20240927/Database/ContentIdentifier.hs
===================================================================
--- git-annex-10.20240927.orig/Database/ContentIdentifier.hs	2024-09-30 23:15:57.000000000 +0000
+++ git-annex-10.20240927/Database/ContentIdentifier.hs	2024-10-26 13:36:42.452641193 +0000
@@ -12,10 +12,8 @@
 {-# LANGUAGE RankNTypes #-}
 {-# LANGUAGE DataKinds, FlexibleInstances #-}
 {-# LANGUAGE UndecidableInstances #-}
-#if MIN_VERSION_persistent_template(2,8,0)
 {-# LANGUAGE DerivingStrategies #-}
 {-# LANGUAGE StandaloneDeriving #-}
-#endif
 
 module Database.ContentIdentifier (
 	ContentIdentifierHandle,
Index: git-annex-10.20240927/Database/Export.hs
===================================================================
--- git-annex-10.20240927.orig/Database/Export.hs	2024-09-30 23:15:57.000000000 +0000
+++ git-annex-10.20240927/Database/Export.hs	2024-10-26 13:36:42.452641193 +0000
@@ -5,17 +5,14 @@
  - Licensed under the GNU AGPL version 3 or higher.
  -}
 
-{-# LANGUAGE CPP #-}
 {-# LANGUAGE QuasiQuotes, TypeFamilies, TypeOperators, TemplateHaskell #-}
 {-# LANGUAGE OverloadedStrings, GADTs, FlexibleContexts #-}
 {-# LANGUAGE MultiParamTypeClasses, GeneralizedNewtypeDeriving #-}
 {-# LANGUAGE RankNTypes #-}
 {-# LANGUAGE DataKinds, FlexibleInstances #-}
 {-# LANGUAGE UndecidableInstances #-}
-#if MIN_VERSION_persistent_template(2,8,0)
 {-# LANGUAGE DerivingStrategies #-}
 {-# LANGUAGE StandaloneDeriving #-}
-#endif
 
 module Database.Export (
 	ExportHandle,
Index: git-annex-10.20240927/Database/Fsck.hs
===================================================================
--- git-annex-10.20240927.orig/Database/Fsck.hs	2024-09-30 23:15:57.000000000 +0000
+++ git-annex-10.20240927/Database/Fsck.hs	2024-10-26 13:36:42.452641193 +0000
@@ -5,7 +5,6 @@
  - Licensed under the GNU AGPL version 3 or higher.
  -}
 
-{-# LANGUAGE CPP #-}
 {-# LANGUAGE QuasiQuotes, TypeFamilies, TemplateHaskell #-}
 {-# LANGUAGE OverloadedStrings, GADTs, FlexibleContexts #-}
 {-# LANGUAGE MultiParamTypeClasses, GeneralizedNewtypeDeriving #-}
@@ -13,10 +12,8 @@
 {-# LANGUAGE RankNTypes #-}
 {-# LANGUAGE UndecidableInstances #-}
 {-# LANGUAGE TypeOperators #-}
-#if MIN_VERSION_persistent_template(2,8,0)
 {-# LANGUAGE DerivingStrategies #-}
 {-# LANGUAGE StandaloneDeriving #-}
-#endif
 
 module Database.Fsck (
 	FsckHandle,
Index: git-annex-10.20240927/Database/ImportFeed.hs
===================================================================
--- git-annex-10.20240927.orig/Database/ImportFeed.hs	2024-09-30 23:15:57.000000000 +0000
+++ git-annex-10.20240927/Database/ImportFeed.hs	2024-10-26 13:36:42.452641193 +0000
@@ -6,17 +6,14 @@
  - Licensed under the GNU AGPL version 3 or higher.
  -}
 
-{-# LANGUAGE CPP #-}
 {-# LANGUAGE QuasiQuotes, TypeFamilies, TypeOperators, TemplateHaskell #-}
 {-# LANGUAGE OverloadedStrings, GADTs, FlexibleContexts, EmptyDataDecls #-}
 {-# LANGUAGE MultiParamTypeClasses, GeneralizedNewtypeDeriving #-}
 {-# LANGUAGE RankNTypes #-}
 {-# LANGUAGE DataKinds, FlexibleInstances #-}
 {-# LANGUAGE UndecidableInstances #-}
-#if MIN_VERSION_persistent_template(2,8,0)
 {-# LANGUAGE DerivingStrategies #-}
 {-# LANGUAGE StandaloneDeriving #-}
-#endif
 
 module Database.ImportFeed (
 	ImportFeedDbHandle,
Index: git-annex-10.20240927/Database/Keys/SQL.hs
===================================================================
--- git-annex-10.20240927.orig/Database/Keys/SQL.hs	2024-09-30 23:15:57.000000000 +0000
+++ git-annex-10.20240927/Database/Keys/SQL.hs	2024-10-26 13:36:42.453641181 +0000
@@ -5,17 +5,14 @@
  - Licensed under the GNU AGPL version 3 or higher.
  -}
 
-{-# LANGUAGE CPP #-}
 {-# LANGUAGE QuasiQuotes, TypeFamilies, TypeOperators, TemplateHaskell #-}
 {-# LANGUAGE OverloadedStrings, GADTs, FlexibleContexts #-}
 {-# LANGUAGE MultiParamTypeClasses, GeneralizedNewtypeDeriving #-}
 {-# LANGUAGE RankNTypes, ScopedTypeVariables #-}
 {-# LANGUAGE DataKinds, FlexibleInstances #-}
 {-# LANGUAGE UndecidableInstances #-}
-#if MIN_VERSION_persistent_template(2,8,0)
 {-# LANGUAGE DerivingStrategies #-}
 {-# LANGUAGE StandaloneDeriving #-}
-#endif
 
 module Database.Keys.SQL where
 
Index: git-annex-10.20240927/git-annex.cabal
===================================================================
--- git-annex-10.20240927.orig/git-annex.cabal	2024-09-30 23:15:57.000000000 +0000
+++ git-annex-10.20240927/git-annex.cabal	2024-10-26 13:36:42.453641181 +0000
@@ -249,8 +249,7 @@ Executable git-annex
    time (>= 1.5.0),
    old-locale,
    persistent-sqlite (>= 2.8.1),
-   persistent (>= 2.8.1),
-   persistent-template,
+   persistent (>= 2.12.0.2),
    unliftio-core,
    microlens,
    aeson,
Index: git-annex-10.20240927/Database/RepoSize.hs
===================================================================
--- git-annex-10.20240927.orig/Database/RepoSize.hs	2024-09-30 23:15:57.000000000 +0000
+++ git-annex-10.20240927/Database/RepoSize.hs	2024-10-26 13:37:26.311088729 +0000
@@ -5,7 +5,6 @@
  - Licensed under the GNU AGPL version 3 or higher.
  -}
 
-{-# LANGUAGE CPP #-}
 {-# LANGUAGE QuasiQuotes, TypeFamilies, TemplateHaskell #-}
 {-# LANGUAGE OverloadedStrings, GADTs, FlexibleContexts #-}
 {-# LANGUAGE MultiParamTypeClasses, GeneralizedNewtypeDeriving #-}
@@ -13,10 +12,8 @@
 {-# LANGUAGE RankNTypes #-}
 {-# LANGUAGE UndecidableInstances #-}
 {-# LANGUAGE TypeOperators #-}
-#if MIN_VERSION_persistent_template(2,8,0)
 {-# LANGUAGE DerivingStrategies #-}
 {-# LANGUAGE StandaloneDeriving #-}
-#endif
 
 module Database.RepoSize (
 	RepoSizeHandle,
