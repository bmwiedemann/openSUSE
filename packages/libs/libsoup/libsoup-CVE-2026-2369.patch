From b91bbd7d7888c85b17a8b33173caa806dff51681 Mon Sep 17 00:00:00 2001
From: Samuel Dainard <>
Date: Wed, 11 Feb 2026 10:19:04 -0600
Subject: [PATCH] sniffer: Handle potential underflow

Closes #498
---
 libsoup/content-sniffer/soup-content-sniffer.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/libsoup/content-sniffer/soup-content-sniffer.c b/libsoup/content-sniffer/soup-content-sniffer.c
index 26757a6a..16961cca 100644
--- a/libsoup/content-sniffer/soup-content-sniffer.c
+++ b/libsoup/content-sniffer/soup-content-sniffer.c
@@ -524,6 +524,10 @@ sniff_unknown (SoupContentSniffer *sniffer, GBytes *buffer,
 		if (!sniff_scriptable && type_row->scriptable)
 			continue;
 
+		/* Ensure we have data to sniff - prevents underflow in resource_length - 1 */
+		if (resource_length == 0)
+			continue;
+
 		if (type_row->has_ws) {
 			guint index_stream = 0;
 			guint index_pattern = 0;
-- 
2.53.0

