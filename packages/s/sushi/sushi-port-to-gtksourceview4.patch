From bafeb19233325a7fc7c2e82b488abfb7a7556f61 Mon Sep 17 00:00:00 2001
From: Martin Blanchard <tchaik@gmx.com>
Date: Sun, 19 May 2019 22:31:37 +0200
Subject: [PATCH] Port to GtkSourceView 4

GtkSourceView 3 isn't maintained any more.

https://gitlab.gnome.org/GNOME/sushi/issues/6
---
 flatpak/org.gnome.NautilusPreviewer.json | 4 ++--
 meson.build                              | 2 +-
 src/js/viewers/text.js                   | 2 +-
 src/libsushi/meson.build                 | 2 +-
 4 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/flatpak/org.gnome.NautilusPreviewer.json b/flatpak/org.gnome.NautilusPreviewer.json
index 4565b82..9a60827 100644
--- a/flatpak/org.gnome.NautilusPreviewer.json
+++ b/flatpak/org.gnome.NautilusPreviewer.json
@@ -102,8 +102,8 @@
             "sources": [
                 {
                     "type": "archive",
-                    "url": "http://download.gnome.org/sources/gtksourceview/3.24/gtksourceview-3.24.8.tar.xz",
-                    "sha256": "1e9bb8ff190db705deb916dd23ff681f0e8803aec407bf0fd64c7e615ac436fe"
+                    "url": "https://download.gnome.org/sources/gtksourceview/4.2/gtksourceview-4.2.0.tar.xz",
+                    "sha256": "c431eb234dc83c7819e58f77dd2af973252c7750da1c9d125ddc94268f94f675"
                 }
             ]
         },
diff --git a/meson.build b/meson.build
index 56398d9..538dc4b 100644
--- a/meson.build
+++ b/meson.build
@@ -19,7 +19,7 @@ gstreamer_base_dep = dependency('gstreamer-base-1.0')
 gstreamer_pbutils_dep = dependency('gstreamer-pbutils-1.0')
 gstreamer_tag_dep = dependency('gstreamer-tag-1.0')
 gtk_dep = dependency('gtk+-3.0', version: '>=3.13.2')
-gtksourceview_dep = dependency('gtksourceview-3.0')
+gtksourceview_dep = dependency('gtksourceview-4', version: '>=4.0.3')
 harfbuzz_dep = dependency('harfbuzz', version: '>=0.9.9')
 introspection_dep = dependency('gobject-introspection-1.0', version: '>=1.0.1')
 musicbrainz_dep = dependency('libmusicbrainz5')
diff --git a/src/js/viewers/text.js b/src/js/viewers/text.js
index 9566adb..a044fbe 100644
--- a/src/js/viewers/text.js
+++ b/src/js/viewers/text.js
@@ -23,7 +23,7 @@
  *
  */
 
-imports.gi.versions.GtkSource = '3.0';
+imports.gi.versions.GtkSource = '4';
 
 const Gdk = imports.gi.Gdk;
 const GtkClutter = imports.gi.GtkClutter;
diff --git a/src/libsushi/meson.build b/src/libsushi/meson.build
index c8ff6fa..66ef646 100644
--- a/src/libsushi/meson.build
+++ b/src/libsushi/meson.build
@@ -62,7 +62,7 @@ gnome.generate_gir(
     'GstTag-1.0',
     'GdkPixbuf-2.0',
     'Gtk-3.0',
-    'GtkSource-3.0',
+    'GtkSource-4',
     'EvinceDocument-3.0',
   ],
   install: true,
-- 
2.21.0

