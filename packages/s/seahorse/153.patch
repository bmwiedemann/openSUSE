From a635e5df77ced15dbc7ac3b7b461108133cdb4d7 Mon Sep 17 00:00:00 2001
From: Niels De Graef <nielsdegraef@gmail.com>
Date: Sat, 20 Feb 2021 09:06:44 +0100
Subject: [PATCH] key-manager: Make sure to update after unlocking

When we unlock a keyring, the main list view gets updated due to a
signal that gets triggered when the number of elements in a collection
changes. In the case of an empty keying however, we won't get this
signal as the number of elements will remain zero. We can fix this by
explicitly triggering an update.

Fixes https://gitlab.gnome.org/GNOME/seahorse/-/issues/315
---
 src/key-manager.vala | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/key-manager.vala b/src/key-manager.vala
index ed5e4ca0..559188f1 100644
--- a/src/key-manager.vala
+++ b/src/key-manager.vala
@@ -492,6 +492,8 @@ public class Seahorse.KeyManager : Catalog {
             try {
                 unlock_button.sensitive = true;
                 place.unlock.end(res);
+                // Explicitly trigger an update of the main view
+                check_empty_state();
             } catch (GLib.Error e) {
                 unlock_button.sensitive = true;
                 Util.show_error(this, _("Couldnâ€™t unlock keyring"), e.message);
-- 
GitLab

