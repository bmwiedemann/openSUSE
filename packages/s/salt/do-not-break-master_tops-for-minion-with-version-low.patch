From a4412799453bf967aa14b93660bfc70f94e11a85 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Pablo=20Su=C3=A1rez=20Hern=C3=A1ndez?=
 <psuarezhernandez@suse.com>
Date: Thu, 30 Sep 2021 11:06:09 +0100
Subject: [PATCH] Do not break master_tops for minion with version lower
 to 3003

---
 salt/master.py | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/salt/master.py b/salt/master.py
index 1bfd278b31..2c5739cc90 100644
--- a/salt/master.py
+++ b/salt/master.py
@@ -1234,6 +1234,7 @@ class AESFuncs(TransportMethods):
         "_dir_list",
         "_symlink_list",
         "_file_envs",
+        "_ext_nodes",
     )
 
     def __init__(self, opts):
@@ -1433,6 +1434,9 @@ class AESFuncs(TransportMethods):
             return {}
         return self.masterapi._master_tops(load, skip_verify=True)
 
+    # Needed so older minions can request master_tops
+    _ext_nodes = _master_tops
+
     def _master_opts(self, load):
         """
         Return the master options to the minion
-- 
2.33.0


