From 1bbd34e500980b9ea2514776bb2dbd745247e651 Mon Sep 17 00:00:00 2001
From: Benjamin Block <bblock@linux.ibm.com>
Date: Fri, 12 Nov 2021 13:34:22 +0100
Subject: [PATCH] chreipl-fcp-mpath: don't compress the manpage before
 installing it
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Remove the call to `gzip` before installing the manpage during the
`make install` call. What and if compression is done should be handled by
the distribution tooling.

This also removes a dependency for the build process.

Reviewed-by: Steffen Maier <maier@linux.ibm.com>
Signed-off-by: Benjamin Block <bblock@linux.ibm.com>
Signed-off-by: Jan HÃ¶ppner <hoeppner@linux.ibm.com>
---
 CHANGELOG.md                 |  1 +
 README.md                    |  2 +-
 chreipl-fcp-mpath/.gitignore |  1 -
 chreipl-fcp-mpath/Makefile   | 11 +----------
 chreipl-fcp-mpath/README.md  |  5 ++---
 5 files changed, 5 insertions(+), 15 deletions(-)

diff --git a/CHANGELOG.md b/CHANGELOG.md
index 94817e1..8cac1cb 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -12,6 +12,7 @@
   - dbginfo.sh: Add retry timeout and remove possible blocking "blockdev --report"
   - dbginfo.sh: Collect config- and debug-data for chreipl-fcp-mpath
   - hsci: Add support for multiple MAC addresses
+  - chreipl-fcp-mpath: don't compress the manpage before installing it
 
   Bug Fixes:
   - lshwc: Fix compile error for gcc <8.1
diff --git a/README.md b/README.md
index eb5c81f..62e4c11 100644
--- a/README.md
+++ b/README.md
@@ -479,4 +479,4 @@ the different tools are provided:
   util-linux, udev, and multipath-tools. When using `HAVE_DRACUT=1` with the
   make invocation, it also requires dracut. When using `ENABLE_DOC=1` with the
   make invocation to build a man page and render the README.md as HTML, make
-  further requires pandoc, GNU awk, and GNU Gzip for the build process.
+  further requires pandoc and GNU awk for the build process.
diff --git a/chreipl-fcp-mpath/.gitignore b/chreipl-fcp-mpath/.gitignore
index 4611195..ecd49ee 100644
--- a/chreipl-fcp-mpath/.gitignore
+++ b/chreipl-fcp-mpath/.gitignore
@@ -10,4 +10,3 @@
 /README.pdf
 /chreipl-fcp-mpath.md
 /chreipl-fcp-mpath.7
-/chreipl-fcp-mpath.7.gz
diff --git a/chreipl-fcp-mpath/Makefile b/chreipl-fcp-mpath/Makefile
index 80cab7f..9b4aae0 100644
--- a/chreipl-fcp-mpath/Makefile
+++ b/chreipl-fcp-mpath/Makefile
@@ -12,8 +12,6 @@
 #   bash:
 #     - bash
 # If $(ENABLE_DOC) is `1`:
-#   GNU Gzip:
-#     - gzip
 #   GNU awk:
 #     - gawk
 
@@ -186,18 +184,11 @@ INSTDIRS += $(MANDIR)
 .PHONY: chreipl-fcp-mpath-install-man-page
 chreipl-fcp-mpath-install-man-page: | $(DESTDIR)$(MANDIR)/man7
 chreipl-fcp-mpath-install-man-page: chreipl-fcp-mpath.7
-	$(GZIP) -fk --best chreipl-fcp-mpath.7
 	$(INSTALL_DATA) -t $(DESTDIR)$(MANDIR)/man7			\
-		chreipl-fcp-mpath.7.gz
+		chreipl-fcp-mpath.7
 
 chreipl-fcp-mpath-install: chreipl-fcp-mpath-install-man-page
 
-.PHONY: chreipl-fcp-mpath-install-man-page-clean
-chreipl-fcp-mpath-install-man-page-clean:
-	rm -f chreipl-fcp-mpath.7.gz
-
-chreipl-fcp-mpath-clean: chreipl-fcp-mpath-install-man-page-clean
-
 endif
 
 #
diff --git a/chreipl-fcp-mpath/README.md b/chreipl-fcp-mpath/README.md
index 3943f73..d58ccd2 100644
--- a/chreipl-fcp-mpath/README.md
+++ b/chreipl-fcp-mpath/README.md
@@ -131,8 +131,7 @@ To build and install the documentation (man page) you need:
 
   - pandoc;
   - GNU Core Utilities (date);
-  - GNU awk;
-  - GNU Gzip.
+  - GNU awk.
 
 INSTALLATION
 ============
@@ -207,7 +206,7 @@ files to these default locations:
     /usr/lib/udev/chreipl-fcp-mpath-record-volume-identifier
     /usr/lib/udev/chreipl-fcp-mpath-try-change-ipl-path
     /usr/lib/udev/rules.d/70-chreipl-fcp-mpath.rules
-    /usr/share/man/man7/chreipl-fcp-mpath.7.gz
+    /usr/share/man/man7/chreipl-fcp-mpath.7
 
 UNINSTALL
 =========
-- 
2.26.2

