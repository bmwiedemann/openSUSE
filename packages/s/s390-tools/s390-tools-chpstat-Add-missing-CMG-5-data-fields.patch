From 02554fa6d8b61bcd8a3dbe5f18d6e620fb676baf Mon Sep 17 00:00:00 2001
From: Peter Oberparleiter <oberpar@linux.ibm.com>
Date: Fri, 23 May 2025 16:13:38 +0200
Subject: [PATCH] chpstat: Add missing CMG 5 data fields
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

DPU-related data fields dpu_num_cores, dpu_channel_exec_time_cpc, and
dpu_exec_time_cpc are missing from machine-readable output for CMG 5
channel-paths.

Fix this by adding them to the corresponding output routines.

Reviewed-by: Vineeth Vijayan <vneethv@linux.ibm.com>
Signed-off-by: Peter Oberparleiter <oberpar@linux.ibm.com>
Signed-off-by: Jan HÃ¶ppner <hoeppner@linux.ibm.com>
---
 zconf/chp/chpstat/cmg5.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/zconf/chp/chpstat/cmg5.c b/zconf/chp/chpstat/cmg5.c
index fc451b4f..804e938c 100644
--- a/zconf/chp/chpstat/cmg5.c
+++ b/zconf/chp/chpstat/cmg5.c
@@ -127,6 +127,7 @@ static void pr_chars(struct cmg_pair_t **a, unsigned int *n,
 	pr_u32(a, n, cmcb, max_channel_work_units);
 	pr_u32(a, n, cmcb, max_write_data_units);
 	pr_u32(a, n, cmcb, max_read_data_units);
+	pr_u32(a, n, cmcb, dpu_num_cores);
 	pr_u32(a, n, cmcb, data_unit_size);
 }
 
@@ -151,6 +152,8 @@ static void pr_ext_cue(struct cmg_pair_t **a, unsigned int *n,
 	struct ext_cue5_t *ext_cue = get_ext_cue(data, util_b);
 	bool v = data->util_b.extended;
 
+	pr_cond_u32(a, n, v, ext_cue, dpu_channel_exec_time_cpc);
+	pr_cond_u32(a, n, v, ext_cue, dpu_exec_time_cpc);
 	pr_cond_u32(a, n, v, ext_cue, total_ficon_ops_cpc);
 	pr_cond_u32(a, n, v, ext_cue, total_deferred_ficon_ops_cpc);
 	pr_cond_u64(a, n, v, ext_cue, sum_ficon_ops_cpc);
