Subject: zkey: Create key repository and group during make install
From: Philipp Rudo <prudo@linux.ibm.com>

Summary:     zkey: Add support of protected key crypto for dm-crypt.
Description: Support the usage of protected key crypto for dm-crypt disks in
             plain format by providing a tool to manage a key repository
             allowing to associate secure keys with disk partitions or logical
             volumes.
Upstream-ID: 6a2f4fd3760420e11b23db13f8b736f87764d409
Problem-ID:  SEC1800

Upstream-Description:

             zkey: Create key repository and group during make install

             Create the default keystore directory '/etc/zkey/repository'
             and the user group 'zkeyadm' during make install.

             Signed-off-by: Ingo Franzki <ifranzki@linux.ibm.com>
             Reviewed-by: Hendrik Brueckner <brueckner@linux.ibm.com>
             Signed-off-by: Jan HÃ¶ppner <hoeppner@linux.ibm.com>


Signed-off-by: Philipp Rudo <prudo@linux.ibm.com>
---
 zkey/Makefile |    3 +++
 1 file changed, 3 insertions(+)

--- a/zkey/Makefile
+++ b/zkey/Makefile
@@ -36,6 +36,9 @@ install: all
 	$(INSTALL) -g $(GROUP) -o $(OWNER) -m 755 zkey $(DESTDIR)$(USRBINDIR)
 	$(INSTALL) -d -m 755 $(DESTDIR)$(MANDIR)/man1
 	$(INSTALL) -m 644 -c zkey.1 $(DESTDIR)$(MANDIR)/man1
+	getent group zkeyadm >/dev/null || groupadd -r zkeyadm
+	$(INSTALL) -d -g zkeyadm -m 770 $(DESTDIR)$(SYSCONFDIR)/zkey
+	$(INSTALL) -d -g zkeyadm -m 770 $(DESTDIR)$(SYSCONFDIR)/zkey/repository
 
 endif
 
