Subject: [PATCH] [FEAT VS1804] zipl/libc: printf: print on linemode and ASCII console
From: Marc Hartmayer <mhartmay@linux.ibm.com>

Summary:     genprotimg: Introduce new tool for the creation of PV images
Description: genprotimg takes a kernel, host-key documents, optionally an
             initrd, optionally a file with the kernel command line, and it
             generates a single, loadable image file. The image consists of a
             concatenation of a plain text boot loader, the encrypted
             components for kernel, initrd, and cmdline, and the
             integrity-protected PV header, containing metadata necessary for
             running the guest in PV mode. It's possible to use this image file
             as a kernel for zIPL or for a direct kernel boot using QEMU.
Upstream-ID: e51663bbca8770c1f7986dac47a59193dbf96010
Problem-ID:  VS1804

Upstream-Description:

             zipl/libc: printf: print on linemode and ASCII console

             ... if the `ENABLE_SCLP_ASCII` macro is defined.

             Reviewed-by: Philipp Rudo <prudo@linux.ibm.com>
             Reviewed-by: Stefan Haberland <sth@linux.ibm.com>
             Signed-off-by: Marc Hartmayer <mhartmay@linux.ibm.com>
             Signed-off-by: Jan HÃ¶ppner <hoeppner@linux.ibm.com>


Signed-off-by: Marc Hartmayer <mhartmay@linux.ibm.com>
---
 zipl/boot/libc.c |    5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

--- a/zipl/boot/libc.c
+++ b/zipl/boot/libc.c
@@ -406,8 +406,11 @@ void printf(const char *fmt, ...)
 		buf[LINE_LENGTH - 2] = '.';
 		buf[LINE_LENGTH - 3] = '.';
 	}
-	sclp_print(buf);
 	va_end(va);
+	sclp_print(buf);
+#ifdef ENABLE_SCLP_ASCII
+	sclp_print_ascii(buf);
+#endif /* ENABLE_SCLP_ASCII */
 }
 
 /*
