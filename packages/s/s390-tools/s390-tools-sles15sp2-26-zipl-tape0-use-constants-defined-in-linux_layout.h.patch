Subject: [PATCH] [FEAT VS1804] zipl: tape0: use constants defined in linux_layout.h
From: Marc Hartmayer <mhartmay@linux.ibm.com>

Summary:     genprotimg: Introduce new tool for the creation of PV images
Description: genprotimg takes a kernel, host-key documents, optionally an
             initrd, optionally a file with the kernel command line, and it
             generates a single, loadable image file. The image consists of a
             concatenation of a plain text boot loader, the encrypted
             components for kernel, initrd, and cmdline, and the
             integrity-protected PV header, containing metadata necessary for
             running the guest in PV mode. It's possible to use this image file
             as a kernel for zIPL or for a direct kernel boot using QEMU.
Upstream-ID: c871050097ecb2ec83cf3018ea36e01cd22cbe7d
Problem-ID:  VS1804

Upstream-Description:

             zipl: tape0: use constants defined in linux_layout.h

             Use the constants defined in `linux_layout.h`. Therefore move the
             `PARMAREA` address offset to `linux_layout.h` and include the header.

             Reviewed-by: Philipp Rudo <prudo@linux.ibm.com>
             Reviewed-by: Stefan Haberland <sth@linux.ibm.com>
             Signed-off-by: Marc Hartmayer <mhartmay@linux.ibm.com>
             Signed-off-by: Jan HÃ¶ppner <hoeppner@linux.ibm.com>


Signed-off-by: Marc Hartmayer <mhartmay@linux.ibm.com>
---
 include/boot/linux_layout.h |    1 +
 zipl/boot/tape0.S           |   14 +++-----------
 2 files changed, 4 insertions(+), 11 deletions(-)

--- a/include/boot/linux_layout.h
+++ b/include/boot/linux_layout.h
@@ -17,6 +17,7 @@
 #define IMAGE_ENTRY_KDUMP	_AC(0x10010, UL)
 
 /* Parameter address offsets */
+#define PARMAREA		_AC(0x10400, UL)
 #define IPL_DEVICE		_AC(0x10400, UL)
 #define INITRD_START		_AC(0x10408, UL)
 #define INITRD_SIZE		_AC(0x10410, UL)
--- a/zipl/boot/tape0.S
+++ b/zipl/boot/tape0.S
@@ -8,29 +8,21 @@
 #
 
 #include "boot/sigp.h"
+#include "boot/linux_layout.h"
 
 IPL_BS			= 1024			# block size for tape access
 IPL_OFF			= 0x4000		# temporary kernel load addr
-COMMAND_LINE_SIZE	= 896			# max command line length
-KERNEL_OFF		= 0x10000		# kernel start code offset
+KERNEL_OFF		= IMAGE_ENTRY		# kernel start code offset
 						# relative to image start
 __LC_IO_NEW_PSW         = 0x1f0			# IO New PSW addr
 
 
-# Parameter address offsets
-
-PARMAREA		= 0x10400		# Parameter area offset
-IPL_DEVICE		= 0x10400		# IPL device offset
-INITRD_START		= 0x10408		# ramdisk addr offset
-INITRD_SIZE		= 0x10410		# ramdisk size offset
-COMMAND_LINE		= 0x10480		# command line offset
-
 # Default IPL parameter - will be overwritten by zIPL
 
 RAMDISK_ORIGIN		= 0x800000		# default ramdisk load addr
 RAMDISK_SIZE		= 0x800000		# default ramdisk size
 PARMFILE_ADDR		= 0x1000		# default parmfile load addr
-KERNEL_ADDR		= 0x10000		# default kernel load addr
+KERNEL_ADDR		= IMAGE_ENTRY		# default kernel load addr
 
 
 	.org 0x0
