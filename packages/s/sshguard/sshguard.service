[Unit]
Description=SSHGUARD provides automatic attack blocking
After=network.target

[Service]
# added automatically, for details please see
# https://en.opensuse.org/openSUSE:Security_Features#Systemd_hardening_effort
ProtectSystem=full
ProtectHome=true
PrivateDevices=true
ProtectHostname=true
ProtectClock=true
ProtectKernelTunables=true
ProtectKernelModules=true
ProtectKernelLogs=true
ProtectControlGroups=true
RestrictRealtime=true
# end of automatic additions 
EnvironmentFile=-/etc/sshguard.conf
ExecStartPre=/usr/sbin/iptables -N sshguard
ExecStartPre=/usr/sbin/ip6tables -N sshguard
ExecStart=/usr/sbin/sshguard -a $THRESHOLD -p $BLOCK_TIME -s $DETECTION_TIME -w $WHITELIST_FILE -b $BLACKLIST_FILE
ExecReload=/bin/kill -HUP $MAINPID
ExecStopPost=/usr/sbin/iptables -F sshguard
ExecStopPost=/usr/sbin/ip6tables -F sshguard
ExecStopPost=/usr/sbin/iptables -X sshguard
ExecStopPost=/usr/sbin/ip6tables -X sshguard
KillMode=process
Restart=always

[Install]
WantedBy=multi-user.target
