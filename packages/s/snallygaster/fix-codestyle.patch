From 311a11d7a21eabe0686fd756009685041dce3f75 Mon Sep 17 00:00:00 2001
From: Sebastian Wagner <sebix@sebix.at>
Date: Tue, 6 Apr 2021 21:36:19 +0200
Subject: [PATCH] replace deprecated ssl.wrap_socket with SSLContext

fixes hannob/snallygaster#57
---
 tests/test_scan_testdata.py | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/tests/test_scan_testdata.py b/tests/test_scan_testdata.py
index 195a052..e0fc217 100644
--- a/tests/test_scan_testdata.py
+++ b/tests/test_scan_testdata.py
@@ -35,7 +35,9 @@ def test_scan_testdata(self):
         olddir = os.getcwd()
         os.chdir(tmp + "/testdata")
         httpd = http.server.HTTPServer(('localhost', 4443), http.server.SimpleHTTPRequestHandler)
-        httpd.socket = ssl.wrap_socket(httpd.socket, certfile=tmp + '/testdata/testserver.pem')
+        context = ssl.create_default_context(ssl.Purpose.CLIENT_AUTH)
+        context.load_cert_chain(certfile=tmp + '/testdata/testserver.pem')
+        httpd.socket = context.wrap_socket(httpd.socket, server_side=True)
         t = threading.Thread(target=httpd.serve_forever)
         t.daemon = True
         t.start()
