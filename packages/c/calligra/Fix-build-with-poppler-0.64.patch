From 3760bb3012456261024324e15598d1aefc611665 Mon Sep 17 00:00:00 2001
From: Antonio Rojas <arojas@archlinux.org>
Date: Sat, 27 Oct 2018 00:02:34 +0200
Subject: Fix build with poppler<0.64

Commit a615718222f8ad3bba4b88fad640382e517f7dd9 broke build with poppler<0.64, where getNextChar doesn't accept a const char first argument.

Differential Revision: https://phabricator.kde.org/D16406
---
 filters/karbon/pdf/CMakeLists.txt   | 3 +++
 filters/karbon/pdf/SvgOutputDev.cpp | 4 ++++
 2 files changed, 7 insertions(+)

diff --git a/filters/karbon/pdf/CMakeLists.txt b/filters/karbon/pdf/CMakeLists.txt
index 77c60d8..3521571 100644
--- a/filters/karbon/pdf/CMakeLists.txt
+++ b/filters/karbon/pdf/CMakeLists.txt
@@ -1,3 +1,6 @@
+if(Poppler_VERSION VERSION_LESS "0.64.0")
+    add_definitions("-DHAVE_POPPLER_PRE_0_64")
+endif()
 
 set(pdf2svg_PART_SRCS PdfImportDebug.cpp PdfImport.cpp SvgOutputDev.cpp )
 
diff --git a/filters/karbon/pdf/SvgOutputDev.cpp b/filters/karbon/pdf/SvgOutputDev.cpp
index 7901317..5692824 100644
--- a/filters/karbon/pdf/SvgOutputDev.cpp
+++ b/filters/karbon/pdf/SvgOutputDev.cpp
@@ -402,7 +402,11 @@ void SvgOutputDev::drawString(GfxState * state, GooString * s)
 
     QString str;
 
+#ifdef HAVE_POPPLER_PRE_0_64
+    char * p = s->getCString();
+#else
     const char * p = s->getCString();
+#endif
     int len = s->getLength();
     CharCode code;
     Unicode *u = nullptr;
-- 
cgit v1.1

