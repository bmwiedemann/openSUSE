From 3f6cd624418e2aacd7f2802df188585db78044da Mon Sep 17 00:00:00 2001
From: Paul Wankadia <junyer@chromium.org>
Date: Tue, 30 May 2023 19:53:20 +0000
Subject: [PATCH] Don't pass nullptr to construct re2::StringPiece.

This avoids breakage when re2::StringPiece becomes
an alias for absl::string_view/std::string_view.

Also, remove an unused variable that will start
upsetting the compiler for some reason.

Bug: 1447090
Change-Id: I5d2ffdb261391c0f0f3eaac706eb47a3cf108125
Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/4569968
Commit-Queue: Nico Weber <thakis@chromium.org>
Auto-Submit: Paul Wankadia <junyer@chromium.org>
Reviewed-by: Nico Weber <thakis@chromium.org>
Owners-Override: Nico Weber <thakis@chromium.org>
Cr-Commit-Position: refs/heads/main@{#1150783}
---
 .../browser_switcher/alternative_browser_driver_posix.cc       | 2 +-
 components/feedback/redaction_tool/redaction_tool.cc           | 2 +-
 extensions/browser/api/web_request/form_data_parser.cc         | 3 +--
 3 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/chrome/browser/browser_switcher/alternative_browser_driver_posix.cc b/chrome/browser/browser_switcher/alternative_browser_driver_posix.cc
index b2f7cd8ed0788f..272b933bab9625 100644
--- a/chrome/browser/browser_switcher/alternative_browser_driver_posix.cc
+++ b/chrome/browser/browser_switcher/alternative_browser_driver_posix.cc
@@ -89,7 +89,7 @@ void ExpandEnvironmentVariables(std::string* arg) {
   static re2::LazyRE2 re = {
       "\\$\\{([a-zA-Z_][a-zA-Z_0-9]*)\\}|\\$([a-zA-Z_][a-zA-Z_0-9]*)"};
   std::string out;
-  re2::StringPiece submatch[3] = {nullptr};
+  re2::StringPiece submatch[3] = {};
   size_t start = 0;
   bool matched = false;
   while (re->Match(*arg, start, arg->size(), re2::RE2::Anchor::UNANCHORED,
diff --git a/components/feedback/redaction_tool/redaction_tool.cc b/components/feedback/redaction_tool/redaction_tool.cc
index 876e8da509aa74..c81806e0fb029f 100644
--- a/components/feedback/redaction_tool/redaction_tool.cc
+++ b/components/feedback/redaction_tool/redaction_tool.cc
@@ -1081,7 +1081,7 @@ std::string RedactionTool::RedactCustomPatternWithContext(
   // Keep consuming, building up a result string as we go.
   re2::StringPiece text(input);
   re2::StringPiece skipped;
-  re2::StringPiece pre_match, pre_matched_id, matched_id, post_matched_id;
+  re2::StringPiece pre_matched_id, matched_id, post_matched_id;
   while (FindAndConsumeAndGetSkipped(&text, *re, &skipped, &pre_matched_id,
                                      &matched_id, &post_matched_id)) {
     std::string matched_id_as_string(matched_id);
diff --git a/extensions/browser/api/web_request/form_data_parser.cc b/extensions/browser/api/web_request/form_data_parser.cc
index 6d516e86c9f1ed..cf73709add6d68 100644
--- a/extensions/browser/api/web_request/form_data_parser.cc
+++ b/extensions/browser/api/web_request/form_data_parser.cc
@@ -372,8 +372,7 @@ std::unique_ptr<FormDataParser> FormDataParser::CreateFromContentTypeHeader(
 FormDataParser::FormDataParser() = default;
 
 FormDataParserUrlEncoded::FormDataParserUrlEncoded()
-    : source_(nullptr),
-      source_set_(false),
+    : source_set_(false),
       source_malformed_(false),
       arg_name_(&name_),
       arg_value_(&value_),
