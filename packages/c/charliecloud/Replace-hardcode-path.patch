From: Ana Guerrero Lopez <aguerrero@suse.com>
Date: Fri 21 Aug 2020 18:45:33 CEST
Subject: [PATCH] Replace hardcoded ../lib/charliecloud

All the resulting binaries and script will try to look for extra
scripts in /usr/lib/charliecloud while it should be /usr/lib64/charliecloud

diff -Nrua charliecloud-0.19/bin/ch-build charliecloud-0.19/bin/ch-build
--- charliecloud-0.19/bin/ch-build
+++ charliecloud-0.19/bin/ch-build
@@ -1,6 +1,6 @@
 #!/bin/sh
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 # shellcheck disable=SC2034
diff -Nrua charliecloud-0.19/bin/ch-build2dir charliecloud-0.19/bin/ch-build2dir
--- charliecloud-0.19/bin/ch-build2dir
+++ charliecloud-0.19/bin/ch-build2dir
@@ -1,6 +1,6 @@
 #!/bin/bash
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 # shellcheck disable=SC2034
diff -Nrua charliecloud-0.19/bin/ch-builder2squash charliecloud-0.19/bin/ch-builder2squash
--- charliecloud-0.19/bin/ch-builder2squash
+++ charliecloud-0.19/bin/ch-builder2squash
@@ -1,6 +1,6 @@
 #!/bin/sh
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 # shellcheck disable=SC2034
diff -Nrua charliecloud-0.19/bin/ch-builder2tar charliecloud-0.19/bin/ch-builder2tar
--- charliecloud-0.19/bin/ch-builder2tar
+++ charliecloud-0.19/bin/ch-builder2tar
@@ -1,6 +1,6 @@
 #!/bin/sh
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 # shellcheck disable=SC2034
diff -Nrua charliecloud-0.19/bin/ch-dir2squash charliecloud-0.19/bin/ch-dir2squash
--- charliecloud-0.19/bin/ch-dir2squash
+++ charliecloud-0.19/bin/ch-dir2squash
@@ -2,7 +2,7 @@
 
 set -e
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 # shellcheck disable=SC2034
diff -Nrua charliecloud-0.19/bin/ch-fromhost charliecloud-0.19/bin/ch-fromhost
--- charliecloud-0.19/bin/ch-fromhost
+++ charliecloud-0.19/bin/ch-fromhost
@@ -35,7 +35,7 @@
 #   3. Here string, e.g. 'while IFS= read -r FILE; do ... done <<< "$FILES"'.
 #      This is a bashism.
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 set -e
diff -Nrua charliecloud-0.19/bin/ch-grow.py.in charliecloud-0.19/bin/ch-grow.py.in
--- charliecloud-0.19/bin/ch-grow.py.in
+++ charliecloud-0.19/bin/ch-grow.py.in
@@ -6,7 +6,7 @@
 import sys
 
 sys.path.insert(0, (  os.path.dirname(os.path.abspath(__file__))
-                    + "/../lib/charliecloud"))
+                    + "/../lib64/charliecloud"))
 import charliecloud as ch
 import build
 import misc
diff -Nrua charliecloud-0.19/bin/ch-mount charliecloud-0.19/bin/ch-mount
--- charliecloud-0.19/bin/ch-mount
+++ charliecloud-0.19/bin/ch-mount
@@ -1,6 +1,6 @@
 #!/bin/sh
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 # shellcheck disable=SC2034
diff -Nrua charliecloud-0.19/bin/ch-pull2dir charliecloud-0.19/bin/ch-pull2dir
--- charliecloud-0.19/bin/ch-pull2dir
+++ charliecloud-0.19/bin/ch-pull2dir
@@ -1,6 +1,6 @@
 #!/bin/sh
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 set -e
diff -Nrua charliecloud-0.19/bin/ch-pull2tar charliecloud-0.19/bin/ch-pull2tar
--- charliecloud-0.19/bin/ch-pull2tar
+++ charliecloud-0.19/bin/ch-pull2tar
@@ -1,6 +1,6 @@
 #!/bin/sh
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 set -e
diff -Nrua charliecloud-0.19/bin/ch-run-oci.py.in charliecloud-0.19/bin/ch-run-oci.py.in
--- charliecloud-0.19/bin/ch-run-oci.py.in
+++ charliecloud-0.19/bin/ch-run-oci.py.in
@@ -13,7 +13,7 @@
 import types
 
 sys.path.insert(0, (  os.path.dirname(os.path.abspath(__file__))
-                    + "/../lib/charliecloud"))
+                    + "/../lib64/charliecloud"))
 import charliecloud as ch
 import misc
 
diff -Nrua charliecloud-0.19/bin/ch-tar2dir charliecloud-0.19/bin/ch-tar2dir
--- charliecloud-0.19/bin/ch-tar2dir
+++ charliecloud-0.19/bin/ch-tar2dir
@@ -2,7 +2,7 @@
 
 set -e
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 # shellcheck disable=SC2034
diff -Nrua charliecloud-0.19/bin/ch-test charliecloud-0.19/bin/ch-test
--- charliecloud-0.19/bin/ch-test
+++ charliecloud-0.19/bin/ch-test
@@ -20,7 +20,7 @@
 
 ### Setup
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 if [[ ! -f ${lib}/base.sh ]]; then
     fatal "install or build problem: not found: ${lib}/base.sh"
 fi
diff -Nrua charliecloud-0.19/bin/ch-umount charliecloud-0.19/bin/ch-umount
--- charliecloud-0.19/bin/ch-umount
+++ charliecloud-0.19/bin/ch-umount
@@ -1,6 +1,6 @@
 #!/bin/sh
 
-lib=$(cd "$(dirname "$0")" && pwd)/../lib/charliecloud
+lib=/usr/lib64/charliecloud
 . "${lib}/base.sh"
 
 # shellcheck disable=SC2034
diff -Nrua charliecloud-0.19/lib/base.sh charliecloud-0.19/lib/base.sh
--- charliecloud-0.19/lib/base.sh
+++ charliecloud-0.19/lib/base.sh
@@ -6,7 +6,7 @@
 # shellcheck disable=SC2034
 ch_base=${ch_bin%/*}
 
-lib="${ch_bin}/../lib/charliecloud"
+lib="/usr/lib64/charliecloud"
 . "${lib}/version.sh"
 
