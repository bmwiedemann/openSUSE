From 9a4523d47efeafd674d419169fe161e5a3b31cb3 Mon Sep 17 00:00:00 2001
From: Jan Beich <jbeich@FreeBSD.org>
Date: Thu, 3 Jun 2021 17:53:11 +0000
Subject: [PATCH 1/3] view: chase swaywm/wlroots@9e58301df7f0

view.c:238:52: error: no member named 'subsurfaces' in 'struct wlr_surface'
        wl_list_for_each (subsurface, &view->wlr_surface->subsurfaces, parent_link) {
                                       ~~~~~~~~~~~~~~~~~  ^
/usr/include/wayland-util.h:443:30: note: expanded from macro 'wl_list_for_each'
        for (pos = wl_container_of((head)->next, pos, member);  \
                                    ^~~~
/usr/include/wayland-util.h:409:32: note: expanded from macro 'wl_container_of'
        (__typeof__(sample))((char *)(ptr) -                            \
                                      ^~~

Based on https://github.com/swaywm/sway/commit/3162766eef14
---
 view.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/view.c b/view.c
index b9ba9c2..3f3b0ed 100644
--- a/view.c
+++ b/view.c
@@ -235,7 +235,10 @@ view_map(struct cg_view *view, struct wlr_surface *surface)
 	view->wlr_surface = surface;
 
 	struct wlr_subsurface *subsurface;
-	wl_list_for_each (subsurface, &view->wlr_surface->subsurfaces, parent_link) {
+	wl_list_for_each (subsurface, &view->wlr_surface->subsurfaces_below, parent_link) {
+		subsurface_create(view, subsurface);
+	}
+	wl_list_for_each (subsurface, &view->wlr_surface->subsurfaces_above, parent_link) {
 		subsurface_create(view, subsurface);
 	}
 

From 7b081cfeee4c351f2e77bf3ca503ff484ed04e2e Mon Sep 17 00:00:00 2001
From: Jan Beich <jbeich@FreeBSD.org>
Date: Wed, 23 Jun 2021 16:44:03 +0000
Subject: [PATCH 2/3] meson: require wlroots 0.14.0 after 9a4523d47efe

view.c:238:52: error: no member named 'subsurfaces_below' in 'struct wlr_surface'
        wl_list_for_each (subsurface, &view->wlr_surface->subsurfaces_below, parent_link) {
                                       ~~~~~~~~~~~~~~~~~  ^
/usr/include/wayland-util.h:443:30: note: expanded from macro 'wl_list_for_each'
        for (pos = wl_container_of((head)->next, pos, member);  \
                                    ^~~~
/usr/include/wayland-util.h:409:32: note: expanded from macro 'wl_container_of'
        (__typeof__(sample))((char *)(ptr) -                            \
                                      ^~~
---
 meson.build | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/meson.build b/meson.build
index a268f1a..5b0f9a6 100644
--- a/meson.build
+++ b/meson.build
@@ -34,7 +34,7 @@ if is_freebsd
   )
 endif
 
-wlroots        = dependency('wlroots', version: '>= 0.13.0')
+wlroots        = dependency('wlroots', version: '>= 0.14.0')
 wayland_protos = dependency('wayland-protocols', version: '>=1.14')
 wayland_server = dependency('wayland-server')
 pixman         = dependency('pixman-1')

From 14b8f13297e97850bebe299c10b5c1f8c5fc883a Mon Sep 17 00:00:00 2001
From: Jan Beich <jbeich@FreeBSD.org>
Date: Wed, 23 Jun 2021 16:45:11 +0000
Subject: [PATCH 3/3] CI: bump wlroots version to 0.14.0

---
 .builds/alpine.yml    | 2 +-
 .builds/archlinux.yml | 2 +-
 .builds/freebsd.yml   | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/.builds/alpine.yml b/.builds/alpine.yml
index 044966e..ef32a95 100644
--- a/.builds/alpine.yml
+++ b/.builds/alpine.yml
@@ -19,7 +19,7 @@ tasks:
   # version, instead of master, to avoid any breaking changes in wlroots.
   - wlroots: |
       cd wlroots
-      git checkout 0.13.0
+      git checkout 0.14.0
       meson --prefix=/usr build -Dexamples=false
       ninja -C build
       sudo ninja -C build install
diff --git a/.builds/archlinux.yml b/.builds/archlinux.yml
index 0a64c48..99cdd24 100644
--- a/.builds/archlinux.yml
+++ b/.builds/archlinux.yml
@@ -18,7 +18,7 @@ tasks:
   # version, instead of master, to avoid any breaking changes in wlroots.
   - wlroots: |
       cd wlroots
-      git checkout 0.13.0
+      git checkout 0.14.0
       meson --prefix=/usr build -Dexamples=false
       ninja -C build
       sudo ninja -C build install
diff --git a/.builds/freebsd.yml b/.builds/freebsd.yml
index af4ee34..92a2119 100644
--- a/.builds/freebsd.yml
+++ b/.builds/freebsd.yml
@@ -21,7 +21,7 @@ tasks:
   # version, instead of master, to avoid any breaking changes in wlroots.
   - wlroots: |
       cd wlroots
-      git checkout 0.13.0
+      git checkout 0.14.0
       meson --prefix=/usr/local build -Dexamples=false
       ninja -C build
       sudo ninja -C build install
