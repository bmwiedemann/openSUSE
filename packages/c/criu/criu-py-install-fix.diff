---
 lib/Makefile          |    7 ++++++-
 scripts/crit-setup.py |   25 +++++++++++++++++++++++++
 2 files changed, 31 insertions(+), 1 deletion(-)

--- a/lib/Makefile
+++ b/lib/Makefile
@@ -2,6 +2,10 @@ CRIU_SO			:= libcriu.so
 CRIU_A			:= libcriu.a
 UAPI_HEADERS		:= lib/c/criu.h images/rpc.proto images/rpc.pb-c.h criu/include/version.h
 
+#
+# File to keep track of files installed by setup.py
+CRIT_SETUP_FILES       := lib/.crit-setup.files
+
 all-y	+= lib-c lib-a lib-py
 
 #
@@ -56,7 +60,8 @@ install: lib-c lib-a lib-py crit/crit li
 	$(Q) install -m 644 lib/c/criu.pc $(DESTDIR)$(LIBDIR)/pkgconfig
 ifeq ($(PYTHON),python3)
 	$(E) "  INSTALL " crit
-	$(Q) $(PYTHON) -m pip install --upgrade --force-reinstall --prefix=$(DESTDIR)$(PREFIX) ./crit
+	# $(Q) $(PYTHON) -m pip install --upgrade --force-reinstall --prefix=$(DESTDIR)$(PREFIX) ./crit
+	$(Q) $(PYTHON) scripts/crit-setup.py install --root=$(DESTDIR) --prefix=$(PREFIX) --record $(CRIT_SETUP_FILES)
 endif
 .PHONY: install
 
--- /dev/null
+++ b/scripts/crit-setup.py
@@ -0,0 +1,25 @@
+import os
+from distutils.core import setup
+
+criu_version = "0.0.1"
+env = os.environ
+
+if 'CRIU_VERSION_MAJOR' in env and 'CRIU_VERSION_MINOR' in env:
+    criu_version = '{}.{}'.format(
+        env['CRIU_VERSION_MAJOR'],
+        env['CRIU_VERSION_MINOR']
+    )
+
+    if 'CRIU_VERSION_SUBLEVEL' in env and env['CRIU_VERSION_SUBLEVEL']:
+        criu_version += '.' + env['CRIU_VERSION_SUBLEVEL']
+
+setup(name="crit",
+      version=criu_version,
+      description="CRiu Image Tool",
+      author="CRIU team",
+      author_email="criu@openvz.org",
+      license="GPLv2",
+      url="https://github.com/checkpoint-restore/criu",
+      package_dir={'pycriu': 'lib/py'},
+      packages=["pycriu", "pycriu.images"],
+      scripts=["crit/crit"])
