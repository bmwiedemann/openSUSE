From bc203e0e9f5b447d184cc5facce3dacc29c2142d Mon Sep 17 00:00:00 2001
From: Ben Greiner <code@bnavigator.de>
Date: Thu, 1 Apr 2021 14:53:50 +0200
Subject: [PATCH] only assign to _flat_array if something to assign

---
 datashader/datatypes.py | 15 ++++++++-------
 1 file changed, 8 insertions(+), 7 deletions(-)

diff --git a/datashader/datatypes.py b/datashader/datatypes.py
index ec412688..5b944133 100644
--- a/datashader/datatypes.py
+++ b/datashader/datatypes.py
@@ -303,17 +303,18 @@ def __init__(self, data, dtype=None, copy=False):
             # Populate arrays
             next_start_ind = 0
             for i, array_el in enumerate(data):
-                # Compute element length
-                n = len(array_el) if not missing(array_el) else 0
-
                 # Update start indices
                 self._start_indices[i] = next_start_ind
 
-                # Update flat array
-                self._flat_array[next_start_ind:next_start_ind+n] = array_el
+                if not missing(array_el):
+                    # Compute element length
+                    n = len(array_el)
+
+                    # Update flat array
+                    self._flat_array[next_start_ind:next_start_ind+n] = array_el
 
-                # increment next start index
-                next_start_ind += n
+                    # increment next start index
+                    next_start_ind += n
 
         self._dtype = RaggedDtype(dtype=dtype)
 
