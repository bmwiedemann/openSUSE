From c9a2328c8264b8cc9cc2dcf31d49bd8923c05bf7 Mon Sep 17 00:00:00 2001
From: Christophe Giboudeaux <christophe@krop.fr>
Date: Sun, 17 Apr 2022 15:16:18 +0200
Subject: [PATCH] Work around build issue in pyside 6.3

Reported upstream: https://bugreports.qt.io/browse/PYSIDE-1890

Change-Id: I084b5d96b71b3b8468008cd415b3102d3a7918d7
---
 sources/pyside6/PySide6/CMakeLists.txt | 1 +
 sources/pyside6/PySide6/__init__.py.in | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/sources/pyside6/PySide6/CMakeLists.txt b/sources/pyside6/PySide6/CMakeLists.txt
index 95693ff67..8c53341b3 100644
--- a/sources/pyside6/PySide6/CMakeLists.txt
+++ b/sources/pyside6/PySide6/CMakeLists.txt
@@ -4,6 +4,7 @@ project(pyside6)
 configure_file("${CMAKE_CURRENT_SOURCE_DIR}/global.h.in"
                "${CMAKE_CURRENT_BINARY_DIR}/pyside6_global.h" @ONLY)
 
+get_filename_component(_build_dir_name ${CMAKE_BINARY_DIR} NAME)
 configure_file("${CMAKE_CURRENT_SOURCE_DIR}/__init__.py.in"
                "${CMAKE_CURRENT_BINARY_DIR}/__init__.py" @ONLY)
 configure_file("${CMAKE_CURRENT_SOURCE_DIR}/_config.py.in"
diff --git a/sources/pyside6/PySide6/__init__.py.in b/sources/pyside6/PySide6/__init__.py.in
index d8439985d..ba748a91f 100644
--- a/sources/pyside6/PySide6/__init__.py.in
+++ b/sources/pyside6/PySide6/__init__.py.in
@@ -123,7 +123,7 @@ def _find_all_qt_modules():
     location = Path(__file__).resolve().parent
 
     # Note: We should _not_ call this function while still building, but use the existing value!
-    in_build = location.parents[1].name == "build"
+    in_build = location.parents[1].name == "@_build_dir_name@"
     if in_build:
         return __all__
 
-- 
2.35.1

