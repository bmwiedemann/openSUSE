From e4af3aada45d841b83e632dccbeb6c024486ab9e Mon Sep 17 00:00:00 2001
From: Fabian Vogt <fabian@ritter-vogt.de>
Date: Thu, 16 May 2019 20:49:18 +0200
Subject: [PATCH] Revert "Inform about missing NetworkManager VPN plugin"

This reverts commit 0903dc0178ede2ef96e8155b2732f947e37449c3.
---
 libs/CMakeLists.txt |  1 -
 libs/handler.cpp    | 21 ++-------------------
 2 files changed, 2 insertions(+), 20 deletions(-)

diff --git a/libs/CMakeLists.txt b/libs/CMakeLists.txt
index 20ee74f4..29e7298a 100644
--- a/libs/CMakeLists.txt
+++ b/libs/CMakeLists.txt
@@ -22,7 +22,6 @@ target_link_libraries(plasmanm_internal
 PUBLIC
     KF5::NetworkManagerQt
     plasmanm_editor
-    ${NETWORKMANAGER_LIBRARIES}
 PRIVATE
     KF5::Service
     KF5::I18n
diff --git a/libs/handler.cpp b/libs/handler.cpp
index 54155eab..90b8999b 100644
--- a/libs/handler.cpp
+++ b/libs/handler.cpp
@@ -38,8 +38,6 @@
 #include <NetworkManagerQt/ActiveConnection>
 #include <NetworkManagerQt/Ipv4Setting>
 
-#include <libnm/nm-vpn-plugin-info.h>
-
 #if WITH_MODEMMANAGER_SUPPORT
 #include <ModemManagerQt/Manager>
 #include <ModemManagerQt/ModemDevice>
@@ -104,24 +102,10 @@ void Handler::activateConnection(const QString& connection, const QString& devic
         NetworkManager::VpnSetting::Ptr vpnSetting = con->settings()->setting(NetworkManager::Setting::Vpn).staticCast<NetworkManager::VpnSetting>();
         if (vpnSetting) {
             qCDebug(PLASMA_NM) << "Checking VPN" << con->name() << "type:" << vpnSetting->serviceType();
-
-            bool pluginMissing = false;
-
-            // Check missing plasma-nm VPN plugin
+            // get the list of supported VPN service types
             const KService::List services = KServiceTypeTrader::self()->query("PlasmaNetworkManagement/VpnUiPlugin",
                                                                               QString::fromLatin1("[X-NetworkManager-Services]=='%1'").arg(vpnSetting->serviceType()));
-            pluginMissing = services.isEmpty();
-
-            // Check missing NetworkManager VPN plugin
-            if (!pluginMissing) {
-                GSList *plugins = nullptr;
-                plugins = nm_vpn_plugin_info_list_load();
-
-                NMVpnPluginInfo *plugin_info = nm_vpn_plugin_info_list_find_by_service(plugins, vpnSetting->serviceType().toStdString().c_str());
-                pluginMissing = !plugin_info;
-            }
-
-            if (pluginMissing) {
+            if (services.isEmpty()) {
                 qCWarning(PLASMA_NM) << "VPN" << vpnSetting->serviceType() << "not found, skipping";
                 KNotification *notification = new KNotification("MissingVpnPlugin", KNotification::CloseOnTimeout, this);
                 notification->setComponentName("networkmanagement");
@@ -131,7 +115,6 @@ void Handler::activateConnection(const QString& connection, const QString& devic
                 notification->sendEvent();
                 return;
             }
-
         }
     }
 
-- 
2.21.0

