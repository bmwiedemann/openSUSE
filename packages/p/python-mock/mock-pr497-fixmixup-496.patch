From 67ca856792f8655d4043885facfcf1450a2c4ddb Mon Sep 17 00:00:00 2001
From: Chris Withers <chris@simplistix.co.uk>
Date: Sat, 10 Apr 2021 20:06:10 +0100
Subject: [PATCH 1/3] move to matrix and add 3.9

---
 .circleci/config.yml | 59 ++++++++++++++------------------------------
 1 file changed, 19 insertions(+), 40 deletions(-)

diff --git a/.circleci/config.yml b/.circleci/config.yml
index 9855ef7..4564ec2 100644
--- a/.circleci/config.yml
+++ b/.circleci/config.yml
@@ -24,26 +24,21 @@ jobs:
 
 common: &common
   jobs:
+
     - python/pip-run-tests:
-        name: python36
-        image: circleci/python:3.6
-    - python/pip-run-tests:
-        name: python37
-        image: circleci/python:3.7
-    - python/pip-run-tests:
-        name: python38
-        image: circleci/python:3.8
-    - python/pip-run-tests:
-        name: pypy36
-        image: pypy:3.6
+        matrix:
+          parameters:
+            image:
+              - circleci/python:3.6
+              - circleci/python:3.7
+              - circleci/python:3.8
+              - circleci/python:3.9
+              - pypy:3.6
 
     - python/coverage:
         name: coverage
         requires:
-          - python36
-          - python37
-          - python38
-          - pypy36
+          - python/pip-run-tests
 
     - python/pip-docs:
         name: docs
@@ -59,27 +54,14 @@ common: &common
             only: master
 
     - check-package:
-        name: check-package-python36
-        image: circleci/python:3.6
-        requires:
-          - package
-
-    - check-package:
-        name: check-package-python37
-        image: circleci/python:3.7
-        requires:
-          - package
-
-    - check-package:
-        name: check-package-python38
-        image: circleci/python:3.8
-        requires:
-          - package
-
-    - check-package:
-        name: check-package-pypy36
-        image: pypy:3.6
-        python: pypy3
+        matrix:
+          parameters:
+            image:
+              - circleci/python:3.6
+              - circleci/python:3.7
+              - circleci/python:3.8
+              - circleci/python:3.9
+              - pypy:3.6
         requires:
           - package
 
@@ -87,10 +69,7 @@ common: &common
         name: release
         config: .carthorse.yml
         requires:
-          - check-package-python36
-          - check-package-python37
-          - check-package-python38
-          - check-package-pypy36
+          - check-package
 
 workflows:
   push:

From e293a82592401306f2cdca91c048acf59503bcf8 Mon Sep 17 00:00:00 2001
From: Chris Withers <chris@simplistix.co.uk>
Date: Thu, 15 Apr 2021 08:23:18 +0100
Subject: [PATCH 2/3] remove unused tox.ini

---
 tox.ini | 12 ------------
 1 file changed, 12 deletions(-)
 delete mode 100644 tox.ini

diff --git a/tox.ini b/tox.ini
deleted file mode 100644
index 14eb4f4..0000000
--- a/tox.ini
+++ /dev/null
@@ -1,12 +0,0 @@
-[tox]
-envlist = py36,py37,py38,docs
-
-[testenv]
-commands =
-    {envbindir}/pytest {posargs}
-
-[testenv:docs]
-deps =
-    sphinx
-commands =
-    {envbindir}/python setup.py build_sphinx

From f57ca71ba69596cd30e5abd36d197e8014377982 Mon Sep 17 00:00:00 2001
From: Chris Withers <chris@simplistix.co.uk>
Date: Thu, 15 Apr 2021 08:27:25 +0100
Subject: [PATCH 3/3] fix tests that should test mock but were testing
 unittest.mock

---
 mock/tests/testmock.py | 15 ++++++++-------
 1 file changed, 8 insertions(+), 7 deletions(-)

diff --git a/mock/tests/testmock.py b/mock/tests/testmock.py
index 5702b6d..1a70909 100644
--- a/mock/tests/testmock.py
+++ b/mock/tests/testmock.py
@@ -13,6 +13,7 @@
     create_autospec, mock
 )
 from mock.mock import _Call, _CallList
+import mock.mock as mock_module
 
 
 class Iter(object):
@@ -47,7 +48,7 @@ def test_all(self):
         # if __all__ is badly defined then import * will raise an error
         # We have to exec it because you can't import * inside a method
         # in Python 3
-        exec("from unittest.mock import *")
+        exec("from mock.mock import *")
 
 
     def test_constructor(self):
@@ -2137,16 +2138,16 @@ def test_isinstance_under_settrace(self):
         # test_patch_dict_test_prefix and test_patch_test_prefix not restoring
         # causes the objects patched to go out of sync
 
-        old_patch = unittest.mock.patch
+        old_patch = mock_module.patch
 
         # Directly using __setattr__ on unittest.mock causes current imported
         # reference to be updated. Use a lambda so that during cleanup the
         # re-imported new reference is updated.
-        self.addCleanup(lambda patch: setattr(unittest.mock, 'patch', patch),
+        self.addCleanup(lambda patch: setattr(mock_module, 'patch', patch),
                         old_patch)
 
         with patch.dict('sys.modules'):
-            del sys.modules['unittest.mock']
+            del sys.modules['mock']
 
             # This trace will stop coverage being measured ;-)
             def trace(frame, event, arg):  # pragma: no cover
@@ -2155,7 +2156,7 @@ def trace(frame, event, arg):  # pragma: no cover
             self.addCleanup(sys.settrace, sys.gettrace())
             sys.settrace(trace)
 
-            from unittest.mock import (
+            from mock.mock import (
                 Mock, MagicMock, NonCallableMock, NonCallableMagicMock
             )
 
@@ -2170,10 +2171,10 @@ def trace(frame, event, arg):  # pragma: no cover
     def test_bool_not_called_when_passing_spec_arg(self):
         class Something:
             def __init__(self):
-                self.obj_with_bool_func = unittest.mock.MagicMock()
+                self.obj_with_bool_func = mock_module.MagicMock()
 
         obj = Something()
-        with unittest.mock.patch.object(obj, 'obj_with_bool_func', autospec=True): pass
+        with mock_module.patch.object(obj, 'obj_with_bool_func', autospec=True): pass
 
         self.assertEqual(obj.obj_with_bool_func.__bool__.call_count, 0)
 
