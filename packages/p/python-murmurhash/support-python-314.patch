From 7d925ff64d6655a02ea110f829fd059d1f7aa369 Mon Sep 17 00:00:00 2001
From: Lysandros Nikolaou <lisandrosnik@gmail.com>
Date: Wed, 30 Jul 2025 10:17:30 +0200
Subject: [PATCH] Implement support for 3.14 & free-threading

---
 .github/workflows/cibuildwheel.yml | 2 +-
 .github/workflows/tests.yml        | 9 ++++++++-
 murmurhash/mrmr.pyx                | 1 +
 pyproject.toml                     | 4 ++--
 requirements.txt                   | 3 ++-
 setup.py                           | 6 ++++--
 6 files changed, 18 insertions(+), 7 deletions(-)

Index: murmurhash-1.0.13/murmurhash/mrmr.pyx
===================================================================
--- murmurhash-1.0.13.orig/murmurhash/mrmr.pyx
+++ murmurhash-1.0.13/murmurhash/mrmr.pyx
@@ -1,3 +1,4 @@
+# cython: freethreading_compatible=True
 from libc.stdint cimport uint64_t, int64_t, int32_t
 
 
Index: murmurhash-1.0.13/pyproject.toml
===================================================================
--- murmurhash-1.0.13.orig/pyproject.toml
+++ murmurhash-1.0.13/pyproject.toml
@@ -1,7 +1,7 @@
 [build-system]
 requires = [
     "setuptools",
-    "cython>=0.25",
+    "cython>=3.1",
 ]
 build-backend = "setuptools.build_meta"
 
@@ -9,7 +9,7 @@ build-backend = "setuptools.build_meta"
 build = "*"
 skip = "pp* cp36* cp37* cp38*"
 test-skip = ""
-free-threaded-support = false
+enable = ["cpython-freethreading"]
 
 archs = ["native"]
 
Index: murmurhash-1.0.13/setup.py
===================================================================
--- murmurhash-1.0.13.orig/setup.py
+++ murmurhash-1.0.13/setup.py
@@ -113,8 +113,8 @@ def setup_package():
             version=about["__version__"],
             url=about["__uri__"],
             license=about["__license__"],
-            ext_modules=cythonize(ext_modules, language_level=2),
-            python_requires=">=3.6,<3.14",
+            ext_modules=cythonize(ext_modules),
+            python_requires=">=3.6,<3.15",
             classifiers=[
                 "Development Status :: 5 - Production/Stable",
                 "Environment :: Console",
@@ -132,6 +132,8 @@ def setup_package():
                 "Programming Language :: Python :: 3.10",
                 "Programming Language :: Python :: 3.11",
                 "Programming Language :: Python :: 3.12",
+                "Programming Language :: Python :: 3.13",
+                "Programming Language :: Python :: 3.14",
                 "Topic :: Scientific/Engineering",
             ],
             cmdclass={"build_ext": build_ext_subclass},
