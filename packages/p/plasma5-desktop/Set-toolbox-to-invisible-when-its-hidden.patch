From 7a48de1efa224e616d9f24f1fa1e4cdab0bce196 Mon Sep 17 00:00:00 2001
From: David Edmundson <kde@davidedmundson.co.uk>
Date: Fri, 14 Feb 2020 14:16:30 +0200
Subject: Set toolbox to invisble when it's hidden

Summary:
opacity was bound to editMode, but this did not affect visibility or
enabled.

Not only is this somewhat wasteful, enabled is very important as
otherwise shortcuts for buttons get intercepted to match the accelerator
applied to the internal buttons. This breaks all the multi-key shortcuts
that plasma uses as alt+d gets taken.

BUG: 416695
FIXED-IN: 5.18.1

Test Plan:
Mad gammaray skillz to find the bug

Checked alt+d, a now opens the widget explorer
Checked edit mode through the context menu still showed the toolbox

Reviewers: #plasma, ngraham

Reviewed By: ngraham

Subscribers: ngraham, plasma-devel

Tags: #plasma

Differential Revision: https://phabricator.kde.org/D27386
---
 toolboxes/desktoptoolbox/contents/ui/ToolBoxButton.qml | 1 +
 toolboxes/desktoptoolbox/contents/ui/ToolBoxRoot.qml   | 2 --
 2 files changed, 1 insertion(+), 2 deletions(-)

diff --git a/toolboxes/desktoptoolbox/contents/ui/ToolBoxButton.qml b/toolboxes/desktoptoolbox/contents/ui/ToolBoxButton.qml
index e706b69..e8055ec 100644
--- a/toolboxes/desktoptoolbox/contents/ui/ToolBoxButton.qml
+++ b/toolboxes/desktoptoolbox/contents/ui/ToolBoxButton.qml
@@ -44,6 +44,7 @@ Item {
     }
     transformOrigin: Item.Center
     opacity: plasmoid.editMode
+    visible: plasmoid.editMode
     Behavior on opacity {
         OpacityAnimator {
             duration: units.longDuration
diff --git a/toolboxes/desktoptoolbox/contents/ui/ToolBoxRoot.qml b/toolboxes/desktoptoolbox/contents/ui/ToolBoxRoot.qml
index 4478d6e..9921a26 100644
--- a/toolboxes/desktoptoolbox/contents/ui/ToolBoxRoot.qml
+++ b/toolboxes/desktoptoolbox/contents/ui/ToolBoxRoot.qml
@@ -54,10 +54,8 @@ Item {
 
     ToolBoxButton {
         id: toolBoxButton
-        visible: false
         Component.onCompleted: {
             placeToolBox(plasmoid.configuration.ToolBoxButtonState);
-            toolBoxButton.visible = true
         }
     }
 
-- 
cgit v1.1

