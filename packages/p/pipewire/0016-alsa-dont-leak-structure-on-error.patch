From ac54b7ace1305795497fb01f6badeaf138035fbb Mon Sep 17 00:00:00 2001
From: Wim Taymans <wtaymans@redhat.com>
Date: Thu, 2 Jul 2020 15:52:50 +0200
Subject: [PATCH] alsa: don't leak structure on error

---
 pipewire-alsa/alsa-plugins/pcm_pipewire.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/pipewire-alsa/alsa-plugins/pcm_pipewire.c b/pipewire-alsa/alsa-plugins/pcm_pipewire.c
index 9d2397f4..d2fdcf44 100644
--- a/pipewire-alsa/alsa-plugins/pcm_pipewire.c
+++ b/pipewire-alsa/alsa-plugins/pcm_pipewire.c
@@ -915,8 +915,10 @@ static int snd_pcm_pipewire_open(snd_pcm_t **pcmp, const char *name,
 	else
 		pw->node_name = strdup(node_name);
 
-	if (pw->node_name == NULL)
-		return -errno;
+	if (pw->node_name == NULL) {
+		err = -errno;
+		goto error;
+	}
 
 	pw->target = PW_ID_ANY;
 	if (str != NULL)
