From dec7f7a608fc2f8aac1338d398ae30ba5a592e64 Mon Sep 17 00:00:00 2001
From: Wim Taymans <wtaymans@redhat.com>
Date: Mon, 17 Jan 2022 16:28:06 +0100
Subject: [PATCH] merger: also reconfigure when monitor changes

So that monitor ports are added/removed.
---
 spa/plugins/audioconvert/merger.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/spa/plugins/audioconvert/merger.c b/spa/plugins/audioconvert/merger.c
index 9ebf040e9..c0b979997 100644
--- a/spa/plugins/audioconvert/merger.c
+++ b/spa/plugins/audioconvert/merger.c
@@ -624,7 +624,9 @@ static int impl_node_set_param(void *object, uint32_t id, uint32_t flags,
 
 		info.info.raw.rate = 0;
 
-		if (this->have_profile && memcmp(&this->format, &info, sizeof(info)) == 0)
+		if (this->have_profile &&
+		    memcmp(&this->format, &info, sizeof(info)) == 0 &&
+		    this->monitor == monitor)
 			return 0;
 
 		spa_log_debug(this->log, "%p: port config %d/%d %d", this,
-- 
GitLab

