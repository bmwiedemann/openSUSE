---
 proc/sysinfo.c |    9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

--- proc/sysinfo.c
+++ proc/sysinfo.c	2022-06-22 11:29:39.240066488 +0000
@@ -794,10 +794,6 @@ nextline:
      where such values will be dramatically distorted over those of the host. */
   if (kb_main_available > kb_main_total)
     kb_main_available = kb_main_free;
-  mem_used = kb_main_total - kb_main_free - kb_main_cached - kb_main_buffers;
-  if (mem_used < 0)
-    mem_used = kb_main_total - kb_main_free;
-  kb_main_used = (unsigned long)mem_used;
 
   /* zero? might need fallback for 2.6.27 <= kernel <? 3.14 */
   if (!kb_main_available) {
@@ -821,6 +817,11 @@ nextline:
       kb_main_available = kb_main_free;
 #endif /* linux */
   }
+
+  mem_used = kb_main_total - kb_main_available;
+  if (mem_used < 0)
+    mem_used = kb_main_total - kb_main_free;
+  kb_main_used = (unsigned long)mem_used;
 }
 
 /*****************************************************************/
