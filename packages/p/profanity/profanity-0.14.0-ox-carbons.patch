From 122434a276e21017ba294bda25164e27fd7cd731 Mon Sep 17 00:00:00 2001
From: Michael Vetter <jubalh@iodoru.org>
Date: Thu, 24 Aug 2023 09:31:50 +0200
Subject: [PATCH] ox: correctly recognize ox encrypted carbons

and dont display them as legacy pgp encrypted messages.
This was forgotten in 2c94ee5a8.

Fix https://github.com/profanity-im/profanity/issues/1875
---
 src/event/server_events.c | 2 ++
 src/ui/chatwin.c          | 2 ++
 2 files changed, 4 insertions(+)

diff --git a/src/event/server_events.c b/src/event/server_events.c
index 81ce3927c..66ee65a96 100644
--- a/src/event/server_events.c
+++ b/src/event/server_events.c
@@ -471,6 +471,8 @@ sv_ev_outgoing_carbon(ProfMessage* message)
 
     if (message->enc == PROF_MSG_ENC_OMEMO) {
         chatwin_outgoing_carbon(chatwin, message);
+    } else if (message->enc == PROF_MSG_ENC_OX) {
+        chatwin_outgoing_carbon(chatwin, message);
     } else if (message->encrypted) {
 #ifdef HAVE_LIBGPGME
         message->plain = p_gpg_decrypt(message->encrypted);
diff --git a/src/ui/chatwin.c b/src/ui/chatwin.c
index d462f08aa..c1ecd7054 100644
--- a/src/ui/chatwin.c
+++ b/src/ui/chatwin.c
@@ -467,6 +467,8 @@ chatwin_outgoing_carbon(ProfChatWin* chatwin, ProfMessage* message)
         enc_char = prefs_get_pgp_char();
     } else if (message->enc == PROF_MSG_ENC_OMEMO) {
         enc_char = prefs_get_omemo_char();
+    } else if (message->enc == PROF_MSG_ENC_OX) {
+        enc_char = prefs_get_ox_char();
     } else {
         enc_char = strdup("-");
     }
