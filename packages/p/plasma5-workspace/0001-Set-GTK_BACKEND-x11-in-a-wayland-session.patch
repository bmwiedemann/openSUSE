From 3deadbfcdf776eb0c994bb4d719e601160943bfa Mon Sep 17 00:00:00 2001
From: Fabian Vogt <fabian@ritter-vogt.de>
Date: Wed, 28 Aug 2019 15:09:49 +0200
Subject: [PATCH] Set GTK_BACKEND=x11 in a wayland session

Works around missing window decorations and broken config file reading
---
 startkde/startplasma-waylandsession.cpp | 5 +++++
 1 file changed, 5 insertions(+)

Index: plasma-workspace-5.15.80git.20210121T134153~83e5f9011/startkde/startplasma-waylandsession.cpp
===================================================================
--- plasma-workspace-5.15.80git.20210121T134153~83e5f9011.orig/startkde/startplasma-waylandsession.cpp	2021-01-21 14:41:53.000000000 +0100
+++ plasma-workspace-5.15.80git.20210121T134153~83e5f9011/startkde/startplasma-waylandsession.cpp	2021-01-22 08:39:19.900539408 +0100
@@ -47,6 +47,11 @@
     out << "startplasma-waylandsession: Starting up...";
 
     if (qEnvironmentVariableIsSet("DISPLAY")) {
+        // GTK3 uses the wayland backend by default, but its implementation is not correct
+        // enough to work well here. Window decorations are missing, for instance.
+        if (!qEnvironmentVariableIsSet("GDK_BACKEND")) {
+            qputenv("GDK_BACKEND", "x11");
+        }
         setupX11();
     } else {
         qWarning() << "running kwin without Xwayland support";
