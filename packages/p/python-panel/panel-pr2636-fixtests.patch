From 3c7104e5420e3bf5a5665ae84c3c731e7cf3a10b Mon Sep 17 00:00:00 2001
From: Philipp Rudiger <prudiger@anaconda.com>
Date: Mon, 16 Aug 2021 15:05:10 +0200
Subject: [PATCH 1/2] Ensure tests pass in packaged version

---
 MANIFEST.in                   | 2 ++
 panel/tests/pane/test_base.py | 5 ++++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/MANIFEST.in b/MANIFEST.in
index b0d5d242d7..2b323f506b 100644
--- a/MANIFEST.in
+++ b/MANIFEST.in
@@ -11,6 +11,8 @@ include panel/models/vtk/*.ts
 include panel/_templates/*.js
 include panel/_templates/*.html
 include panel/tests/test_data/*.png
+include panel/tests/pane/assets/*.mp3
+include panel/tests/pane/assets/*.mp4
 recursive-include panel/template *.html
 recursive-include panel/template *.css
 recursive-include panel/template *.js
diff --git a/panel/tests/pane/test_base.py b/panel/tests/pane/test_base.py
index 32f9f9dfc2..1ffc078014 100644
--- a/panel/tests/pane/test_base.py
+++ b/panel/tests/pane/test_base.py
@@ -33,7 +33,10 @@ def test_pane_layout_properties(pane, document, comm):
 
 @pytest.mark.parametrize('pane', all_panes+[Bokeh])
 def test_pane_linkable_params(pane):
-    p = pane()
+    try:
+        p = pane()
+    except ImportError:
+        pytest.skip("Dependent library could not be imported.")
     controls = p.controls(jslink=True)
     layout = Row(p, controls)
 

From 8ad7606eda22875cc7e24b855273c25ccec5e147 Mon Sep 17 00:00:00 2001
From: Philipp Rudiger <prudiger@anaconda.com>
Date: Mon, 16 Aug 2021 15:49:42 +0200
Subject: [PATCH 2/2] Update plotly test

---
 panel/tests/pane/test_plotly.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/panel/tests/pane/test_plotly.py b/panel/tests/pane/test_plotly.py
index a71b75009e..5c56eeecfa 100644
--- a/panel/tests/pane/test_plotly.py
+++ b/panel/tests/pane/test_plotly.py
@@ -92,7 +92,7 @@ def test_plotly_pane_datetime_array_transform(document, comm):
     pane = Plotly(fig)
 
     model = pane.get_root(document, comm)
-    assert all(isinstance(v, str) for v in model.data[0]['x'])
+    assert model.data_sources[0].data['x'][0].dtype.kind == 'U'
 
 
 @plotly_available
