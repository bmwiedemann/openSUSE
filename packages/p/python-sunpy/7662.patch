From 73c903882a0ec3b97a87ba2d331a501627f74846 Mon Sep 17 00:00:00 2001
From: Nabil Freij <nabil.freij@gmail.com>
Date: Wed, 5 Jun 2024 16:26:44 -0700
Subject: [PATCH 1/3] comment removla

---
 sunpy/io/src/ana/_pyana.c | 3 ---
 1 file changed, 3 deletions(-)

diff --git a/sunpy/io/src/ana/_pyana.c b/sunpy/io/src/ana/_pyana.c
index 6c5f3decd69..7b1ac831bf3 100644
--- a/sunpy/io/src/ana/_pyana.c
+++ b/sunpy/io/src/ana/_pyana.c
@@ -344,12 +344,10 @@ static PyObject * pyana_fzwrite(PyObject *self, PyObject *args) {
     int *dims = malloc(nd*sizeof(int));
     // Get the dimensions and number of elements
     npy_intp *npy_dims = PyArray_DIMS(anadata_align);
-    //npy_intp npy_nelem = PyArray_SIZE(anadata_align);
 
     if (debug == 1) printf("pyana_fzwrite(): Dimensions: ");
     for (d=0; d<nd; d++) {
         // ANA stores dimensions the other way around?
-        //dims[d] = npy_dims[d];
         dims[d] = npy_dims[nd-1-d];
         if (debug == 1) printf(" %d", dims[d]);
     }
@@ -363,6 +361,5 @@ static PyObject * pyana_fzwrite(PyObject *self, PyObject *args) {
         ana_fzwrite(anadata_bytes, filename, dims, nd, header, type);
 
     free(dims);
-    // If we didn't crash up to here, we're probably ok :P
     return Py_BuildValue("i", 1);
 }

From f4e99f159435c0d4d568f484f8068cd34884ca20 Mon Sep 17 00:00:00 2001
From: Nabil Freij <nabil.freij@gmail.com>
Date: Wed, 5 Jun 2024 16:29:43 -0700
Subject: [PATCH 2/3] Fix bug in ana code and gcc 14

---
 sunpy/io/src/ana/_pyana.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/sunpy/io/src/ana/_pyana.c b/sunpy/io/src/ana/_pyana.c
index 7b1ac831bf3..cc5961d5f8f 100644
--- a/sunpy/io/src/ana/_pyana.c
+++ b/sunpy/io/src/ana/_pyana.c
@@ -260,7 +260,7 @@ static PyObject * pyana_fzwrite(PyObject *self, PyObject *args) {
     int compress = 1, debug=0;
     char *header = NULL;
     // Processed data goes here
-    PyObject *anadata_align;
+    PyArrayObject *anadata_align;
     uint8_t *anadata_bytes;
     // ANA file writing
     int	type, d;
@@ -334,7 +334,7 @@ static PyObject * pyana_fzwrite(PyObject *self, PyObject *args) {
     // Sanitize data, make a new array from the old array and force the
     // NPY_ARRAY_CARRAY_RO requirement which ensures a C-contiguous and aligned
     // array will be made
-    anadata_align = PyArray_FromArray(anadata, PyArray_DESCR(anadata),NPY_ARRAY_CARRAY_RO);
+    anadata_align = (PyArrayObject*) PyArray_FromArray(anadata, PyArray_DESCR(anadata),NPY_ARRAY_CARRAY_RO);
 
     // Get a pointer to the aligned data
     anadata_bytes = (uint8_t*) PyArray_DATA(anadata_align);

From 9c434c82090cc0511a7a9c76465096e88f1620c4 Mon Sep 17 00:00:00 2001
From: Nabil Freij <nabil.freij@gmail.com>
Date: Wed, 5 Jun 2024 16:33:20 -0700
Subject: [PATCH 3/3] changelog

---
 changelog/7662.bugfix.rst | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 changelog/7662.bugfix.rst

diff --git a/changelog/7662.bugfix.rst b/changelog/7662.bugfix.rst
new file mode 100644
index 00000000000..40eb16295ed
--- /dev/null
+++ b/changelog/7662.bugfix.rst
@@ -0,0 +1 @@
+Fix compilation with gcc 14, avoid implicit pointer conversions.
