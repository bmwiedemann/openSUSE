From 64308fbad38715afddc4f6b3c77e47f8606624b3 Mon Sep 17 00:00:00 2001
From: Ben Darnell <ben@bendarnell.com>
Date: Sun, 28 Apr 2019 19:31:52 -0400
Subject: [PATCH] test: Silence a deprecation warning in py38+pycurl

---
 tornado/test/runtests.py | 10 ++++++++++
 1 file changed, 10 insertions(+)

Index: tornado-4.5.3/tornado/test/runtests.py
===================================================================
--- tornado-4.5.3.orig/tornado/test/runtests.py
+++ tornado-4.5.3/tornado/test/runtests.py
@@ -129,7 +129,16 @@ def main():
     # 3.5.2's PendingDeprecationWarning became a DeprecationWarning in 3.6.
     warnings.filterwarnings("ignore", category=DeprecationWarning,
                             message=".*legacy __aiter__ protocol")
-
+    # This deprecation warning is introduced in Python 3.8 and is
+    # triggered by pycurl. Unforunately, because it is raised in the C
+    # layer it can't be filtered by module and we must match the
+    # message text instead (Tornado's C module uses PY_SSIZE_T_CLEAN
+    # so it's not at risk of running into this issue).
+    warnings.filterwarnings(
+        "ignore",
+        category=DeprecationWarning,
+        message="PY_SSIZE_T_CLEAN will be required",
+    )
     logging.getLogger("tornado.access").setLevel(logging.CRITICAL)
 
     define('httpclient', type=str, default=None,
