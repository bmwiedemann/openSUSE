From 98060fe704f7195356d754a78c67c6fd4756daa7 Mon Sep 17 00:00:00 2001
From: Loic Jaquemet <loic.jaquemet+github@gmail.com>
Date: Tue, 16 Feb 2021 18:14:32 -0700
Subject: [PATCH] add an helpful helper for clang python & .so in -version

---
 ctypeslib/__init__.py | 8 +++++++-
 ctypeslib/clang2py.py | 3 ++-
 2 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/ctypeslib/__init__.py b/ctypeslib/__init__.py
index a332e9e..c8fabfd 100644
--- a/ctypeslib/__init__.py
+++ b/ctypeslib/__init__.py
@@ -23,7 +23,10 @@
 try:
     from ctypes.util import find_library
     # debug for python-haystack travis-ci
-    for version in ["libclang", "clang", "clang-11", "clang-5.0", "clang-4.0", "clang-3.9", "clang-3.8", "clang-3.7"]:
+    v1 = ["clang-%d" % _ for _ in range(14, 6, -1)]
+    v2 = ["clang-%f" % _ for _ in range(6, 3, -1)]
+    v_list = v1 + v2 + ["clang-3.9", "clang-3.8", "clang-3.7"]
+    for version in ["libclang", "clang"] + v_list:
         if find_library(version) is not None:
             from clang import cindex
             cindex.Config.set_library_file(find_library(version))
@@ -33,6 +36,9 @@
             # On darwin, consider that Xcode should be installed in its default path.
             from clang import cindex
             cindex.Config.set_library_file('/Applications/Xcode.app/Contents/Frameworks/libclang.dylib')
+
+    def ctypes_version():
+        return cindex.Config.library_file
 except ImportError as e:
     print(e)
 
diff --git a/ctypeslib/clang2py.py b/ctypeslib/clang2py.py
index 611cc0d..465df84 100755
--- a/ctypeslib/clang2py.py
+++ b/ctypeslib/clang2py.py
@@ -13,6 +13,7 @@
 from ctypeslib.codegen import typedesc
 from ctypeslib.codegen.codegenerator import generate_code
 from ctypeslib.library import Library
+from ctypeslib import ctypes_version
 
 ################################################################
 windows_dll_names = """\
@@ -175,7 +176,7 @@ def windows_dlls(option, opt, value, parser):
                         default=False)
     parser.add_argument('-V', '--version',
                         action='version',
-                        version="%(prog)s version " + version)
+                        version="%(prog)s version " + version + " clang: " + ctypes_version())
 
     parser.add_argument("-w",
                         action="store",
