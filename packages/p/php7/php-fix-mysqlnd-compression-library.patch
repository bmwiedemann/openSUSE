--- ext/mysqlnd/config9.m4
+++ ext/mysqlnd/config9.m4
@@ -24,6 +24,11 @@
 
 
   if test "$PHP_MYSQLND_COMPRESSION_SUPPORT" != "no"; then
+    PKG_CHECK_MODULES([ZLIB], [zlib])
+
+    PHP_EVAL_LIBLINE($ZLIB_LIBS, MYSQLND_SHARED_LIBADD)
+    PHP_EVAL_INCLINE($ZLIB_CFLAGS)
+
     AC_DEFINE([MYSQLND_COMPRESSION_WANTED], 1, [Enable compressed protocol support])
   fi
 
