Index: ext/openssl/openssl.c
===================================================================
--- ext/openssl/openssl.c	2017-01-17 21:44:41.000000000 +0100
+++ ext/openssl/openssl.c	2017-02-13 15:25:42.219789317 +0100
@@ -1388,6 +1388,7 @@ PHP_MINIT_FUNCTION(openssl)
 	OpenSSL_add_all_ciphers();
 	OpenSSL_add_all_digests();
 	OpenSSL_add_all_algorithms();
+	OPENSSL_config(NULL);
 
 #if !defined(OPENSSL_NO_AES) && defined(EVP_CIPH_CCM_MODE) && OPENSSL_VERSION_NUMBER < 0x100020000
 	EVP_add_cipher(EVP_aes_128_ccm());
Index: ext/openssl/xp_ssl.c
===================================================================
--- ext/openssl/xp_ssl.c	2017-02-13 15:25:42.219789317 +0100
+++ ext/openssl/xp_ssl.c	2017-02-13 15:33:47.520365579 +0100
@@ -1518,6 +1518,10 @@ int php_openssl_setup_crypto(php_stream
 		return FAILURE;
 	}
 
+#ifdef SSL_MODE_RELEASE_BUFFERS
+       SSL_CTX_set_mode(sslsock->ctx, SSL_MODE_RELEASE_BUFFERS);
+#endif
+
 	if (GET_VER_OPT("no_ticket") && zend_is_true(val)) {
 		ssl_ctx_options |= SSL_OP_NO_TICKET;
 	}
