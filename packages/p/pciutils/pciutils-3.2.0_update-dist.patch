Index: pciutils-3.3.1/Makefile
===================================================================
--- pciutils-3.3.1.orig/Makefile
+++ pciutils-3.3.1/Makefile
@@ -88,7 +88,7 @@ lspci: LDLIBS+=$(LIBKMOD_LIBS)
 ls-kernel.o: CFLAGS+=$(LIBKMOD_CFLAGS)
 
 update-pciids: update-pciids.sh
-	sed <$< >$@ "s@^DEST=.*@DEST=$(IDSDIR)/$(PCI_IDS)@;s@^PCI_COMPRESSED_IDS=.*@PCI_COMPRESSED_IDS=$(PCI_COMPRESSED_IDS)@"
+	sed <$< >$@ "s@^DEST=.*@DEST=$(IDSDIR)/pci.ids.d/pci.ids.dist@;s@^PCI_COMPRESSED_IDS=.*@PCI_COMPRESSED_IDS=@"
 	chmod +x $@
 
 # The example of use of libpci
Index: pciutils-3.3.1/update-pciids.sh
===================================================================
--- pciutils-3.3.1.orig/update-pciids.sh
+++ pciutils-3.3.1/update-pciids.sh
@@ -4,7 +4,7 @@
 
 set -e
 SRC="http://pci-ids.ucw.cz/v2.2/pci.ids"
-DEST=pci.ids
+DEST=pci.ids.d/pci.ids.dist
 PCI_COMPRESSED_IDS=
 GREP=grep
 
@@ -66,6 +66,13 @@ fi
 mv $DEST.neww $DEST
 rm $DEST.new
 
+if [ -x /usr/bin/merge-pciids -a -x /usr/bin/perl ]; then
+	merge-pciids
+else
+	echo "WARNING: merge-pciids or perl missing"
+	cp -p $DEST /usr/share/pci.ids
+fi
+
 # Older versions did not compress the ids file, so let's make sure we
 # clean that up.
 if [ ${DEST%.gz} != ${DEST} ] ; then
