From 8da6c472ddcf18a30676bf8f7c55785dd2de91c5 Mon Sep 17 00:00:00 2001
From: Paul Wolneykien <manowar@altlinux.org>
Date: Fri, 26 Apr 2024 18:10:24 +0300
Subject: [PATCH] Set 'slot_num' configuration parameter to 0 by default

See https://github.com/OpenSC/pam_pkcs11/pull/74 for details.

Signed-off-by: Paul Wolneykien <manowar@altlinux.org>
---
 src/pam_pkcs11/pam_config.c |   11 +++--------
 1 file changed, 3 insertions(+), 8 deletions(-)

--- a/src/pam_pkcs11/pam_config.c
+++ b/src/pam_pkcs11/pam_config.c
@@ -50,7 +50,7 @@ struct configuration_st configuration =
         NULL,				/* const char *pkcs11_module_path; */
         NULL,                           /* screen savers */
         NULL,			/* slot_description */
-        -1,				/* int slot_num; */
+        0,				/* int slot_num; */
 	0,				/* support threads */
 	/* cert policy; */
         {
@@ -167,13 +167,8 @@ static void parse_config_file(void) {
 	    configuration.slot_num =
 	        scconf_get_int(pkcs11_mblk,"slot_num",configuration.slot_num);
 
-	    if (configuration.slot_description != NULL && configuration.slot_num != -1) {
-		DBG1("Can not specify both slot_description and slot_num in file %s",configuration.config_file);
-	            return;
-	    }
-
-	    if (configuration.slot_description == NULL && configuration.slot_num == -1) {
-		DBG1("Neither slot_description nor slot_num found in file %s",configuration.config_file);
+	    if (configuration.slot_description != NULL && configuration.slot_num != 0) {
+		DBG1("Can not specify both slot_description and slot_num != 0 in file %s",configuration.config_file);
 	            return;
 	    }
 
