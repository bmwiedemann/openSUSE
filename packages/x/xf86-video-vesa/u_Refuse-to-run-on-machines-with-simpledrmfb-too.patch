From 05aa4057d9369165f4f49b5dcc9064b4bfdfe9e5 Mon Sep 17 00:00:00 2001
From: Takashi Iwai <tiwai@suse.de>
Date: Thu, 10 Mar 2022 08:22:21 +0100
Subject: [PATCH] Refuse to run on machines with simpledrmfb, too
References: bsc#1193539

simpledrm framebuffer takes over EFI and manages the graphics.
Running vesa driver on those would confuse the system and result in a
bad interaction.
Just bail out like efifb and other cases.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 src/vesa.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/vesa.c b/src/vesa.c
index b2a1922c2332..53c3d47547c7 100644
--- a/src/vesa.c
+++ b/src/vesa.c
@@ -453,6 +453,7 @@ VESAPciProbe(DriverPtr drv, int entity_num, struct pci_device *dev,
 
 #ifdef __linux__
     if (access("/sys/devices/platform/efi-framebuffer.0", F_OK) == 0 ||
+        access("/sys/devices/platform/simple-framebuffer.0", F_OK) == 0 ||
         access("/sys/devices/platform/efifb.0", F_OK) == 0) {
         ErrorF("vesa: Refusing to run on UEFI\n");
         return FALSE;
-- 
2.31.1

