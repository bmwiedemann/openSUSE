From ceb711ec1f98ba18bce1dc6ee6a091e304a0c883 Mon Sep 17 00:00:00 2001
From: Thomas Zimmermann <tzimmermann@suse.de>
Date: Fri, 3 Dec 2021 10:24:20 +0100
Subject: Add udev rule for HyperV devices

Add a udev rule to generate configuration files for HyperV-based
graphics output.

Signed-off-by: Thomas Zimmermann <tzimmermann@suse.de>
---
 hw/xfree86/os-support/linux/99-xorg-sysfs.rules | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/hw/xfree86/os-support/linux/99-xorg-sysfs.rules b/hw/xfree86/os-support/linux/99-xorg-sysfs.rules
index 940d18ef5..0cc9ad7b6 100644
--- a/hw/xfree86/os-support/linux/99-xorg-sysfs.rules
+++ b/hw/xfree86/os-support/linux/99-xorg-sysfs.rules
@@ -27,3 +27,12 @@ ACTION=="add|remove", \
 	SUBSYSTEM=="drm", \
 	SUBSYSTEMS=="platform", \
 	RUN+="/usr/sbin/x11sysfsconf $env{ACTION} $env{DEVPATH}"
+
+# HyperV graphics devices
+ACTION=="add|remove", \
+	KERNEL=="card[0-9]", \
+	SUBSYSTEM=="drm", \
+	SUBSYSTEMS=="vmbus", \
+	KERNELS=="5620e0c7-8062-4dce-aeb7-520c7ef76171", \
+	DRIVERS=="hyperv_drm", \
+	RUN+="/usr/sbin/x11sysfsconf $env{ACTION} $env{DEVPATH}"
--
2.34.0

