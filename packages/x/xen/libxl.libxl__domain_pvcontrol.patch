References: bsc#1161480

Fix xl shutdown for HVM without PV drivers

A return value of zero means no PV drivers. Restore the hunk which was removed.

Fixes commit b183e180bce93037d3ef385a8c2338bbfb7f23d9

Signed-off-by: Olaf Hering <olaf@aepfle.de>
---
 tools/libxl/libxl_domain.c | 3 +++
 1 file changed, 3 insertions(+)

--- a/tools/libxl/libxl_domain.c
+++ b/tools/libxl/libxl_domain.c
@@ -765,24 +765,27 @@ char * libxl__domain_pvcontrol_read(libxl__gc *gc, xs_transaction_t t,
 
 int libxl__domain_pvcontrol(libxl__egc *egc, libxl__xswait_state *pvcontrol,
                             domid_t domid, const char *cmd)
 {
     STATE_AO_GC(pvcontrol->ao);
     const char *shutdown_path;
     int rc;
 
     rc = libxl__domain_pvcontrol_available(gc, domid);
     if (rc < 0)
         return rc;
 
+    if (!rc)
+        return ERROR_NOPARAVIRT;
+
     shutdown_path = libxl__domain_pvcontrol_xspath(gc, domid);
     if (!shutdown_path)
         return ERROR_FAIL;
 
     rc = libxl__xs_printf(gc, XBT_NULL, shutdown_path, "%s", cmd);
     if (rc)
         return rc;
 
     pvcontrol->path = shutdown_path;
     pvcontrol->what = GCSPRINTF("guest acknowledgement of %s request", cmd);
     pvcontrol->timeout_ms = 60 * 1000;
     rc = libxl__xswait_start(gc, pvcontrol);
