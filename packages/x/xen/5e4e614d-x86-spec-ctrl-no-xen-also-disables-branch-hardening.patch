# Commit e6ca7afcf2ddeb72beade853ccd6fa3332210014
# Date 2020-02-20 11:37:01 +0100
# Author Jan Beulich <jbeulich@suse.com>
# Committer Jan Beulich <jbeulich@suse.com>
x86: "spec-ctrl=no-xen" should also disable branch hardening

This is controlling Xen behavior alone, after all.

Reported-by: Jin Nan Wang <jnwang@suse.com>
Signed-off-by: Jan Beulich <jbeulich@suse.com>
Acked-by: Andrew Cooper <andrew.cooper3@citrix.com>

--- a/xen/arch/x86/spec_ctrl.c
+++ b/xen/arch/x86/spec_ctrl.c
@@ -97,8 +97,6 @@ static int __init parse_spec_ctrl(const
             if ( opt_pv_l1tf_domu < 0 )
                 opt_pv_l1tf_domu = 0;
 
-            opt_branch_harden = false;
-
             if ( opt_tsx == -1 )
                 opt_tsx = -3;
 
@@ -113,6 +111,7 @@ static int __init parse_spec_ctrl(const
             opt_ibpb = false;
             opt_ssbd = false;
             opt_l1d_flush = 0;
+            opt_branch_harden = false;
         }
         else if ( val > 0 )
             rc = -EINVAL;
