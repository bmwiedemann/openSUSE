From 34ee4dad896f9f82131a090293c3a9ccaa77b729 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fridrich=20=C5=A0trba?= <fridrich.strba@bluewin.ch>
Date: Sun, 8 May 2022 15:19:45 +0200
Subject: [PATCH 2/2] --module-path not allowed with release=8

---
 .../fedoraproject/xmvn/mojo/JavadocMojo.java  | 49 +++++++++----------
 1 file changed, 24 insertions(+), 25 deletions(-)

diff --git a/xmvn-mojo/src/main/java/org/fedoraproject/xmvn/mojo/JavadocMojo.java b/xmvn-mojo/src/main/java/org/fedoraproject/xmvn/mojo/JavadocMojo.java
index 68d097f5..480b0f0a 100644
--- a/xmvn-mojo/src/main/java/org/fedoraproject/xmvn/mojo/JavadocMojo.java
+++ b/xmvn-mojo/src/main/java/org/fedoraproject/xmvn/mojo/JavadocMojo.java
@@ -227,35 +227,12 @@ public class JavadocMojo
             populateClasspath( reactorClassPath, fullClassPath );
             boolean isModular = !findFiles( reactorClassPath, "module-info\\.class" ).isEmpty();
 
-            if ( !isModular )
-            {
-                opts.add( "-classpath" );
-            }
-            else
-            {
-                opts.add( "--module-path" );
-            }
-            opts.add( quoted( StringUtils.join( fullClassPath.iterator(), ":" ) ) );
-            opts.add( "-encoding" );
-            opts.add( quoted( encoding ) );
-            opts.add( "-sourcepath" );
-            opts.add( quoted( StringUtils.join( sourcePaths.iterator(), ":" ) ) );
-            opts.add( "-charset" );
-            opts.add( quoted( docencoding ) );
-            opts.add( "-d" );
-            opts.add( quoted( outputDir ) );
-            opts.add( "-docencoding" );
-            opts.add( quoted( docencoding ) );
-            opts.add( "-doctitle" );
-            opts.add( quoted( "Javadoc for package XXX" ) );
-
             String sourceLevel = null;
-            if ( release != null && isModular )
+            if ( release != null )
             {
                 opts.add( "--release" );
                 opts.add( quoted( release ) );
                 sourceLevel = release;
-
             }
             else if ( source != null )
             {
@@ -265,7 +242,7 @@ public class JavadocMojo
             }
 
             boolean skipModuleInfo = !isModular;
-            if ( sourceLevel != null && !skipModuleInfo )
+            if ( sourceLevel != null )
             {
                 try
                 {
@@ -279,6 +256,28 @@ public class JavadocMojo
                 }
             }
 
+            if ( !isModular || skipModuleInfo )
+            {
+                opts.add( "-classpath" );
+            }
+            else
+            {
+                opts.add( "--module-path" );
+            }
+            opts.add( quoted( StringUtils.join( fullClassPath.iterator(), ":" ) ) );
+            opts.add( "-encoding" );
+            opts.add( quoted( encoding ) );
+            opts.add( "-sourcepath" );
+            opts.add( quoted( StringUtils.join( sourcePaths.iterator(), ":" ) ) );
+            opts.add( "-charset" );
+            opts.add( quoted( docencoding ) );
+            opts.add( "-d" );
+            opts.add( quoted( outputDir ) );
+            opts.add( "-docencoding" );
+            opts.add( quoted( docencoding ) );
+            opts.add( "-doctitle" );
+            opts.add( quoted( "Javadoc for package XXX" ) );
+
             for ( Path file : sourceFiles )
             {
                 if ( !skipModuleInfo || !file.endsWith( "module-info.java" ) )
-- 
2.36.0

