From 76716169e3fe95b14c75b5571717b148b524909c Mon Sep 17 00:00:00 2001
From: Daike Yu <yu.daike@suse.com>
Date: Mon, 7 Nov 2022 18:27:07 +0800
Subject: [PATCH] Update pamdir_suse to accommodate with TW pam.d move
References: bsc#1203468
Upstream: submitted

On newer builds of openSUSE tumbleweed the path of pam.d has moved from
/usr/etc/pam.d to /usr/lib/pam.d, which prevents install script to
correctly guess pam rules. Updating path in mkpamrules solves the
problem.
---
 instfiles/pam.d/mkpamrules | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/instfiles/pam.d/mkpamrules b/instfiles/pam.d/mkpamrules
index 989a52f4..230d92be 100755
--- a/instfiles/pam.d/mkpamrules
+++ b/instfiles/pam.d/mkpamrules
@@ -8,7 +8,11 @@ outfile="$3"
 
 service="xrdp-sesman"
 pamdir="/etc/pam.d"
-pamdir_suse="/usr/etc/pam.d"
+pamdir_suse="/usr/lib/pam.d"
+if [ ! -d $pamdir_suse ]; then
+   # Older SUSE distros uses /usr/etc/pam.d
+   pamdir_suse="/usr/etc/pam.d"
+fi
 
 # Modules needed by xrdp-sesman.unix, if we get to that
 unix_modules_needed="pam_unix.so pam_env.so pam_nologin.so"
-- 
2.35.3

