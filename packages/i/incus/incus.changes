-------------------------------------------------------------------
Fri Dec 13 07:07:01 UTC 2024 - Johannes Kastl <opensuse_buildservice@ojkastl.de>

- update to 6.8:
  * exec: Consume websocket pings for stderr by @stefanor in #1380
  * incus-simplestreams: Add prune command by @presztak in #1381
  * internal/instance: Fix validation of volatile.cpu.nodes by
    @stgraber in #1394
  * Add a function to clone map and use it where appropriate by
    @montag451 in #1397
  * cgo/process_utils: fix 32bit builds by @brauner in #1398
  * Start using goimports by @stgraber in #1399
  * instance/config: Mark user keys as live updatable by @stgraber
    in #1404
  * incus/internal/server/instance/drivers/: Fix incorrect Vars
    file mapping in edk2 driver by @cmspam in #1406
  * zfs: load keys for encrypted datasets during pool import by
    @cyphar in #1384
  * incusd/instance: Lock image access by @stgraber in #1408
  * incus/image: Make use of server-side alias handling by
    @stgraber in #1409
  * incusd/cluster: Validate cluster HTTPS address on join too by
    @stgraber in #1411
  * Remove metadata info from space usage calculation by @presztak
    in #1417
  * Add ability to set the initial owner of a custom volume by
    @presztak in #1415
  * Allow local live-migration between storage pools by @presztak
    in #1410
  * incus: Add aliases completion by @montag451 in #1385
  * golangci: Add local prefixes for goimports by @breml in #1401
  * client: invalidate simple streams cache by @breml in #1424
  * incusd/instances_post: Fix cluster internal migrations by
    @stgraber in #1427
  * Fix DHCP client keeping container up by @stgraber in #1430
  * Add support for VGA console screenshots by @breml in #1431
  * Add --reuse to incus image import by @presztak in #1428
  * Fix random ETag values due to map ordering by @stgraber in
    #1432
  * incusd/task: Fix wait group logic (more entries than running
    tasks) by @stgraber in #1433
  * Allow setting aliases during raw image upload by @stgraber in
    #1434
  * Fixes an issue when copying a custom volume using the --refresh
    flag by @presztak in #1437
  * Openfga improvements by @stgraber in #1435
  * doc/instance/properties: Add missing instance properties by
    @stgraber in #1439
  * incusd/daemon_storage: Ensure corect symlinks for
    images/backups by @stgraber in #1441
  * incusd/storage/lvm: Handle newer LVM by @stgraber in #1442
  * Tweak rendering of manpage in doc by @stgraber in #1443
  * incusd/storage/lvm: Require 512-bytes physical block size for
    VM images by @stgraber in #1444
  * incusd: Fill ExpiryDate and remove LastUsedDate in
    volumeSnapshotToProtobuf by @presztak in #1448
  * incusd/device/tpm: Wait for swtpm to be ready by @stgraber in
    #1447
  * incus: Improve completion for file push and file pull by
    @montag451 in #1445
  * incusd/auth/tls: Restrict config access to non-admin by
    @stgraber in #1451
  * incusd/storage: Handle default disk size in GetInstanceUsage by
    @stgraber in #1452
  * incus: Improve completion for some file sub-commmands by
    @montag451 in #1453
  * incus: Fix completion for profile copy by @montag451 in #1454
  * incus: Add completion for image alias subcommands by @montag451
    in #1457
  * doc/installing: Update Fedora instructions by @stgraber in
    #1456
  * Fix gap in validation of pre-existing certificates when
    switching to PKI mode by @stgraber in #1458
  * doc/network_forwards: Split configuration into own table by
    @stgraber in #1460
  * chore: Happy path on the left, early return by @breml in #1461
  * incus: Fix completion for image alias create by @montag451 in
    #1459
  * incus/top: Ignore CPU idle time by @stgraber in #1462
  * incus: Display the alias expansion when execution of an alias
    fails by @montag451 in #1464
  * lint: disallow restricted licenses in go-licenses by @breml in
    #1466
  * chore: code structure, Go identifier shaddowing by @breml in
    #1465
  * incus: Fix alias arguments handling by @montag451 in #1463
  * incus/file/push Use SFTP client instead of file API by
    @HassanAlsamahi in #1468
  * Fix TPM fd leaks and OpenFGA patching issue by @stgraber in
    #1469
  * Clarify device override syntax by @stgraber in #1471
  * incusd/auth/openfga: refresh model before applying patches by
    @stgraber in #1472
  * Add authorization scriptlet by @bensmrs in #1412
  * doc: add openSUSE installation instructions by @cyphar in #1475
  * OCI image debugging improvements by @danbiagini in #1478
  * Add function checks to scriptlet validation by @bensmrs in
    #1484
  * incus/project: Fix handling of default (unset) project in
    get-current by @irhndt in #1476
  * Translations update from Hosted Weblate by @weblate in #1492
  * Add --force flag to the console command by @presztak in #1491
  * Accept io.Writer in RenderTable by @breml in #1490
  * doc/network_bridge: Fix missing escaping around variable by
    @irhndt in #1493
  * incusd/cluster: Skip project restrictions during join by
    @stgraber in #1497
  * incusd/instance/lxc: Skip instances without idmap allocation
    yet by @stgraber in #1495
  * incusd/storage/drivers/common: Truncate/Discard ahead of sparse
    write by @stgraber in #1496
  * Add AskPassword/AskPasswordOnce to Asker by @breml in #1499
  * Add additional check to Cancel method for ConsoleShow operation
    by @presztak in #1500
  * Improve console disconnections by @stgraber in #1501
  * Fix duplicate OVN load-balancer entries by @stgraber in #1502
  * Improve SFTP performance by @stgraber in #1503
  * incusd/instance_post: Expand profiles in scriptlet context by
    @stgraber in #1504
- remove patches:
  * 0001-incusd-storage-zfs-Fix-deletion-of-unavailable-pools.patch
  * 0002-zfs-load-keys-for-encrypted-datasets-during-pool-imp.patch

-------------------------------------------------------------------
Fri Nov 22 13:36:58 UTC 2024 - Aleksa Sarai <asarai@suse.com>

- Remove the incus.sysctl drop-in file. This setting file overlaps with lxd's
  sysctl settings, and setting these sysctls on boot even if you aren't running
  containers is suboptimal.

  We could come up with a complicated scheme for loading the rules once Incus
  starts, as suggested in bsc#1233410, but ultimately these settings are only
  really useful for production servers with >100 containers, at which point
  admins are expected to tune their servers anyway.

  So we can just remove it.

-------------------------------------------------------------------
Fri Nov 22 13:31:58 UTC 2024 - Aleksa Sarai <asarai@suse.com>

- Backport patches to fix encrypted ZFS datasets having their keys be unloaded
  on Incus daemon restarts. <https://github.com/lxc/incus/pull/1384>
  + 0001-incusd-storage-zfs-Fix-deletion-of-unavailable-pools.patch
  + 0002-zfs-load-keys-for-encrypted-datasets-during-pool-imp.patch

-------------------------------------------------------------------
Fri Nov 21 15:24:17 UTC 2024 - Charles Miller <charlesmillerspam@gmail.com>

- Fix secureboot VMs by switching to passing the correct environment variable
  (INCUS_EDK2_PATH) and updating the ovmf symlinks to point to the correct
  blobs. There is an upstream bug here, so we will need to fix this again later
  once <https://github.com/lxc/incus/pull/1406> is merged.

-------------------------------------------------------------------
Fri Nov 15 18:53:50 UTC 2024 - Jeff Kowalczyk <jkowalczyk@suse.com>

- Update to version 6.7:
  * fix live update VM's limits.memory configuration when use a percentage value #1287
  * fix: fix slice init length #1285
  * incusd/instance/lxc: Remove restrictions on /run #1288
  * Correct macvlan mode names #1284
  * Translations update from Hosted Weblate #1290
  * Translations update from Hosted Weblate #1295
  * Translations update from Hosted Weblate #1304
  * incus-simplestreams: Fix list -f json #1310
  * Profile performance improvements #1314
  * incus-agent: Add timeout for DNS query #1313
  * incusd/instance/qemu: Don't fail on console retrival issue #1316
  * Allow changing the parent value on physical networks #1317
  * incus: Fix display of current project in projects list #1318
  * Add --format to incus admin sql #1319
  * incusd/internal/server/instance/drivers: support for Chimera Linux (qemu/edk2) pkg layout #1298
  * incusd/instance/common: Cleanup volatile on device add failure #1323
  * incusd/network/bgp: Only advertise networks with BGP configuration #1325
  * Make revert library shared #1326
  * Fix to the cluster resources caching mechanism #1324
  * Fix idmap issues #1327
  * Make ask library shared #1329
  * doc/network/resolved: Add disabling DNSSEC and DNSOverTLS #1328
  * Add some application container documentation #1331
  * incusd/device/nic/bridged: Handle invalid configuration #1330
  * Fix handling of custom volume snapshot patterns #1333
  * Add OCI DHCP renewal #1334
  * doc/installing: Update for Chimera Linux #1335
  * shared/cgo: Don't use strlcpy #1337
  * Implement incus webui #1338
  * incusd/scriptlet: Make set_target fail with invalid members #1339
  * Export QMP functions #1340
  * incusd/network/ovn: Add support to ipv4.dhcp.ranges #1341
  * internal/server: Log QMP interaction to a file #1345
  * incusd/instance/qemu: Log QEMU command line #1346
  * Improve cluster instance placement #1344
  * incusd/instance_logs: Update log file list #1347
  * Add infrastructure for OVN events #1349
  * Fix QEMU feature checks during startup #1350
  * incusd/instance/lxc: Fix LXCFS per-instance path #1352
  * doc/idmap: Clarify subuid/subgid configuration #1353
  * incusd/instance/qmp: Fix logging with no log file #1355
  * Add a GetOIDCTokens() method #1357
  * Add get-current to show current project #1356
  * incus/file/create: Use SFTP client instead of file API #1354
  * internal/instance: Allow 0 as value to limits.cpu.nodes #1358
  * Translations update from Hosted Weblate #1361
  * Translations update from Hosted Weblate #1362
  * Translations update from Hosted Weblate #1368
  * Improve agent interface listing performance #1367
  * Make incus top output configurable through options #1370
  * Automatic live-migration to balance load on cluster #1369
  * gomod: Update dependencies #1372
  * Add refresh-exclude-older flag to only transfer new snapshots during instance/volume refresh #1365
  * incusd/instances/publish: Fix base metadata #1374
  * Fix TPM with long instance names #1377
  * Don't BGP advertise OVN load-balancers when all backends are offline #1376
  * incusd/instance/qemu: Don't take over operations on console retrieval #1379
  * Tweak to cluster internal relocation #1378

-------------------------------------------------------------------
Thu Nov 14 13:31:11 UTC 2024 - Aleksa Sarai <asarai@suse.com>

- Move some binaries to sbin to match upstream packaging recommendations.
- Update VM-related dependencies to make VMs work properly.

-------------------------------------------------------------------
Wed Oct 23 10:11:25 UTC 2024 - Aleksa Sarai <asarai@suse.com>

- Fix %_libexecdir usage for Leap 15.x (Leap 15.x still uses /usr/lib, so we
  need to replace the usage of /usr/libexec in our scripts with a token that we
  can replace during build).

-------------------------------------------------------------------
Mon Oct 21 05:02:17 UTC 2024 - Aleksa Sarai <asarai@suse.com>

- Rework packaging to match recommended packaging from doc/packaging.md and
  <https://github.com/zabbly/incus/tree/stable/systemd>.

-------------------------------------------------------------------
Fri Oct 18 11:33:24 UTC 2024 - Aleksa Sarai <asarai@suse.com>

- Package Incus 6.6, based on the LXD 5.21 package. The primary differences are
  that we no longer need to do ELF patching to work around having a custom
  sqlite fork (instead we can use libcowsql, which is packaged for openSUSE
  already).
