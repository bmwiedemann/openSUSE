From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bj=C3=B6rn=20Bidar?= <bjorn.bidar@thaodan.de>
Date: Thu, 19 Oct 2023 23:21:50 +0300
Subject: [PATCH] Add install targets for libgit and libegit2
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

There is no standard directory for dynamic modules to be installed in.
If the target system uses a different path DYNMODDRIR has to be reset
during build.

Signed-off-by: Bj√∂rn Bidar <bjorn.bidar@thaodan.de>
---
 Makefile | 24 +++++++++++++++++++++++-
 1 file changed, 23 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index 6a6a4e1ce9584fb95048e8160e42bd70dcad6196..ff1d8e8de5985195429f35b5dfb9775c56f05222 100644
--- a/Makefile
+++ b/Makefile
@@ -1,3 +1,11 @@
+DESTDIR     ?=
+PREFIX      ?= /usr
+DATADIR     ?= $(PREFIX)/share
+BINDIR      ?= $(PREFIX)/bin
+LIBDIR      ?= $(PREFIX)/lib
+ELDIR       ?= $(DATADIR)/emacs/site-lisp
+DYNMODDRIR  ?= $(LIBDIR)/emacs/site-lisp
+
 BUILD_OPTIONS=-DCMAKE_BUILD_TYPE=Debug
 
 ifeq '$(findstring ;,$(PATH))' ';'
@@ -54,7 +62,7 @@ EMACS_ARGS ?=
 
 LOAD_PATH  ?= -L . -L build
 
-.PHONY: test libgit2 submodule-update
+.PHONY: test libgit2 submodule-update install
 
 all: lisp
 
@@ -135,3 +143,17 @@ $(PKG)-autoloads.el: $(ELS)
 	(update-directory-autoloads default-directory))"
 
 endif
+
+install-%-dynamic-module:
+	$(if $<, install -m755 -d $(DESTDIR)$(DYNMODDRIR))
+	$(if $<, install -m755 $^ $(DESTDIR)$(DYNMODDRIR))
+
+install-%-el:
+	$(if $<, install -m755 -d $(DESTDIR)$(ELDIR))
+	$(if $<, install -m644 $^ $(DESTDIR)$(ELDIR))
+
+install: $(addprefix install-, libgit-el libgit-dynamic-module)
+
+install-libgit-el: $(ELS) $(ELCS) $(PKG)-autoloads.el
+
+install-libgit-dynamic-module: build/libegit2.so
