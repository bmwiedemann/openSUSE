From da84b74848d192308ac968d38d2b6d3e7bfc2a43 Mon Sep 17 00:00:00 2001
From: Jasem Mutlaq <mutlaqja@ikarustech.com>
Date: Thu, 13 May 2021 23:07:37 +0300
Subject: [PATCH 1/2] iOptron DST fix. Bump iOptron version to 1.4

---
 drivers.xml                     | 8 ++++----
 drivers/telescope/ioptronv3.cpp | 6 +++++-
 2 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/drivers.xml b/drivers.xml
index c68b693c..0802dac9 100644
--- a/drivers.xml
+++ b/drivers.xml
@@ -155,19 +155,19 @@
         </device>
         <device label="iOptron CEM26" manufacturer="iOptron">
             <driver name="iOptronV3">indi_ioptronv3_telescope</driver>
-            <version>1.3</version>
+            <version>1.4</version>
         </device>
         <device label="iOptron GEM28" manufacturer="iOptron">
             <driver name="iOptronV3">indi_ioptronv3_telescope</driver>
-            <version>1.3</version>
+            <version>1.4</version>
         </device>
         <device label="iOptron CEM40" manufacturer="iOptron">
             <driver name="iOptronV3">indi_ioptronv3_telescope</driver>
-            <version>1.3</version>
+            <version>1.4</version>
         </device>
         <device label="iOptron GEM45" manufacturer="iOptron">
             <driver name="iOptronV3">indi_ioptronv3_telescope</driver>
-            <version>1.3</version>
+            <version>1.4</version>
         </device>
         <device label="iOptron iEQ45 Pro" manufacturer="iOptron">
             <driver name="iEQ">indi_ieq_telescope</driver>
diff --git a/drivers/telescope/ioptronv3.cpp b/drivers/telescope/ioptronv3.cpp
index 5f31b576..ce95458b 100644
--- a/drivers/telescope/ioptronv3.cpp
+++ b/drivers/telescope/ioptronv3.cpp
@@ -81,7 +81,7 @@ void ISSnoopDevice(XMLEle *root)
 /* Constructor */
 IOptronV3::IOptronV3()
 {
-    setVersion(1, 3);
+    setVersion(1, 4);
 
     driver.reset(new Driver(getDeviceName()));
 
@@ -340,6 +340,10 @@ void IOptronV3::getStartupData()
 
         // UTC Offset
         char offset[8] = {0};
+        // 2021-05-12 JM: Account for daylight savings
+        if (dayLightSavings)
+            utcOffsetMinutes += 60;
+
         snprintf(offset, 8, "%.2f", utcOffsetMinutes / 60.0);
         IUSaveText(&TimeT[1], offset);
         LOGF_INFO("Mount UTC Offset: %s", offset);
-- 
2.31.1


From 39a7b9076a80d3ad314953734abefdfcc9dc8403 Mon Sep 17 00:00:00 2001
From: Jasem Mutlaq <mutlaqja@ikarustech.com>
Date: Fri, 14 May 2021 14:59:50 +0300
Subject: [PATCH 2/2] Update version for rest of iOptronv3 drivers

---
 drivers.xml | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers.xml b/drivers.xml
index 0802dac9..4efd67af 100644
--- a/drivers.xml
+++ b/drivers.xml
@@ -207,15 +207,15 @@
         </device>
         <device label="iOptron v3" manufacturer="iOptron">
             <driver name="iOptronV3">indi_ioptronv3_telescope</driver>
-            <version>1.3</version>
+            <version>1.4</version>
         </device>
         <device label="iOptron CEM120" manufacturer="iOptron">
             <driver name="iOptronV3">indi_ioptronv3_telescope</driver>
-            <version>1.3</version>
+            <version>1.4</version>
         </device>
         <device label="iOptron CEM70" manufacturer="iOptron">
             <driver name="iOptronV3">indi_ioptronv3_telescope</driver>
-            <version>1.3</version>
+            <version>1.4</version>
         </device>
         <device label="Pulsar2">
             <driver name="Pulsar2">indi_lx200pulsar2</driver>
-- 
2.31.1

