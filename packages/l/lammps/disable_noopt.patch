From afd769314b67d9614e70d80c4e8fade41b367899 Mon Sep 17 00:00:00 2001
From: Axel Kohlmeyer <akohlmey@gmail.com>
Date: Sun, 10 May 2020 14:06:56 -0400
Subject: [PATCH] define _noopt macro with -D_FORTIFY_SOURCE to be empty to
 avoid false positives

---
 src/lmptype.h | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/src/lmptype.h b/src/lmptype.h
index 5c19ab7483..1513fe5782 100644
--- a/src/lmptype.h
+++ b/src/lmptype.h
@@ -206,10 +206,13 @@ typedef int bigint;
 #define _noalias
 #endif
 
-// declaration to turn off optimization for specific functions
-// and avoid compiler warnings about variable tracking
+// Declaration to turn off optimization for specific noncritical
+// functions and avoid compiler warnings about variable tracking.
+// Disable for broken -D_FORTIFY_SOURCE feature.
 
-#if defined(__clang__)
+#if defined(_FORTIFY_SOURCE) && (_FORTIFY_SOURCE > 0)
+#define _noopt
+#elif defined(__clang__)
 #  define _noopt __attribute__((optnone))
 #elif defined(__INTEL_COMPILER)
 #  define _noopt
