From f30f345eece6802aa63d641193d2a3b7a7d77286 Mon Sep 17 00:00:00 2001
From: Andy Buckley <andy.buckley@cern.ch>
Date: Wed, 24 Aug 2022 09:31:44 +0100
Subject: [PATCH] Python build fix

---
 wrappers/python/Makefile.am |  4 ++--
 wrappers/python/build.py.in | 25 +------------------------
 2 files changed, 3 insertions(+), 26 deletions(-)

Index: LHAPDF-6.5.2/wrappers/python/Makefile.am
===================================================================
--- LHAPDF-6.5.2.orig/wrappers/python/Makefile.am
+++ LHAPDF-6.5.2/wrappers/python/Makefile.am
@@ -30,7 +30,7 @@ PYEXT_ENV = CC="$(CXX)" CXX="$(CXX)" CFL
 
 all-local: fix-out-of-source
 	@test "${FORCE}" = 1 && touch lhapdf.pyx || true
-	$(PYEXT_ENV) $(PYTHON) build.py
+	$(PYEXT_ENV) LHAPDF_LOCAL=1 $(PYTHON) build.py
 
 install-exec-local:
 	$(MKDIR_P) $(DESTDIR)$(PYTHON_PATH)/ && \
Index: LHAPDF-6.5.2/wrappers/python/build.py.in
===================================================================
--- LHAPDF-6.5.2.orig/wrappers/python/build.py.in
+++ LHAPDF-6.5.2/wrappers/python/build.py.in
@@ -26,7 +26,7 @@ incargs += " @CPPFLAGS@"
 cmpargs = ""  #"@PYEXT_CXXFLAGS@"
 
 ## Link args -- base on install-prefix, or on local lib dirs for pre-install build
-linkargs = " -L@abs_top_builddir@/src/.libs" if "RIVET_LOCAL" in os.environ else "-L@prefix@/lib"
+linkargs = " -L@abs_top_builddir@/src/.libs" if "LHAPDF_LOCAL" in os.environ else "-L@prefix@/lib"
 
 ## Library args
 libraries = ["stdc++", "LHAPDF"]
@@ -74,26 +74,3 @@ for pyfile in glob("@srcdir@/*.py"):
 ## Run the extension compilation in the build dir
 import subprocess
 subprocess.call(compile_cmd.split(), cwd="@abs_builddir@/build/lhapdf")
-
-
-
-# ## Configure the C++ extension
-# ext = Extension("lhapdf",
-#                 ["lhapdf.cpp"],
-#                 include_dirs=[incdir_src, incdir_build],
-#                 extra_compile_args=["-I@prefix@/include"],
-#                 library_dirs=[libdir],
-#                 language="C++",
-#                 libraries=["stdc++", "LHAPDF"])
-
-# ## Configure the Python package
-# setup(name="LHAPDF",
-#       version="@PACKAGE_VERSION@",
-#       description="The LHAPDF parton density evaluation library",
-#       author="LHAPDF Collaboration",
-#       author_email="lhapdf-dev@cern.ch",
-#       url="https://lhapdf.hepforge.org/",
-#       long_description="",
-#       long_description_content_type="text/plain",
-#       license="GPLv3",
-#       ext_modules=[ext])
