diff -Naur FreeFileSync_11.4_Source_orig/FreeFileSync/Source/Makefile FreeFileSync_11.4_Source/FreeFileSync/Source/Makefile
--- FreeFileSync_11.4_Source_orig/FreeFileSync/Source/Makefile	2020-12-05 14:38:38.000000000 +0100
+++ FreeFileSync_11.4_Source/FreeFileSync/Source/Makefile	2020-12-11 09:24:39.418116342 +0100
@@ -2,9 +2,9 @@
 
 cxxFlags = -std=c++2a -pipe -DWXINTL_NO_GETTEXT_MACRO -I../.. -I../../zenXml -include "zen/i18n.h" -include "zen/warn_static.h" \
            -Wall -Wfatal-errors -Wmissing-include-dirs -Wswitch-enum -Wcast-align -Wnon-virtual-dtor -Wno-unused-function -Wshadow -Wno-maybe-uninitialized \
-           -O3 -DNDEBUG `wx-config --cxxflags --debug=no` -pthread
+           -O3 -DNDEBUG `wx-config --cxxflags --debug=no` -pthread -fpie
 
-linkFlags = -s -no-pie `wx-config --libs std, aui, richtext --debug=no` -pthread
+linkFlags = -s `wx-config --libs std, aui, richtext --debug=no` -pthread -lz -pie
 
 
 cxxFlags  += `pkg-config --cflags openssl`
@@ -16,9 +16,10 @@
 cxxFlags  += `pkg-config --cflags libssh2`
 linkFlags += `pkg-config --libs   libssh2`
 
-cxxFlags  += `pkg-config --cflags gtk+-2.0`
+cxxFlags  += `pkg-config --cflags gtk+-3.0`
+linkFlags += `pkg-config --libs   gtk+-3.0`
 #treat as system headers so that warnings are hidden:
-cxxFlags  += -isystem/usr/include/gtk-2.0
+cxxFlags  += -isystem/usr/include/gtk-3.0
 
 #support for SELinux (optional)
 SELINUX_EXISTING=$(shell pkg-config --exists libselinux && echo YES)
diff -Naur FreeFileSync_11.4_Source_orig/FreeFileSync/Source/RealTimeSync/Makefile FreeFileSync_11.4_Source/FreeFileSync/Source/RealTimeSync/Makefile
--- FreeFileSync_11.4_Source_orig/FreeFileSync/Source/RealTimeSync/Makefile	2020-12-05 14:38:38.000000000 +0100
+++ FreeFileSync_11.4_Source/FreeFileSync/Source/RealTimeSync/Makefile	2020-12-11 09:19:38.287288344 +0100
@@ -2,14 +2,15 @@
 
 cxxFlags = -std=c++2a -pipe -DWXINTL_NO_GETTEXT_MACRO -I../../.. -I../../../zenXml -include "zen/i18n.h" -include "zen/warn_static.h" \
            -Wall -Wfatal-errors -Wmissing-include-dirs -Wswitch-enum -Wcast-align -Wnon-virtual-dtor -Wno-unused-function -Wshadow -Wno-maybe-uninitialized \
-           -O3 -DNDEBUG `wx-config --cxxflags --debug=no` -pthread
+           -O3 -DNDEBUG `wx-config --cxxflags --debug=no` -pthread -fpie
 
-linkFlags = -s -no-pie `wx-config --libs std, aui, richtext --debug=no` -pthread
+linkFlags = -s `wx-config --libs std, aui, richtext --debug=no` -pthread -lz -pie
 
 #Gtk - support "no button border"
-cxxFlags  += `pkg-config --cflags gtk+-2.0`
+cxxFlags  += `pkg-config --cflags gtk+-3.0`
+linkFlags += `pkg-config --libs   gtk+-3.0`
 #treat as system headers so that warnings are hidden:
-cxxFlags  += -isystem/usr/include/gtk-2.0
+cxxFlags  += -isystem/usr/include/gtk-3.0
 
 cppFiles=
 cppFiles+=application.cpp
diff -Naur FreeFileSync_11.4_Source_orig/libssh2/libssh2_wrap.h FreeFileSync_11.4_Source/libssh2/libssh2_wrap.h
--- FreeFileSync_11.4_Source_orig/libssh2/libssh2_wrap.h	2020-12-05 14:38:38.000000000 +0100
+++ FreeFileSync_11.4_Source/libssh2/libssh2_wrap.h	2020-12-11 09:17:38.447774909 +0100
@@ -20,6 +20,22 @@
     #error libssh2_sftp.h header guard changed
 #endif
 
+// fix some build errors
+/* MAX_SFTP_READ_SIZE is how much data is asked for at max in each FXP_READ
+ * packets.
+ */
+#ifndef MAX_SFTP_READ_SIZE
+    #define MAX_SFTP_READ_SIZE 30000
+#endif
+
+/*
+ * MAX_SFTP_OUTGOING_SIZE MUST not be larger than 32500 or so. This is the
+ * amount of data sent in each FXP_WRITE packet
+ */
+#ifndef MAX_SFTP_OUTGOING_SIZE
+    #define MAX_SFTP_OUTGOING_SIZE 30000
+#endif
+
 //fix libssh2 64-bit warning mess: https://github.com/libssh2/libssh2/pull/96
 #undef libssh2_userauth_password
 inline int libssh2_userauth_password(LIBSSH2_SESSION* session, const std::string& username, const std::string& password)
diff -Naur FreeFileSync_11.4_Source_orig/zen/ring_buffer.h FreeFileSync_11.4_Source/zen/ring_buffer.h
--- FreeFileSync_11.4_Source_orig/zen/ring_buffer.h	2020-12-05 14:38:38.000000000 +0100
+++ FreeFileSync_11.4_Source/zen/ring_buffer.h	2020-12-11 09:16:43.519997924 +0100
@@ -8,6 +8,7 @@
 #define RING_BUFFER_H_01238467085684139453534
 
 #include <cassert>
+#include <cstddef>
 #include "scope_guard.h"
 
 
