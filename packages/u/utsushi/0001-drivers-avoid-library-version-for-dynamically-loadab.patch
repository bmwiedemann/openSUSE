From 7fe816a87d01d9584140916d8cc5c0553b85e4ad Mon Sep 17 00:00:00 2001
Message-Id: <7fe816a87d01d9584140916d8cc5c0553b85e4ad.1604302260.git.maciek.borzecki@gmail.com>
From: Maciek Borzecki <maciek.borzecki@gmail.com>
Date: Mon, 2 Nov 2020 08:29:41 +0100
Subject: [PATCH] drivers: avoid library version for dynamically loadable
 drivers

The drivers are loaded dynamically at runtime and always match the actual
package. No need to have libdrv-*.so.0.0.0 scattered arround in
$libexecdir/utsushi.

Signed-off-by: Maciek Borzecki <maciek.borzecki@gmail.com>
---
 drivers/Makefile.am      | 1 +
 drivers/esci/Makefile.am | 1 +
 2 files changed, 2 insertions(+)

diff --git a/drivers/Makefile.am b/drivers/Makefile.am
index 282eaa3b00a09cbf10fa1de1668ad93f076d1069..dbccc9fc760c45dcb2338b0e792308cbe229c13a 100644
--- a/drivers/Makefile.am
+++ b/drivers/Makefile.am
@@ -29,6 +29,7 @@ driverdatadir   = $(pkgsysconfdir)
 driver_ldflags  = $(AM_LDFLAGS)
 driver_ldflags += -export-dynamic
 driver_ldflags += -export-symbols-regex libdrv_$(driver)_LTX_scanner_factory
+driver_ldflags += -module -avoid-version
 
 driverlib_LTLIBRARIES = libdrv-combo.la
 
diff --git a/drivers/esci/Makefile.am b/drivers/esci/Makefile.am
index 09becc8611048099c80df0671e73d65b02e25ac3..49e35021de992dede805b430ae498cddde8c64da 100644
--- a/drivers/esci/Makefile.am
+++ b/drivers/esci/Makefile.am
@@ -38,6 +38,7 @@ driverdatadir   = $(pkgdatadir)/drivers/esci
 driver_ldflags  = $(AM_LDFLAGS)
 driver_ldflags += -export-dynamic
 driver_ldflags += -export-symbols-regex libdrv_$(driver)_LTX_scanner_factory
+driver_ldflags += -module -avoid-version
 
 driverlib_LTLIBRARIES = libdrv-esci.la
 
-- 
2.29.1
