From a366296785aa1020b8ebfdbb0f9713bc7fea3d3d Mon Sep 17 00:00:00 2001
From: theGreatWhiteShark <princess.trudildis@posteo.de>
Date: Wed, 12 Apr 2023 20:24:05 +0200
Subject: [PATCH] AE: fix beat&bar calc in pattern mode

fixes #1741
---
 src/core/AudioEngine/AudioEngine.cpp | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/src/core/AudioEngine/AudioEngine.cpp b/src/core/AudioEngine/AudioEngine.cpp
index 989930bc3..ea9e7d27b 100644
--- a/src/core/AudioEngine/AudioEngine.cpp
+++ b/src/core/AudioEngine/AudioEngine.cpp
@@ -470,15 +470,17 @@ void AudioEngine::updateTransportPosition( double fTick, long long nFrame, std::
 
 	updateBpmAndTickSize( pPos );
 
+
 	// Beat - Bar (- Tick) information is a coarse grained position
 	// information and might not change on small position increments.
 	bool bBBTChanged = false;
-	if ( pPos->getColumn() + 1 != pPos->getBar() ) {
-		pPos->setBar( pPos->getColumn() + 1 );
+	const int nBar = std::max( pPos->getColumn(), 0 ) + 1;
+	if ( nBar != pPos->getBar() ) {
+		pPos->setBar( nBar );
 		bBBTChanged = true;
 	}
 
-	int nBeat = static_cast<int>(
+	const int nBeat = static_cast<int>(
 		std::floor(static_cast<float>(pPos->getPatternTickPosition()) /  48 )) + 1;
 	if ( pPos->getBeat() != nBeat ) {
 		pPos->setBeat( nBeat );
