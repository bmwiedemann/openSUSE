From 4cfdad9d9b8344d9f871dba7a0201d54d1565833 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jaime=20Marqui=CC=81nez=20Ferra=CC=81ndiz?=
 <jaime.marquinez.ferrandiz@fastmail.net>
Date: Fri, 25 Feb 2022 17:42:27 +0100
Subject: [PATCH] Disable the JIT tests on arm architectures
Upstream: submitted
References: gh#HaxeFoundation/hashlink#521

---
 CMakeLists.txt | 25 ++++++++++++++++---------
 1 file changed, 16 insertions(+), 9 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 01c00142e..454634655 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -267,15 +267,22 @@ if(BUILD_TESTING)
     #####################
     # Tests
 
-    add_test(NAME hello.hl
-        COMMAND hl ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/test/hello.hl
-    )
-    add_test(NAME threads.hl
-        COMMAND hl ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/test/threads.hl
-    )
-    add_test(NAME uvsample.hl
-        COMMAND hl ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/test/uvsample.hl
-    )
+    set(JIT_TEST_ENABLED TRUE)
+    if(CMAKE_SYSTEM_PROCESSOR MATCHES "arm|aarch64")
+        set(JIT_TEST_ENABLED FALSE)
+    endif()
+
+    if(JIT_TEST_ENABLED)
+        add_test(NAME hello.hl
+            COMMAND hl ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/test/hello.hl
+        )
+        add_test(NAME threads.hl
+            COMMAND hl ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/test/threads.hl
+        )
+        add_test(NAME uvsample.hl
+            COMMAND hl ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/test/uvsample.hl
+        )
+    endif()
     add_test(NAME hello
         COMMAND hello
     )
