commit 2edd63a0dbd445112db23596ee0128521e8f1ff5
Author: Jiri Denemark <jdenemar@redhat.com>
Date:   Wed Aug 5 10:01:45 2020 +0200

    util: Fix logic in virFileSetCOW
    
    When COW is not explicitly requested to be disabled or enabled, the
    function is supposed to do nothing on non-BTRFS file systems.
    
    Fixes commit 7230bc95aa78379c9ee20cf59394c5fc4305b75b.
    
    https://bugzilla.redhat.com/show_bug.cgi?id=1866157
    
    Signed-off-by: Jiri Denemark <jdenemar@redhat.com>
    Reviewed-by: Daniel P. Berrang√© <berrange@redhat.com>

Index: libvirt-6.6.0/src/util/virfile.c
===================================================================
--- libvirt-6.6.0.orig/src/util/virfile.c
+++ libvirt-6.6.0/src/util/virfile.c
@@ -4550,7 +4550,7 @@ virFileSetCOW(const char *path,
     }
 
     if (buf.f_type != BTRFS_SUPER_MAGIC) {
-        if (state == VIR_TRISTATE_BOOL_ABSENT) {
+        if (state != VIR_TRISTATE_BOOL_ABSENT) {
             virReportSystemError(ENOSYS,
                                  _("unable to control COW flag on '%s', not btrfs"),
                                  path);
