From 1189650fe97193ef5d1259053c11e7f1883690e1 Mon Sep 17 00:00:00 2001
From: Luigi Baldoni <aloisio@gmx.com>
Date: Mon, 3 Jun 2019 08:51:04 +0200
Subject: [PATCH] Add pkgconfig support to cmake as well

---
 CMakeLists.txt        |  1 +
 quazip.pc.cmakein     | 12 ++++++++++++
 quazip/CMakeLists.txt | 10 +++++++++-
 3 files changed, 22 insertions(+), 1 deletion(-)
 create mode 100644 quazip.pc.cmakein

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 6fcdd95..571204a 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -55,6 +55,7 @@ set(LIBRARY_OUTPUT_PATH ${CMAKE_BINARY_DIR})
 
 set(LIB_SUFFIX "" CACHE STRING "Define suffix of directory name (32/64)")
 set(LIB_DESTINATION "${CMAKE_INSTALL_PREFIX}/lib${LIB_SUFFIX}" CACHE STRING "Library directory name" FORCE)
+set(INSTALL_PKGCONFIG_DIR "${CMAKE_INSTALL_PREFIX}/lib${LIB_SUFFIX}/pkgconfig" CACHE STRING "Installation directory for pkgconfig (.pc) files" FORCE)
 set(QUAZIP_LIB_TARGET_NAME quazip${QUAZIP_LIB_VERSION_SUFFIX} CACHE
     INTERNAL "Target name of libquazip" FORCE)
 
diff --git a/quazip.pc.cmakein b/quazip.pc.cmakein
new file mode 100644
index 0000000..48a3e11
--- /dev/null
+++ b/quazip.pc.cmakein
@@ -0,0 +1,12 @@
+prefix=@CMAKE_INSTALL_PREFIX@
+exec_prefix=${prefix}
+libdir=${prefix}/lib@LIB_SUFFIX@
+includedir=${prefix}/include
+
+
+Name: Quazip
+Description: Quazip Library
+Version: @QUAZIP_LIB_VERSION@
+Libs: -lquazip
+Cflags:
+Requires: Qt5Core
diff --git a/quazip/CMakeLists.txt b/quazip/CMakeLists.txt
index abcdcf7..4beacfb 100644
--- a/quazip/CMakeLists.txt
+++ b/quazip/CMakeLists.txt
@@ -8,6 +8,9 @@ include_directories(
 file(GLOB SRCS "*.c" "*.cpp")
 file(GLOB PUBLIC_HEADERS "*.h")
 
+set(QUAZIP_LIB_VERSION 1.0.0)
+set(QUAZIP_LIB_SOVERSION 1)
+
 # Must be added to enable export macro
 ADD_DEFINITIONS(-DQUAZIP_BUILD)
 
@@ -23,10 +26,15 @@ if (NOT WIN32)
 	set_target_properties(quazip_static PROPERTIES OUTPUT_NAME quazip${QUAZIP_LIB_VERSION_SUFFIX})
 endif ()
 
-set_target_properties(${QUAZIP_LIB_TARGET_NAME} quazip_static PROPERTIES VERSION 1.0.0 SOVERSION 1 DEBUG_POSTFIX d)
+set_target_properties(${QUAZIP_LIB_TARGET_NAME} quazip_static PROPERTIES VERSION ${QUAZIP_LIB_VERSION} SOVERSION ${QUAZIP_LIB_SOVERSION} DEBUG_POSTFIX d)
 # Link against ZLIB_LIBRARIES if needed (on Windows this variable is empty)
 target_link_libraries(${QUAZIP_LIB_TARGET_NAME} ${QT_QTMAIN_LIBRARY} ${QTCORE_LIBRARIES} ${ZLIB_LIBRARIES})
 target_link_libraries(quazip_static ${QT_QTMAIN_LIBRARY} ${QTCORE_LIBRARIES} ${ZLIB_LIBRARIES})
 
+if(UNIX AND NOT APPLE)
+	configure_file( ${CMAKE_SOURCE_DIR}/quazip.pc.cmakein
+			${CMAKE_BINARY_DIR}/quazip.pc @ONLY)
+	install(FILES ${CMAKE_BINARY_DIR}/quazip.pc DESTINATION "${INSTALL_PKGCONFIG_DIR}")
+endif()
 install(FILES ${PUBLIC_HEADERS} DESTINATION include/quazip${QUAZIP_LIB_VERSION_SUFFIX})
 install(TARGETS ${QUAZIP_LIB_TARGET_NAME} quazip_static LIBRARY DESTINATION ${LIB_DESTINATION} ARCHIVE DESTINATION ${LIB_DESTINATION} RUNTIME DESTINATION ${LIB_DESTINATION})
From b9c1fd7795530ef37dcdaa8e798df8e2932aaf22 Mon Sep 17 00:00:00 2001
From: Luigi Baldoni <aloisio@gmx.com>
Date: Mon, 3 Jun 2019 19:56:39 +0200
Subject: [PATCH] Add version suffix to library name to be linked

---
 quazip.pc.cmakein | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/quazip.pc.cmakein b/quazip.pc.cmakein
index 48a3e11..e46d4c6 100644
--- a/quazip.pc.cmakein
+++ b/quazip.pc.cmakein
@@ -7,6 +7,6 @@ includedir=${prefix}/include
 Name: Quazip
 Description: Quazip Library
 Version: @QUAZIP_LIB_VERSION@
-Libs: -lquazip
+Libs: -lquazip@QUAZIP_LIB_VERSION_SUFFIX@
 Cflags:
 Requires: Qt5Core
