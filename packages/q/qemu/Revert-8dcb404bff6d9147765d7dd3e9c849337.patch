From: Dario Faggioli <dfaggioli@suse.com>
Date: Tue, 24 May 2022 20:52:17 +0200
Subject: Revert 8dcb404bff6d9147765d7dd3e9c8493372186420

Git-commit: 0000000000000000000000000000000000000000

Revert commit "tests/qtest: enable more vhost-user tests by default"
(8dcb404bff6d9), as it causes prooblem when building with GCC 12 and LTO
enabled.

This should be considered temporary, until the actual reason why the
code of the tests that are added in that commit breaks.

It has been reported upstream, and will be (hopefully) solved there:
https://lore.kernel.org/qemu-devel/1d3bbff9e92e7c8a24db9e140dcf3f428c2df103.camel@suse.com/

Signed-off-by: Dario Faggioli <dfaggioli@suse.com>
---
 tests/qtest/vhost-user-test.c | 21 ++++++++++++---------
 1 file changed, 12 insertions(+), 9 deletions(-)

diff --git a/tests/qtest/vhost-user-test.c b/tests/qtest/vhost-user-test.c
index ee30f54796485e1fb2cab1fe7641..6e79935c47e6f7fab9741cdf9e50 100644
--- a/tests/qtest/vhost-user-test.c
+++ b/tests/qtest/vhost-user-test.c
@@ -995,17 +995,20 @@ static void register_vhost_user_test(void)
                  "virtio-net",
                  test_migrate, &opts);
 
-    opts.before = vhost_user_test_setup_reconnect;
-    qos_add_test("vhost-user/reconnect", "virtio-net",
-                 test_reconnect, &opts);
+    /* keeps failing on build-system since Aug 15 2017 */
+    if (getenv("QTEST_VHOST_USER_FIXME")) {
+        opts.before = vhost_user_test_setup_reconnect;
+        qos_add_test("vhost-user/reconnect", "virtio-net",
+                     test_reconnect, &opts);
 
-    opts.before = vhost_user_test_setup_connect_fail;
-    qos_add_test("vhost-user/connect-fail", "virtio-net",
-                 test_vhost_user_started, &opts);
+        opts.before = vhost_user_test_setup_connect_fail;
+        qos_add_test("vhost-user/connect-fail", "virtio-net",
+                     test_vhost_user_started, &opts);
 
-    opts.before = vhost_user_test_setup_flags_mismatch;
-    qos_add_test("vhost-user/flags-mismatch", "virtio-net",
-                 test_vhost_user_started, &opts);
+        opts.before = vhost_user_test_setup_flags_mismatch;
+        qos_add_test("vhost-user/flags-mismatch", "virtio-net",
+                     test_vhost_user_started, &opts);
+    }
 
     opts.before = vhost_user_test_setup_multiqueue;
     opts.edge.extra_device_opts = "mq=on";
