From e95c53e9b4ab58666aed16dff1bb90962ee0f24a Mon Sep 17 00:00:00 2001
From: Andreas Stieger <Andreas.Stieger@gmx.de>
Date: Thu, 8 Sep 2022 22:26:47 +0200
Subject: [PATCH] Fix tests with GNU grep 3.8
References: https://bugzilla.opensuse.org/show_bug.cgi?id=1203231

Adapted from https://github.com/qpdf/qpdf/pull/761

Index: qpdf-10.6.3/build-scripts/build-doc
===================================================================
--- qpdf-10.6.3.orig/build-scripts/build-doc
+++ qpdf-10.6.3/build-scripts/build-doc
@@ -10,7 +10,7 @@ pip3 install sphinx sphinx_rtd_theme
 ./configure --enable-doc-maintenance
 make -j$(nproc) doc-dist DOC_DEST=doc
 zip -r doc.zip doc
-version=$(egrep '^release' manual/conf.py | cut -d"'" -f 2)
+version=$(grep -E '^release' manual/conf.py | cut -d"'" -f 2)
 mv doc qpdf-${version}-doc
 mkdir distribution
 zip -r distribution/qpdf-${version}-doc.zip qpdf-${version}-doc
Index: qpdf-10.6.3/qpdf/qtest/qpdf/diff-encrypted
===================================================================
--- qpdf-10.6.3.orig/qpdf/qtest/qpdf/diff-encrypted
+++ qpdf-10.6.3/qpdf/qtest/qpdf/diff-encrypted
@@ -1,5 +1,5 @@
 #!/bin/sh
-lines=$(expr 0 + $(diff "$1" "$2" | egrep '^[<>]' | egrep -v '(Date|InstanceID)' | wc -l))
+lines=$(expr 0 + $(diff "$1" "$2" | grep -E '^[<>]' | grep -E -v '(Date|InstanceID)' | wc -l))
 if [ "$lines" = "0" ]; then
    echo okay
 else
Index: qpdf-10.6.3/qpdf/qtest/qpdf/diff-ignore-ID-version
===================================================================
--- qpdf-10.6.3.orig/qpdf/qtest/qpdf/diff-ignore-ID-version
+++ qpdf-10.6.3/qpdf/qtest/qpdf/diff-ignore-ID-version
@@ -1,6 +1,6 @@
 #!/bin/sh
-lines=$(expr 0 + $(diff "$1" "$2" | egrep '^[<>]' | \
-        egrep -v '/ID' | egrep -v '%PDF-' | wc -l))
+lines=$(expr 0 + $(diff "$1" "$2" | grep -E '^[<>]' | \
+        grep -E -v '/ID' | grep -E -v '%PDF-' | wc -l))
 if [ "$lines" = "0" ]; then
    echo okay
 else
