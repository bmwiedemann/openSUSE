From ece624ec76c93c28bfcc47037bed4fc4e232ef4f Mon Sep 17 00:00:00 2001
From: Osmo Salomaa <otsaloma@iki.fi>
Date: Fri, 16 Aug 2019 20:32:00 +0300
Subject: [PATCH] Fix CSS error with the abnormal weight of the Unscii font

---
 TODO.md         | 4 ++++
 nfoview/util.py | 4 +++-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/TODO.md b/TODO.md
index e69de29..c64e371 100644
--- a/TODO.md
+++ b/TODO.md
@@ -0,0 +1,4 @@
+NFO Viewer 1.27.1/1.28
+======================
+
+* [x] Fix CSS error with the abnormal weight of the Unscii font
diff --git a/nfoview/util.py b/nfoview/util.py
index b29b63b..2cbad3d 100644
--- a/nfoview/util.py
+++ b/nfoview/util.py
@@ -52,7 +52,9 @@ def apply_style(widget):
         family=font_desc.get_family().split(",")[0],
         size=int(round(font_desc.get_size() / Pango.SCALE)),
         unit=unit,
-        weight=int(font_desc.get_weight()),
+        # Round weight to hundreds to work around CSS errors
+        # with weird weights such as Unscii's 101.
+        weight=round(font_desc.get_weight(), -2),
     )
     css = css.replace("font-size: 0{unit};".format(unit=unit), "")
     css = css.replace("font-weight: 0;", "")

