From 6eea56674442b884a4fee6ede4c8aad63541aa5b Mon Sep 17 00:00:00 2001
From: Gabor Melis <mega@retes.hu>
Date: Sun, 9 Nov 2025 18:20:21 +0100
Subject: [PATCH] unbreak after SBCL internals change

---
 src/cruft.lisp | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/cruft.lisp b/src/cruft.lisp
index 01f9783..9b43cbd 100644
--- orig/_build/named-readtables/src/cruft.lisp
+++ orig/_build/named-readtables/src/cruft.lisp
@@ -231,7 +231,11 @@
                      (grovel-unicode-chars)
                      (let ((reader-fn (svref char-macro-array char-code))
                            (char (code-char (shiftf char-code (1+ char-code)))))
-                       (if reader-fn
+                       ;; In older SBCL, READER-FN may be NIL. Since
+                       ;; commit 00eabf5 ("Make a few mostly-stylistic
+                       ;; tweaks to macro char reading"), this is 0
+                       ;; instead.
+                       (if (and reader-fn (not (eql reader-fn 0)))
                            (yield char)
                            (grovel-base-chars)))))
                (grovel-unicode-chars ()
