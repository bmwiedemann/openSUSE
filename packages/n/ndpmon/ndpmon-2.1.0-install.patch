--- a/src/ndpmon_defs.h.in
+++ b/src/ndpmon_defs.h.in
@@ -12,7 +12,7 @@
 #define _CACHE_DTD_PATH_ "@VARDATADIR@/ndpmon/neighbor_list.dtd"
 /* #define _DISCOVERY_HISTORY_PATH_ "@VARDATADIR@/ndpmon/discovery_history.dat" */
 #define _DISCOVERY_HISTORY_PATH_ "@VARDATADIR@/ndpmon/"
-#define _MANUF_PATH_ "@prefix@/lib/ndpmon/src/plugins/mac_resolv/manuf"
+#define _MANUF_PATH_ "@prefix@/lib/ndpmon/plugins/mac_resolv/manuf"
 #ifdef _WEBINTERFACE_
 #define _WEBINTERFACE_PATH_ "@WEBDIR@"
 #endif
--- a/Makefile.in
+++ b/Makefile.in
@@ -7,25 +7,24 @@ FLAGS=-Wall -pedantic @CFLAGS@ @OPTIONS@
 CC=@CC@
 LIB=@LIBS@
 MAKE_PLUGINS=@MAKE_PLUGINS@
+INSTALL=@INSTALL@
 all: ./bin/ndpmon
 
-prefix=@prefix@/lib
+prefix=@prefix@
 exec_prefix=@prefix@
 datadir=@datadir@
 confdir=@sysconfdir@
 datadir=@datadir@
 localstatedir=@localstatedir@
+sysconfdir=@sysconfdir@
 
-INSTALL_DIR=${prefix}/ndpmon
 MAN_DIR=@MANDIR@
 BINARY_DIR=@sbindir@
-confprefix=@CONFDIR@
-CONF_DIR=$(confprefix)/ndpmon
-# By default, ndpmon is installed in /usr/local
-# variable data thus go to /var/local and not /usr/local/share
-#DATA_DIR=${datadir}/ndpmon
-dataprefix=@VARDATADIR@
-DATA_DIR=$(dataprefix)/ndpmon
+CONF_DIR=${sysconfdir}/ndpmon
+DATA_DIR=${datadir}/ndpmon
+SCRIPT_DIR=${prefix}/lib/ndpmon
+PLUGIN_DIR=${SCRIPT_DIR}/plugins
+VAR_DATA_DIR=${localstatedir}/lib/ndpmon
 WEBDIR=@WEBDIR@
 INSTALL_PLUGINS=@INSTALL_PLUGINS@
 UNINSTALL_PLUGINS=@UNINSTALL_PLUGINS@
@@ -36,41 +35,39 @@ SYSLOGFILTERING=@SYSLOGFILTERING@
 # ------------------------------
 
 install: ./bin/ndpmon
-	# Copy the source and objects to the INSTALL_DIR
-	mkdir -p $(INSTALL_DIR)
-	cp -r src $(INSTALL_DIR)
-	cp -r doc $(INSTALL_DIR)
-	cp ./install/demopipeprogram.pl.sample $(INSTALL_DIR)
-	cp ./install/alerts_to_xml.py $(INSTALL_DIR)
-	chmod +x $(INSTALL_DIR)/alerts_to_xml.py
+	$(INSTALL) -D -m 0755 ./install/alerts_to_xml.py $(DESTDIR)$(SCRIPT_DIR)/alerts_to_xml.py
+	$(INSTALL) -d -m 0755 $(DESTDIR)$(PLUGIN_DIR)/countermeasures
+	$(INSTALL) -m 0644 src/plugins/countermeasures/*.dox $(DESTDIR)$(PLUGIN_DIR)/countermeasures
+	$(INSTALL) -d -m 0755 $(DESTDIR)$(PLUGIN_DIR)/mac_resolv
+	$(INSTALL) -m 0644 src/plugins/mac_resolv/README $(DESTDIR)$(PLUGIN_DIR)/mac_resolv
+	$(INSTALL) -d -m 0755 $(DESTDIR)$(PLUGIN_DIR)/rules
+	$(INSTALL) -m 0644 src/plugins/rules/*.dox $(DESTDIR)$(PLUGIN_DIR)/rules
 
 	# Copy the XML and DTD of the configuration to the CONF_DIR
-	mkdir -p $(CONF_DIR)
-	cp ./install/config_ndpmon.xml $(CONF_DIR)
-	cp ./install/config_ndpmon.dtd $(CONF_DIR)
+	$(INSTALL) -d -m 0755 $(DESTDIR)$(CONF_DIR)
+	$(INSTALL) -m 0644 install/config_ndpmon.xml $(DESTDIR)$(CONF_DIR)
+	$(INSTALL) -m 0644 install/config_ndpmon.dtd $(DESTDIR)$(CONF_DIR)
 
 	# Copy the XML and DTD of the neighbor cache to the DATA_DIR
-	mkdir -p $(DATA_DIR)
-	cp ./install/neighbor_list.xml $(DATA_DIR)
-	cp ./install/neighbor_list.dtd $(DATA_DIR)
-	cp ./install/alerts.xml $(DATA_DIR)
-	
+	$(INSTALL) -d -m 0755 $(DESTDIR)$(VAR_DATA_DIR)
+	$(INSTALL) -m 0644 install/neighbor_list.xml $(DESTDIR)$(VAR_DATA_DIR)
+	$(INSTALL) -m 0644 install/neighbor_list.dtd $(DESTDIR)$(VAR_DATA_DIR)
+	$(INSTALL) -m 0644 install/alerts.xml $(DESTDIR)$(VAR_DATA_DIR)
+
 	# Copy the manpage to the MAN_DIR
-	mkdir -p $(MAN_DIR)
-	mkdir -p $(MAN_DIR)
-	cp ./install/ndpmon.8 $(MAN_DIR)
+	$(INSTALL) -D -m 0644 install/ndpmon.8 $(DESTDIR)$(MAN_DIR)/ndpmon.8
 
 	# Copy the binary to BINARY_DIR
-	mkdir -p $(BINARY_DIR)
-	mkdir -p $(BINARY_DIR)
-	cp ./bin/ndpmon $(BINARY_DIR)
-
-	# Linux Specific
-	cp ./install/ndpmon.sh /etc/init.d/ndpmon
-	chmod +x /etc/init.d/ndpmon
+	$(INSTALL) -D -m 0755 bin/ndpmon $(DESTDIR)$(BINARY_DIR)/ndpmon
 
-	#plugin specific
-	$(INSTALL_PLUGINS)
+	# Install web interface
+	$(INSTALL) -d -m 0755 $(DESTDIR)$(WEBDIR)
+	$(INSTALL) -m 0644 src/plugins/webinterface/install/*.xsl $(DESTDIR)$(WEBDIR)
+	$(INSTALL) -m 0644 src/plugins/webinterface/install/*.css $(DESTDIR)$(WEBDIR)
+	$(INSTALL) -m 0644 src/plugins/webinterface/install/*.html $(DESTDIR)$(WEBDIR)
+	$(INSTALL) -d -m 0755 $(DESTDIR)$(WEBDIR)/img
+	$(INSTALL) -m 0644 src/plugins/webinterface/install/img/* $(DESTDIR)$(WEBDIR)/img
+	ln -sf $(CONF_DIR)/config_ndpmon.xml $(DESTDIR)$(WEBDIR)
 
 uninstall:
 	-rm -rf $(INSTALL_DIR)
@@ -117,79 +114,79 @@ doc_clean:
 # -------------------------
 
 ./bin/ndpmon: $(OBJ) make_plugins
-	$(CC) $(FLAGS) ./bin/*.o -o ./bin/ndpmon $(LIB)
+	$(CC) $(CFLAGS) $(FLAGS) ./bin/*.o -o ./bin/ndpmon $(LIB)
 
 ./bin/ndpmon.o: ./src/ndpmon.c ./src/ndpmon.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/ndpmon.c  -o ./bin/ndpmon.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/ndpmon.c  -o ./bin/ndpmon.o
 	
 ./bin/extensions.o: ./src/extensions.c ./src/extensions.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/extensions.c  -o ./bin/extensions.o	
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/extensions.c  -o ./bin/extensions.o	
 
 # ----
 # Core
 # ----
 
 ./bin/alerts.o: ./src/core/alerts.c ./src/core/alerts.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/core/alerts.c -o ./bin/alerts.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/core/alerts.c -o ./bin/alerts.o
 
 ./bin/capture.o: ./src/core/capture.c ./src/core/capture.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/core/capture.c -o ./bin/capture.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/core/capture.c -o ./bin/capture.o
 
 ./bin/events.o: ./src/core/events.c ./src/core/events.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/core/events.c -o ./bin/events.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/core/events.c -o ./bin/events.o
 	
 ./bin/extinfo.o: ./src/core/extinfo.c ./src/core/extinfo.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/core/extinfo.c -o ./bin/extinfo.o	
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/core/extinfo.c -o ./bin/extinfo.o	
 
 ./bin/neighbors.o: ./src/core/neighbors.c ./src/core/neighbors.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/core/neighbors.c -o ./bin/neighbors.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/core/neighbors.c -o ./bin/neighbors.o
 
 ./bin/parser.o: ./src/core/parser.c
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/core/parser.c  -o ./bin/parser.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/core/parser.c  -o ./bin/parser.o
 
 ./bin/print_packet_info.o: ./src/core/print_packet_info.c ./src/core/print_packet_info.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/core/print_packet_info.c  -o ./bin/print_packet_info.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/core/print_packet_info.c  -o ./bin/print_packet_info.o
 
 ./bin/probes.o: ./src/core/probes.c ./src/core/probes.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/core/probes.c  -o ./bin/probes.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/core/probes.c  -o ./bin/probes.o
 
 ./bin/settings.o: ./src/core/settings.c ./src/core/settings.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/core/settings.c -o ./bin/settings.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/core/settings.c -o ./bin/settings.o
 
 ./bin/routers.o: ./src/core/routers.c ./src/core/routers.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/core/routers.c -o ./bin/routers.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/core/routers.c -o ./bin/routers.o
 
 ./bin/watchers.o: ./src/core/watchers.c ./src/core/watchers.h
-	$(CC) $(FLAGS) -c ./src/core/watchers.c -o ./bin/watchers.o
+	$(CC) $(CFLAGS) $(FLAGS) -c ./src/core/watchers.c -o ./bin/watchers.o
 
 # -----------------
 # Capture functions
 # -----------------
 
 ./bin/capture_pcap.o: ./src/capture/capture_pcap.c ./src/capture/capture_pcap.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/capture/capture_pcap.c -o ./bin/capture_pcap.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/capture/capture_pcap.c -o ./bin/capture_pcap.o
 
 ./bin/capture_lnfq.o: ./src/capture/capture_lnfq.c ./src/capture/capture_lnfq.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/capture/capture_lnfq.c -o ./bin/capture_lnfq.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/capture/capture_lnfq.c -o ./bin/capture_lnfq.o
 
 # ---------------
 # Watch functions
 # ---------------
 
 ./bin/monitoring.o: ./src/watchers/monitoring.c ./src/watchers/monitoring.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/watchers/monitoring.c -o ./bin/monitoring.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/watchers/monitoring.c -o ./bin/monitoring.o
 
 ./bin/monitoring_ra.o: ./src/watchers/monitoring_ra.c ./src/watchers/monitoring_ra.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/watchers/monitoring_ra.c -o ./bin/monitoring_ra.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/watchers/monitoring_ra.c -o ./bin/monitoring_ra.o
 
 ./bin/monitoring_na.o: ./src/watchers/monitoring_na.c ./src/watchers/monitoring_na.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/watchers/monitoring_na.c -o ./bin/monitoring_na.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/watchers/monitoring_na.c -o ./bin/monitoring_na.o
 
 ./bin/monitoring_ns.o: ./src/watchers/monitoring_ns.c ./src/watchers/monitoring_ns.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/watchers/monitoring_ns.c -o ./bin/monitoring_ns.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/watchers/monitoring_ns.c -o ./bin/monitoring_ns.o
 
 ./bin/monitoring_rd.o: ./src/watchers/monitoring_rd.c ./src/watchers/monitoring_rd.h
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./src/watchers/monitoring_rd.c -o ./bin/monitoring_rd.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./src/watchers/monitoring_rd.c -o ./bin/monitoring_rd.o
 
 # -------
 # Plugins
--- a/configure.in
+++ b/configure.in
@@ -8,6 +8,7 @@ AC_PROG_CC
 AC_LANG_C
         
 AC_PROG_MAKE_SET
+AC_PROG_INSTALL
 
 dnl #####################################################
 dnl Set the directory for variable data
@@ -237,6 +238,13 @@ if test "$enable_lnfq" = "yes"; then
         CFLAGS="$CFLAGS -D_CAPTURE_USE_LNFQ_"
         AC_MSG_RESULT($found_lnfq)
     fi
+
+    AC_CHECK_PROG(iptables_found, ip6tables, [yes], [no])
+    if test $iptables_found = "no"; then
+	    if ! test -f "/sbin/ip6tables" ; then
+                AC_ERROR([The ip6tables program is required to set up the netfilter queue. Please install ip6tables.])
+	    fi
+    fi
 fi
 
 
@@ -264,13 +272,6 @@ if test "$enable_lnfq" != "yes"; then
         CFLAGS="$CFLAGS -D_CAPTURE_USE_PCAP_"
         AC_MSG_RESULT($found_pcap)
     fi
-    
-    AC_CHECK_PROG(iptables_found, ip6tables, [yes], [no])
-    if test $iptables_found = "no"; then
-	    if ! test -f "/sbin/ip6tables" ; then
-                AC_ERROR([The ip6tables program is required to set up the netfilter queue. Please install ip6tables.])
-	    fi
-    fi
 fi
 
 
@@ -313,26 +314,10 @@ dnl ####################################
 AC_ARG_ENABLE(mac-resolv, [--enable-mac-resolv	enable MAC Manufacturer Resolution [default=no]],enable_mac_resolv=yes)
 AC_MSG_CHECKING([for MAC Resolution])
 
-found_manuf=no
-
 if test "$enable_mac_resolv" = "yes"; then
 	PLUGINS="$PLUGINS ../../bin/mac_resolv.o"
 	OPTIONS="$OPTIONS -D_MACRESOLUTION_"
 	AC_MSG_RESULT([MAC Manufacturer Resolution activated.])
-
-	AC_MSG_CHECKING([for Wireshark manuf file])
-	AC_ARG_WITH([manuf], [--with-manuf=DIR	Find wireshark manuf file in DIR], [found_manuf=$withval])
-	for testdir in /usr/share/wireshark/manuf /usr/local/share/wireshark/manuf ; do
-		if test -f "${testdir}" -a $found_manuf = no ; then
-            		found_manuf=$testdir
-        	fi
-	done
-	if test "$found_manuf" = "no"; then
-		AC_ERROR([Error: Please install wireshark.]) 
-	else
-		AC_MSG_RESULT($found_manuf)
-		MANUF=$found_manuf
-	fi
 else
 	AC_MSG_RESULT([MAC Manufacturer Resolution NOT activated.])
 fi
@@ -454,16 +439,6 @@ if test "$enable_soap" = "yes"; then
     fi
 fi
 
-dnl #####################################################
-dnl Checks for the 'mail' program
-dnl #####################################################
-
-AC_CHECK_PROG(mail_found, mail, [yes], [no])
-
-if test $mail_found = "no"; then
-    AC_ERROR([The mail program is required to send NDPMon alerts. Please install bsd-mailx, or mailutils or a package containing /usr/bin/mail.])
-fi
-
 
 dnl #####################################################
 dnl            -- Conditional libraries --
--- a/src/plugins/Makefile.in
+++ b/src/plugins/Makefile.in
@@ -10,44 +10,41 @@ all: $(PLUGINS)
 # ---------------------
 
 ../../bin/mac_resolv.o: ./mac_resolv/mac_resolv.c
-	#./mac_resolv/make-manuf
-	-rm -f ./mac_resolv/manuf
-	ln -sf @MANUF@ ./mac_resolv/manuf
-	$(CC) $(FLAGS) `xml2-config  --cflags` -c ./mac_resolv/mac_resolv.c -o ../../bin/mac_resolv.o
+	$(CC) $(CFLAGS) $(FLAGS) `xml2-config  --cflags` -c ./mac_resolv/mac_resolv.c -o ../../bin/mac_resolv.o
 
 # ----------------------
 # Countermeasures Plugin
 # ----------------------
 
 ../../bin/countermeasures.o: ../../bin/icmp_lib.o ../../bin/icmp_lib_nd.o ./countermeasures/countermeasures.c
-	$(CC) $(FLAGS) -c ./countermeasures/countermeasures.c -o ../../bin/countermeasures.o
+	$(CC) $(CFLAGS) $(FLAGS) -c ./countermeasures/countermeasures.c -o ../../bin/countermeasures.o
 
 ../../bin/icmp_lib.o: ./countermeasures/icmp_lib.c
-	$(CC) $(FLAGS) -c ./countermeasures/icmp_lib.c -o ../../bin/icmp_lib.o
+	$(CC) $(CFLAGS) $(FLAGS) -c ./countermeasures/icmp_lib.c -o ../../bin/icmp_lib.o
 
 ../../bin/icmp_lib_nd.o: ./countermeasures/icmp_lib_nd.c
-	$(CC) $(FLAGS) -c ./countermeasures/icmp_lib_nd.c -o ../../bin/icmp_lib_nd.o
+	$(CC) $(CFLAGS) $(FLAGS) -c ./countermeasures/icmp_lib_nd.c -o ../../bin/icmp_lib_nd.o
 
 # -------------------
 # Webinterface Plugin
 # -------------------
 
 ../../bin/webinterface.o: ./webinterface/webinterface.c
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./webinterface/webinterface.c -o ../../bin/webinterface.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./webinterface/webinterface.c -o ../../bin/webinterface.o
 
 # ------------
 # Rules Plugin
 # ------------
 
 ../../bin/rules.o: ../../bin/rules_matches.o ./rules/rules.c
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./rules/rules.c -o ../../bin/rules.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./rules/rules.c -o ../../bin/rules.o
 
 ../../bin/rules_matches.o: ./rules/rules_matches.c
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./rules/rules_matches.c -o ../../bin/rules_matches.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./rules/rules_matches.c -o ../../bin/rules_matches.o
 	
 # ------------
 # Soap Plugin
 # ------------
 
 ../../bin/soap.o: ./soap/soap.c
-	$(CC) $(FLAGS) -c `xml2-config  --cflags` ./soap/soap.c -o ../../bin/soap.o
+	$(CC) $(CFLAGS) $(FLAGS) -c `xml2-config  --cflags` ./soap/soap.c -o ../../bin/soap.o
--- /dev/null
+++ b/install-sh
@@ -0,0 +1,527 @@
+#!/bin/sh
+# install - install a program, script, or datafile
+
+scriptversion=2011-01-19.21; # UTC
+
+# This originates from X11R5 (mit/util/scripts/install.sh), which was
+# later released in X11R6 (xc/config/util/install.sh) with the
+# following copyright and license.
+#
+# Copyright (C) 1994 X Consortium
+#
+# Permission is hereby granted, free of charge, to any person obtaining a copy
+# of this software and associated documentation files (the "Software"), to
+# deal in the Software without restriction, including without limitation the
+# rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
+# sell copies of the Software, and to permit persons to whom the Software is
+# furnished to do so, subject to the following conditions:
+#
+# The above copyright notice and this permission notice shall be included in
+# all copies or substantial portions of the Software.
+#
+# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+# X CONSORTIUM BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+# AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNEC-
+# TION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+#
+# Except as contained in this notice, the name of the X Consortium shall not
+# be used in advertising or otherwise to promote the sale, use or other deal-
+# ings in this Software without prior written authorization from the X Consor-
+# tium.
+#
+#
+# FSF changes to this file are in the public domain.
+#
+# Calling this script install-sh is preferred over install.sh, to prevent
+# `make' implicit rules from creating a file called install from it
+# when there is no Makefile.
+#
+# This script is compatible with the BSD install script, but was written
+# from scratch.
+
+nl='
+'
+IFS=" ""	$nl"
+
+# set DOITPROG to echo to test this script
+
+# Don't use :- since 4.3BSD and earlier shells don't like it.
+doit=${DOITPROG-}
+if test -z "$doit"; then
+  doit_exec=exec
+else
+  doit_exec=$doit
+fi
+
+# Put in absolute file names if you don't have them in your path;
+# or use environment vars.
+
+chgrpprog=${CHGRPPROG-chgrp}
+chmodprog=${CHMODPROG-chmod}
+chownprog=${CHOWNPROG-chown}
+cmpprog=${CMPPROG-cmp}
+cpprog=${CPPROG-cp}
+mkdirprog=${MKDIRPROG-mkdir}
+mvprog=${MVPROG-mv}
+rmprog=${RMPROG-rm}
+stripprog=${STRIPPROG-strip}
+
+posix_glob='?'
+initialize_posix_glob='
+  test "$posix_glob" != "?" || {
+    if (set -f) 2>/dev/null; then
+      posix_glob=
+    else
+      posix_glob=:
+    fi
+  }
+'
+
+posix_mkdir=
+
+# Desired mode of installed file.
+mode=0755
+
+chgrpcmd=
+chmodcmd=$chmodprog
+chowncmd=
+mvcmd=$mvprog
+rmcmd="$rmprog -f"
+stripcmd=
+
+src=
+dst=
+dir_arg=
+dst_arg=
+
+copy_on_change=false
+no_target_directory=
+
+usage="\
+Usage: $0 [OPTION]... [-T] SRCFILE DSTFILE
+   or: $0 [OPTION]... SRCFILES... DIRECTORY
+   or: $0 [OPTION]... -t DIRECTORY SRCFILES...
+   or: $0 [OPTION]... -d DIRECTORIES...
+
+In the 1st form, copy SRCFILE to DSTFILE.
+In the 2nd and 3rd, copy all SRCFILES to DIRECTORY.
+In the 4th, create DIRECTORIES.
+
+Options:
+     --help     display this help and exit.
+     --version  display version info and exit.
+
+  -c            (ignored)
+  -C            install only if different (preserve the last data modification time)
+  -d            create directories instead of installing files.
+  -g GROUP      $chgrpprog installed files to GROUP.
+  -m MODE       $chmodprog installed files to MODE.
+  -o USER       $chownprog installed files to USER.
+  -s            $stripprog installed files.
+  -t DIRECTORY  install into DIRECTORY.
+  -T            report an error if DSTFILE is a directory.
+
+Environment variables override the default commands:
+  CHGRPPROG CHMODPROG CHOWNPROG CMPPROG CPPROG MKDIRPROG MVPROG
+  RMPROG STRIPPROG
+"
+
+while test $# -ne 0; do
+  case $1 in
+    -c) ;;
+
+    -C) copy_on_change=true;;
+
+    -d) dir_arg=true;;
+
+    -g) chgrpcmd="$chgrpprog $2"
+	shift;;
+
+    --help) echo "$usage"; exit $?;;
+
+    -m) mode=$2
+	case $mode in
+	  *' '* | *'	'* | *'
+'*	  | *'*'* | *'?'* | *'['*)
+	    echo "$0: invalid mode: $mode" >&2
+	    exit 1;;
+	esac
+	shift;;
+
+    -o) chowncmd="$chownprog $2"
+	shift;;
+
+    -s) stripcmd=$stripprog;;
+
+    -t) dst_arg=$2
+	# Protect names problematic for `test' and other utilities.
+	case $dst_arg in
+	  -* | [=\(\)!]) dst_arg=./$dst_arg;;
+	esac
+	shift;;
+
+    -T) no_target_directory=true;;
+
+    --version) echo "$0 $scriptversion"; exit $?;;
+
+    --)	shift
+	break;;
+
+    -*)	echo "$0: invalid option: $1" >&2
+	exit 1;;
+
+    *)  break;;
+  esac
+  shift
+done
+
+if test $# -ne 0 && test -z "$dir_arg$dst_arg"; then
+  # When -d is used, all remaining arguments are directories to create.
+  # When -t is used, the destination is already specified.
+  # Otherwise, the last argument is the destination.  Remove it from $@.
+  for arg
+  do
+    if test -n "$dst_arg"; then
+      # $@ is not empty: it contains at least $arg.
+      set fnord "$@" "$dst_arg"
+      shift # fnord
+    fi
+    shift # arg
+    dst_arg=$arg
+    # Protect names problematic for `test' and other utilities.
+    case $dst_arg in
+      -* | [=\(\)!]) dst_arg=./$dst_arg;;
+    esac
+  done
+fi
+
+if test $# -eq 0; then
+  if test -z "$dir_arg"; then
+    echo "$0: no input file specified." >&2
+    exit 1
+  fi
+  # It's OK to call `install-sh -d' without argument.
+  # This can happen when creating conditional directories.
+  exit 0
+fi
+
+if test -z "$dir_arg"; then
+  do_exit='(exit $ret); exit $ret'
+  trap "ret=129; $do_exit" 1
+  trap "ret=130; $do_exit" 2
+  trap "ret=141; $do_exit" 13
+  trap "ret=143; $do_exit" 15
+
+  # Set umask so as not to create temps with too-generous modes.
+  # However, 'strip' requires both read and write access to temps.
+  case $mode in
+    # Optimize common cases.
+    *644) cp_umask=133;;
+    *755) cp_umask=22;;
+
+    *[0-7])
+      if test -z "$stripcmd"; then
+	u_plus_rw=
+      else
+	u_plus_rw='% 200'
+      fi
+      cp_umask=`expr '(' 777 - $mode % 1000 ')' $u_plus_rw`;;
+    *)
+      if test -z "$stripcmd"; then
+	u_plus_rw=
+      else
+	u_plus_rw=,u+rw
+      fi
+      cp_umask=$mode$u_plus_rw;;
+  esac
+fi
+
+for src
+do
+  # Protect names problematic for `test' and other utilities.
+  case $src in
+    -* | [=\(\)!]) src=./$src;;
+  esac
+
+  if test -n "$dir_arg"; then
+    dst=$src
+    dstdir=$dst
+    test -d "$dstdir"
+    dstdir_status=$?
+  else
+
+    # Waiting for this to be detected by the "$cpprog $src $dsttmp" command
+    # might cause directories to be created, which would be especially bad
+    # if $src (and thus $dsttmp) contains '*'.
+    if test ! -f "$src" && test ! -d "$src"; then
+      echo "$0: $src does not exist." >&2
+      exit 1
+    fi
+
+    if test -z "$dst_arg"; then
+      echo "$0: no destination specified." >&2
+      exit 1
+    fi
+    dst=$dst_arg
+
+    # If destination is a directory, append the input filename; won't work
+    # if double slashes aren't ignored.
+    if test -d "$dst"; then
+      if test -n "$no_target_directory"; then
+	echo "$0: $dst_arg: Is a directory" >&2
+	exit 1
+      fi
+      dstdir=$dst
+      dst=$dstdir/`basename "$src"`
+      dstdir_status=0
+    else
+      # Prefer dirname, but fall back on a substitute if dirname fails.
+      dstdir=`
+	(dirname "$dst") 2>/dev/null ||
+	expr X"$dst" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	     X"$dst" : 'X\(//\)[^/]' \| \
+	     X"$dst" : 'X\(//\)$' \| \
+	     X"$dst" : 'X\(/\)' \| . 2>/dev/null ||
+	echo X"$dst" |
+	    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+		   s//\1/
+		   q
+		 }
+		 /^X\(\/\/\)[^/].*/{
+		   s//\1/
+		   q
+		 }
+		 /^X\(\/\/\)$/{
+		   s//\1/
+		   q
+		 }
+		 /^X\(\/\).*/{
+		   s//\1/
+		   q
+		 }
+		 s/.*/./; q'
+      `
+
+      test -d "$dstdir"
+      dstdir_status=$?
+    fi
+  fi
+
+  obsolete_mkdir_used=false
+
+  if test $dstdir_status != 0; then
+    case $posix_mkdir in
+      '')
+	# Create intermediate dirs using mode 755 as modified by the umask.
+	# This is like FreeBSD 'install' as of 1997-10-28.
+	umask=`umask`
+	case $stripcmd.$umask in
+	  # Optimize common cases.
+	  *[2367][2367]) mkdir_umask=$umask;;
+	  .*0[02][02] | .[02][02] | .[02]) mkdir_umask=22;;
+
+	  *[0-7])
+	    mkdir_umask=`expr $umask + 22 \
+	      - $umask % 100 % 40 + $umask % 20 \
+	      - $umask % 10 % 4 + $umask % 2
+	    `;;
+	  *) mkdir_umask=$umask,go-w;;
+	esac
+
+	# With -d, create the new directory with the user-specified mode.
+	# Otherwise, rely on $mkdir_umask.
+	if test -n "$dir_arg"; then
+	  mkdir_mode=-m$mode
+	else
+	  mkdir_mode=
+	fi
+
+	posix_mkdir=false
+	case $umask in
+	  *[123567][0-7][0-7])
+	    # POSIX mkdir -p sets u+wx bits regardless of umask, which
+	    # is incompatible with FreeBSD 'install' when (umask & 300) != 0.
+	    ;;
+	  *)
+	    tmpdir=${TMPDIR-/tmp}/ins$RANDOM-$$
+	    trap 'ret=$?; rmdir "$tmpdir/d" "$tmpdir" 2>/dev/null; exit $ret' 0
+
+	    if (umask $mkdir_umask &&
+		exec $mkdirprog $mkdir_mode -p -- "$tmpdir/d") >/dev/null 2>&1
+	    then
+	      if test -z "$dir_arg" || {
+		   # Check for POSIX incompatibilities with -m.
+		   # HP-UX 11.23 and IRIX 6.5 mkdir -m -p sets group- or
+		   # other-writeable bit of parent directory when it shouldn't.
+		   # FreeBSD 6.1 mkdir -m -p sets mode of existing directory.
+		   ls_ld_tmpdir=`ls -ld "$tmpdir"`
+		   case $ls_ld_tmpdir in
+		     d????-?r-*) different_mode=700;;
+		     d????-?--*) different_mode=755;;
+		     *) false;;
+		   esac &&
+		   $mkdirprog -m$different_mode -p -- "$tmpdir" && {
+		     ls_ld_tmpdir_1=`ls -ld "$tmpdir"`
+		     test "$ls_ld_tmpdir" = "$ls_ld_tmpdir_1"
+		   }
+		 }
+	      then posix_mkdir=:
+	      fi
+	      rmdir "$tmpdir/d" "$tmpdir"
+	    else
+	      # Remove any dirs left behind by ancient mkdir implementations.
+	      rmdir ./$mkdir_mode ./-p ./-- 2>/dev/null
+	    fi
+	    trap '' 0;;
+	esac;;
+    esac
+
+    if
+      $posix_mkdir && (
+	umask $mkdir_umask &&
+	$doit_exec $mkdirprog $mkdir_mode -p -- "$dstdir"
+      )
+    then :
+    else
+
+      # The umask is ridiculous, or mkdir does not conform to POSIX,
+      # or it failed possibly due to a race condition.  Create the
+      # directory the slow way, step by step, checking for races as we go.
+
+      case $dstdir in
+	/*) prefix='/';;
+	[-=\(\)!]*) prefix='./';;
+	*)  prefix='';;
+      esac
+
+      eval "$initialize_posix_glob"
+
+      oIFS=$IFS
+      IFS=/
+      $posix_glob set -f
+      set fnord $dstdir
+      shift
+      $posix_glob set +f
+      IFS=$oIFS
+
+      prefixes=
+
+      for d
+      do
+	test X"$d" = X && continue
+
+	prefix=$prefix$d
+	if test -d "$prefix"; then
+	  prefixes=
+	else
+	  if $posix_mkdir; then
+	    (umask=$mkdir_umask &&
+	     $doit_exec $mkdirprog $mkdir_mode -p -- "$dstdir") && break
+	    # Don't fail if two instances are running concurrently.
+	    test -d "$prefix" || exit 1
+	  else
+	    case $prefix in
+	      *\'*) qprefix=`echo "$prefix" | sed "s/'/'\\\\\\\\''/g"`;;
+	      *) qprefix=$prefix;;
+	    esac
+	    prefixes="$prefixes '$qprefix'"
+	  fi
+	fi
+	prefix=$prefix/
+      done
+
+      if test -n "$prefixes"; then
+	# Don't fail if two instances are running concurrently.
+	(umask $mkdir_umask &&
+	 eval "\$doit_exec \$mkdirprog $prefixes") ||
+	  test -d "$dstdir" || exit 1
+	obsolete_mkdir_used=true
+      fi
+    fi
+  fi
+
+  if test -n "$dir_arg"; then
+    { test -z "$chowncmd" || $doit $chowncmd "$dst"; } &&
+    { test -z "$chgrpcmd" || $doit $chgrpcmd "$dst"; } &&
+    { test "$obsolete_mkdir_used$chowncmd$chgrpcmd" = false ||
+      test -z "$chmodcmd" || $doit $chmodcmd $mode "$dst"; } || exit 1
+  else
+
+    # Make a couple of temp file names in the proper directory.
+    dsttmp=$dstdir/_inst.$$_
+    rmtmp=$dstdir/_rm.$$_
+
+    # Trap to clean up those temp files at exit.
+    trap 'ret=$?; rm -f "$dsttmp" "$rmtmp" && exit $ret' 0
+
+    # Copy the file name to the temp name.
+    (umask $cp_umask && $doit_exec $cpprog "$src" "$dsttmp") &&
+
+    # and set any options; do chmod last to preserve setuid bits.
+    #
+    # If any of these fail, we abort the whole thing.  If we want to
+    # ignore errors from any of these, just make sure not to ignore
+    # errors from the above "$doit $cpprog $src $dsttmp" command.
+    #
+    { test -z "$chowncmd" || $doit $chowncmd "$dsttmp"; } &&
+    { test -z "$chgrpcmd" || $doit $chgrpcmd "$dsttmp"; } &&
+    { test -z "$stripcmd" || $doit $stripcmd "$dsttmp"; } &&
+    { test -z "$chmodcmd" || $doit $chmodcmd $mode "$dsttmp"; } &&
+
+    # If -C, don't bother to copy if it wouldn't change the file.
+    if $copy_on_change &&
+       old=`LC_ALL=C ls -dlL "$dst"	2>/dev/null` &&
+       new=`LC_ALL=C ls -dlL "$dsttmp"	2>/dev/null` &&
+
+       eval "$initialize_posix_glob" &&
+       $posix_glob set -f &&
+       set X $old && old=:$2:$4:$5:$6 &&
+       set X $new && new=:$2:$4:$5:$6 &&
+       $posix_glob set +f &&
+
+       test "$old" = "$new" &&
+       $cmpprog "$dst" "$dsttmp" >/dev/null 2>&1
+    then
+      rm -f "$dsttmp"
+    else
+      # Rename the file to the real destination.
+      $doit $mvcmd -f "$dsttmp" "$dst" 2>/dev/null ||
+
+      # The rename failed, perhaps because mv can't rename something else
+      # to itself, or perhaps because mv is so ancient that it does not
+      # support -f.
+      {
+	# Now remove or move aside any old file at destination location.
+	# We try this two ways since rm can't unlink itself on some
+	# systems and the destination file might be busy for other
+	# reasons.  In this case, the final cleanup might fail but the new
+	# file should still install successfully.
+	{
+	  test ! -f "$dst" ||
+	  $doit $rmcmd -f "$dst" 2>/dev/null ||
+	  { $doit $mvcmd -f "$dst" "$rmtmp" 2>/dev/null &&
+	    { $doit $rmcmd -f "$rmtmp" 2>/dev/null; :; }
+	  } ||
+	  { echo "$0: cannot unlink or rename $dst" >&2
+	    (exit 1); exit 1
+	  }
+	} &&
+
+	# Now rename the file to the real destination.
+	$doit $mvcmd "$dsttmp" "$dst"
+      }
+    fi || exit 1
+
+    trap '' 0
+  fi
+done
+
+# Local variables:
+# eval: (add-hook 'write-file-hooks 'time-stamp)
+# time-stamp-start: "scriptversion="
+# time-stamp-format: "%:y-%02m-%02d.%02H"
+# time-stamp-time-zone: "UTC"
+# time-stamp-end: "; # UTC"
+# End:
