diff -Nur mruby-3.0.0/mrbgems/mruby-compiler/core/codegen.c new/mrbgems/mruby-compiler/core/codegen.c
--- mruby-3.0.0/mrbgems/mruby-compiler/core/codegen.c	2021-03-05 09:07:35.000000000 +0100
+++ new/mrbgems/mruby-compiler/core/codegen.c	2022-02-09 17:00:32.354407572 +0100
@@ -1928,7 +1928,7 @@
 
       while (tree) {
         if (nint(tree->car->car->car) == NODE_KW_REST_ARGS) {
-          if (len > 0) {
+          if (val && len > 0) {
             pop_n(len*2);
             if (!update) {
               genop_2(s, OP_HASH, cursp(), len);
@@ -1940,7 +1940,7 @@
             push();
           }
           codegen(s, tree->car->cdr, VAL);
-          if (len > 0 || update) {
+          if (val && (len > 0 || update)) {
             pop(); pop();
             genop_1(s, OP_HASHCAT, cursp());
             push();
