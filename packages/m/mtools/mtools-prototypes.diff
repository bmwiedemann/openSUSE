Index: mtools-4.0.31/mformat.c
===================================================================
--- mtools-4.0.31.orig/mformat.c
+++ mtools-4.0.31/mformat.c
@@ -19,6 +19,7 @@
  */
 
 #define DONT_NEED_WAIT
+#define DONT_NEED_IN
 
 #include "sysincludes.h"
 #include "msdos.h"
@@ -44,7 +45,7 @@
 
 #ifdef OS_linux
 #include "linux/hdreg.h"
-#include "linux/fs.h"
+#include "sys/mount.h"
 
 #endif
 
Index: mtools-4.0.31/mpartition.c
===================================================================
--- mtools-4.0.31.orig/mpartition.c
+++ mtools-4.0.31/mpartition.c
@@ -17,6 +17,7 @@
  * mformat.c
  */
 #define DONT_NEED_WAIT
+#define DONT_NEED_IN
 
 #include "sysincludes.h"
 #include "msdos.h"
@@ -33,7 +34,7 @@
 
 #ifdef OS_linux
 #include "linux/hdreg.h"
-#include "linux/fs.h"
+#include "sys/mount.h"
 #endif
 
 static void set_offset(hsc *h, unsigned long offset,
Index: mtools-4.0.31/sysincludes.h
===================================================================
--- mtools-4.0.31.orig/sysincludes.h
+++ mtools-4.0.31/sysincludes.h
@@ -382,12 +382,16 @@ extern int errno;
 #endif
 
 #ifdef HAVE_NETINET_TCP_H
+#ifndef DONT_NEED_IN
 #include <netinet/tcp.h>
 #endif
+#endif
 
 #ifdef HAVE_ARPA_INET_H
+#ifndef DONT_NEED_IN
 #include <arpa/inet.h>
 #endif
+#endif
 
 #ifdef HAVE_NETDB_H
 #include <netdb.h>
