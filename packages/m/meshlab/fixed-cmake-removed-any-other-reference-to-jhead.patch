From 3b8245899234c9ac7343e7002e0e0835eabe69c4 Mon Sep 17 00:00:00 2001
From: alemuntoni <muntoni.alessandro@gmail.com>
Date: Wed, 23 Sep 2020 13:20:39 +0200
Subject: [PATCH] fixed cmake, removed any other reference to jhead

---
 src/common/CMakeLists.txt   |  7 ++++---
 src/common/common.pro       |  4 +---
 src/external.cmake          | 20 --------------------
 src/meshlab/CMakeLists.txt  |  7 ++++---
 src/templates/common.cmake  |  4 +---
 src/templates/meshlab.cmake |  4 +---
 6 files changed, 11 insertions(+), 35 deletions(-)

diff --git a/src/common/CMakeLists.txt b/src/common/CMakeLists.txt
index e55628e25..1a8da3eea 100644
--- a/src/common/CMakeLists.txt
+++ b/src/common/CMakeLists.txt
@@ -28,7 +28,8 @@ set(SOURCES
     ml_thread_safe_memory_info.cpp
     mlapplication.cpp
     pluginmanager.cpp
-    searcher.cpp)
+    searcher.cpp
+    ${EXTERNAL_DIR}/easyexif/exif.cpp)
 
 set(HEADERS
     filter_parameter/rich_parameter.h
@@ -65,6 +66,7 @@ endif()
 add_library(common ${TARGET_TYPE} ${SOURCES} ${HEADERS} ${RESOURCES})
 
 set_target_properties(common PROPERTIES OUTPUT_NAME meshlab-common)
+target_include_directories(common PRIVATE ${EXTERNAL_DIR}/easyexif/)
 target_link_libraries(
     common
     PUBLIC Qt5::Core
@@ -72,8 +74,7 @@ target_link_libraries(
            Qt5::Widgets
            Qt5::Xml
            Qt5::XmlPatterns
-           external-glew
-    PRIVATE external-jhead)
+           external-glew)
 
 set_property(TARGET common PROPERTY FOLDER Core)
 
diff --git a/src/common/common.pro b/src/common/common.pro
index fc16e18a4..706b9f0c8 100644
--- a/src/common/common.pro
+++ b/src/common/common.pro
@@ -1,5 +1,4 @@
 include (../general.pri)
-EXIF_DIR = ../external/jhead-3.04
 
 QT += opengl
 QT += xml
@@ -19,8 +18,7 @@ linux:CONFIG += dll
 INCLUDEPATH *= \
     ../.. \
     $$VCGDIR \
-    $$EIGENDIR \
-    $$EXIF_DIR
+	$$EIGENDIR
 
 !CONFIG(system_glew) {
     INCLUDEPATH *= $$GLEWDIR/include
diff --git a/src/external.cmake b/src/external.cmake
index ef778ce52..08be7e6c3 100644
--- a/src/external.cmake
+++ b/src/external.cmake
@@ -1,26 +1,6 @@
 # Copyright 2019 Collabora, Ltd.
 # SPDX-License-Identifier: BSL-1.0
 
-# jhead - required
-message(STATUS "- jhead - using bundled source")
-set(JHEAD_DIR ${EXTERNAL_DIR}/jhead-3.04)
-add_library(
-    external-jhead STATIC
-    "${JHEAD_DIR}/jpgfile.c"
-    "${JHEAD_DIR}/jpgqguess.c"
-    "${JHEAD_DIR}/jhead.c"
-    "${JHEAD_DIR}/paths.c"
-    "${JHEAD_DIR}/exif.c"
-    "${JHEAD_DIR}/iptc.c"
-    "${JHEAD_DIR}/gpsinfo.c"
-    "${JHEAD_DIR}/makernote.c")
-if(WIN32)
-    target_sources(external-jhead PRIVATE "${JHEAD_DIR}/myglob.c")
-endif()
-target_compile_definitions(external-jhead PRIVATE main=jhead_main)
-target_include_directories(external-jhead PUBLIC ${JHEAD_DIR})
-set_property(TARGET external-jhead PROPERTY FOLDER External)
-
 # GLEW - required
 set(GLEW_DIR ${EXTERNAL_DIR}/glew-2.1.0)
 if(ALLOW_SYSTEM_GLEW AND TARGET GLEW::GLEW)
diff --git a/src/meshlab/CMakeLists.txt b/src/meshlab/CMakeLists.txt
index 698358fb6..c44bb972d 100644
--- a/src/meshlab/CMakeLists.txt
+++ b/src/meshlab/CMakeLists.txt
@@ -30,7 +30,8 @@ set(SOURCES
 	meshlab_settings/meshlabsettingsdialog.cpp
 	${VCGDIR}/wrap/gui/trackball.cpp
 	${VCGDIR}/wrap/gui/trackmode.cpp
-	${VCGDIR}/wrap/gui/coordinateframe.cpp)
+	${VCGDIR}/wrap/gui/coordinateframe.cpp
+	${EXTERNAL_DIR}/easyexif/exif.cpp)
 
 set(HEADERS
 	additionalgui.h
@@ -87,11 +88,11 @@ add_executable(meshlab WIN32 MACOSX_BUNDLE
 	${UI})
 
 target_compile_definitions(meshlab PUBLIC QT_DISABLE_DEPRECATED_BEFORE=0x000000)
-target_include_directories(meshlab PRIVATE ${CMAKE_CURRENT_SOURCE_DIR})
+target_include_directories(meshlab PRIVATE ${CMAKE_CURRENT_SOURCE_DIR} ${EXTERNAL_DIR}/easyexif/)
 target_link_libraries(
 	meshlab
 	PUBLIC common OpenGL::GLU Qt5::Network
-	PRIVATE external-jhead)
+	)
 
 set_property(TARGET meshlab PROPERTY FOLDER Core)
 
diff --git a/src/templates/common.cmake b/src/templates/common.cmake
index 7dfe4553a..f9f465347 100644
--- a/src/templates/common.cmake
+++ b/src/templates/common.cmake
@@ -30,9 +30,7 @@ target_link_libraries({{name}}
     Qt5::Widgets
     Qt5::Xml
     Qt5::XmlPatterns
-    external-glew
-    PRIVATE
-    external-jhead)
+    external-glew)
 {% endblock %}
 
 {% block output_dir %}{% endblock %}
diff --git a/src/templates/meshlab.cmake b/src/templates/meshlab.cmake
index 6426363e1..14116ae91 100644
--- a/src/templates/meshlab.cmake
+++ b/src/templates/meshlab.cmake
@@ -42,9 +42,7 @@ target_link_libraries({{name}}
     PUBLIC
     common
     OpenGL::GLU
-    Qt5::Network
-    PRIVATE
-    external-jhead)
+    Qt5::Network)
 
 {% endblock %}
 {% block install %}
