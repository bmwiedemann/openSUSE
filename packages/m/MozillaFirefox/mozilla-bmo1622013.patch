From be45ba20c33a8a247115e79fd4c1f3295d652ba3 Mon Sep 17 00:00:00 2001
From: Jan Beich <jbeich@FreeBSD.org>
Date: Mon, 23 Mar 2020 08:20:22 +0000
Subject: [PATCH] Bug 1622013 - Build *_mmx.c files with -mmmx in bundled libvpx.

diff --git a/media/libvpx/moz.build b/media/libvpx/moz.build
index f3845941fe4de..47853d43408b7 100644
--- a/media/libvpx/moz.build
+++ b/media/libvpx/moz.build
@@ -97,16 +97,18 @@ if CONFIG['OS_TARGET'] == 'Android':
     DEFINES['__linux__'] = True
 
     SOURCES += [
         '%%%s/sources/android/cpufeatures/cpu-features.c' % CONFIG['ANDROID_NDK'],
     ]
 
 for f in SOURCES:
     if f.endswith('.c'):
+        if 'mmx.c' in f:
+            SOURCES[f].flags += ['-mmmx']
         if 'sse2.c' in f:
             SOURCES[f].flags += CONFIG['SSE2_FLAGS']
         if 'ssse3.c' in f:
             SOURCES[f].flags += ['-mssse3']
         if 'sse4.c' in f:
             SOURCES[f].flags += ['-msse4.1']
         if 'avx.c' in f:
             SOURCES[f].flags += ['-mavx']
