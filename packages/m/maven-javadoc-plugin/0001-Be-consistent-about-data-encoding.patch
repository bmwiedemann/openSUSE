From 116c679c73cc6f4a4826cedfde2d63496cfd0b2d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fridrich=20=C5=A0trba?= <fridrich.strba@bluewin.ch>
Date: Mon, 30 Sep 2024 19:54:38 +0200
Subject: [PATCH 1/3] Be consistent about data encoding

---
 .../maven/plugins/javadoc/StaleHelper.java    | 26 +++++++++++++------
 1 file changed, 18 insertions(+), 8 deletions(-)

diff --git a/src/main/java/org/apache/maven/plugins/javadoc/StaleHelper.java b/src/main/java/org/apache/maven/plugins/javadoc/StaleHelper.java
index aabe9840..9bebe146 100644
--- a/src/main/java/org/apache/maven/plugins/javadoc/StaleHelper.java
+++ b/src/main/java/org/apache/maven/plugins/javadoc/StaleHelper.java
@@ -40,6 +40,20 @@ import org.codehaus.plexus.util.cli.Commandline;
  */
 public class StaleHelper {
 
+    /**
+     * Compute the encoding of the stale javadoc
+     *
+     * @return the the encoding of the stale data
+     */
+    private static Charset getDataCharset() {
+        if (JavaVersion.JAVA_SPECIFICATION_VERSION.isAtLeast("9")
+                && JavaVersion.JAVA_SPECIFICATION_VERSION.isBefore("12")) {
+            return StandardCharsets.UTF_8;
+        } else {
+            return Charset.defaultCharset();
+        }
+    }
+
     /**
      * Compute the data used to detect a stale javadoc
      *
@@ -55,13 +69,7 @@ public class StaleHelper {
             String[] args = cmd.getArguments();
             Collections.addAll(options, args);
 
-            final Charset cs;
-            if (JavaVersion.JAVA_SPECIFICATION_VERSION.isAtLeast("9")
-                    && JavaVersion.JAVA_SPECIFICATION_VERSION.isBefore("12")) {
-                cs = StandardCharsets.UTF_8;
-            } else {
-                cs = Charset.defaultCharset();
-            }
+            final Charset cs = getDataCharset();
 
             for (String arg : args) {
                 if (arg.startsWith("@")) {
@@ -115,9 +123,11 @@ public class StaleHelper {
      */
     public static void writeStaleData(Commandline cmd, Path path) throws MavenReportException {
         try {
+            final Charset cs = getDataCharset();
+
             List<String> curdata = getStaleData(cmd);
             Files.createDirectories(path.getParent());
-            Files.write(path, curdata, StandardCharsets.UTF_8);
+            Files.write(path, curdata, cs);
         } catch (IOException e) {
             throw new MavenReportException("Error checking stale data", e);
         }
-- 
2.50.0

