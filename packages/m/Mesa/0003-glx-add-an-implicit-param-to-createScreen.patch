From 2dedd2e26dce587e1efe8250f8f2da60db906071 Mon Sep 17 00:00:00 2001
From: Mike Blumenkrantz <michael.blumenkrantz@gmail.com>
Date: Tue, 12 Mar 2024 09:36:57 -0400
Subject: [PATCH 3/9] glx: add an 'implicit' param to createScreen

---
 src/glx/dri2_glx.c       | 2 +-
 src/glx/dri3_glx.c       | 2 +-
 src/glx/drisw_glx.c      | 2 +-
 src/glx/driwindows_glx.c | 2 +-
 src/glx/glxclient.h      | 2 +-
 src/glx/glxext.c         | 8 ++++----
 6 files changed, 9 insertions(+), 9 deletions(-)

Index: mesa-24.0.3/src/glx/dri2_glx.c
===================================================================
--- mesa-24.0.3.orig/src/glx/dri2_glx.c
+++ mesa-24.0.3/src/glx/dri2_glx.c
@@ -1001,7 +1001,7 @@ static const struct glx_screen_vtable dr
 };
 
 static struct glx_screen *
-dri2CreateScreen(int screen, struct glx_display * priv)
+dri2CreateScreen(int screen, struct glx_display * priv, bool implicit)
 {
    const __DRIconfig **driver_configs;
    const __DRIextension **extensions;
Index: mesa-24.0.3/src/glx/dri3_glx.c
===================================================================
--- mesa-24.0.3.orig/src/glx/dri3_glx.c
+++ mesa-24.0.3/src/glx/dri3_glx.c
@@ -789,7 +789,7 @@ static const struct glx_screen_vtable dr
  */
 
 static struct glx_screen *
-dri3_create_screen(int screen, struct glx_display * priv)
+dri3_create_screen(int screen, struct glx_display * priv, bool implicit)
 {
    xcb_connection_t *c = XGetXCBConnection(priv->dpy);
    const __DRIconfig **driver_configs;
Index: mesa-24.0.3/src/glx/drisw_glx.c
===================================================================
--- mesa-24.0.3.orig/src/glx/drisw_glx.c
+++ mesa-24.0.3/src/glx/drisw_glx.c
@@ -1055,7 +1055,7 @@ driswCreateScreenDriver(int screen, stru
 }
 
 static struct glx_screen *
-driswCreateScreen(int screen, struct glx_display *priv)
+driswCreateScreen(int screen, struct glx_display *priv, bool implicit)
 {
    const struct drisw_display *pdpyp = (struct drisw_display *)priv->driswDisplay;
    if (pdpyp->zink && !debug_get_bool_option("LIBGL_KOPPER_DISABLE", false)) {
Index: mesa-24.0.3/src/glx/driwindows_glx.c
===================================================================
--- mesa-24.0.3.orig/src/glx/driwindows_glx.c
+++ mesa-24.0.3/src/glx/driwindows_glx.c
@@ -461,7 +461,7 @@ driwindowsMapConfigs(struct glx_display
 }
 
 static struct glx_screen *
-driwindowsCreateScreen(int screen, struct glx_display *priv)
+driwindowsCreateScreen(int screen, struct glx_display *priv, bool implicit)
 {
    __GLXDRIscreen *psp;
    struct driwindows_screen *psc;
Index: mesa-24.0.3/src/glx/glxclient.h
===================================================================
--- mesa-24.0.3.orig/src/glx/glxclient.h
+++ mesa-24.0.3/src/glx/glxclient.h
@@ -85,7 +85,7 @@ struct __GLXDRIdisplayRec
      */
    void (*destroyDisplay) (__GLXDRIdisplay * display);
 
-   struct glx_screen *(*createScreen)(int screen, struct glx_display * priv);
+   struct glx_screen *(*createScreen)(int screen, struct glx_display * priv, bool implicit);
 };
 
 struct __GLXDRIscreenRec {
Index: mesa-24.0.3/src/glx/glxext.c
===================================================================
--- mesa-24.0.3.orig/src/glx/glxext.c
+++ mesa-24.0.3/src/glx/glxext.c
@@ -783,19 +783,19 @@ AllocAndFetchScreenConfigs(Display * dpy
 #if defined(GLX_USE_DRM)
 #if defined(HAVE_DRI3)
       if (priv->dri3Display)
-         psc = priv->dri3Display->createScreen(i, priv);
+         psc = priv->dri3Display->createScreen(i, priv, false);
 #endif /* HAVE_DRI3 */
       if (psc == NULL && priv->dri2Display)
-	     psc = priv->dri2Display->createScreen(i, priv);
+	     psc = priv->dri2Display->createScreen(i, priv, false);
 #endif /* GLX_USE_DRM */
 
 #ifdef GLX_USE_WINDOWSGL
       if (psc == NULL && priv->windowsdriDisplay)
-	     psc = priv->windowsdriDisplay->createScreen(i, priv);
+	     psc = priv->windowsdriDisplay->createScreen(i, priv, false);
 #endif
 
       if (psc == NULL && priv->driswDisplay)
-	     psc = priv->driswDisplay->createScreen(i, priv);
+	     psc = priv->driswDisplay->createScreen(i, priv, false);
 #endif /* GLX_DIRECT_RENDERING && !GLX_USE_APPLEGL */
 
       bool indirect = false;
