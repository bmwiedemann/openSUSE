From 55236ac5349f1208356e713336276c052384e444 Mon Sep 17 00:00:00 2001
From: Mike Blumenkrantz <michael.blumenkrantz@gmail.com>
Date: Tue, 12 Mar 2024 10:05:49 -0400
Subject: [PATCH 7/9] frontends/dri: plumb an 'implicit' param through screen
 init

---
 include/GL/internal/mesa_interface.h | 2 +-
 src/gallium/frontends/dri/dri2.c     | 4 ++--
 src/gallium/frontends/dri/dri_util.c | 2 +-
 src/gallium/frontends/dri/drisw.c    | 2 +-
 src/gallium/frontends/dri/kopper.c   | 2 +-
 5 files changed, 6 insertions(+), 6 deletions(-)

Index: mesa-24.0.3/include/GL/internal/mesa_interface.h
===================================================================
--- mesa-24.0.3.orig/include/GL/internal/mesa_interface.h
+++ mesa-24.0.3/include/GL/internal/mesa_interface.h
@@ -60,7 +60,7 @@ struct __DRImesaCoreExtensionRec {
    __DRIcreateContextAttribsFunc createContext;
 
    /* driver function for finishing initialization inside createNewScreen(). */
-   const __DRIconfig **(*initScreen)(struct dri_screen *screen);
+   const __DRIconfig **(*initScreen)(struct dri_screen *screen, bool implicit);
 
    int (*queryCompatibleRenderOnlyDeviceFd)(int kms_only_fd);
 
Index: mesa-24.0.3/src/gallium/frontends/dri/dri2.c
===================================================================
--- mesa-24.0.3.orig/src/gallium/frontends/dri/dri2.c
+++ mesa-24.0.3/src/gallium/frontends/dri/dri2.c
@@ -2374,7 +2374,7 @@ dri2_create_drawable(struct dri_screen *
  * Returns the struct gl_config supported by this driver.
  */
 static const __DRIconfig **
-dri2_init_screen(struct dri_screen *screen)
+dri2_init_screen(struct dri_screen *screen, bool implicit)
 {
    const __DRIconfig **configs;
    struct pipe_screen *pscreen = NULL;
@@ -2430,7 +2430,7 @@ fail:
  * Returns the struct gl_config supported by this driver.
  */
 static const __DRIconfig **
-dri_swrast_kms_init_screen(struct dri_screen *screen)
+dri_swrast_kms_init_screen(struct dri_screen *screen, bool implicit)
 {
 #if defined(GALLIUM_SOFTPIPE)
    const __DRIconfig **configs;
Index: mesa-24.0.3/src/gallium/frontends/dri/dri_util.c
===================================================================
--- mesa-24.0.3.orig/src/gallium/frontends/dri/dri_util.c
+++ mesa-24.0.3/src/gallium/frontends/dri/dri_util.c
@@ -136,7 +136,7 @@ driCreateNewScreen3(int scrn, int fd,
     driParseConfigFiles(&screen->optionCache, &screen->optionInfo, screen->myNum,
                         "dri2", NULL, NULL, NULL, 0, NULL, 0);
 
-    *driver_configs = mesa->initScreen(screen);
+    *driver_configs = mesa->initScreen(screen, implicit);
     if (*driver_configs == NULL) {
         dri_destroy_screen(screen);
         return NULL;
Index: mesa-24.0.3/src/gallium/frontends/dri/drisw.c
===================================================================
--- mesa-24.0.3.orig/src/gallium/frontends/dri/drisw.c
+++ mesa-24.0.3/src/gallium/frontends/dri/drisw.c
@@ -539,7 +539,7 @@ drisw_create_drawable(struct dri_screen
 }
 
 static const __DRIconfig **
-drisw_init_screen(struct dri_screen *screen)
+drisw_init_screen(struct dri_screen *screen, bool implicit)
 {
    const __DRIswrastLoaderExtension *loader = screen->swrast_loader;
    const __DRIconfig **configs;
Index: mesa-24.0.3/src/gallium/frontends/dri/kopper.c
===================================================================
--- mesa-24.0.3.orig/src/gallium/frontends/dri/kopper.c
+++ mesa-24.0.3/src/gallium/frontends/dri/kopper.c
@@ -110,7 +110,7 @@ static const __DRIextension *drivk_sw_sc
 };
 
 static const __DRIconfig **
-kopper_init_screen(struct dri_screen *screen)
+kopper_init_screen(struct dri_screen *screen, bool implicit)
 {
    const __DRIconfig **configs;
    struct pipe_screen *pscreen = NULL;
