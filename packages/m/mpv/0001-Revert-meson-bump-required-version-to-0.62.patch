From b79288e109c7d792ff4b37dabf679afa81dbab9d Mon Sep 17 00:00:00 2001
From: llyyr <llyyr.public@gmail.com>
Date: Mon, 31 Jul 2023 16:14:43 +0530
Subject: [PATCH] Revert "meson: bump required version to 0.62"

This reverts commit a3eb16330361396311f09c952095ea6280835399.
---
 meson.build | 16 ++++++++++------
 1 file changed, 10 insertions(+), 6 deletions(-)

diff --git a/meson.build b/meson.build
index 5a82220b38..1ef3a824cb 100644
--- a/meson.build
+++ b/meson.build
@@ -2,7 +2,7 @@ project('mpv',
         'c',
         license: ['GPL2+', 'LGPL2.1+'],
         version: files('./VERSION'),
-        meson_version: '>=0.62.0',
+        meson_version: '>=0.60.3',
         default_options: [
             'buildtype=debugoptimized',
             'b_lundef=false',
@@ -331,10 +331,10 @@ endif
 
 features += {'ta-leak-report': get_option('ta-leak-report')}
 
-libdl = dependency('dl', required: false)
-features += {'libdl': libdl.found()}
+libdl_dep = cc.find_library('dl', required: false)
+features += {'libdl': cc.has_function('dlopen', dependencies: libdl_dep, prefix: '#include <dlfcn.h>')}
 if features['libdl']
-    dependencies += libdl
+    dependencies += libdl_dep
 endif
 
 cplugins = get_option('cplugins').require(
@@ -1621,7 +1621,10 @@ endif
 rst2pdf = find_program('rst2pdf', required: get_option('pdf-build'))
 features += {'pdf-build': rst2pdf.found()}
 if features['pdf-build']
-    dependency_file = rst2pdf.version().version_compare('>=0.100')
+    rst2pdf_help = run_command(
+        rst2pdf, '--help',
+        check: true, capture: true
+    ).stdout()
     datadir = get_option('datadir')
     custom_target('pdf-manpages',
         input: manpage,
@@ -1629,7 +1632,8 @@ if features['pdf-build']
         command: [
             docutils_wrapper, rst2pdf,
             '-c', '-b', '1', '--repeat-table-rows',
-            dependency_file ? ['--record-dependencies', '@DEPFILE@'] : [],
+            rst2pdf_help.contains('--record-dependencies') ?
+                ['--record-dependencies', '@DEPFILE@'] : [],
             '@INPUT@', '-o', '@OUTPUT@'],
         depfile: 'mpv.pdf.dep',
         install: true,
-- 
2.41.0

