From f11c1ab393185aecedc3f1445b0dff5b187f58c1 Mon Sep 17 00:00:00 2001
From: Jens Axboe <axboe@kernel.dk>
Date: Thu, 8 Aug 2024 07:34:46 -0600
Subject: [PATCH] test/buf-ring-nommap: skip the test on queue init ENOMEM
 failure

Fixes: https://github.com/axboe/liburing/issues/1200
Signed-off-by: Jens Axboe <axboe@kernel.dk>
---
 test/buf-ring-nommap.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/test/buf-ring-nommap.c b/test/buf-ring-nommap.c
index 17c1495..32a372c 100644
--- a/test/buf-ring-nommap.c
+++ b/test/buf-ring-nommap.c
@@ -46,7 +46,7 @@ int main(int argc, char *argv[])
 	p.flags = IORING_SETUP_NO_MMAP;
 	ret = io_uring_queue_init_mem(1, &ring, &p, ring_mem, 16384);
 	if (ret < 0) {
-		if (ret == -EINVAL)
+		if (ret == -EINVAL || ret == -ENOMEM)
 			return T_EXIT_SKIP;
 		fprintf(stderr, "queue init failed %d\n", ret);
 		return T_EXIT_FAIL;
-- 
2.45.2

