From 8fa76a79e9fbfbf0b07cdc3543c5cad86218cad3 Mon Sep 17 00:00:00 2001
From: Christian Hoene <christian.hoene@symonics.com>
Date: Wed, 17 May 2023 18:15:09 +0000
Subject: [PATCH] fix big endian convertion of double value

---
 src/hrtf/reader.c | 14 ++++++++++----
 1 file changed, 10 insertions(+), 4 deletions(-)

Index: libmysofa-1.3.1/src/hrtf/reader.c
===================================================================
--- libmysofa-1.3.1.orig/src/hrtf/reader.c	2022-10-04 18:31:49.000000000 +0200
+++ libmysofa-1.3.1/src/hrtf/reader.c	2023-06-12 10:30:38.627731016 +0200
@@ -11,8 +11,8 @@
 #include <stdlib.h>
 #include <string.h>
 
-#include "../config.h"
 #include "../hdf/reader.h"
+#include "../config.h"
 #include "mysofa.h"
 #include "mysofa_export.h"
 
@@ -151,7 +151,7 @@
 
 static int getArray(struct MYSOFA_ARRAY *array, struct DATAOBJECT *dataobject) {
   float *p1;
-  double *p2;
+  uint64_t *p2;
   unsigned int i;
 
   struct MYSOFA_ATTRIBUTE *attr = dataobject->attributes;
@@ -170,8 +170,14 @@
 
   p1 = dataobject->data;
   p2 = dataobject->data;
-  for (i = 0; i < array->elements; i++)
-    *p1++ = (float)*p2++;
+  for (i = 0; i < array->elements; i++) {
+    union {
+      uint64_t i;
+      double d;
+    } u;
+    u.i = le64toh(*p2++);
+    *p1++ = (float)u.d;
+  }
   array->values = realloc(dataobject->data, array->elements * sizeof(float));
 
   dataobject->data = NULL;
