From e7a327fafd75f9d020b0de7539fb072cef059b9a Mon Sep 17 00:00:00 2001
From: Aleksander Morgado <aleksander@aleksander.es>
Date: Tue, 2 Jul 2019 13:57:38 +0200
Subject: [PATCH] build: define GLIB_VERSION_MAX_ALLOWED and disable
 deprecation warnings

---
 configure.ac | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/configure.ac b/configure.ac
index 26898ca..f0798bb 100644
--- a/configure.ac
+++ b/configure.ac
@@ -67,9 +67,12 @@ AC_SUBST(MBIM_GLIB_LT_AGE)
 dnl Required dependency versions
 GLIB_MIN_VERSION=2.36
 
+GLIB_BUILD_SYMBOLS="-DGLIB_VERSION_MIN_REQUIRED=GLIB_VERSION_2_36 -DGLIB_VERSION_MAX_ALLOWED=GLIB_VERSION_2_36 -DGLIB_DISABLE_DEPRECATION_WARNINGS"
+
 dnl General dependencies for common
 PKG_CHECK_MODULES(MBIM_COMMON,
                   glib-2.0 >= $GLIB_MIN_VERSION)
+MBIM_COMMON_CFLAGS="$MBIM_COMMON_CFLAGS $GLIB_BUILD_SYMBOLS"
 AC_SUBST(MBIM_COMMON_CFLAGS)
 AC_SUBST(MBIM_COMMON_LIBS)
 
@@ -79,6 +82,7 @@ PKG_CHECK_MODULES(LIBMBIM_GLIB,
                   gobject-2.0
                   gio-2.0
                   gio-unix-2.0)
+LIBMBIM_GLIB_CFLAGS="$LIBMBIM_GLIB_CFLAGS $GLIB_BUILD_SYMBOLS"
 AC_SUBST(LIBMBIM_GLIB_CFLAGS)
 AC_SUBST(LIBMBIM_GLIB_LIBS)
 
@@ -87,6 +91,7 @@ PKG_CHECK_MODULES(MBIMCLI,
                   glib-2.0 >= $GLIB_MIN_VERSION
                   gobject-2.0
                   gio-2.0)
+MBIMCLI_CFLAGS="$MBIMCLI_CFLAGS $GLIB_BUILD_SYMBOLS"
 AC_SUBST(MBIMCLI_CFLAGS)
 AC_SUBST(MBIMCLI_LIBS)
 
@@ -95,6 +100,7 @@ PKG_CHECK_MODULES(MBIMPROXY,
                   glib-2.0 >= $GLIB_MIN_VERSION
                   gobject-2.0
                   gio-2.0)
+MBIMPROXY_CFLAGS="$MBIMPROXY_CFLAGS $GLIB_BUILD_SYMBOLS"
 AC_SUBST(MBIMPROXY_CFLAGS)
 AC_SUBST(MBIMPROXY_LIBS)
 
-- 
2.22.0


From 07f4f8fa3f53e93a8988a6a2f3e5179c334b7f2f Mon Sep 17 00:00:00 2001
From: Aleksander Morgado <aleksander@aleksander.es>
Date: Tue, 23 Jul 2019 13:24:03 +0200
Subject: [PATCH] libmbim,uuid: fix build with -Werror=type-limits

  mbim-uuid.c: In function 'mbim_uuid_from_service':
  mbim-uuid.c:400:5: error: comparison of unsigned expression >= 0 is always true [-Werror=type-limits]
  mbim-uuid.c: In function 'mbim_uuid_from_context_type':
  mbim-uuid.c:594:5: error: comparison of unsigned expression >= 0 is always true [-Werror=type-limits]
---
 src/libmbim-glib/mbim-uuid.c | 8 ++------
 1 file changed, 2 insertions(+), 6 deletions(-)

diff --git a/src/libmbim-glib/mbim-uuid.c b/src/libmbim-glib/mbim-uuid.c
index a7066e5..63fa221 100644
--- a/src/libmbim-glib/mbim-uuid.c
+++ b/src/libmbim-glib/mbim-uuid.c
@@ -397,10 +397,7 @@ mbim_uuid_from_service (MbimService service)
 {
     GList *l;
 
-    g_return_val_if_fail (service >= MBIM_SERVICE_INVALID &&
-                          (service < MBIM_SERVICE_LAST ||
-                           mbim_service_id_is_custom (service)),
-                          &uuid_invalid);
+    g_return_val_if_fail (service < MBIM_SERVICE_LAST || mbim_service_id_is_custom (service), &uuid_invalid);
 
     switch (service) {
     case MBIM_SERVICE_INVALID:
@@ -591,8 +588,7 @@ static const MbimUuid uuid_context_type_local = {
 const MbimUuid *
 mbim_uuid_from_context_type (MbimContextType context_type)
 {
-    g_return_val_if_fail (context_type >= MBIM_CONTEXT_TYPE_INVALID && context_type <= MBIM_CONTEXT_TYPE_LOCAL,
-                          &uuid_invalid);
+    g_return_val_if_fail (context_type <= MBIM_CONTEXT_TYPE_LOCAL, &uuid_invalid);
 
     switch (context_type) {
     case MBIM_CONTEXT_TYPE_INVALID:
-- 
2.22.0


From 47cf7e1aebb3d0ccd95c0e88a30df68bf6dfc0f4 Mon Sep 17 00:00:00 2001
From: Aleksander Morgado <aleksander@aleksander.es>
Date: Tue, 23 Jul 2019 13:41:52 +0200
Subject: [PATCH] libmbim,cid: fix build with -Werror=type-limits

  mbim-cid.c: In function 'mbim_cid_get_printable':
  mbim-cid.c:360:5: error: comparison of unsigned expression >= 0 is always true [-Werror=type-limits]
---
 src/libmbim-glib/mbim-cid.c | 1 -
 1 file changed, 1 deletion(-)

diff --git a/src/libmbim-glib/mbim-cid.c b/src/libmbim-glib/mbim-cid.c
index 82ab61e..53e32c1 100644
--- a/src/libmbim-glib/mbim-cid.c
+++ b/src/libmbim-glib/mbim-cid.c
@@ -357,7 +357,6 @@ mbim_cid_get_printable (MbimService service,
     /* CID = 0 is never a valid command */
     g_return_val_if_fail (cid > 0, NULL);
     /* Known service required */
-    g_return_val_if_fail (service >= MBIM_SERVICE_INVALID, NULL);
     g_return_val_if_fail (service < MBIM_SERVICE_LAST, NULL);
 
     switch (service) {
-- 
2.22.0

