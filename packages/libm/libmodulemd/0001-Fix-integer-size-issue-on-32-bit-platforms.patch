From 05afb01e3a6de8f09ac664f2d93c3aac9be1e99e Mon Sep 17 00:00:00 2001
From: Stephen Gallagher <sgallagh@redhat.com>
Date: Fri, 20 Nov 2020 15:52:27 -0500
Subject: [PATCH] Fix integer size issue on 32-bit platforms

Signed-off-by: Stephen Gallagher <sgallagh@redhat.com>
---
 modulemd/modulemd-module.c    | 6 +++---
 modulemd/modulemd-obsoletes.c | 7 ++++---
 modulemd/modulemd-util.c      | 2 +-
 3 files changed, 8 insertions(+), 7 deletions(-)

diff --git a/modulemd/modulemd-module.c b/modulemd/modulemd-module.c
index 8cc7995..1b1ee71 100644
--- a/modulemd/modulemd-module.c
+++ b/modulemd/modulemd-module.c
@@ -877,8 +877,8 @@ modulemd_module_add_obsoletes (ModulemdModule *self,
           continue;
         }
       g_info (
-        "Overriding existing obsolete because of idenical stream: %s, "
-        "context: %s and modified time: %lu.",
+        "Overriding existing obsolete because of identical stream: %s, "
+        "context: %s and modified time: %" PRIu64 ".",
         modulemd_obsoletes_get_module_stream (obsoletes),
         modulemd_obsoletes_get_module_context (obsoletes),
         modulemd_obsoletes_get_modified (obsoletes));
@@ -967,7 +967,7 @@ modulemd_module_add_obsoletes (ModulemdModule *self,
                   g_info (
                     "Multiple obsoletes for module: %s, stream: %s, context: "
                     "%s "
-                    "with identical modified time: %lu",
+                    "with identical modified time: %" PRIu64,
                     modulemd_module_get_module_name (self),
                     stream_str,
                     context_str,
diff --git a/modulemd/modulemd-obsoletes.c b/modulemd/modulemd-obsoletes.c
index 46bbc43..ceb7682 100644
--- a/modulemd/modulemd-obsoletes.c
+++ b/modulemd/modulemd-obsoletes.c
@@ -1092,7 +1092,7 @@ modulemd_obsoletes_emit_yaml (ModulemdObsoletes *self,
         error,
         MODULEMD_ERROR,
         MMD_ERROR_VALIDATE,
-        "Cannot convert modified date: %lu to iso8601 date.",
+        "Cannot convert modified date: %" PRIu64 " to iso8601 date.",
         modulemd_obsoletes_get_modified (MODULEMD_OBSOLETES (self)));
       return FALSE;
     }
@@ -1166,7 +1166,8 @@ modulemd_obsoletes_emit_yaml (ModulemdObsoletes *self,
           g_set_error (error,
                        MODULEMD_ERROR,
                        MMD_ERROR_VALIDATE,
-                       "Cannot convert eol_date: %lu to iso8601 date.",
+                       "Cannot convert eol_date: %" PRIu64
+                       " to iso8601 date.",
                        eol_date);
           return FALSE;
         }
@@ -1231,7 +1232,7 @@ modulemd_obsoletes_is_active (ModulemdObsoletes *self)
 
   char buf[255];
   strftime (buf, sizeof (buf), "%Y%m%d%H%M", tm);
-  guint64 now = atol (buf);
+  guint64 now = g_ascii_strtoull (buf, NULL, 0);
 
   if (now >= modulemd_obsoletes_get_eol_date (self))
     {
diff --git a/modulemd/modulemd-util.c b/modulemd/modulemd-util.c
index 2a50bb5..7c4c891 100644
--- a/modulemd/modulemd-util.c
+++ b/modulemd/modulemd-util.c
@@ -521,7 +521,7 @@ modulemd_iso8601date_to_guint64 (const gchar *iso8601)
   char buf[32];
   strftime (buf, sizeof (buf), "%Y%m%d%H%M", &tm);
 
-  return atol (buf);
+  return g_ascii_strtoull (buf, NULL, 0);
 }
 
 
-- 
2.28.0

