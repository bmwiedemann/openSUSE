From d7ea20fb2e1433ebece9f004d87ad8f2377af23d Mon Sep 17 00:00:00 2001
From: pancake <pancake@nowsecure.com>
Date: Fri, 23 Jul 2021 09:29:54 +0200
Subject: [PATCH] Fix #18923 - Fix resource exhaustion bug in LE binary
 (#18926)

---
 libr/bin/format/le/le.c | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/libr/bin/format/le/le.c b/libr/bin/format/le/le.c
index b2d4abf59b7..537f2004e57 100644
--- a/libr/bin/format/le/le.c
+++ b/libr/bin/format/le/le.c
@@ -1,4 +1,4 @@
-/* radare - LGPL - Copyright 2019 - GustavoLCR */
+/* radare - LGPL - Copyright 2019-2021 - GustavoLCR */
 
 #include "le.h"
 #include <r_bin.h>
@@ -366,7 +366,11 @@ RList *r_bin_le_get_sections(r_bin_le_obj_t *bin) {
 
 			int cur_idx = entry->page_tbl_idx + j - 1;
 			ut64 page_entry_off = objpageentrysz * cur_idx + objmaptbloff;
-			r_buf_read_at (bin->buf, page_entry_off, (ut8 *)&page, sizeof (page));
+			int r = r_buf_read_at (bin->buf, page_entry_off, (ut8 *)&page, sizeof (page));
+			if (r < sizeof (page)) {
+				R_LOG_WARN ("Cannot read out of bounds page table entry.");
+				break;
+			}
 			if (cur_idx < next_idx) { // If not true rest of pages will be zeroes
 				if (bin->is_le) {
 					// Why is it big endian???
