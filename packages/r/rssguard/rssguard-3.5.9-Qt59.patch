From cfb0c3490eec11e47790c1efd913c0fdd9a579b4 Mon Sep 17 00:00:00 2001
From: Martin Rotter <rotter@praktik.cz>
Date: Thu, 6 Jun 2019 09:07:04 +0200
Subject: [PATCH] min qt required is now 5.9.0 + fixed pw saving in tt-rss
 plugin in some circumstances + fix #208


diff --git a/src/miscellaneous/textfactory.cpp b/src/miscellaneous/textfactory.cpp
index 53451d63..f371d02d 100755
--- a/src/miscellaneous/textfactory.cpp
+++ b/src/miscellaneous/textfactory.cpp
@@ -10,10 +10,11 @@
 
 #include <QDir>
 #include <QLocale>
-#include <QRandomGenerator>
 #include <QString>
 #include <QStringList>
 
+#include <random>
+
 quint64 TextFactory::s_encryptionKey = 0x0;
 
 TextFactory::TextFactory() = default;
@@ -128,7 +129,10 @@ quint64 TextFactory::initializeSecretEncryptionKey() {
     QString encryption_file_path = qApp->settings()->pathName() + QDir::separator() + ENCRYPTION_FILE_NAME;
 
     try {
-      s_encryptionKey = quint64(QString(IOFactory::readFile(encryption_file_path)).toLongLong());
+      s_encryptionKey = quint64(QString(IOFactory::readFile(encryption_file_path)).toULongLong());
+
+      auto aa = s_encryptionKey;
+      auto bb = false;
     }
     catch (ApplicationException&) {
       // Well, key does not exist or is invalid, generate and save one.
@@ -148,5 +152,10 @@ quint64 TextFactory::initializeSecretEncryptionKey() {
 }
 
 quint64 TextFactory::generateSecretEncryptionKey() {
-  return QRandomGenerator().generate64();
+  std::random_device rd;
+  std::mt19937 mt(rd());
+  std::uniform_int<quint64> dist(std::numeric_limits<quint64>().min() + 1000000UL,
+                                 std::numeric_limits<quint64>().max());
+
+  return dist(mt);
 }
From d347ba63072ab13c0dbc1792d1a2b837af997a46 Mon Sep 17 00:00:00 2001
From: Martin Rotter <rotter@praktik.cz>
Date: Thu, 6 Jun 2019 11:35:25 +0200
Subject: [PATCH] Fix random class name

---
 src/miscellaneous/textfactory.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/miscellaneous/textfactory.cpp b/src/miscellaneous/textfactory.cpp
index 48597235..1ac6f049 100755
--- a/src/miscellaneous/textfactory.cpp
+++ b/src/miscellaneous/textfactory.cpp
@@ -151,8 +151,8 @@ quint64 TextFactory::initializeSecretEncryptionKey() {
 quint64 TextFactory::generateSecretEncryptionKey() {
   std::random_device rd;
   std::mt19937 mt(rd());
-  std::uniform_int<quint64> dist(std::numeric_limits<quint64>().min() + 1000000UL,
-                                 std::numeric_limits<quint64>().max());
+  std::uniform_int_distribution<quint64> dist(std::numeric_limits<quint64>().min() + 1000000UL,
+                                              std::numeric_limits<quint64>().max());
 
   return dist(mt);
 }
