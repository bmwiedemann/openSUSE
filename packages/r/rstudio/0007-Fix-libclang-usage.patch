From 42fe2eb6367c27a912a2edcd13bc1f1a1a44338a Mon Sep 17 00:00:00 2001
From: Aaron Puchert <aaronpuchert@alice-dsl.net>
Date: Mon, 7 Sep 2020 11:12:26 +0200
Subject: [PATCH 7/8] Fix libclang usage

---
 src/cpp/core/include/core/libclang/LibClang.hpp |  1 +
 src/cpp/core/libclang/LibClang.cpp              | 14 +++++---------
 2 files changed, 6 insertions(+), 9 deletions(-)

diff --git a/src/cpp/core/include/core/libclang/LibClang.hpp b/src/cpp/core/include/core/libclang/LibClang.hpp
index b67a53ee50..63c5a906be 100644
--- a/src/cpp/core/include/core/libclang/LibClang.hpp
+++ b/src/cpp/core/include/core/libclang/LibClang.hpp
@@ -35,6 +35,7 @@
 
 #include "clang-c/Index.h"
 #include "clang-c/CXCompilationDatabase.h"
+#include "clang-c/Documentation.h"
 
 namespace rstudio {
 namespace core {
diff --git a/src/cpp/core/libclang/LibClang.cpp b/src/cpp/core/libclang/LibClang.cpp
index 33f113f2f1..f1100b0422 100644
--- a/src/cpp/core/libclang/LibClang.cpp
+++ b/src/cpp/core/libclang/LibClang.cpp
@@ -58,12 +58,11 @@ std::vector<std::string> defaultCompileArgs(LibraryVersion version)
 
    // we need to add in the associated libclang headers as
    // they are not discovered / used by default during compilation
-   FilePath llvmPath = s_libraryPath.getParent().getParent();
-   boost::format fmt("%1%/lib/clang/%2%/include");
+   FilePath llvmPath = s_libraryPath.getParent();
+   boost::format fmt("%1%/clang/%2%/include");
    fmt % llvmPath.getAbsolutePath() % version.asString();
    std::string includePath = fmt.str();
-   if (FilePath(includePath).exists())
-     compileArgs.push_back(std::string("-I") + includePath);
+   compileArgs.push_back(std::string("-I") + includePath);
 
    return compileArgs;
 }
@@ -85,12 +84,9 @@ std::vector<std::string> systemClangVersions()
 #elif defined(__unix__)
    // default set of versions
    clangVersions = {
-      "/usr/lib/libclang.so",
-      "/usr/lib/llvm/libclang.so",
-      "/usr/lib64/libclang.so",
-      "/usr/lib64/llvm/libclang.so",
+      "LIBCLANG_PLACEHOLDER",
    };
-   
+#elif 0
    // iterate through the set of available 'llvm' directories
    for (const char* prefix : {"/usr/lib", "/usr/lib64"})
    {
-- 
2.28.0

