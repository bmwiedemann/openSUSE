From: Andreas Stieger <Andreas.Stieger@gmx.de>
Date: Sun, 08 Nov 2020 13:11:39 +0000
Subject: Support feedparser 6
References: https://github.com/rss2email/rss2email/issues/73 https://github.com/rss2email/rss2email/pull/149 https://bugzilla.opensuse.org/show_bug.cgi?id=1178085

Traceback (most recent call last):
  File "/usr/bin/r2e", line 5, in <module>
    rss2email.main.run()
  File "/usr/lib/python3.8/site-packages/rss2email/main.py", line 186, in run
    args.func(feeds=feeds, args=args)
  File "/usr/lib/python3.8/site-packages/rss2email/command.py", line 90, in run
    feed.run(send=args.send)
  File "/usr/lib/python3.8/site-packages/rss2email/feed.py", line 912, in run
    for (guid, state, sender, message) in self._process(parsed):
  File "/usr/lib/python3.8/site-packages/rss2email/feed.py", line 381, in _process
    self._check_for_errors(parsed)
  File "/usr/lib/python3.8/site-packages/rss2email/feed.py", line 436, in _check_for_errors
    elif isinstance(exc, _feedparser.zlib.error):
AttributeError: module 'feedparser' has no attribute 'zlib'

Index: rss2email-3.12.2/rss2email/feed.py
===================================================================
--- rss2email-3.12.2.orig/rss2email/feed.py
+++ rss2email-3.12.2/rss2email/feed.py
@@ -433,7 +433,7 @@ class Feed (object):
         elif isinstance(exc, _SOCKET_ERRORS):
             _LOG.error('{}: {}'.format(exc, self))
             warned = True
-        elif isinstance(exc, _feedparser.zlib.error):
+        elif isinstance(exc, _feedparser.http.zlib.error):
             _LOG.error('broken compression: {}'.format(self))
             warned = True
         elif isinstance(exc, (IOError, AttributeError)):
Index: rss2email-3.12.2/requirements.txt
===================================================================
--- rss2email-3.12.2.orig/requirements.txt
+++ rss2email-3.12.2/requirements.txt
@@ -1,2 +1,2 @@
-feedparser==5.2.1
+feedparser>=6.0.0
 html2text==2020.1.16
Index: rss2email-3.12.2/setup.py
===================================================================
--- rss2email-3.12.2.orig/setup.py
+++ rss2email-3.12.2/setup.py
@@ -65,7 +65,7 @@ setuptools.setup(
     scripts=['r2e'],
     provides=['rss2email'],
     install_requires=[
-        'feedparser>=5.0.1',
+        'feedparser>=6.0.0',
         'html2text>=3.0.1',
         ],
     )
Index: rss2email-3.12.2/test/data/disqus/1.expected
===================================================================
--- rss2email-3.12.2.orig/test/data/disqus/1.expected
+++ rss2email-3.12.2/test/data/disqus/1.expected
@@ -43,7 +43,7 @@ User-Agent: rss2email/...
 List-ID: <test.localhost>
 List-Post: NO (posting not allowed on this list)
 X-RSS-Feed: data/disqus/feed.rss
-X-RSS-ID: ab03f2100069a1cd0876b997be87976c18d48e8a
+X-RSS-ID: a52375ec78a988241fe9864a2243d4d910538d52
 X-RSS-URL: http://software-carpentry.org/2012/11/who-wants-to-write-a-little-code/#comment-713578640
 
 @Hans-Martin  
