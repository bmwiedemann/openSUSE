--- jna-4.5.1/native/testlib.c~	2017-12-27 20:27:16.000000000 +0100
+++ jna-4.5.1/native/testlib.c	2018-06-13 20:48:41.724621101 +0200
@@ -796,8 +796,8 @@
 }
 
 EXPORT callback_t
-callCallbackWithCallback(cb_callback_t cb) {
-  return (*cb)((callback_t)cb);
+callCallbackWithCallback(cb_callback_t cb, callback_t arg) {
+  return (*cb)(arg);
 }
 
 static int32_t 
--- jna-4.5.1/test/com/sun/jna/CallbacksTest.java~	2017-12-27 20:27:16.000000000 +0100
+++ jna-4.5.1/test/com/sun/jna/CallbacksTest.java	2018-06-13 20:49:38.461620074 +0200
@@ -191,9 +191,9 @@
         int callCallbackWithByReferenceArgument(CopyArgToByReference cb, int arg, IntByReference result);
         TestStructure.ByValue callCallbackWithStructByValue(TestStructure.TestCallback callback, TestStructure.ByValue cbstruct);
         interface CbCallback extends Callback {
-            CbCallback callback(CbCallback arg);
+            Callback callback(Callback arg);
         }
-        CbCallback callCallbackWithCallback(CbCallback cb);
+        Callback callCallbackWithCallback(CbCallback cb, Callback arg);
 
         interface Int32CallbackX extends Callback {
             public int callback(int arg);
--- jna-4.5.1/test/com/sun/jna/DirectCallbacksTest.java~	2017-12-27 20:27:16.000000000 +0100
+++ jna-4.5.1/test/com/sun/jna/DirectCallbacksTest.java	2018-06-13 20:50:42.942752879 +0200
@@ -65,7 +65,7 @@
         @Override
         public native TestStructure.ByValue callCallbackWithStructByValue(TestStructure.TestCallback callback, TestStructure.ByValue cbstruct);
         @Override
-        public native CbCallback callCallbackWithCallback(CbCallback cb);
+        public native Callback callCallbackWithCallback(CbCallback cb, Callback arg);
         @Override
         public native Int32CallbackX returnCallback();
         @Override
--- jna-4.5.1/test/com/sun/jna/CallbacksTest.java~	2018-06-13 20:49:38.461620074 +0200
+++ jna-4.5.1/test/com/sun/jna/CallbacksTest.java	2018-06-13 20:52:51.645006532 +0200
@@ -840,7 +840,7 @@
                 return arg;
             }
         };
-        TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb);
+        TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb, cb);
         assertEquals("Callback reference should be reused", cb, cb2);
     }
 
@@ -856,7 +856,7 @@
                     throw ERROR;
                 }
             };
-            TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb);
+            TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb, cb);
             String output = s.toString();
             assertTrue("Default handler not called", output.length() > 0);
         }
@@ -887,7 +887,7 @@
                     throw ERROR;
                 }
             };
-            TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb);
+            TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb, cb);
             assertNotNull("Exception handler not called", CALLBACK[0]);
             assertEquals("Wrong callback argument to handler", cb, CALLBACK[0]);
             assertEquals("Wrong exception passed to handler",
@@ -932,7 +932,7 @@
                 }
             };
             TestLibrary.CbCallback cb = new TestProxy();
-            TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb);
+            TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb, cb);
             assertNotNull("Exception handler not called", CALLBACK[0]);
             assertEquals("Wrong callback argument to handler", cb, CALLBACK[0]);
             assertEquals("Wrong exception passed to handler",
--- jna-4.5.1/test/com/sun/jna/CallbacksTest.java~	2018-06-13 20:52:51.645006532 +0200
+++ jna-4.5.1/test/com/sun/jna/CallbacksTest.java	2018-06-13 20:56:38.888929160 +0200
@@ -840,7 +840,7 @@
                 return arg;
             }
         };
-        TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb, cb);
+        TestLibrary.Callback cb2 = lib.callCallbackWithCallback(cb, cb);
         assertEquals("Callback reference should be reused", cb, cb2);
     }
 
@@ -856,7 +856,7 @@
                     throw ERROR;
                 }
             };
-            TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb, cb);
+            TestLibrary.Callback cb2 = lib.callCallbackWithCallback(cb, cb);
             String output = s.toString();
             assertTrue("Default handler not called", output.length() > 0);
         }
@@ -887,7 +887,7 @@
                     throw ERROR;
                 }
             };
-            TestLibrary.CbCallback cb2 = lib.callCallbackWithCallback(cb, cb);
+            TestLibrary.Callback cb2 = lib.callCallbackWithCallback(cb, cb);
             assertNotNull("Exception handler not called", CALLBACK[0]);
             assertEquals("Wrong callback argument to handler", cb, CALLBACK[0]);
             assertEquals("Wrong exception passed to handler",
