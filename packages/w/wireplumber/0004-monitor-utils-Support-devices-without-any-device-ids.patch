From 0d356f90ed9fbdb168b6294aae2c049f4dfb6d92 Mon Sep 17 00:00:00 2001
From: Robert Mader <robert.mader@collabora.com>
Date: Tue, 1 Apr 2025 14:37:17 +0200
Subject: [PATCH] monitor-utils: Support devices without any device ids

Such as libcameras virtual devices.
---
 src/scripts/lib/monitor-utils.lua | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/src/scripts/lib/monitor-utils.lua b/src/scripts/lib/monitor-utils.lua
index 3e409cab..410d495c 100644
--- a/src/scripts/lib/monitor-utils.lua
+++ b/src/scripts/lib/monitor-utils.lua
@@ -135,8 +135,6 @@ end
 function mutils.register_cam_node (self, parent, id, factory, properties)
   local obj_path = properties["object.path"]
   local api = properties["device.api"]
-  local dev_ids = properties["device.devids"]
-  log:debug(api .. " reported device " .. obj_path .. " with device ids " .. dev_ids)
 
   -- cache info, it comes handy when creating node
   local cam_data = {}
@@ -146,6 +144,14 @@ function mutils.register_cam_node (self, parent, id, factory, properties)
   cam_data.factory = factory
   cam_data.properties = properties
 
+  local dev_ids = properties["device.devids"]
+  if not dev_ids then
+    log:debug(api .. " reported device " .. obj_path .. " without device ids")
+    create_cam_node(cam_data)
+    return
+  end
+
+  log:debug(api .. " reported device " .. obj_path .. " with device ids " .. dev_ids)
   table.insert(self.cam_data, cam_data)
 
   if self.cam_source then
-- 
GitLab

