From 1ddfbc532c87fb0ad18e128d574e5c3b72089416 Mon Sep 17 00:00:00 2001
From: Barnabas Pocze <pobrn@protonmail.com>
Date: Sat, 18 May 2024 00:46:58 +0200
Subject: [PATCH 4/7] transition: fix memory leak when error is already set

Fixes: 18377fbf829ff2 ("transition: don't allow _return_error() to be called recursively")
---
 lib/wp/transition.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/lib/wp/transition.c b/lib/wp/transition.c
index 547f555f0..0538208f4 100644
--- a/lib/wp/transition.c
+++ b/lib/wp/transition.c
@@ -493,6 +493,7 @@ wp_transition_return_error (WpTransition * self, GError * error)
   if (G_UNLIKELY (priv->error)) {
     wp_warning_object (self, "transition bailing out multiple times; "
         "new error is: %s", error->message);
+    g_error_free (error);
     return;
   }
 
-- 
2.45.1

