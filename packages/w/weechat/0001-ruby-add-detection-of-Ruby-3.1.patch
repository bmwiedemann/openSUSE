From b32059638933d2c958961dae396fe4a5a0c2e784 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?S=C3=A9bastien=20Helleu?= <flashcode@flashtux.org>
Date: Tue, 8 Feb 2022 12:41:32 +0100
Subject: [PATCH] ruby: add detection of Ruby 3.1

---
 cmake/FindRuby.cmake | 2 +-
 configure.ac         | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/cmake/FindRuby.cmake b/cmake/FindRuby.cmake
index f874453..407a8a8 100644
--- a/cmake/FindRuby.cmake
+++ b/cmake/FindRuby.cmake
@@ -37,7 +37,7 @@ if(PKG_CONFIG_FOUND)
     # set specific search path for macOS
     set(ENV{PKG_CONFIG_PATH} "$ENV{PKG_CONFIG_PATH}:/usr/local/opt/ruby/lib/pkgconfig")
   endif()
-  pkg_search_module(RUBY ruby-3.0 ruby-2.7 ruby-2.6 ruby-2.5 ruby-2.4 ruby-2.3 ruby-2.2 ruby-2.1 ruby-2.0 ruby-1.9 ruby)
+  pkg_search_module(RUBY ruby-3.1 ruby-3.0 ruby-2.7 ruby-2.6 ruby-2.5 ruby-2.4 ruby-2.3 ruby-2.2 ruby-2.1 ruby-2.0 ruby-1.9 ruby)
   if(RUBY_FOUND AND ${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
     # FIXME: weird hack: hardcoding the Ruby lib location on macOS
     set(RUBY_LDFLAGS "${RUBY_LDFLAGS} -L/usr/local/opt/ruby/lib")
diff --git a/configure.ac b/configure.ac
index 75fa0b4..de2750a 100644
--- a/configure.ac
+++ b/configure.ac
@@ -501,7 +501,7 @@ RUBY_VERSION=
 if test "x$enable_ruby" = "xyes" ; then
     RUBY_CFLAGS=""
     RUBY_LFLAGS=""
-    for v in "3.0" "2.7" "2.6" "2.5" "2.4" "2.3" "2.2" "2.1" "2.0" "1.9" "1.8" ; do
+    for v in "3.1" "3.0" "2.7" "2.6" "2.5" "2.4" "2.3" "2.2" "2.1" "2.0" "1.9" "1.8" ; do
         pkgconfig_ruby_found=`$PKGCONFIG --exists ruby-$v 2>/dev/null`
         if test "x$?" = "x0" ; then
             RUBY_VERSION=`$PKGCONFIG --modversion ruby-$v`
-- 
2.35.1

