diff --git a/src/nautilus-dropbox.c b/src/nautilus-dropbox.c
index c75ccbf..f554be3 100644
--- a/src/nautilus-dropbox.c
+++ b/src/nautilus-dropbox.c
@@ -808,11 +808,19 @@ remove_emblem_paths(GHashTable* emblem_paths_response)
   gchar ** paths;
   gint path_count;
 
+#if GTK_MAJOR_VERSION >= 4
+  paths = gtk_icon_theme_get_search_path(icon_theme);
+#else
   gtk_icon_theme_get_search_path(icon_theme, &paths, &path_count);
+#endif
 
   gint i, j, out = 0;
   gboolean found = FALSE;
+#if GTK_MAJOR_VERSION >= 4
+  for (i = 0; paths[i]; i++) {
+#else
   for (i = 0; i < path_count; i++) {
+#endif
       gboolean keep = TRUE;
       for (j = 0; emblem_paths_list[j] != NULL; j++) {
 	  if (emblem_paths_list[j][0]) {
@@ -834,7 +842,11 @@ remove_emblem_paths(GHashTable* emblem_paths_response)
      accomodate the changes */
   if (found) {
     paths[out] = NULL; /* Clear the last one */
+#if GTK_MAJOR_VERSION >= 4
+    gtk_icon_theme_set_search_path(icon_theme, (const gchar **)paths);
+#else
     gtk_icon_theme_set_search_path(icon_theme, (const gchar **)paths, out);
+#endif
   }
 
   g_strfreev(paths);
