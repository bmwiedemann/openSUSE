From bef81a09e0af1033bd3daac8441e094d9068877a Mon Sep 17 00:00:00 2001
From: Christophe Giboudeaux <christophe@krop.fr>
Date: Sat, 27 Apr 2019 19:50:04 +0200
Subject: [PATCH] Adapt scidavis for openSUSE

- install the python config file to /etc/scidavis/
- Add a (working) option to fix the lib vs. lib64 installation
- Update paths for the current qwt5-qt5 and qwtplot3d-qt5 packages
- Fix the Qt5 linguist executable names
---
 config.pri                                    | 21 ++++++++++---------
 fitPlugins/exp_saturation/exp_saturation.pro  |  1 -
 fitPlugins/explin/explin.pro                  |  1 -
 fitPlugins/fitRational0/fitRational0.pro      |  1 -
 fitPlugins/fitRational1/fitRational1.pro      |  1 -
 .../planck_wavelength/planck_wavelength.pro   |  1 -
 libscidavis/libscidavis.pro                   |  1 -
 7 files changed, 11 insertions(+), 16 deletions(-)

diff --git a/config.pri b/config.pri
index 377a0a3..35028d8 100644
--- a/config.pri
+++ b/config.pri
@@ -74,6 +74,11 @@ unix:message(Building with preset $$PRESET)
 ###            and/or copy files to the desired locations by other means.      #
 ################################################################################
 
+### 64bit Linux only suffix
+contains(64BITS, 1) { libsuff=64 }
+
+unix:LIBS         += -L/usr/lib$${libsuff}
+
 unix {# Linux / MacOS X
 	contains(PRESET, self_contained) {
       ### Unless you're trying to build a self-contained bundle, see the
@@ -120,12 +125,12 @@ unix {# Linux / MacOS X
 		### directory specified here or somewhere else in the python path (sys.path) where "import" can find it
 
 		### where scidavisrc.py is searched for at runtime
-		pythonconfig.path = "$$INSTALLBASE/../etc"
+		pythonconfig.path = "$$INSTALLBASE/../etc/scidavis"
 		### where the scidavisUtil python module is searched for at runtime
 		pythonutils.path = "$$INSTALLBASE/share/scidavis"
 
 		### where plugins are expected by default
-		plugins.path = "$$INSTALLBASE/lib/scidavis/plugins"
+		plugins.path = "$$INSTALLBASE/lib$${libsuff}/scidavis/plugins"
 	}
 	
 ###################### DESKTOP INTEGRATION ##################################	
@@ -181,10 +186,6 @@ win32 {# Windows
 	plugins.path = "$$INSTALLBASE/fitPlugins"
 }
 
-### 64bit Linux only suffix
-linux-g++-64: libsuff = 64 
-unix:LIBS         += -L/usr/lib$${libsuff}
-
 ################################################################################
 ### Optional features                                                          #
 ################################################################################
@@ -283,8 +284,8 @@ contains(PRESET, linux_package) {
 	### cause problems.
 
     equals(QT_MAJOR_VERSION, 5) {
-        exists(/usr/include/qt5/qwt5-qt5)      {INCLUDEPATH+=/usr/include/qt5/qwt5-qt5}
-        exists(/usr/include/qt5/qwtplot3d-qt5) {INCLUDEPATH+=/usr/include/qt5/qwtplot3d-qt5}
+        exists(/usr/include/qt5/qwt5)      {INCLUDEPATH+=/usr/include/qt5/qwt5}
+        exists(/usr/include/qt5/qwtplot3d) {INCLUDEPATH+=/usr/include/qt5/qwtplot3d}
 
         system (ls /usr/lib*/libqwt5-qt5.so) {
             LIBS+=-lqwt5-qt5
@@ -405,7 +406,7 @@ exists(/usr/bin/lupdate-qt4) {
 	LRELEASE_BIN = lrelease-qt4
 } else {
 	# anything else
-	LUPDATE_BIN = lupdate
-	LRELEASE_BIN = lrelease
+	LUPDATE_BIN = lupdate-qt5
+	LRELEASE_BIN = lrelease-qt5
 }
 
diff --git a/fitPlugins/exp_saturation/exp_saturation.pro b/fitPlugins/exp_saturation/exp_saturation.pro
index 200c14b..a4a50e1 100644
--- a/fitPlugins/exp_saturation/exp_saturation.pro
+++ b/fitPlugins/exp_saturation/exp_saturation.pro
@@ -1,5 +1,4 @@
 QMAKE_PROJECT_DEPTH = 0
-linux-g++-64: libsuff=64
 
 include(../../config.pri)
 TARGET = exp_saturation
diff --git a/fitPlugins/explin/explin.pro b/fitPlugins/explin/explin.pro
index 67475e2..a633270 100644
--- a/fitPlugins/explin/explin.pro
+++ b/fitPlugins/explin/explin.pro
@@ -1,5 +1,4 @@
 QMAKE_PROJECT_DEPTH = 0
-linux-g++-64: libsuff=64
 
 include(../../config.pri)
 TARGET = explin
diff --git a/fitPlugins/fitRational0/fitRational0.pro b/fitPlugins/fitRational0/fitRational0.pro
index fdc4373..1e30591 100644
--- a/fitPlugins/fitRational0/fitRational0.pro
+++ b/fitPlugins/fitRational0/fitRational0.pro
@@ -1,5 +1,4 @@
 QMAKE_PROJECT_DEPTH = 0
-linux-g++-64: libsuff=64
 
 include(../../config.pri)
 TARGET            = fitRational0
diff --git a/fitPlugins/fitRational1/fitRational1.pro b/fitPlugins/fitRational1/fitRational1.pro
index e632e78..9a04421 100644
--- a/fitPlugins/fitRational1/fitRational1.pro
+++ b/fitPlugins/fitRational1/fitRational1.pro
@@ -1,5 +1,4 @@
 QMAKE_PROJECT_DEPTH = 0
-linux-g++-64: libsuff=64
 
 include(../../config.pri)
 TARGET            = fitRational1
diff --git a/fitPlugins/planck_wavelength/planck_wavelength.pro b/fitPlugins/planck_wavelength/planck_wavelength.pro
index ae22122..a7201d2 100644
--- a/fitPlugins/planck_wavelength/planck_wavelength.pro
+++ b/fitPlugins/planck_wavelength/planck_wavelength.pro
@@ -1,5 +1,4 @@
 QMAKE_PROJECT_DEPTH = 0
-linux-g++-64: libsuff=64
 
 include(../../config.pri)
 TARGET = planck_wavelength
diff --git a/libscidavis/libscidavis.pro b/libscidavis/libscidavis.pro
index 51dbf79..0a4762b 100644
--- a/libscidavis/libscidavis.pro
+++ b/libscidavis/libscidavis.pro
@@ -47,6 +47,5 @@ include( muparser.pri )
 python {include( python.pri )}
 
 
-
 #############################################################################
 #############################################################################
-- 
2.21.0

