From 98d8547cc3abfbb2a1fb2aad1f11f05a9d394636 Mon Sep 17 00:00:00 2001
From: Stasiek Michalski <hellcp@opensuse.org>
Date: Thu, 24 Jan 2019 16:14:39 +0100
Subject: [PATCH] zypp: Switch to doUpgrade solver when required by
 distribution

---
 backends/zypp/pk-backend-zypp.cpp | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/backends/zypp/pk-backend-zypp.cpp b/backends/zypp/pk-backend-zypp.cpp
index 77fc69639..b607d5632 100644
--- a/backends/zypp/pk-backend-zypp.cpp
+++ b/backends/zypp/pk-backend-zypp.cpp
@@ -3297,6 +3297,14 @@ backend_update_packages_thread (PkBackendJob *job, GVariant *params, gpointer us
 	ResPool pool = zypp_build_pool (zypp, TRUE);
 	PkRestartEnum restart = PK_RESTART_ENUM_NONE;
 
+	for ( const PoolItem & pi : pool.byKind<Product>() ) {
+		static const Capability indicator( "product-update()", Rel::EQ, "dup" );
+		if ( pi->asKind<Product>()->referencePackage().provides().matches( indicator ) ) {
+			zypp->resolver()->setUpgradeMode(TRUE);
+			break;
+		}
+	}
+
 	PoolStatusSaver saver;
 
 	for (guint i = 0; package_ids[i]; i++) {
